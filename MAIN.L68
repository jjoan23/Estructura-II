0000189E Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 23/12/2024 10:47:12

00000000                             1  *-----------------------------------------------------------------------------
00000000                             2  * Title      : MAIN
00000000                             3  * Written by :
00000000                             4  * Date       :
00000000                             5  * Description:
00000000                             6  *-----------------------------------------------------------------------------
00000000                             7  
00001000                             8              ORG    $1000
00001000                             9              
00001000                            10              INCLUDE 'CONST.X68'
00001000                            11  ; ----------------------------------------------------------------------------
00001000                            12  ; CONSTANTES DEL JUEGO
00001000                            13  ; ----------------------------------------------------------------------------
00001000                            14     
00001000                            15  ; --- CONSTANTES DE LA MANZANA -----------------------------------------------
00001000                            16  
00001000  =00000014                 17  MNZWIDTH    EQU     20                      ; ANCHURA DE LA MANZANA (a determinar)
00001000  =00000014                 18  MNZHEIGH    EQU     20                      ; ALTURA DE LA MANZANA (a determinar)
00001000  =0000AAFF                 19  MNZPCOL     EQU     $0000AAFF               ; COLOR CONTORNO MANZANA (a determinar)
00001000  =000000FF                 20  MNZFCOL     EQU     $000000FF               ; COLOR RELLENO MANZANA (a determinar)
00001000                            21  
00001000                            22  ; --- CONSTANTES DE LA SERPIENTE ---------------------------------------------
00001000                            23  
00001000  =00000001                 24  MAXSGM      EQU     1                       ; TAMAÑO MÁXIMO DE SEGMENTOS (a determinar)
00001000  =00000001                 25  LNGINI      EQU     1                       ; LONGITUD INICIAL SERPIENTE (a determinar)
00001000  =00000014                 26  SGMWIDTH    EQU     20                      ; ANCHURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 27  SGMHEIGH    EQU     20                      ; ALTURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 28  CBZVEL      EQU     20                      ; VELOCIDAD DE LA CABEZA (a determinar)
00001000  =0000FF00                 29  SGMPCOL     EQU     $0000FF00               ; COLOR CONTORNO SEGMENTO (PROVISIONAL)
00001000  =0000AA00                 30  SGMFCOL     EQU     $0000AA00               ; COLOR RELLENO SEGMENTO (PROVISIONAL)
00001000  =0000000A                 31  COLWIDTH    EQU     10                      ; ANCHURA DE LA COLA (PROVISIONAL)
00001000  =0000000A                 32  COLHEIGH    EQU     10                      ; ALTURA DE LA COLA (PROVISIONAL)
00001000  =0000FF00                 33  COLPCOL     EQU     $0000FF00               ; COLOR CONTORNO COLA (PROVISIONAL)
00001000  =0000AA00                 34  COLFCOL     EQU     $0000AA00               ; COLOR RELLENO COLA (PROVISIONAL)
00001000  =00000014                 35  CBZWIDTH    EQU     20                      ; ANCHURA DE LA CABEZA (PROVISIONAL)
00001000  =00000014                 36  CBZHEIGH    EQU     20                      ; ALTURA DE LA CABEZA (PROVISIONAL)
00001000  =0000FF00                 37  CBZPCOL     EQU     $0000FF00               ; COLOR CONTORNO CABEZA (PROVISIONAL)
00001000  =0000AA00                 38  CBZFCOL     EQU     $0000AA00               ; COLOR RELLENO CABEZA (PROVISIONAL)
00001000  =0000000A                 39  OJOWIDTH    EQU     10                      ; ANCHURA DE OJO DE SERPIENTE
00001000  =0000000A                 40  OJOHEIGH    EQU     10                      ; ALTURA DE OJO DE SERPIENTE
00001000  =00000000                 41  OJOPCOL     EQU     $00000000               ; COLOR CONTORNO OJO
00001000  =00FFFFFF                 42  OJOFCOL     EQU     $00FFFFFF               ; COLOR RELLENO OJO
00001000                            43  
00001000                            44  
00001000                            45  
00001000                            46  ; --- CONSTANTES MARCADOR ----------------------------------------------------
00001000                            47  
00001000  =00000000                 48  PNTSFCOL    EQU     $00000000               ; COLOR FONDO MARCADOR (a determinar)
00001000  =00000065                 49  PNTSTEXT    EQU     0101                    ; COORDENADAS DEL MARCADOR (a determinar)
00001000                            50  
00001000                            51  
00001000                            52  
00001000                            53  
00001000                            54  
00001000                            55  
00001000                            56  
00001000                            57  -------------------- end include --------------------
00001000                            58              INCLUDE 'SYSCONST.X68'
00001000                            59  ; ----------------------------------------------------------------------------
00001000                            60  ; CONSTANTES DEL SISTEMA
00001000                            61  ; ----------------------------------------------------------------------------
00001000                            62  
00001000                            63  ; ---CONSTANTES DE LA PANTALLA------------------------------------------------
00001000                            64  
00001000  =00000280                 65  PANWIDTH    EQU     640                     ; ANCHO DE LA PANTALLA
00001000  =000001E0                 66  PANHEIGH    EQU     480                     ; ALTURA DE LA PANTALLA
00001000  =0090EE90                 67  COLFND      EQU     $90EE90                 ; COLOR DEL FONDO DE LA PANTALLA
00001000                            68  
00001000                            69  ; ---CONSTANTES DE LA MATRIZ--------------------------------------------------
00001000                            70  
00001000  =00000014                 71  SIZECLDA    EQU     20                      ; TAMAÑO DE CADA CELDA EN PIXELES
00001000  =00000020                 72  NUMCLMNS    EQU     32                      ; COLUMNAS DE CELDAS (640/10)
00001000  =00000018                 73  NUMFILAS    EQU     24                      ; FILAS DE CELDAS (480/10)
00001000  =00000300                 74  TCELDAS     EQU     768                     ; TOTAL DE CELDAS (64 * 48)
00001000                            75  
00001000                            76  ; ---CÓDIGOS DE TECLADO-------------------------------------------------------
00001000                            77  
00001000  =00000025                 78  KBDLEFT     EQU     $25
00001000  =00000026                 79  KBDUP       EQU     $26
00001000  =00000027                 80  KBDRIGHT    EQU     $27
00001000  =00000028                 81  KBDDOWN     EQU     $28
00001000                            82  
00001000                            83  
00001000                            84  -------------------- end include --------------------
00001000                            85              INCLUDE 'SYSTEM.X68'
00001000                            86   
00001000                            87   
00001000                            88  SYSINIT
00001000                            89  ; INICIA EL  SISTEMA
00001000                            90  ; INPUT    : NONE
00001000                            91  ; OUTPUT   : NONE
00001000                            92  ; MODIFIES : NONE
00001000                            93  ; ----------------------------------------------------------------------------
00001000  4EB9 0000101E             94              JSR     SCRINIT
00001006                            95              
00001006  21FC 0000104C 0080        96              MOVE.L  #SCRPLOT,($80)
0000100E  21FC 00001074 0084        97              MOVE.L  #KBDUPD,($84)
00001016                            98              
00001016  40E7                      99              MOVE.W  SR,-(A7)
00001018  0257 DFFF                100              ANDI.W  #$DFFF,(A7)
0000101C                           101              
0000101C  4E73                     102              RTE
0000101E                           103              
0000101E                           104  ; ------------------------------------------------------------------------------
0000101E                           105  SCRINIT
0000101E                           106  ; INIT SCREEN. SET SCREEN RESOLUTION, SET WINDOWED MODE, CLEAR SCREEN,
0000101E                           107  ; ENABLE DOUBLE BUFFER.
0000101E                           108  ; INPUT    : NONE
0000101E                           109  ; OUTPUT   : NONE
0000101E                           110  ; MODIFIES : NONE
0000101E                           111  ; ------------------------------------------------------------------------------
0000101E                           112  
0000101E  48E7 C000                113              MOVEM.L D0-D1,-(A7)
00001022                           114  
00001022                           115              ; SET SCREEN RESOLUTION
00001022  103C 0021                116              MOVE.B  #33,D0
00001026  223C 028001E0            117              MOVE.L  #PANWIDTH<<16|PANHEIGH,D1
0000102C  4E4F                     118              TRAP    #15
0000102E                           119              
0000102E                           120              ; SET WINDOWED MODE
0000102E  7201                     121              MOVE.L  #1,D1
00001030  4E4F                     122              TRAP    #15
00001032                           123              
00001032                           124              ; CLEAR SCREEN
00001032  103C 000B                125              MOVE.B  #11,D0
00001036  323C FF00                126              MOVE.W  #$FF00,D1
0000103A  4E4F                     127              TRAP    #15
0000103C                           128              
0000103C                           129              ; ENABLE DOUBLE BUFFER
0000103C  103C 005C                130              MOVE.B  #92,D0
00001040  123C 0011                131              MOVE.B  #17,D1
00001044  4E4F                     132              TRAP    #15
00001046                           133              
00001046  4CDF 0003                134              MOVEM.L (A7)+,D0-D1
0000104A                           135              
0000104A  4E75                     136              RTS    
0000104C                           137  
0000104C                           138  ; ------------------------------------------------------------------------------
0000104C                           139  SCRPLOT
0000104C                           140  ; UPDATES DOUBLE BUFFER
0000104C                           141  ; INPUT    : NONE
0000104C                           142  ; OUTPUT   : NONE
0000104C                           143  ; MODIFIES : NONE
0000104C                           144  ; ------------------------------------------------------------------------------
0000104C                           145  
0000104C  48A7 C000                146              MOVEM.W D0-D1,-(A7)
00001050                           147              
00001050                           148              ; SWITCH BUFFERS
00001050  103C 005E                149              MOVE.B  #94,D0
00001054  4E4F                     150              TRAP    #15
00001056                           151              
00001056                           152              ; CLEAR HIDDEN BUFFER
00001056  103C 000B                153              MOVE.B  #11,D0
0000105A  323C FF00                154              MOVE.W  #$FF00,D1
0000105E  4E4F                     155              TRAP    #15
00001060                           156              
00001060  4C9F 0003                157              MOVEM.W (A7)+,D0-D1
00001064                           158              
00001064  4E73                     159              RTE
00001066                           160          
00001066                           161  ; ------------------------------------------------------------------------------
00001066                           162  KBDINIT
00001066                           163  ; INIT KEYBOARD
00001066                           164  ; INPUT    : NONE
00001066                           165  ; OUTPUT   : NONE
00001066                           166  ; MODIFIES : NONE
00001066                           167  ; ------------------------------------------------------------------------------
00001066                           168  
00001066  4239 00001C17            169              CLR.B   (KBDVAL)
0000106C  4239 00001C18            170              CLR.B   (KBDEDGE)
00001072  4E75                     171              RTS
00001074                           172  
00001074                           173  ; ------------------------------------------------------------------------------
00001074                           174  KBDUPD
00001074                           175  ; UPDATE KEYBOARD INFO.  
00001074                           176  ; 7 -> PAUSE
00001074                           177  ; 6 -> FIRE 3
00001074                           178  ; 5 -> FIRE 2
00001074                           179  ; 4 -> FIRE 1
00001074                           180  ; 3 -> DOWN
00001074                           181  ; 2 -> RIGHT
00001074                           182  ; 1 -> UP
00001074                           183  ; 0 -> LEFT
00001074                           184  ; INPUT    : NONE
00001074                           185  ; OUTPUT   : NONE
00001074                           186  ; MODIFIES : NONE
00001074                           187  ; ------------------------------------------------------------------------------
00001074                           188  
00001074  48E7 F000                189              MOVEM.L D0-D3,-(A7)
00001078                           190  
00001078                           191              ; LEE ESTADO DEL TECLADO
00001078  103C 0013                192              MOVE.B  #19,D0
0000107C  223C 25262728            193              MOVE.L  #KBDLEFT<<24|KBDUP<<16|KBDRIGHT<<8|KBDDOWN,D1
00001082  4E4F                     194              TRAP    #15                  ; Lee las teclas y guarda en D1
00001084                           195  
00001084                           196              ; CONVERT TO DESIRED FORMAT
00001084  363C 0003                197              MOVE.W  #3,D3
00001088  4282                     198              CLR.L   D2
0000108A  E189                     199  .LOOP       LSL.L   #8,D1
0000108C  E312                     200              ROXL.B  #1,D2
0000108E  51CB FFFA                201              DBRA.W  D3,.LOOP
00001092                           202  
00001092                           203              ; PROCESA FLANCOS ASCENDENTES
00001092  1039 00001C17            204              MOVE.B  (KBDVAL),D0         ; Estado anterior
00001098  4600                     205              NOT.B   D0                   ; Invertir bits (teclas no presionadas)
0000109A  C002                     206              AND.B   D2,D0                ; Detectar flancos ascendentes
0000109C  13C0 00001C18            207              MOVE.B  D0,(KBDEDGE)         ; Almacena los flancos en KBDEDGE
000010A2                           208              
000010A2                           209              
000010A2                           210              ; ACTUALIZA EL ESTADO DE LA DIRECCIÓN
000010A2  1039 00001C18            211              MOVE.B  (KBDEDGE),D0         ; Lee teclas con flanco ascendente
000010A8                           212  
000010A8                           213              ; Detecta pulsaciones y actualiza ESTDCBZ
000010A8  0800 0000                214              BTST    #0,D0                  ; Verifica si la tecla IZQUIERDA está pulsada
000010AC  6700 000E                215              BEQ     CHKARR
000010B0  33FC 0002 00001C16       216              MOVE.W  #2,(ESTDCBZ)           ; Actualiza a IZQUIERDA
000010B8  6000 003A                217              BRA     CONTINU
000010BC                           218  
000010BC                           219  CHKARR:
000010BC  0800 0001                220              BTST    #1,D0                  ; Verifica si la tecla ARRIBA está pulsada
000010C0  6700 000E                221              BEQ     CHKDER
000010C4  33FC 0001 00001C16       222              MOVE.W  #1,(ESTDCBZ)           ; Actualiza a ARRIBA
000010CC  6000 0026                223              BRA     CONTINU
000010D0                           224  
000010D0                           225  CHKDER:
000010D0  0800 0002                226              BTST    #2,D0                  ; Verifica si la tecla DERECHA está pulsada
000010D4  6700 000E                227              BEQ     CHKDWN
000010D8  33FC 0000 00001C16       228              MOVE.W  #0,(ESTDCBZ)           ; Actualiza a DERECHA
000010E0  6000 0012                229              BRA     CONTINU
000010E4                           230  
000010E4                           231  CHKDWN:
000010E4  0800 0003                232              BTST    #3,D0                  ; Verifica si la tecla ABAJO está pulsada
000010E8  6700 000A                233              BEQ     CONTINU
000010EC  33FC 0003 00001C16       234              MOVE.W  #3,(ESTDCBZ)           ; Actualiza a ABAJO
000010F4                           235              
000010F4                           236  
000010F4                           237  CONTINU:
000010F4                           238              ; STORE KBDEDGE
000010F4  13C2 00001C17            239              MOVE.B  D2,(KBDVAL)
000010FA  4CDF 000F                240              MOVEM.L (A7)+,D0-D3
000010FE  4E73                     241              RTE
00001100                           242  
00001100                           243  
00001100                           244  
00001100                           245  ; CODIGO ANTERIOR
00001100                           246  
00001100                           247  
00001100                           248  
00001100                           249  
00001100                           250  
00001100                           251  
00001100                           252  
00001100                           253  
00001100                           254  
00001100                           255  
00001100                           256  
00001100                           257  
00001100                           258  
00001100                           259  
00001100                           260  
00001100                           261  
00001100                           262  
00001100                           263  
00001100                           264  
00001100                           265  
00001100                           266  
00001100                           267  
00001100                           268  
00001100                           269  
00001100                           270  
00001100                           271  
00001100                           272  
00001100                           273  
00001100                           274  
00001100                           275  
00001100                           276  
00001100                           277  
00001100                           278  
00001100                           279  
00001100                           280  
00001100                           281  
00001100                           282  -------------------- end include --------------------
00001100                           283              INCLUDE 'LIB/UTLCODE.X68'
00001100                           284  ; =============================================================================
00001100                           285  ; UTILITY CODE
00001100                           286  ; =============================================================================
00001100                           287  
00001100                           288  ; -----------------------------------------------------------------------------
00001100                           289  UTLINIT
00001100                           290  ; INITIALIZES UTILITY CODE
00001100                           291  ; INPUT    - NONE
00001100                           292  ; OUTPUT   - NONE
00001100                           293  ; MODIFIES - NONE
00001100                           294  ; -----------------------------------------------------------------------------
00001100  48E7 C000                295              MOVEM.L D0-D1,-(A7)
00001104  103C 0008                296              MOVE.B  #8,D0
00001108  4E4F                     297              TRAP    #15
0000110A  13C1 00001914            298              MOVE.B  D1,(UTLRNDIX)
00001110  4CDF 0003                299              MOVEM.L (A7)+,D0-D1
00001114  4E75                     300              RTS
00001116                           301  
00001116                           302  ; -----------------------------------------------------------------------------
00001116                           303  UTLRAND
00001116                           304  ; PROVIDES A PSEUDO-RANDOM BYTE
00001116                           305  ; INPUT    - NONE
00001116                           306  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
00001116                           307  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001116                           308  ; -----------------------------------------------------------------------------
00001116  2F08                     309              MOVE.L  A0,-(A7)
00001118  41F9 00001134            310              LEA     .RANDVEC,A0
0000111E  4280                     311              CLR.L   D0
00001120  1039 00001914            312              MOVE.B  (UTLRNDIX),D0
00001126  1030 0800                313              MOVE.B  (A0,D0.L),D0
0000112A  5239 00001914            314              ADDQ.B  #1,(UTLRNDIX)
00001130  205F                     315              MOVE.L  (A7)+,A0
00001132  4E75                     316              RTS
00001134                           317  
00001134                           318  
00001134= A2 EE 9A 0C F5 24 ...    319  .RANDVEC    DC.B    162, 238, 154, 12 , 245, 36 , 32 , 103
0000113C= 2A A3 51 26 E0 AC ...    320              DC.B    42 , 163, 81 , 38 , 224, 172, 19 , 69
00001144= 75 51 CA FD 33 EB ...    321              DC.B    117, 81 , 202, 253, 51 , 235, 108, 154
0000114C= 60 CC E7 B8 9A EB ...    322              DC.B    96 , 204, 231, 184, 154, 235, 34 , 203
00001154= 1D 76 B5 95 B0 89 ...    323              DC.B    29 , 118, 181, 149, 176, 137, 62 , 108
0000115C= 39 15 48 C9 6E CA ...    324              DC.B    57 , 21 , 72 , 201, 110, 202, 159, 41
00001164= 43 E7 E2 7C 37 25 ...    325              DC.B    67 , 231, 226, 124, 55 , 37 , 84 , 62
0000116C= E9 94 CE E9 E4 52 ...    326              DC.B    233, 148, 206, 233, 228, 82 , 243, 78
00001174= 37 6D 9A 84 A2 28 ...    327              DC.B    55 , 109, 154, 132, 162, 40 , 30 , 39
0000117C= 19 E2 C6 77 80 D4 ...    328              DC.B    25 , 226, 198, 119, 128, 212, 232, 225
00001184= 0A 5A 32 67 33 C2 ...    329              DC.B    10 , 90 , 50 , 103, 51 , 194, 222, 40
0000118C= 59 80 DC 0E 57 FC ...    330              DC.B    89 , 128, 220, 14 , 87 , 252, 243, 252
00001194= 8A AB BC F7 07 4D ...    331              DC.B    138, 171, 188, 247, 7  , 77 , 29 , 234
0000119C= EF D5 77 6E 1E BB ...    332              DC.B    239, 213, 119, 110, 30 , 187, 131, 23
000011A4= D6 E0 2A 8F BD 28 ...    333              DC.B    214, 224, 42 , 143, 189, 40 , 212, 130
000011AC= 13 4F 66 EC 0A 64 ...    334              DC.B    19 , 79 , 102, 236, 10 , 100, 122, 188
000011B4= 56 52 9A 16 9B 90 ...    335              DC.B    86 , 82 , 154, 22 , 155, 144, 7  , 199
000011BC= 06 8A A4 F7 01 DA ...    336              DC.B    6  , 138, 164, 247, 1  , 218, 166, 82
000011C4= F2 E7 77 28 B1 76 ...    337              DC.B    242, 231, 119, 40 , 177, 118, 220, 102
000011CC= A4 42 E3 81 B1 67 ...    338              DC.B    164, 66 , 227, 129, 177, 103, 165, 108
000011D4= BF CE FA 16 BF 38 ...    339              DC.B    191, 206, 250, 22 , 191, 56 , 30 , 161
000011DC= D1 8B 50 0C 5F 49 ...    340              DC.B    209, 139, 80 , 12 , 95 , 73 , 168, 56
000011E4= DE 4C 14 A2 40 DC ...    341              DC.B    222, 76 , 20 , 162, 64 , 220, 93 , 12
000011EC= B6 9B 0A 38 5D AB ...    342              DC.B    182, 155, 10 , 56 , 93 , 171, 89 , 6
000011F4= E2 1B DD 75 15 82 ...    343              DC.B    226, 27 , 221, 117, 21 , 130, 101, 18
000011FC= 8A 26 51 30 9F 47 ...    344              DC.B    138, 38 , 81 , 48 , 159, 71 , 57 , 21
00001204= 1E 8A BB 71 C6 6E ...    345              DC.B    30 , 138, 187, 113, 198, 110, 185, 152
0000120C= 9F 47 E5 34 94 27 ...    346              DC.B    159, 71 , 229, 52 , 148, 39 , 77 , 6
00001214= 7D 06 D6 BA 30 0F ...    347              DC.B    125, 6  , 214, 186, 48 , 15 , 212, 22
0000121C= EC 7F 7E 03 CF 2D ...    348              DC.B    236, 127, 126, 3  , 207, 45 , 193, 2
00001224= 94 5B 23 F2 8B CD ...    349              DC.B    148, 91 , 35 , 242, 139, 205, 248, 237
0000122C= 74 33 EC B9 0F D5 ...    350              DC.B    116, 51 , 236, 185, 15 , 213, 221, 6
0000122C= 74 33 EC B9 0F D5 ...    351  -------------------- end include --------------------
00001234                           352              INCLUDE 'HEADSRP.X68'
00001234                           353  
00001234                           354  ; ------------------------------------------------------------------------------
00001234                           355  HEADINIT
00001234                           356  ; INICIALIZAR CABEZA.
00001234                           357  ; INPUT    : NONE 
00001234                           358  ; OUTPUT   : NONE
00001234                           359  ; MODIFIES : NONE
00001234                           360  ; ------------------------------------------------------------------------------
00001234  33FC 0140 00001900       361              MOVE.W  #PANWIDTH/2,(CBZPOSX)
0000123C  33FC 00F0 00001902       362              MOVE.W  #PANHEIGH/2,(CBZPOSY)
00001244  4279 00001910            363              CLR     (TRZPLOT)
0000124A  13FC 0003 00001910       364              MOVE.B  #3,(TRZPLOT)
00001252  4279 00001C16            365              CLR.W   (ESTDCBZ)
00001258  33FC 0000 00001C16       366              MOVE.W  #0,(ESTDCBZ)
00001260  4E75                     367              RTS
00001262                           368              
00001262                           369  ; ------------------------------------------------------------------------------
00001262                           370  HEADUPD
00001262                           371  ; ACTUALIZAR CABEZA.
00001262                           372  ; INPUT    : NONE 
00001262                           373  ; OUTPUT   : NONE
00001262                           374  ; MODIFIES : NONE
00001262                           375  ; ------------------------------------------------------------------------------
00001262                           376  
00001262  48A7 E000                377              MOVEM.W D0-D2,-(A7)            ; Guardar registros
00001266                           378  
00001266                           379  
00001266                           380              ; Marcar celda actual como vacía
00001266  3239 00001900            381              MOVE.W  (CBZPOSX),D1
0000126C  3439 00001902            382              MOVE.W  (CBZPOSY),D2
00001272  4EB9 0000166E            383              JSR     CINDMTRZ
00001278  4EB9 000016C0            384              JSR     RSTCLD               ; RESTAMOS 1 A LA CELDA ACTUAL
0000127E                           385              
0000127E                           386              
0000127E                           387              ;CLR.W   D0
0000127E  3039 00001C16            388              MOVE.W  (ESTDCBZ),D0
00001284  B07C 0000                389              CMP.W   #0,D0
00001288  6700 001E                390              BEQ     SIGDER
0000128C  B07C 0001                391              CMP.W   #1,D0
00001290  6700 0022                392              BEQ     SIGARR
00001294  B07C 0002                393              CMP.W   #2,D0
00001298  6700 0026                394              BEQ     SIGIZQ
0000129C  B07C 0003                395              CMP.W   #3,D0
000012A0  6700 002A                396              BEQ     SIGABA
000012A4                           397  
000012A4                           398  
000012A4                           399  
000012A4                           400              ; Si no hay dirección válida, salir
000012A4  6000 0060                401              BRA     FIN
000012A8                           402  
000012A8                           403  SIGDER:
000012A8  0679 0014 00001900       404              ADD.W   #CBZVEL, (CBZPOSX)
000012B0  6000 0022                405              BRA     UPDMTRZ
000012B4                           406  
000012B4                           407  SIGARR:
000012B4  0479 0014 00001902       408              SUB.W   #CBZVEL, (CBZPOSY)
000012BC  6000 0016                409              BRA     UPDMTRZ
000012C0                           410  
000012C0                           411  SIGIZQ:
000012C0  0479 0014 00001900       412              SUB.W   #CBZVEL, (CBZPOSX)
000012C8  6000 000A                413              BRA     UPDMTRZ
000012CC                           414  
000012CC                           415  SIGABA:
000012CC  0679 0014 00001902       416              ADD.W   #CBZVEL, (CBZPOSY)
000012D4                           417  
000012D4                           418  UPDMTRZ:
000012D4                           419              ; Convertir posición nueva a índice
000012D4  3239 00001900            420              MOVE.W  (CBZPOSX),D1
000012DA  3439 00001902            421              MOVE.W  (CBZPOSY),D2
000012E0  4EB9 0000166E            422              JSR     CINDMTRZ
000012E6                           423  
000012E6                           424              ; Verificar colisiones
000012E6  4EB9 00001768            425              JSR     CHECKCLD
000012EC  B07C 0000                426              CMP.W   #0,D0                 ; Si celda está libre
000012F0  6700 0006                427              BEQ     MARKCLD
000012F4  6000 000C                428              BRA     GAMEOVER              ; Colisión consigo misma
000012F8                           429  
000012F8                           430  MARKCLD:
000012F8                           431              ; Marcar nueva posición como ocupada por la cabeza
000012F8  4EB9 000016A8            432              JSR     CBZOCPD
000012FE  6000 0006                433              BRA     FIN
00001302                           434  
00001302                           435  GAMEOVER:
00001302                           436              ; Implementar lógica de fin de juego
00001302                           437              ; Por ahora, simplemente retornar
00001302  6000 0002                438              BRA     FIN
00001306                           439  
00001306                           440  FIN:
00001306  4C9F 0007                441              MOVEM.W (A7)+,D0-D2            ; Restaurar registros
0000130A                           442  
0000130A  4E75                     443      RTS
0000130C                           444              
0000130C                           445  ; ------------------------------------------------------------------------------
0000130C                           446  HEADPLOT
0000130C                           447  ; DIBUJAR CABEZA.
0000130C                           448  ; INPUT    : NONE 
0000130C                           449  ; OUTPUT   : NONE
0000130C                           450  ; MODIFIES : NONE
0000130C                           451  ; ------------------------------------------------------------------------------
0000130C                           452                         
0000130C  3F00                     453              MOVE.W  D0,-(A7)               ; GUARDAMOS D0
0000130E  3003                     454              MOVE.W  D3,D0                  ; PONEMOS EL INDICE DE LA CELDA EN D0 PARA CALCULAR SUS COORDENADAS
00001310  4EB9 0000172C            455              JSR     CNVICOOR
00001316  2F01                     456              MOVE.L  D1,-(A7)
00001318                           457              
00001318                           458              ; SET COLOR DEL CONTORNO CABEZA
00001318  103C 0050                459              MOVE.B  #80,D0
0000131C  223C 0000FF00            460              MOVE.L  #CBZPCOL,D1
00001322  4E4F                     461              TRAP    #15
00001324                           462              
00001324                           463              ; SET COLOR DEL RELLENO CABEZA
00001324  103C 0051                464              MOVE.B  #81,D0
00001328  223C 0000AA00            465              MOVE.L  #CBZFCOL,D1
0000132E  4E4F                     466              TRAP    #15
00001330                           467              
00001330                           468              ; DIBUJAR CABEZA
00001330  103C 0057                469              MOVE.B  #87,D0
00001334  221F                     470              MOVE.L  (A7)+,D1
00001336  3F03                     471              MOVE.W  D3,-(A7)
00001338  3601                     472              MOVE.W  D1,D3
0000133A  0643 0014                473              ADD.W   #CBZWIDTH,D3
0000133E  3802                     474              MOVE.W  D2,D4
00001340  0644 0014                475              ADD.W   #CBZHEIGH,D4
00001344  4E4F                     476              TRAP    #15
00001346                           477              
00001346  2F01                     478              MOVE.L  D1,-(A7)
00001348                           479              
00001348                           480              ; SET COLOR DEL CONTORNO OJO
00001348  103C 0050                481              MOVE.B  #80,D0
0000134C  7200                     482              MOVE.L  #OJOPCOL,D1
0000134E  4E4F                     483              TRAP    #15
00001350                           484              
00001350                           485              ; SET COLOR DEL RELLENO OJO
00001350  103C 0051                486              MOVE.B  #81,D0
00001354  223C 00FFFFFF            487              MOVE.L  #OJOFCOL,D1
0000135A  4E4F                     488              TRAP    #15
0000135C                           489              
0000135C                           490              ; DIBUJAR OJO
0000135C  103C 0058                491              MOVE.B  #88,D0
00001360  221F                     492              MOVE.L  (A7)+,D1
00001362  2F01                     493              MOVE.L  D1,-(A7)
00001364  2F02                     494              MOVE.L  D2,-(A7)
00001366  0641 000A                495              ADD.W   #OJOWIDTH,D1            
0000136A  3601                     496              MOVE.W  D1,D3
0000136C  5A43                     497              ADD.W   #OJOWIDTH/2,D3
0000136E  5442                     498              ADD.W   #OJOHEIGH/4,D2
00001370  3802                     499              MOVE.W  D2,D4
00001372  5A44                     500              ADD.W   #OJOHEIGH/2,D4
00001374  4E4F                     501              TRAP    #15                     ; DIBUJAMOS EL PRIMER OJO
00001376  0642 000A                502              ADD.W   #OJOHEIGH,D2
0000137A  3802                     503              MOVE.W  D2,D4
0000137C  5A44                     504              ADD.W   #OJOHEIGH/2,D4
0000137E  4E4F                     505              TRAP    #15                     ; Y EL SEGUNDO
00001380                           506  
00001380                           507              
00001380                           508  
00001380                           509              ; DEFINIR COORDENADAS IRIS
00001380  241F                     510              MOVE.L  (A7)+,D2
00001382  221F                     511              MOVE.L  (A7)+,D1
00001384  0641 000A                512              ADD.W   #OJOWIDTH,D1
00001388  5641                     513              ADD.W   #OJOWIDTH/3,D1
0000138A  5442                     514              ADD.W   #OJOHEIGH/4,D2
0000138C  5442                     515              ADD.W   #OJOHEIGH/4,D2
0000138E  103C 0052                516              MOVE.B  #82,D0
00001392  4E4F                     517              TRAP    #15                     ; DIBUJAMOS EL PRIMER IRIS
00001394                           518              
00001394                           519             
00001394  0642 000A                520              ADD.W   #OJOHEIGH,D2
00001398  5242                     521              ADD.W   #1,D2
0000139A  4E4F                     522              TRAP    #15                     ; DIBUJAMOS EL SEGUNDO IRIS
0000139C                           523              
0000139C                           524              
0000139C  361F                     525              MOVE.W  (A7)+,D3
0000139E  301F                     526              MOVE.W  (A7)+,D0
000013A0                           527  
000013A0                           528  
000013A0  4E75                     529              RTS
000013A2                           530  
000013A2                           531  
000013A2                           532  
000013A2                           533  
000013A2                           534  
000013A2                           535  
000013A2                           536  
000013A2                           537  
000013A2                           538  
000013A2                           539  
000013A2                           540  
000013A2                           541  
000013A2                           542  
000013A2                           543  
000013A2                           544  
000013A2                           545  
000013A2                           546  
000013A2                           547  
000013A2                           548  
000013A2                           549  
000013A2                           550  
000013A2                           551  
000013A2                           552  
000013A2                           553  
000013A2                           554  
000013A2                           555  
000013A2                           556  -------------------- end include --------------------
000013A2                           557              INCLUDE 'SEGSRP.X68'
000013A2                           558  
000013A2                           559  ; ------------------------------------------------------------------------------
000013A2                           560  SEGINIT
000013A2                           561  ; INICIALIZAR SEGMENTO.
000013A2                           562  ; INPUT    : NONE 
000013A2                           563  ; OUTPUT   : NONE
000013A2                           564  ; MODIFIES : NONE
000013A2                           565  ; ------------------------------------------------------------------------------
000013A2  33FC 012C 0000190C       566              MOVE.W  #(PANWIDTH/2)-CBZWIDTH,(SGMPOSX)
000013AA  33FC 00F0 0000190E       567              MOVE.W  #PANHEIGH/2,(SGMPOSY)
000013B2  4E75                     568              RTS
000013B4                           569              
000013B4                           570  ; ------------------------------------------------------------------------------
000013B4                           571  SEGUPD
000013B4                           572  ; ACTUALIZAR SEGMENTO.
000013B4                           573  ; INPUT    : NONE 
000013B4                           574  ; OUTPUT   : NONE
000013B4                           575  ; MODIFIES : NONE
000013B4                           576  ; ------------------------------------------------------------------------------
000013B4  48A7 6000                577              MOVEM.W D1-D2,-(A7)
000013B8                           578              
000013B8  3239 0000190C            579              MOVE.W  SGMPOSX,D1
000013BE  33C1 00001908            580              MOVE.W  D1,COLPOSX
000013C4  3439 0000190E            581              MOVE.W  SGMPOSY,D2
000013CA  33C2 0000190A            582              MOVE.W  D2,COLPOSY
000013D0  4EB9 0000166E            583              JSR     CINDMTRZ
000013D6  4EB9 000016C0            584              JSR     RSTCLD
000013DC                           585              
000013DC  4C9F 0006                586              MOVEM.W (A7)+,D1-D2            
000013E0  4E75                     587              RTS
000013E2                           588              
000013E2                           589  ; ------------------------------------------------------------------------------
000013E2                           590  SEGPLOT
000013E2                           591  ; DIBUJAR SEGMENTO.
000013E2                           592  ; INPUT    : NONE 
000013E2                           593  ; OUTPUT   : NONE
000013E2                           594  ; MODIFIES : NONE
000013E2                           595  ; ------------------------------------------------------------------------------
000013E2  3F00                     596              MOVE.W  D0,-(A7)
000013E4  3003                     597              MOVE.W  D3,D0
000013E6  4EB9 0000172C            598              JSR     CNVICOOR
000013EC  2F01                     599              MOVE.L  D1,-(A7)
000013EE                           600              
000013EE  103C 0050                601              MOVE.B  #80,D0
000013F2  223C 0000FF00            602              MOVE.L  #SGMPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DEL SEGMENTO
000013F8  4E4F                     603              TRAP    #15
000013FA                           604              
000013FA  103C 0051                605              MOVE.B  #81,D0
000013FE  223C 0000AA00            606              MOVE.L  #SGMFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DEL SEGMENTO
00001404  4E4F                     607              TRAP    #15
00001406                           608              
00001406  103C 0057                609              MOVE.B  #87,D0
0000140A  221F                     610              MOVE.L  (A7)+,D1
0000140C  3F03                     611              MOVE.W  D3,-(A7)
0000140E  3601                     612              MOVE.W  D1,D3
00001410  0643 0014                613              ADD.W   #SIZECLDA,D3
00001414  3802                     614              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
00001416  0644 0014                615              ADD.W   #SIZECLDA,D4
0000141A  4E4F                     616              TRAP    #15                     
0000141C                           617                          
0000141C  361F                     618              MOVE.W  (A7)+,D3  
0000141E  301F                     619              MOVE.W  (A7)+,D0
00001420                           620  
00001420                           621  
00001420  4E75                     622              RTS
00001422                           623  
00001422                           624  
00001422                           625  
00001422                           626  
00001422                           627  
00001422                           628  
00001422                           629  
00001422                           630  
00001422                           631  
00001422                           632  -------------------- end include --------------------
00001422                           633              INCLUDE 'TAILSRP.X68'
00001422                           634     
00001422                           635  ; ------------------------------------------------------------------------------
00001422                           636  TAILINIT
00001422                           637  ; INICIALIZAR COLA.
00001422                           638  ; INPUT    : NONE 
00001422                           639  ; OUTPUT   : NONE
00001422                           640  ; MODIFIES : NONE
00001422                           641  ; ------------------------------------------------------------------------------
00001422  33FC 011D 00001908       642              MOVE.W  #(PANWIDTH/2)-CBZWIDTH-SGMWIDTH+(COLWIDTH/2),(COLPOSX)
0000142A  33FC 00F0 0000190A       643              MOVE.W  #(PANHEIGH/2),(COLPOSY)
00001432  4E75                     644              RTS
00001434                           645              
00001434                           646              
00001434                           647  ; ------------------------------------------------------------------------------
00001434                           648  TAILUPD
00001434                           649  ; ACTUALIZAR COLA.
00001434                           650  ; INPUT    : NONE 
00001434                           651  ; OUTPUT   : NONE
00001434                           652  ; MODIFIES : NONE
00001434                           653  ; ------------------------------------------------------------------------------
00001434  48A7 6000                654              MOVEM.W D1-D2,-(A7)
00001438                           655              
00001438  3239 00001908            656              MOVE.W  COLPOSX,D1
0000143E  3439 0000190A            657              MOVE.W  COLPOSY,D2
00001444  4EB9 0000166E            658              JSR     CINDMTRZ
0000144A  4EB9 000016C0            659              JSR     RSTCLD 
00001450                           660              
00001450  4C9F 0006                661              MOVEM.W (A7)+,D1-D2            
00001454  4E75                     662              RTS
00001456                           663              
00001456                           664  ; ------------------------------------------------------------------------------
00001456                           665  TAILPLOT
00001456                           666  ; DIBUJAR COLA
00001456                           667  ; INPUT    : NONE 
00001456                           668  ; OUTPUT   : NONE
00001456                           669  ; MODIFIES : NONE
00001456                           670  ; ------------------------------------------------------------------------------
00001456  3F00                     671              MOVE.W  D0,-(A7)
00001458  3003                     672              MOVE.W  D3,D0
0000145A  4EB9 0000172C            673              JSR     CNVICOOR
00001460  2F01                     674              MOVE.L  D1,-(A7)
00001462                           675              
00001462  103C 0050                676              MOVE.B  #80,D0
00001466  223C 0000FF00            677              MOVE.L  #COLPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA COLA
0000146C  4E4F                     678              TRAP    #15
0000146E                           679              
0000146E  103C 0051                680              MOVE.B  #81,D0
00001472  223C 0000AA00            681              MOVE.L  #COLFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA COLA
00001478  4E4F                     682              TRAP    #15
0000147A                           683              
0000147A  103C 0057                684              MOVE.B  #87,D0
0000147E  221F                     685              MOVE.L  (A7)+,D1
00001480  3F03                     686              MOVE.W  D3,-(A7)
00001482  3601                     687              MOVE.W  D1,D3
00001484  0643 0014                688              ADD.W   #SIZECLDA,D3
00001488  3802                     689              MOVE.W  D2,D4                    
0000148A  0644 0014                690              ADD.W   #SIZECLDA,D4
0000148E  4E4F                     691              TRAP    #15                    ; DIBUJAMOS EL CUADRADO 
00001490                           692                          
00001490  361F                     693              MOVE.W  (A7)+,D3  
00001492  301F                     694              MOVE.W  (A7)+,D0
00001494                           695  
00001494  4E75                     696              RTS
00001496                           697  
00001496                           698  
00001496                           699  
00001496                           700  
00001496                           701  
00001496                           702  
00001496                           703  
00001496                           704  
00001496                           705  -------------------- end include --------------------
00001496                           706              INCLUDE 'APPLE.X68'
00001496                           707     
00001496                           708  ; ------------------------------------------------------------------------------
00001496                           709  APPLEINIT
00001496                           710  ; Inicializa la manzana en una posición aleatoria
00001496                           711  ; INPUT    : NONE 
00001496                           712  ; OUTPUT   : NONE
00001496                           713  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
00001496                           714  ; ------------------------------------------------------------------------------
00001496                           715  
00001496                           716              ; Llama a la función para generar la posición aleatoria
00001496  4EB9 00001584            717              JSR     GENPOSMNZ
0000149C                           718  
0000149C                           719              ; Convierte las coordenadas de la manzana a índice de la matriz
0000149C  4EB9 0000166E            720              JSR     CINDMTRZ
000014A2                           721  
000014A2                           722              ; Verifica si la celda está ocupada o libre
000014A2                           723  CHECK:
000014A2  4EB9 00001768            724              JSR     CHECKCLD
000014A8  6700 0010                725              BEQ     MARKMNZ                  ; Si está libre
000014AC                           726  
000014AC                           727              ; Si la celda está ocupada
000014AC  4EB9 00001584            728              JSR     GENPOSMNZ                ; Genera una nueva posición
000014B2  4EB9 0000166E            729              JSR     CINDMTRZ                 ; Convierte las nuevas coordenadas
000014B8  60E8                     730              BRA     CHECK                    ; Repite la comprobación
000014BA                           731  
000014BA                           732  MARKMNZ:
000014BA                           733              ; Marca la celda como ocupada con la manzana (estado 4)
000014BA  4EB9 00001716            734              JSR     MNZOCPD
000014C0                           735  
000014C0                           736              ; Dibuja la manzana en la pantalla
000014C0  4EB9 00001506            737              JSR     APPLEPLOT
000014C6                           738  
000014C6  4E75                     739              RTS
000014C8                           740              
000014C8                           741              ;MOVE.W  #30,(MNZPOSX)   ;DE MOMENTO PONGO X E Y ELEGIDAS MANUALMENTE, EN TEORÍA DEBE SER ALEATORIO
000014C8                           742              ;MOVE.W  #30,(MNZPOSY)
000014C8                           743  
000014C8                           744  ; ------------------------------------------------------------------------------
000014C8                           745  APPLEUPD
000014C8                           746  ; Actualiza la posición de la manzana cuando la serpiente come
000014C8                           747  ; INPUT    : NONE 
000014C8                           748  ; OUTPUT   : NONE
000014C8                           749  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
000014C8                           750  ; ------------------------------------------------------------------------------
000014C8                           751  
000014C8                           752              ; Convierte las coordenadas actuales de la manzana a índice de la matriz
000014C8  4EB9 0000166E            753              JSR     CINDMTRZ
000014CE                           754  
000014CE                           755              ; Marca la celda anterior como vacía
000014CE  4EB9 000016D4            756              JSR     MCLDVCIA
000014D4                           757  
000014D4                           758              ; Llama a la función para generar una nueva posición aleatoria
000014D4  4EB9 00001584            759              JSR     GENPOSMNZ
000014DA                           760  
000014DA                           761              ; Convierte las nuevas coordenadas de la manzana a índice de la matriz
000014DA  4EB9 0000166E            762              JSR     CINDMTRZ
000014E0                           763  
000014E0                           764  CHCKUPDT:
000014E0  4EB9 00001768            765              JSR     CHECKCLD             ; Verifica si la celda está libre
000014E6  6700 0010                766              BEQ     NEWMNZ               ; Si está libre
000014EA                           767  
000014EA                           768              ; Si la celda está ocupada
000014EA  4EB9 00001584            769              JSR     GENPOSMNZ            ; Genera una nueva posición
000014F0  4EB9 0000166E            770              JSR     CINDMTRZ             ; Convierte las nuevas coordenadas
000014F6  60E8                     771              BRA     CHCKUPDT             ; Repite la comprobación
000014F8                           772  
000014F8                           773  NEWMNZ:
000014F8                           774              ; Marca la celda como ocupada con la manzana (estado 4)
000014F8  4EB9 00001716            775              JSR     MNZOCPD
000014FE                           776  
000014FE                           777              ; Dibuja la nueva manzana en la pantalla
000014FE  4EB9 00001506            778              JSR     APPLEPLOT
00001504                           779  
00001504  4E75                     780              RTS
00001506                           781              
00001506                           782  ; ------------------------------------------------------------------------------
00001506                           783  APPLEPLOT
00001506                           784  ; Dibuja la manzana
00001506                           785  ; INPUT    : NONE 
00001506                           786  ; OUTPUT   : NONE
00001506                           787  ; MODIFIES : NONE
00001506                           788  ; ------------------------------------------------------------------------------
00001506  3F00                     789              MOVE.W  D0,-(A7)
00001508  3003                     790              MOVE.W  D3,D0
0000150A  4EB9 0000172C            791              JSR     CNVICOOR
00001510  2F01                     792              MOVE.L  D1,-(A7)                ; PRIMERO DEBEMOS DIBUJAR EL FONDO Y LUEGO LA MANZANA
00001512                           793              
00001512  103C 0050                794              MOVE.B  #80,D0
00001516  223C 0090EE90            795              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
0000151C  4E4F                     796              TRAP    #15
0000151E                           797              
0000151E  103C 0051                798              MOVE.B  #81,D0
00001522  223C 0090EE90            799              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
00001528  4E4F                     800              TRAP    #15
0000152A                           801              
0000152A  103C 0057                802              MOVE.B  #87,D0
0000152E  221F                     803              MOVE.L  (A7)+,D1
00001530  3F03                     804              MOVE.W  D3,-(A7)
00001532  3601                     805              MOVE.W  D1,D3
00001534  0643 0014                806              ADD.W   #SIZECLDA,D3
00001538  3802                     807              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
0000153A  0644 0014                808              ADD.W   #SIZECLDA,D4
0000153E  4E4F                     809              TRAP    #15                     
00001540                           810                          
00001540  361F                     811              MOVE.W  (A7)+,D3  
00001542  301F                     812              MOVE.W  (A7)+,D0
00001544                           813  
00001544  3F00                     814              MOVE.W  D0,-(A7)
00001546  3003                     815              MOVE.W  D3,D0
00001548  4EB9 0000172C            816              JSR     CNVICOOR
0000154E  2F01                     817              MOVE.L  D1,-(A7)
00001550                           818              
00001550  103C 0050                819              MOVE.B  #80,D0
00001554  223C 0000AAFF            820              MOVE.L  #MNZPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA MANZANA
0000155A  4E4F                     821              TRAP    #15
0000155C                           822              
0000155C  103C 0051                823              MOVE.B  #81,D0
00001560  223C 000000FF            824              MOVE.L  #MNZFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA MANZANA
00001566  4E4F                     825              TRAP    #15
00001568                           826              
00001568  103C 0058                827              MOVE.B  #88,D0
0000156C  221F                     828              MOVE.L  (A7)+,D1
0000156E  3F03                     829              MOVE.W  D3,-(A7)
00001570  3601                     830              MOVE.W  D1,D3
00001572  0643 0014                831              ADD.W   #SIZECLDA,D3
00001576  3802                     832              MOVE.W  D2,D4                    ; DIBUJAMOS EL CIRCULO
00001578  0644 0014                833              ADD.W   #SIZECLDA,D4
0000157C  4E4F                     834              TRAP    #15                     
0000157E                           835                          
0000157E  361F                     836              MOVE.W  (A7)+,D3  
00001580  301F                     837              MOVE.W  (A7)+,D0
00001582                           838  
00001582                           839  
00001582  4E75                     840              RTS
00001584                           841  ; ----------------------------------------------------------------------------
00001584                           842  GENPOSMNZ
00001584                           843  ; Genera una posición aleatoria para la manzana
00001584                           844  ; INPUT: NONE
00001584                           845  ; OUTPUT:
00001584                           846  ; MODIFIES: MNZPOSX, MNZPOSY
00001584                           847  ; ----------------------------------------------------------------------------
00001584                           848  
00001584  48E7 8000                849              MOVEM.L D0,-(A7)
00001588                           850  
00001588                           851              ; Genera la coordenada X aleatoria
00001588  4EB8 1116                852              JSR     UTLRAND
0000158C  0240 001F                853              ANDI.W  #NUMCLMNS-1, D0       ; Asegura que esté en [0, NUMCLMNS-1]
00001590  C0FC 0014                854              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
00001594  3200                     855              MOVE.W  D0,D1
00001596  33C0 000018FC            856              MOVE.W  D0, MNZPOSX           ; Guarda la coordenada X generada
0000159C                           857              
0000159C                           858              ; Generar coordenada Y aleatoria
0000159C  4EB8 1116                859              JSR     UTLRAND
000015A0  0240 0017                860              ANDI.W  #NUMFILAS-1, D0       ; Asegura que esté en el rango [0, NUMFILAS-1]
000015A4  C0FC 0014                861              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
000015A8  3400                     862              MOVE.W  D0,D2
000015AA  33C0 000018FE            863              MOVE.W  D0, MNZPOSY           ; Guarda la coordenada Y generada
000015B0                           864              
000015B0  4CDF 0001                865              MOVEM.L (A7)+,D0
000015B4  4E75                     866              RTS 
000015B6                           867  
000015B6                           868  
000015B6                           869  
000015B6                           870  -------------------- end include --------------------
000015B6                           871              INCLUDE 'SCORE.X68'
000015B6                           872     
000015B6                           873  ; ------------------------------------------------------------------------------
000015B6                           874  SCOINIT
000015B6                           875  ; INICIALIZAR MARCADOR.
000015B6                           876  ; INPUT    : NONE 
000015B6                           877  ; OUTPUT   : NONE
000015B6                           878  ; MODIFIES : NONE
000015B6                           879  ; ------------------------------------------------------------------------------
000015B6  4279 00001912            880              CLR.W   (JGOPNTS)
000015BC  4E75                     881              RTS
000015BE                           882              
000015BE                           883  ; ------------------------------------------------------------------------------
000015BE                           884  SCOUPD
000015BE                           885  ; ACTUALIZAR MARCADOR.
000015BE                           886  ; INPUT    : NONE 
000015BE                           887  ; OUTPUT   : NONE
000015BE                           888  ; MODIFIES : NONE
000015BE                           889  ; ------------------------------------------------------------------------------
000015BE  4E75                     890              RTS
000015C0                           891              
000015C0                           892  ; ------------------------------------------------------------------------------
000015C0                           893  SCOPLOT
000015C0                           894  ; DIBUJAR MARCADOR.
000015C0                           895  ; INPUT    : NONE 
000015C0                           896  ; OUTPUT   : NONE
000015C0                           897  ; MODIFIES : NONE
000015C0                           898  ; ------------------------------------------------------------------------------
000015C0  48E7 C040                899             MOVEM.L  D0-D1/A1,-(A7)
000015C4                           900             ; SET COLOR DE FONDO
000015C4  103C 0051                901             MOVE.B   #81,D0
000015C8  223C 0090EE90            902             MOVE.L   #COLFND,D1
000015CE  4E4F                     903             TRAP     #15
000015D0                           904             
000015D0                           905             
000015D0                           906             
000015D0                           907             ; DIBUJAR LINEA DE PUNTUACIÓN
000015D0  43F9 000015EA            908              LEA     .TXT1,A1
000015D6  4281                     909              CLR.L   D1
000015D8  3239 00001912            910              MOVE.W  (JGOPNTS),D1
000015DE  103C 0011                911              MOVE.B  #17,D0
000015E2  4E4F                     912              TRAP    #15
000015E4                           913              
000015E4  4CDF 0203                914              MOVEM.L (A7)+,D0-D1/A1
000015E8  4E75                     915              RTS
000015EA                           916  
000015EA                           917  
000015EA= 50 55 4E 54 4F 53 ...    918  .TXT1       DC.B    'PUNTOS : ',0
000015F4                           919  
000015F4                           920  
000015F4                           921  -------------------- end include --------------------
000015F4                           922              INCLUDE 'MATRIZ.X68'
000015F4                           923  ; ----------------------------------------------------------------------------
000015F4                           924  ; MATRIZ
000015F4                           925  ; ----------------------------------------------------------------------------
000015F4                           926  
000015F4                           927  ;-----------------------------------------------------------------------------
000015F4                           928  MTZINIT
000015F4                           929  ; INICIALIZA LA MATRIZ, AL PRINCIPIO ESTÁ VACÍA
000015F4                           930  ; INPUT    : NONE
000015F4                           931  ; OUTPUT   : NONE
000015F4                           932  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
000015F4                           933  ; ----------------------------------------------------------------------------
000015F4                           934              
000015F4  48A7 E080                935              MOVEM.W D0-D2/A0,-(A7)
000015F8                           936              
000015F8  41F9 00001916            937              LEA ESTDCLDS, A0       ; Apunta al inicio de ESTDCLDS
000015FE  303C 0300                938              MOVE.W #TCELDAS, D0    ; Número total de celdas
00001602                           939  
00001602                           940  CLNCLDS:
00001602  4218                     941              CLR.B (A0)+            ; Coloca 0 en cada celda
00001604  5340                     942              SUBI.W #1, D0          ; Decrementa el contador de celdas
00001606  66FA                     943              BNE CLNCLDS            ; Repite hasta que esten vacías
00001608                           944              
00001608                           945              
00001608  3239 00001900            946              MOVE.W  CBZPOSX, D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
0000160E  3439 00001902            947              MOVE.W  CBZPOSY, D2
00001614  4EB9 0000166E            948              JSR     CINDMTRZ
0000161A  4EB9 000016A8            949              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
00001620                           950              
00001620  3239 0000190C            951              MOVE.W  SGMPOSX, D1
00001626  3439 0000190E            952              MOVE.W  SGMPOSY, D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
0000162C  4EB9 0000166E            953              JSR     CINDMTRZ
00001632  4EB9 000016EA            954              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
00001638                           955              
00001638  3239 00001908            956              MOVE.W  COLPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA COLA
0000163E  3439 0000190A            957              MOVE.W  COLPOSY, D2
00001644  4EB9 0000166E            958              JSR     CINDMTRZ
0000164A  4EB9 00001700            959              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
00001650                           960              
00001650  3239 000018FC            961              MOVE.W  MNZPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
00001656  3439 000018FE            962              MOVE.W  MNZPOSY, D2
0000165C  4EB9 0000166E            963              JSR     CINDMTRZ
00001662  4EB9 00001716            964              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
00001668                           965              
00001668                           966              
00001668  4C9F 0107                967              MOVEM.W (A7)+,D0-D2/A0
0000166C                           968  
0000166C  4E75                     969              RTS
0000166E                           970  
0000166E                           971  ;-----------------------------------------------------------------------------
0000166E                           972  CINDMTRZ
0000166E                           973  ; CALCULA EL ÍNDICE DE UNA CELDA
0000166E                           974  ; INPUT    : D1 = coordenada X pantalla, D2 = coordenada Y pantalla
0000166E                           975  ; OUTPUT   : D0 = índice de la celda en ESTDCLDS
0000166E                           976  ; MODIFIES : NONE
0000166E                           977  ; ----------------------------------------------------------------------------
0000166E                           978  
0000166E  48A7 7000                979               MOVEM.W D1-D3,-(A7)     ; Guarda los registros D1-D3 en la pila
00001672                           980  
00001672                           981              ; Divide X por SIZECLDA
00001672  3601                     982              MOVE.W  D1, D3          ; Copia X a D3
00001674  4241                     983              CLR.W   D1              ; Inicializa el cociente de X
00001676                           984  
00001676  B67C 0014                985  DIVX:       CMP.W   #SIZECLDA, D3    ; Compara D3 con SIZECLDA
0000167A  6D00 000A                986              BLT     ENDDIVX         ; Si D3 < SIZECLDA, salta a ENDDIVX
0000167E  0443 0014                987              SUB.W   #SIZECLDA, D3   ; Resta SIZECLDA de D3
00001682  5241                     988              ADDQ.W  #1, D1          ; Incrementa el cociente de X
00001684  60F0                     989              BRA     DIVX            ; Repite el bucle
00001686                           990  
00001686                           991  ENDDIVX:
00001686                           992  
00001686                           993              ; Divide Y por SIZECLDA
00001686  3602                     994              MOVE.W  D2, D3          ; Copia Y a D3
00001688  4242                     995              CLR.W   D2              ; Inicializa el cociente de Y
0000168A                           996  
0000168A  B67C 0014                997  DIVY:       CMP.W   #SIZECLDA, D3    ; Compara D3 con SIZECLDA
0000168E  6D00 000A                998              BLT     ENDDIVY         ; Si D3 < SIZECLDA, salta a ENDDIVY
00001692  0443 0014                999              SUB.W   #SIZECLDA, D3   ; Resta SIZECLDA de D3
00001696  5242                    1000              ADDQ.W  #1, D2          ; Incrementa el cociente de Y
00001698  60F0                    1001              BRA     DIVY            ; Repite el bucle
0000169A                          1002  
0000169A                          1003  ENDDIVY:
0000169A                          1004  
0000169A                          1005              ; Calcula el índice
0000169A  4240                    1006              CLR.W   D0
0000169C  3002                    1007              MOVE.W  D2, D0          ; D0 = Y_CELDA
0000169E  EB40                    1008              ASL.W   #5, D0          ; D0 = Y_CELDA * NUMCLMNS (32 = 2^5)
000016A0  D041                    1009              ADD.W   D1, D0          ; D0 = Y_CELDA * NUMCLMNS + X_CELDA
000016A2                          1010  
000016A2  4C9F 000E               1011              MOVEM.W (A7)+,D1-D3     ; Restaura los registros D1-D3 desde la pila
000016A6                          1012  
000016A6  4E75                    1013              RTS  
000016A8                          1014              
000016A8                          1015  ;-----------------------------------------------------------------------------
000016A8                          1016  CBZOCPD
000016A8                          1017  ; MARCA UNA CELDA COMO OCUPADA POR LA CABEZA
000016A8                          1018  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016A8                          1019  ; OUTPUT   : NONE
000016A8                          1020  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016A8                          1021  ; ----------------------------------------------------------------------------
000016A8                          1022  
000016A8  48A7 0080               1023              MOVEM.W A0,-(A7)
000016AC                          1024  
000016AC  41F9 00001916           1025              LEA     ESTDCLDS, A0                ; Dirección de la matriz en A0
000016B2  11B9 00001910 0000      1026              MOVE.B  TRZPLOT, (A0, D0.W)           ; Marca la celda como ocupada
000016BA                          1027              
000016BA  4C9F 0100               1028              MOVEM.W (A7)+,A0
000016BE                          1029              
000016BE  4E75                    1030              RTS
000016C0                          1031              
000016C0                          1032              
000016C0                          1033              
000016C0                          1034  ;-----------------------------------------------------------------------------
000016C0                          1035  RSTCLD
000016C0                          1036  ; RESTA 1 A LA CELDA PASADA POR PARÁMETRO
000016C0                          1037  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016C0                          1038  ; OUTPUT   : NONE
000016C0                          1039  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016C0                          1040  ; ----------------------------------------------------------------------------
000016C0                          1041  
000016C0  48A7 0080               1042              MOVEM.W A0,-(A7)
000016C4                          1043  
000016C4  41F9 00001916           1044              LEA     ESTDCLDS, A0              ; Dirección de la matriz en A0
000016CA  5330 0000               1045              SUBQ.B   #1, (A0, D0.W)           ; Marca la celda como ocupada
000016CE                          1046              
000016CE  4C9F 0100               1047              MOVEM.W (A7)+,A0
000016D2                          1048              
000016D2  4E75                    1049              RTS
000016D4                          1050             
000016D4                          1051  ;-----------------------------------------------------------------------------
000016D4                          1052  MCLDVCIA
000016D4                          1053  ; MARCA UNA CELDA COMO VACÍA
000016D4                          1054  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016D4                          1055  ; OUTPUT   : NONE
000016D4                          1056  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016D4                          1057  ; ----------------------------------------------------------------------------
000016D4                          1058  
000016D4  48A7 0080               1059              MOVEM.W A0,-(A7)
000016D8                          1060  
000016D8  41F9 00001916           1061              LEA ESTDCLDS, A0                ; Direccion de la matriz en A0
000016DE  11BC 0000 0000          1062              MOVE.B #0, (A0, D0.W)           ; Marca la celda como vacía
000016E4                          1063              
000016E4  4C9F 0100               1064              MOVEM.W (A7)+,A0
000016E8                          1065              
000016E8  4E75                    1066              RTS
000016EA                          1067  
000016EA                          1068  ;-----------------------------------------------------------------------------
000016EA                          1069  SGMOCPD
000016EA                          1070  ; MARCA UNA CELDA COMO OCUPADA POR EL SEGMENTO
000016EA                          1071  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016EA                          1072  ; OUTPUT   : NONE
000016EA                          1073  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016EA                          1074  ; ----------------------------------------------------------------------------
000016EA                          1075  
000016EA  48A7 0080               1076              MOVEM.W A0,-(A7)
000016EE                          1077  
000016EE  41F9 00001916           1078              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
000016F4  11BC 0002 0000          1079              MOVE.B #2, (A0, D0.W)           ; Marca la celda como ocupada
000016FA                          1080              
000016FA  4C9F 0100               1081              MOVEM.W (A7)+,A0
000016FE                          1082              
000016FE  4E75                    1083              RTS
00001700                          1084              
00001700                          1085  ;-----------------------------------------------------------------------------
00001700                          1086  COLOCPD
00001700                          1087  ; MARCA UNA CELDA COMO OCUPADA POR LA COLA
00001700                          1088  ; INPUT    : D0 = índice de la celda en ESTDCLDS
00001700                          1089  ; OUTPUT   : NONE
00001700                          1090  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
00001700                          1091  ; ----------------------------------------------------------------------------
00001700                          1092  
00001700  48A7 0080               1093              MOVEM.W A0,-(A7)
00001704                          1094  
00001704  41F9 00001916           1095              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
0000170A  11BC 0001 0000          1096              MOVE.B #1, (A0, D0.W)           ; Marca la celda como ocupada
00001710                          1097              
00001710  4C9F 0100               1098              MOVEM.W (A7)+,A0
00001714                          1099              
00001714  4E75                    1100              RTS
00001716                          1101  
00001716                          1102  
00001716                          1103  ;-----------------------------------------------------------------------------
00001716                          1104  MNZOCPD
00001716                          1105  ; MARCA UNA CELDA COMO OCUPADA POR LA MANZANA
00001716                          1106  ; INPUT    : D0 = índice de la celda en ESTDCLDS
00001716                          1107  ; OUTPUT   : NONE
00001716                          1108  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
00001716                          1109  ; ----------------------------------------------------------------------------
00001716                          1110  
00001716  48A7 0080               1111              MOVEM.W A0,-(A7)
0000171A                          1112  
0000171A  41F9 00001916           1113              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
00001720  11BC 0004 0000          1114              MOVE.B #4, (A0, D0.W)           ; Marca la celda como ocupada
00001726                          1115              
00001726  4C9F 0100               1116              MOVEM.W (A7)+,A0
0000172A                          1117              
0000172A  4E75                    1118              RTS
0000172C                          1119  
0000172C                          1120              
0000172C                          1121  ;-----------------------------------------------------------------------------
0000172C                          1122  CNVICOOR
0000172C                          1123  ; Convierte un índice de celda a coordenadas de pantalla (X, Y)
0000172C                          1124  ; INPUT    : D0 = índice de la celda en ESTADO_CELDAS
0000172C                          1125  ; OUTPUT   : D1 = coordenada X, D2 = coordenada Y
0000172C                          1126  ; MODIFIES : NONE
0000172C                          1127  ; ----------------------------------------------------------------------------
0000172C                          1128  
0000172C  48A7 9800               1129              MOVEM.W D0/D3-D4,-(A7)
00001730                          1130  
00001730  3400                    1131              MOVE.W  D0,D2         ; Copia índice a D2 para calcular la fila
00001732  EA4A                    1132              LSR.W   #5,D2         ; D2 = índice / NUM_COLUMNAS (32 = 2^5)
00001734  3200                    1133              MOVE.W  D0,D1         ; Copia índice a D1 para calcular la columna
00001736  C27C 001F               1134              AND.W   #$1F,D1       ; D1 = índice % NUM_COLUMNAS (31 = 0x1F) (CREO)
0000173A                          1135  
0000173A                          1136              ; Multiplica por TAMAÑO_CELDA = 10
0000173A  363C 0014               1137              MOVE.W  #SIZECLDA, D3
0000173E  3801                    1138              MOVE.W  D1,D4         ; Copia D1 para multiplicar por 10
00001740  4241                    1139              CLR.W   D1            ; Inicializa resultado
00001742                          1140  
00001742                          1141  
00001742                          1142  MULTLOOPX: 
00001742  B87C 0000               1143              CMP.W   #0, D4        ; ¿Quedan iteraciones?
00001746  6700 0008               1144              BEQ     ENDMULTX
0000174A  D243                    1145              ADD.W   D3,D1         ; Suma TAMANO_CELDA (10) repetidamente
0000174C                          1146  
0000174C  5344                    1147              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
0000174E  60F2                    1148              BRA     MULTLOOPX     ; Repite mientras no sea 0
00001750                          1149  ENDMULTX: 
00001750  3802                    1150              MOVE.W  D2,D4         ; Copia D2 para multiplicar por 10
00001752  4242                    1151              CLR.W   D2            ; Inicializa resultado
00001754                          1152  
00001754                          1153  MULTLOOPY: 
00001754  B87C 0000               1154              CMP.W   #0, D4        ; ¿Quedan iteraciones?
00001758  6700 0008               1155              BEQ     ENDMULTY
0000175C  D443                    1156              ADD.W   D3,D2         ; Suma TAMANO_CELDA (10) repetidamente
0000175E  5344                    1157              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
00001760  60F2                    1158              BRA     MULTLOOPY     ; Repite mientras no sea 0
00001762                          1159  ENDMULTY:
00001762  4C9F 0019               1160              MOVEM.W (A7)+,D0/D3-D4
00001766                          1161  
00001766  4E75                    1162              RTS
00001768                          1163  
00001768                          1164  ; ----------------------------------------------------------------------------
00001768                          1165  CHECKCLD
00001768                          1166  ; INPUT: D0 = índice de la celda
00001768                          1167  ; OUTPUT: D0 = 0 si está vacía, 1 si está ocupada
00001768                          1168  ; MODIFIES: Ninguno
00001768                          1169  ; ----------------------------------------------------------------------------
00001768                          1170  
00001768  41F9 00001916           1171              LEA     ESTDCLDS, A0    ; Carga la dirección de la matriz ESTDCLDS
0000176E  1230 0000               1172              MOVE.B  (A0, D0.W),D1   ; Carga el estado de la celda en D1
00001772  B23C 0000               1173              CMP.B   #0, D1          ; Compara si está vacía (0)
00001776  6700 0008               1174              BEQ     CLDFREE         ; Si está vacía
0000177A  303C 0001               1175              MOVE.W  #1, D0          ; Si está ocupada, devuelve 1 (ocupada)
0000177E                          1176  
0000177E  4E75                    1177              RTS
00001780                          1178  
00001780                          1179  CLDFREE:
00001780  303C 0000               1180              MOVE.W  #0, D0                 ; Devuelve 0 (libre)
00001784                          1181  
00001784  4E75                    1182              RTS
00001786                          1183  
00001786                          1184  
00001786                          1185  ;-----------------------------------------------------------------------------
00001786                          1186  FONPLOT
00001786                          1187  ; DIBUJADO DEL FONDO
00001786                          1188  ; INPUT    : NONE
00001786                          1189  ; OUTPUT   : NONE
00001786                          1190  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
00001786                          1191  ; ----------------------------------------------------------------------------
00001786                          1192  
00001786  3F00                    1193              MOVE.W  D0,-(A7)
00001788  3003                    1194              MOVE.W  D3,D0
0000178A  4EB8 172C               1195              JSR     CNVICOOR
0000178E  2F01                    1196              MOVE.L  D1,-(A7)
00001790                          1197              
00001790  103C 0050               1198              MOVE.B  #80,D0
00001794  223C 0090EE90           1199              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
0000179A  4E4F                    1200              TRAP    #15
0000179C                          1201              
0000179C  103C 0051               1202              MOVE.B  #81,D0
000017A0  223C 0090EE90           1203              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
000017A6  4E4F                    1204              TRAP    #15
000017A8                          1205              
000017A8  103C 0057               1206              MOVE.B  #87,D0
000017AC  221F                    1207              MOVE.L  (A7)+,D1
000017AE  3F03                    1208              MOVE.W  D3,-(A7)
000017B0  3601                    1209              MOVE.W  D1,D3
000017B2  0643 0014               1210              ADD.W   #SIZECLDA,D3
000017B6  3802                    1211              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
000017B8  0644 0014               1212              ADD.W   #SIZECLDA,D4
000017BC  4E4F                    1213              TRAP    #15                     
000017BE                          1214                          
000017BE  361F                    1215              MOVE.W  (A7)+,D3  
000017C0  301F                    1216              MOVE.W  (A7)+,D0
000017C2  4E75                    1217              RTS         
000017C4                          1218  
000017C4                          1219  
000017C4                          1220  
000017C4                          1221  ;-----------------------------------------------------------------------------
000017C4                          1222  MTZUPD
000017C4                          1223  ; ACTUALIZA LA MATRIZ CASILLA A CASILLA
000017C4                          1224  ; INPUT    : NONE
000017C4                          1225  ; OUTPUT   : NONE
000017C4                          1226  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
000017C4                          1227  ; ----------------------------------------------------------------------------
000017C4                          1228  
000017C4                          1229  
000017C4  48A7 E080               1230              MOVEM.W D0-D2/A0,-(A7)
000017C8                          1231              
000017C8  41F9 00001916           1232              LEA ESTDCLDS, A0       ; Apunta al inicio de ESTDCLDS
000017CE  303C 0300               1233              MOVE.W #TCELDAS, D0    ; Número total de celdas
000017D2                          1234  
000017D2                          1235  .CLNCLDS:
000017D2  4218                    1236              CLR.B (A0)+            ; Coloca 0 en cada celda
000017D4  5340                    1237              SUBI.W #1, D0          ; Decrementa el contador de celdas
000017D6  66FA                    1238              BNE .CLNCLDS           ; Repite hasta que esten vacías
000017D8                          1239              
000017D8                          1240              
000017D8  3239 00001900           1241              MOVE.W  CBZPOSX, D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
000017DE  3439 00001902           1242              MOVE.W  CBZPOSY, D2
000017E4  4EB8 166E               1243              JSR     CINDMTRZ
000017E8  4EB8 16A8               1244              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
000017EC                          1245              
000017EC  3239 0000190C           1246              MOVE.W  SGMPOSX, D1
000017F2  3439 0000190E           1247              MOVE.W  SGMPOSY, D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
000017F8  4EB8 166E               1248              JSR     CINDMTRZ
000017FC  4EB8 16EA               1249              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
00001800                          1250              
00001800  3239 00001908           1251              MOVE.W  COLPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA COLA
00001806  3439 0000190A           1252              MOVE.W  COLPOSY, D2
0000180C  4EB8 166E               1253              JSR     CINDMTRZ
00001810  4EB8 1700               1254              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
00001814                          1255              
00001814  3239 000018FC           1256              MOVE.W  MNZPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
0000181A  3439 000018FE           1257              MOVE.W  MNZPOSY, D2
00001820  4EB8 166E               1258              JSR     CINDMTRZ
00001824  4EB8 1716               1259              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
00001828                          1260              
00001828                          1261              
00001828  4C9F 0107               1262              MOVEM.W (A7)+,D0-D2/A0
0000182C                          1263  
0000182C  4E75                    1264              RTS
0000182E                          1265  
0000182E                          1266  
0000182E                          1267  
0000182E                          1268  ;-----------------------------------------------------------------------------
0000182E                          1269  MTZPLOT
0000182E                          1270  ; DIBUJA LA MATRIZ CASILLA A CASILLA
0000182E                          1271  ; INPUT    : NONE
0000182E                          1272  ; OUTPUT   : NONE
0000182E                          1273  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
0000182E                          1274  ; ----------------------------------------------------------------------------
0000182E  48E7 F080               1275              MOVEM.L D0-D3/A0,-(A7)
00001832                          1276  
00001832  4240                    1277              CLR.W   D0
00001834  4243                    1278              CLR.W   D3
00001836  41F9 00001916           1279              LEA     ESTDCLDS, A0            ; Apunta al inicio de ESTDCLDS
0000183C  303C 0300               1280              MOVE.W  #TCELDAS, D0            ; Número total de celdas
00001840  363C 0000               1281              MOVE.W  #0,D3                   ; LO UTILIZAMOS PARA SABER EL INDICE EN EL QUE NOS ENCONTRAMOS
00001844  4241                    1282              CLR.W   D1
00001846  4242                    1283              CLR.W   D2
00001848                          1284              
00001848                          1285  
00001848                          1286  PLOTCLDS:
00001848  1218                    1287              MOVE.B  (A0)+,D1                ; MOVEMOS EL VALOR DE LA CELDA A D1
0000184A  B23C 0000               1288              CMP.B   #0,D1
0000184E  6700 0036               1289              BEQ     PLOTVAC                 ; SALTA A DIBUJAR POSICIÓN VACÍA
00001852  B23C 0001               1290              CMP.B   #1,D1 
00001856  6700 0034               1291              BEQ     PLOTCOL                 ; SALTA A DIBUJAR COLA
0000185A  B23C 0002               1292              CMP.B   #2,D1
0000185E  6700 0032               1293              BEQ     PLOTSEG                 ; SALTA A DIBUJAR SEGMENTO
00001862  B239 00001910           1294              CMP.B   TRZPLOT,D1
00001868  6700 0016               1295              BEQ     PLOTCBZ                 ; SALTA A DIBUJAR CABEZA
0000186C  B23C 0004               1296              CMP.B   #4,D1                 
00001870  6700 0026               1297              BEQ     PLOTAPPLE               ; SALTA A DIBUJAR MANZANA
00001874                          1298    
00001874                          1299  DONEPLOT            
00001874  5243                    1300              ADDQ    #1,D3                   ; AUMENTAMOS EL INDICE DE CELDA PARA LA SIGUIENTE
00001876  5340                    1301              SUBI.W  #1, D0                  ; Decrementa el contador de celdas
00001878  66CE                    1302              BNE     PLOTCLDS                ; Repite hasta que esten vacías
0000187A  4CDF 010F               1303              MOVEM.L (A7)+,D0-D3/A0
0000187E  4E75                    1304              RTS
00001880                          1305  PLOTCBZ:
00001880  4EB8 130C               1306              JSR     HEADPLOT
00001884  60EE                    1307              BRA     DONEPLOT
00001886                          1308  
00001886                          1309  PLOTVAC:    
00001886  4EB8 1786               1310              JSR     FONPLOT
0000188A  60E8                    1311              BRA     DONEPLOT                ; DIBUJADO HECHO 
0000188C                          1312  
0000188C                          1313  PLOTCOL:   
0000188C  4EB8 1456               1314              JSR     TAILPLOT 
00001890  60E2                    1315              BRA     DONEPLOT                ; DIBUJADO HECHO 
00001892                          1316              
00001892                          1317  PLOTSEG:    
00001892  4EB8 13E2               1318              JSR     SEGPLOT
00001896  60DC                    1319              BRA     DONEPLOT                ; DIBUJADO HECHO    
00001898                          1320  
00001898                          1321  PLOTAPPLE:
00001898  4EB8 1506               1322              JSR     APPLEPLOT
0000189C  60D6                    1323              BRA     DONEPLOT            
0000189E                          1324  
0000189E                          1325  
0000189E                          1326  
0000189E                          1327  
0000189E                          1328  
0000189E                          1329  
0000189E                          1330  
0000189E                          1331  
0000189E                          1332  
0000189E                          1333  
0000189E                          1334  
0000189E                          1335  
0000189E                          1336  
0000189E                          1337  
0000189E                          1338  -------------------- end include --------------------
0000189E                          1339  START:
0000189E                          1340                  
0000189E                          1341  ; --- INIZIALIZACIÓN ---------------------------------------------------------
0000189E                          1342  
0000189E  4EB8 1000               1343              JSR     SYSINIT
000018A2  4EB8 1100               1344              JSR     UTLINIT
000018A6  4EB8 1066               1345              JSR     KBDINIT
000018AA  4EB8 15F4               1346              JSR     MTZINIT
000018AE  4EB8 1234               1347              JSR     HEADINIT                
000018B2  4EB8 13A2               1348              JSR     SEGINIT
000018B6  4EB8 1422               1349              JSR     TAILINIT
000018BA  4EB8 15B6               1350              JSR     SCOINIT
000018BE  4EB8 1496               1351              JSR     APPLEINIT
000018C2                          1352              
000018C2                          1353  
000018C2                          1354  .LOOP
000018C2                          1355  
000018C2                          1356  ; --- ACTUALIZAR -------------------------------------------------------------
000018C2                          1357  
000018C2                          1358  ; LEER DISPOSITIVOS DE ENTRADA
000018C2                          1359  
000018C2  4E41                    1360              TRAP    #1
000018C4                          1361  
000018C4                          1362  ; ACTUALIZAR LÓGICA DEL JUEGO
000018C4                          1363              
000018C4  4EB8 1434               1364              JSR     TAILUPD
000018C8  4EB8 13B4               1365              JSR     SEGUPD
000018CC  4EB8 1262               1366              JSR     HEADUPD
000018D0                          1367              ;JSR     APPLEUPD  
000018D0  4EB8 17C4               1368              JSR     MTZUPD
000018D4                          1369              
000018D4                          1370  ; --- SINCRONIZACIÓN ---------------------------------------------------------
000018D4                          1371              ; THE FOLLOWING SYNC STRATEGY IS ****WRONG****
000018D4  103C 0017               1372              MOVE.B  #23,D0
000018D8  7201                    1373              MOVE.L  #1,D1
000018DA  4E4F                    1374              TRAP    #15
000018DC                          1375  
000018DC                          1376  
000018DC                          1377  ;---DIBUJAR-------------------------------------------------------------------
000018DC  4EB8 130C               1378               JSR    HEADPLOT
000018E0  4EB8 13E2               1379               JSR    SEGPLOT
000018E4  4EB8 1456               1380               JSR    TAILPLOT
000018E8  4EB8 1506               1381               JSR    APPLEPLOT
000018EC  4EB8 182E               1382               JSR    MTZPLOT
000018F0  4EB8 15C0               1383               JSR    SCOPLOT
000018F4                          1384              
000018F4  4E40                    1385              TRAP    #0                      ; ACTUALIZA DOBLE BUFFER
000018F6                          1386  
000018F6                          1387  
000018F6  60CA                    1388              BRA     .LOOP
000018F8                          1389  
000018F8  FFFF FFFF               1390              SIMHALT
000018FC                          1391              
000018FC                          1392              INCLUDE 'VARS.X68'
000018FC                          1393  ; ----------------------------------------------------------------------------
000018FC                          1394  ; VARIABLES DEL JUEGO
000018FC                          1395  ; ----------------------------------------------------------------------------
000018FC                          1396  
000018FC                          1397  ; --- VARIABLES DE LA MANZANA ------------------------------------------------
000018FC                          1398  
000018FC                          1399  MNZPOSX     DS.W    1                       ; COORDENADA X DE LA MANZANA
000018FE                          1400  MNZPOSY     DS.W    1                       ; COORDENADA Y DE LA MANZANA
00001900                          1401  
00001900                          1402  ; --- VARIABLES DE LA SERPIENTE ----------------------------------------------
00001900                          1403  
00001900                          1404  CBZPOSX     DS.W    1                       ; COORDENADA X CABEZA
00001902                          1405  CBZPOSY     DS.W    1                       ; COORDENADA Y CABEZA
00001904                          1406  CBZVELX     DS.W    1                       ; VELOCIDAD X CABEZA
00001906                          1407  CBZVELY     DS.W    1                       ; VELOCIDAD Y CABEZA
00001908                          1408  COLPOSX     DS.W    1                       ; COORDENADA X COLA
0000190A                          1409  COLPOSY     DS.W    1                       ; COORDENADA Y COLA
0000190C                          1410  SGMPOSX     DS.W    1                       ; COORDENADA X SEGMENTO
0000190E                          1411  SGMPOSY     DS.W    1                       ; COORDENADA Y SEGMENTO
00001910                          1412  TRZPLOT     DS.B    1                       ; NÚMERO DE TROZOS A DIBUJAR
00001911                          1413  
00001911                          1414  ; --- VARIABLES DEL MARCADOR -------------------------------------------------
00001911                          1415  
00001912                          1416  JGOPNTS     DS.W    1                       ; PUNTUACIÓN DEL JUEGO
00001914                          1417  
00001914                          1418  
00001914                          1419  
00001914                          1420  
00001914                          1421  -------------------- end include --------------------
00001914                          1422              INCLUDE 'LIB/UTLVARS.X68'
00001914                          1423  ; =============================================================================
00001914                          1424  ; UTILITY VARIABLES
00001914                          1425  ; =============================================================================
00001914                          1426  
00001914                          1427  UTLRNDIX    DS.B    1                       ; NEXT INDEX TO RANDOM NUMBER
00001916                          1428              DS.W    0
00001916                          1429  -------------------- end include --------------------
00001916                          1430              INCLUDE 'SYSVARS.X68'
00001916                          1431  ; ----------------------------------------------------------------------------
00001916                          1432  ; VARIABLES DEL SISTEMA
00001916                          1433  ; ----------------------------------------------------------------------------
00001916                          1434  
00001916                          1435  ; --- VARIABLES DE LA MATRIZ -------------------------------------------------
00001916                          1436  
00001916                          1437  ESTDCLDS    DS.B    TCELDAS                 ; ESTADO DE LAS CELDAS 0=VACÍO  1=COLA   2=SEGMENTO  TRZPLOT=CABEZA  4?=MANZANA    
00001C16                          1438  ESTDCBZ     DS.B    1                       ; 0= DERECHA, 1=ARRIBA, 2=IZQUIERDA, 3=ABAJO
00001C17                          1439  
00001C17                          1440  ; --- VARIABLES DE TECLADO ---------------------------------------------------
00001C17                          1441  
00001C17                          1442  KBDVAL      DS.B    1
00001C18                          1443  KBDEDGE     DS.B    1                       ; KEY EDGE
00001C1A                          1444  LASTKEY     DS.L    1                       
00001C1E                          1445  
00001C1E                          1446  
00001C1E                          1447  
00001C1E                          1448  
00001C1E                          1449  
00001C1E                          1450  
00001C1E                          1451  
00001C1E                          1452  
00001C1E                          1453  
00001C1E                          1454  
00001C1E                          1455  
00001C1E                          1456  
00001C1E                          1457  
00001C1E                          1458  
00001C1E                          1459  
00001C1E                          1460  
00001C1E                          1461  -------------------- end include --------------------
00001C1E                          1462      
00001C1E                          1463      
00001C1E                          1464              END    START        

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
APPLEINIT           1496
APPLEPLOT           1506
APPLEUPD            14C8
CBZFCOL             AA00
CBZHEIGH            14
CBZOCPD             16A8
CBZPCOL             FF00
CBZPOSX             1900
CBZPOSY             1902
CBZVEL              14
CBZVELX             1904
CBZVELY             1906
CBZWIDTH            14
CHCKUPDT            14E0
CHECK               14A2
CHECKCLD            1768
CHKARR              10BC
CHKDER              10D0
CHKDWN              10E4
CINDMTRZ            166E
CLDFREE             1780
CLNCLDS             1602
CNVICOOR            172C
COLFCOL             AA00
COLFND              90EE90
COLHEIGH            A
COLOCPD             1700
COLPCOL             FF00
COLPOSX             1908
COLPOSY             190A
COLWIDTH            A
CONTINU             10F4
DIVX                1676
DIVY                168A
DONEPLOT            1874
ENDDIVX             1686
ENDDIVY             169A
ENDMULTX            1750
ENDMULTY            1762
ESTDCBZ             1C16
ESTDCLDS            1916
FIN                 1306
FONPLOT             1786
GAMEOVER            1302
GENPOSMNZ           1584
HEADINIT            1234
HEADPLOT            130C
HEADUPD             1262
JGOPNTS             1912
KBDDOWN             28
KBDEDGE             1C18
KBDINIT             1066
KBDLEFT             25
KBDRIGHT            27
KBDUP               26
KBDUPD              1074
KBDUPD:LOOP         108A
KBDVAL              1C17
LASTKEY             1C1A
LNGINI              1
MARKCLD             12F8
MARKMNZ             14BA
MAXSGM              1
MCLDVCIA            16D4
MNZFCOL             FF
MNZHEIGH            14
MNZOCPD             1716
MNZPCOL             AAFF
MNZPOSX             18FC
MNZPOSY             18FE
MNZWIDTH            14
MTZINIT             15F4
MTZPLOT             182E
MTZUPD              17C4
MTZUPD:CLNCLDS      17D2
MULTLOOPX           1742
MULTLOOPY           1754
NEWMNZ              14F8
NUMCLMNS            20
NUMFILAS            18
OJOFCOL             FFFFFF
OJOHEIGH            A
OJOPCOL             0
OJOWIDTH            A
PANHEIGH            1E0
PANWIDTH            280
PLOTAPPLE           1898
PLOTCBZ             1880
PLOTCLDS            1848
PLOTCOL             188C
PLOTSEG             1892
PLOTVAC             1886
PNTSFCOL            0
PNTSTEXT            65
RSTCLD              16C0
SCOINIT             15B6
SCOPLOT             15C0
SCOPLOT:TXT1        15EA
SCOUPD              15BE
SCRINIT             101E
SCRPLOT             104C
SEGINIT             13A2
SEGPLOT             13E2
SEGUPD              13B4
SGMFCOL             AA00
SGMHEIGH            14
SGMOCPD             16EA
SGMPCOL             FF00
SGMPOSX             190C
SGMPOSY             190E
SGMWIDTH            14
SIGABA              12CC
SIGARR              12B4
SIGDER              12A8
SIGIZQ              12C0
SIZECLDA            14
START               189E
START:LOOP          18C2
SYSINIT             1000
TAILINIT            1422
TAILPLOT            1456
TAILUPD             1434
TCELDAS             300
TRZPLOT             1910
UPDMTRZ             12D4
UTLINIT             1100
UTLRAND             1116
UTLRAND:RANDVEC     1134
UTLRNDIX            1914
