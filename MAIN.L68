0000189A Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 19/12/2024 18:01:12

00000000                             1  *-----------------------------------------------------------------------------
00000000                             2  * Title      : MAIN
00000000                             3  * Written by :
00000000                             4  * Date       :
00000000                             5  * Description:
00000000                             6  *-----------------------------------------------------------------------------
00000000                             7  
00001000                             8              ORG    $1000
00001000                             9              
00001000                            10              INCLUDE 'CONST.X68'
00001000                            11  ; ----------------------------------------------------------------------------
00001000                            12  ; CONSTANTES DEL JUEGO
00001000                            13  ; ----------------------------------------------------------------------------
00001000                            14     
00001000                            15  ; --- CONSTANTES DE LA MANZANA -----------------------------------------------
00001000                            16  
00001000  =00000014                 17  MNZWIDTH    EQU     20                      ; ANCHURA DE LA MANZANA (a determinar)
00001000  =00000014                 18  MNZHEIGH    EQU     20                      ; ALTURA DE LA MANZANA (a determinar)
00001000  =0000AAFF                 19  MNZPCOL     EQU     $0000AAFF               ; COLOR CONTORNO MANZANA (a determinar)
00001000  =000000FF                 20  MNZFCOL     EQU     $000000FF               ; COLOR RELLENO MANZANA (a determinar)
00001000                            21  
00001000                            22  ; --- CONSTANTES DE LA SERPIENTE ---------------------------------------------
00001000                            23  
00001000  =00000001                 24  MAXSGM      EQU     1                       ; TAMAÑO MÁXIMO DE SEGMENTOS (a determinar)
00001000  =00000001                 25  LNGINI      EQU     1                       ; LONGITUD INICIAL SERPIENTE (a determinar)
00001000  =00000014                 26  SGMWIDTH    EQU     20                      ; ANCHURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 27  SGMHEIGH    EQU     20                      ; ALTURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 28  CBZVEL      EQU     20                      ; VELOCIDAD DE LA CABEZA (a determinar)
00001000  =0000FF00                 29  SGMPCOL     EQU     $0000FF00               ; COLOR CONTORNO SEGMENTO (PROVISIONAL)
00001000  =0000AA00                 30  SGMFCOL     EQU     $0000AA00               ; COLOR RELLENO SEGMENTO (PROVISIONAL)
00001000  =0000000A                 31  COLWIDTH    EQU     10                      ; ANCHURA DE LA COLA (PROVISIONAL)
00001000  =0000000A                 32  COLHEIGH    EQU     10                      ; ALTURA DE LA COLA (PROVISIONAL)
00001000  =0000FF00                 33  COLPCOL     EQU     $0000FF00               ; COLOR CONTORNO COLA (PROVISIONAL)
00001000  =0000AA00                 34  COLFCOL     EQU     $0000AA00               ; COLOR RELLENO COLA (PROVISIONAL)
00001000  =00000014                 35  CBZWIDTH    EQU     20                      ; ANCHURA DE LA CABEZA (PROVISIONAL)
00001000  =00000014                 36  CBZHEIGH    EQU     20                      ; ALTURA DE LA CABEZA (PROVISIONAL)
00001000  =0000FF00                 37  CBZPCOL     EQU     $0000FF00               ; COLOR CONTORNO CABEZA (PROVISIONAL)
00001000  =0000AA00                 38  CBZFCOL     EQU     $0000AA00               ; COLOR RELLENO CABEZA (PROVISIONAL)
00001000  =0000000A                 39  OJOWIDTH    EQU     10                      ; ANCHURA DE OJO DE SERPIENTE
00001000  =0000000A                 40  OJOHEIGH    EQU     10                      ; ALTURA DE OJO DE SERPIENTE
00001000  =00000000                 41  OJOPCOL     EQU     $00000000               ; COLOR CONTORNO OJO
00001000  =00FFFFFF                 42  OJOFCOL     EQU     $00FFFFFF               ; COLOR RELLENO OJO
00001000                            43  
00001000                            44  
00001000                            45  
00001000                            46  ; --- CONSTANTES MARCADOR ----------------------------------------------------
00001000                            47  
00001000  =00000001                 48  PNTSFCOL    EQU     1                       ; COLOR FONDO MARCADOR (a determinar)
00001000  =00000001                 49  PNTSTEXT    EQU     1                       ; COORDENADAS DEL MARCADOR (a determinar)
00001000                            50  
00001000                            51  
00001000                            52  
00001000                            53  
00001000                            54  
00001000                            55  
00001000                            56  
00001000                            57  -------------------- end include --------------------
00001000                            58              INCLUDE 'SYSCONST.X68'
00001000                            59  ; ----------------------------------------------------------------------------
00001000                            60  ; CONSTANTES DEL SISTEMA
00001000                            61  ; ----------------------------------------------------------------------------
00001000                            62  
00001000                            63  ; ---CONSTANTES DE LA PANTALLA------------------------------------------------
00001000                            64  
00001000  =00000280                 65  PANWIDTH    EQU     640                     ; ANCHO DE LA PANTALLA
00001000  =000001E0                 66  PANHEIGH    EQU     480                     ; ALTURA DE LA PANTALLA
00001000  =0090EE90                 67  COLFND      EQU     $90EE90                 ; COLOR DEL FONDO DE LA PANTALLA
00001000                            68  
00001000                            69  ; ---CONSTANTES DE LA MATRIZ--------------------------------------------------
00001000                            70  
00001000  =00000014                 71  SIZECLDA    EQU     20                      ; TAMAÑO DE CADA CELDA EN PIXELES
00001000  =00000020                 72  NUMCLMNS    EQU     32                      ; COLUMNAS DE CELDAS (640/10)
00001000  =00000018                 73  NUMFILAS    EQU     24                      ; FILAS DE CELDAS (480/10)
00001000  =00000300                 74  TCELDAS     EQU     768                     ; TOTAL DE CELDAS (64 * 48)
00001000                            75  
00001000                            76  ; ---CÓDIGOS DE TECLADO-------------------------------------------------------
00001000                            77  
00001000  =00000025                 78  KBDLEFT     EQU     $25
00001000  =00000026                 79  KBDUP       EQU     $26
00001000  =00000027                 80  KBDRIGHT    EQU     $27
00001000  =00000028                 81  KBDDOWN     EQU     $28
00001000                            82  
00001000                            83  
00001000                            84  -------------------- end include --------------------
00001000                            85              INCLUDE 'SYSTEM.X68'
00001000                            86   
00001000                            87   
00001000                            88  SYSINIT
00001000                            89  ; INICIA EL  SISTEMA
00001000                            90  ; INPUT    : NONE
00001000                            91  ; OUTPUT   : NONE
00001000                            92  ; MODIFIES : NONE
00001000                            93  ; ----------------------------------------------------------------------------
00001000  4EB9 0000101E             94              JSR     SCRINIT
00001006                            95              
00001006  21FC 0000104C 0080        96              MOVE.L  #SCRPLOT,($80)
0000100E  21FC 00001074 0084        97              MOVE.L  #KBDUPD,($84)
00001016                            98              
00001016  40E7                      99              MOVE.W  SR,-(A7)
00001018  0257 DFFF                100              ANDI.W  #$DFFF,(A7)
0000101C                           101              
0000101C  4E73                     102              RTE
0000101E                           103              
0000101E                           104  ; ------------------------------------------------------------------------------
0000101E                           105  SCRINIT
0000101E                           106  ; INIT SCREEN. SET SCREEN RESOLUTION, SET WINDOWED MODE, CLEAR SCREEN,
0000101E                           107  ; ENABLE DOUBLE BUFFER.
0000101E                           108  ; INPUT    : NONE
0000101E                           109  ; OUTPUT   : NONE
0000101E                           110  ; MODIFIES : NONE
0000101E                           111  ; ------------------------------------------------------------------------------
0000101E                           112  
0000101E  48E7 C000                113              MOVEM.L D0-D1,-(A7)
00001022                           114  
00001022                           115              ; SET SCREEN RESOLUTION
00001022  103C 0021                116              MOVE.B  #33,D0
00001026  223C 028001E0            117              MOVE.L  #PANWIDTH<<16|PANHEIGH,D1
0000102C  4E4F                     118              TRAP    #15
0000102E                           119              
0000102E                           120              ; SET WINDOWED MODE
0000102E  7201                     121              MOVE.L  #1,D1
00001030  4E4F                     122              TRAP    #15
00001032                           123              
00001032                           124              ; CLEAR SCREEN
00001032  103C 000B                125              MOVE.B  #11,D0
00001036  323C FF00                126              MOVE.W  #$FF00,D1
0000103A  4E4F                     127              TRAP    #15
0000103C                           128              
0000103C                           129              ; ENABLE DOUBLE BUFFER
0000103C  103C 005C                130              MOVE.B  #92,D0
00001040  123C 0011                131              MOVE.B  #17,D1
00001044  4E4F                     132              TRAP    #15
00001046                           133              
00001046  4CDF 0003                134              MOVEM.L (A7)+,D0-D1
0000104A                           135              
0000104A  4E75                     136              RTS    
0000104C                           137  
0000104C                           138  ; ------------------------------------------------------------------------------
0000104C                           139  SCRPLOT
0000104C                           140  ; UPDATES DOUBLE BUFFER
0000104C                           141  ; INPUT    : NONE
0000104C                           142  ; OUTPUT   : NONE
0000104C                           143  ; MODIFIES : NONE
0000104C                           144  ; ------------------------------------------------------------------------------
0000104C                           145  
0000104C  48A7 C000                146              MOVEM.W D0-D1,-(A7)
00001050                           147              
00001050                           148              ; SWITCH BUFFERS
00001050  103C 005E                149              MOVE.B  #94,D0
00001054  4E4F                     150              TRAP    #15
00001056                           151              
00001056                           152              ; CLEAR HIDDEN BUFFER
00001056  103C 000B                153              MOVE.B  #11,D0
0000105A  323C FF00                154              MOVE.W  #$FF00,D1
0000105E  4E4F                     155              TRAP    #15
00001060                           156              
00001060  4C9F 0003                157              MOVEM.W (A7)+,D0-D1
00001064                           158              
00001064  4E73                     159              RTE
00001066                           160          
00001066                           161  ; ------------------------------------------------------------------------------
00001066                           162  KBDINIT
00001066                           163  ; INIT KEYBOARD
00001066                           164  ; INPUT    : NONE
00001066                           165  ; OUTPUT   : NONE
00001066                           166  ; MODIFIES : NONE
00001066                           167  ; ------------------------------------------------------------------------------
00001066  4239 00001C0F            168              CLR.B   (KBDVAL)
0000106C  4239 00001C10            169              CLR.B   (KBDEDGE)
00001072  4E75                     170              RTS
00001074                           171  
00001074                           172  ; ------------------------------------------------------------------------------
00001074                           173  KBDUPD
00001074                           174  ; UPDATE KEYBOARD INFO.  
00001074                           175  ; 7 -> PAUSE
00001074                           176  ; 6 -> FIRE 3
00001074                           177  ; 5 -> FIRE 2
00001074                           178  ; 4 -> FIRE 1
00001074                           179  ; 3 -> DOWN
00001074                           180  ; 2 -> RIGHT
00001074                           181  ; 1 -> UP
00001074                           182  ; 0 -> LEFT
00001074                           183  ; INPUT    : NONE
00001074                           184  ; OUTPUT   : NONE
00001074                           185  ; MODIFIES : NONE
00001074                           186  ; ------------------------------------------------------------------------------
00001074                           187  
00001074  48E7 E000                188              MOVEM.L D0-D2,-(A7)
00001078                           189  
00001078                           190              ; LEE ESTADO DEL TECLADO
00001078  103C 0013                191              MOVE.B  #19,D0
0000107C  223C 25262728            192              MOVE.L  #KBDLEFT<<24|KBDUP<<16|KBDRIGHT<<8|KBDDOWN,D1
00001082  4E4F                     193              TRAP    #15                  ; Lee las teclas y guarda en D1
00001084  23C1 00001C12            194              MOVE.L  D1,(LASTKEY)         ; Guarda la última tecla leída
0000108A                           195  
0000108A                           196              ; PROCESA FLANCOS ASCENDENTES
0000108A  1039 00001C0F            197              MOVE.B  (KBDVAL),D0          ; Estado anterior
00001090  4600                     198              NOT.B   D0                   ; Invertir bits (teclas no presionadas)
00001092  C002                     199              AND.B   D2,D0                ; Detectar flancos ascendentes
00001094  13C0 00001C10            200              MOVE.B  D0,(KBDEDGE)         ; Almacena los flancos en KBDEDGE
0000109A                           201  
0000109A                           202              ; ACTUALIZA EL ESTADO DE LA DIRECCIÓN
0000109A  4240                     203              CLR.W   D0
0000109C  2039 00001C10            204              MOVE.L  (KBDEDGE),D0         ; Lee teclas con flanco ascendente
000010A2                           205  
000010A2                           206              ; Detecta pulsaciones y actualiza ESTDCBZ
000010A2  B0BC 000000FF            207              CMP.L   #$000000FF,D0        ; Tecla ABAJO
000010A8  6700 0048                208              BEQ     DWN
000010AC  B0BC 0000FF00            209              CMP.L   #$0000FF00,D0        ; Tecla DERECHA
000010B2  6700 001A                210              BEQ     DER
000010B6  B0BC 00FF0000            211              CMP.L   #$00FF0000,D0        ; Tecla ARRIBA
000010BC  6700 001C                212              BEQ     ARR
000010C0  B0BC FF000000            213              CMP.L   #$FF000000,D0        ; Tecla IZQUIERDA
000010C6  6700 001E                214              BEQ     IZQ
000010CA                           215              
000010CA                           216              ; Si no hay pulsaciones, mantener estado
000010CA  6000 0032                217              BRA     CONTINU
000010CE                           218  
000010CE  33FC 0000 00001C0E       219  DER:        MOVE.W  #0,ESTDCBZ           ; Actualiza estado a DERECHA
000010D6  6000 0026                220              BRA     CONTINU
000010DA                           221              
000010DA  33FC 0001 00001C0E       222  ARR:        MOVE.W  #1,ESTDCBZ           ; Actualiza estado a ARRIBA
000010E2  6000 001A                223              BRA     CONTINU
000010E6                           224  
000010E6  33FC 0002 00001C0E       225  IZQ:        MOVE.W  #2,ESTDCBZ           ; Actualiza estado a IZQUIERDA
000010EE  6000 000E                226              BRA     CONTINU                    
000010F2                           227  
000010F2  33FC 0003 00001C0E       228  DWN:        MOVE.W  #3,ESTDCBZ           ; Actualiza estado a ABAJO
000010FA  6000 0002                229              BRA     CONTINU
000010FE                           230  
000010FE                           231  CONTINU:
000010FE  4CDF 0007                232              MOVEM.L (A7)+,D0-D2
00001102  4E73                     233              RTE
00001104                           234  
00001104                           235  
00001104                           236  
00001104                           237  
00001104                           238  
00001104                           239  
00001104                           240  
00001104                           241  
00001104                           242  
00001104                           243  
00001104                           244  
00001104                           245  
00001104                           246  -------------------- end include --------------------
00001104                           247              INCLUDE 'LIB/UTLCODE.X68'
00001104                           248  ; =============================================================================
00001104                           249  ; UTILITY CODE
00001104                           250  ; =============================================================================
00001104                           251  
00001104                           252  ; -----------------------------------------------------------------------------
00001104                           253  UTLINIT
00001104                           254  ; INITIALIZES UTILITY CODE
00001104                           255  ; INPUT    - NONE
00001104                           256  ; OUTPUT   - NONE
00001104                           257  ; MODIFIES - NONE
00001104                           258  ; -----------------------------------------------------------------------------
00001104  48E7 C000                259              MOVEM.L D0-D1,-(A7)
00001108  103C 0008                260              MOVE.B  #8,D0
0000110C  4E4F                     261              TRAP    #15
0000110E  13C1 0000190C            262              MOVE.B  D1,(UTLRNDIX)
00001114  4CDF 0003                263              MOVEM.L (A7)+,D0-D1
00001118  4E75                     264              RTS
0000111A                           265  
0000111A                           266  ; -----------------------------------------------------------------------------
0000111A                           267  UTLRAND
0000111A                           268  ; PROVIDES A PSEUDO-RANDOM BYTE
0000111A                           269  ; INPUT    - NONE
0000111A                           270  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
0000111A                           271  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000111A                           272  ; -----------------------------------------------------------------------------
0000111A  2F08                     273              MOVE.L  A0,-(A7)
0000111C  41F9 00001138            274              LEA     .RANDVEC,A0
00001122  4280                     275              CLR.L   D0
00001124  1039 0000190C            276              MOVE.B  (UTLRNDIX),D0
0000112A  1030 0800                277              MOVE.B  (A0,D0.L),D0
0000112E  5239 0000190C            278              ADDQ.B  #1,(UTLRNDIX)
00001134  205F                     279              MOVE.L  (A7)+,A0
00001136  4E75                     280              RTS
00001138                           281  
00001138                           282  
00001138= A2 EE 9A 0C F5 24 ...    283  .RANDVEC    DC.B    162, 238, 154, 12 , 245, 36 , 32 , 103
00001140= 2A A3 51 26 E0 AC ...    284              DC.B    42 , 163, 81 , 38 , 224, 172, 19 , 69
00001148= 75 51 CA FD 33 EB ...    285              DC.B    117, 81 , 202, 253, 51 , 235, 108, 154
00001150= 60 CC E7 B8 9A EB ...    286              DC.B    96 , 204, 231, 184, 154, 235, 34 , 203
00001158= 1D 76 B5 95 B0 89 ...    287              DC.B    29 , 118, 181, 149, 176, 137, 62 , 108
00001160= 39 15 48 C9 6E CA ...    288              DC.B    57 , 21 , 72 , 201, 110, 202, 159, 41
00001168= 43 E7 E2 7C 37 25 ...    289              DC.B    67 , 231, 226, 124, 55 , 37 , 84 , 62
00001170= E9 94 CE E9 E4 52 ...    290              DC.B    233, 148, 206, 233, 228, 82 , 243, 78
00001178= 37 6D 9A 84 A2 28 ...    291              DC.B    55 , 109, 154, 132, 162, 40 , 30 , 39
00001180= 19 E2 C6 77 80 D4 ...    292              DC.B    25 , 226, 198, 119, 128, 212, 232, 225
00001188= 0A 5A 32 67 33 C2 ...    293              DC.B    10 , 90 , 50 , 103, 51 , 194, 222, 40
00001190= 59 80 DC 0E 57 FC ...    294              DC.B    89 , 128, 220, 14 , 87 , 252, 243, 252
00001198= 8A AB BC F7 07 4D ...    295              DC.B    138, 171, 188, 247, 7  , 77 , 29 , 234
000011A0= EF D5 77 6E 1E BB ...    296              DC.B    239, 213, 119, 110, 30 , 187, 131, 23
000011A8= D6 E0 2A 8F BD 28 ...    297              DC.B    214, 224, 42 , 143, 189, 40 , 212, 130
000011B0= 13 4F 66 EC 0A 64 ...    298              DC.B    19 , 79 , 102, 236, 10 , 100, 122, 188
000011B8= 56 52 9A 16 9B 90 ...    299              DC.B    86 , 82 , 154, 22 , 155, 144, 7  , 199
000011C0= 06 8A A4 F7 01 DA ...    300              DC.B    6  , 138, 164, 247, 1  , 218, 166, 82
000011C8= F2 E7 77 28 B1 76 ...    301              DC.B    242, 231, 119, 40 , 177, 118, 220, 102
000011D0= A4 42 E3 81 B1 67 ...    302              DC.B    164, 66 , 227, 129, 177, 103, 165, 108
000011D8= BF CE FA 16 BF 38 ...    303              DC.B    191, 206, 250, 22 , 191, 56 , 30 , 161
000011E0= D1 8B 50 0C 5F 49 ...    304              DC.B    209, 139, 80 , 12 , 95 , 73 , 168, 56
000011E8= DE 4C 14 A2 40 DC ...    305              DC.B    222, 76 , 20 , 162, 64 , 220, 93 , 12
000011F0= B6 9B 0A 38 5D AB ...    306              DC.B    182, 155, 10 , 56 , 93 , 171, 89 , 6
000011F8= E2 1B DD 75 15 82 ...    307              DC.B    226, 27 , 221, 117, 21 , 130, 101, 18
00001200= 8A 26 51 30 9F 47 ...    308              DC.B    138, 38 , 81 , 48 , 159, 71 , 57 , 21
00001208= 1E 8A BB 71 C6 6E ...    309              DC.B    30 , 138, 187, 113, 198, 110, 185, 152
00001210= 9F 47 E5 34 94 27 ...    310              DC.B    159, 71 , 229, 52 , 148, 39 , 77 , 6
00001218= 7D 06 D6 BA 30 0F ...    311              DC.B    125, 6  , 214, 186, 48 , 15 , 212, 22
00001220= EC 7F 7E 03 CF 2D ...    312              DC.B    236, 127, 126, 3  , 207, 45 , 193, 2
00001228= 94 5B 23 F2 8B CD ...    313              DC.B    148, 91 , 35 , 242, 139, 205, 248, 237
00001230= 74 33 EC B9 0F D5 ...    314              DC.B    116, 51 , 236, 185, 15 , 213, 221, 6
00001230= 74 33 EC B9 0F D5 ...    315  -------------------- end include --------------------
00001238                           316              INCLUDE 'HEADSRP.X68'
00001238                           317  
00001238                           318  ; ------------------------------------------------------------------------------
00001238                           319  HEADINIT
00001238                           320  ; INICIALIZAR CABEZA.
00001238                           321  ; INPUT    : NONE 
00001238                           322  ; OUTPUT   : NONE
00001238                           323  ; MODIFIES : NONE
00001238                           324  ; ------------------------------------------------------------------------------
00001238  33FC 0140 000018F8       325              MOVE.W  #PANWIDTH/2,(CBZPOSX)
00001240  33FC 00F0 000018FA       326              MOVE.W  #PANHEIGH/2,(CBZPOSY)
00001248  4279 00001908            327              CLR     TRZPLOT
0000124E  13FC 0003 00001908       328              MOVE.B  #3,TRZPLOT
00001256  4279 00001C0E            329              CLR.W   ESTDCBZ
0000125C  33FC 0000 00001C0E       330              MOVE.W  #0,ESTDCBZ
00001264  4E75                     331              RTS
00001266                           332              
00001266                           333  ; ------------------------------------------------------------------------------
00001266                           334  HEADUPD
00001266                           335  ; ACTUALIZAR CABEZA.
00001266                           336  ; INPUT    : NONE 
00001266                           337  ; OUTPUT   : NONE
00001266                           338  ; MODIFIES : NONE
00001266                           339  ; ------------------------------------------------------------------------------
00001266  48A7 E000                340              MOVEM.W D0-D2,-(A7)
0000126A                           341                       
0000126A  4240                     342              CLR.W   D0
0000126C  4241                     343              CLR.W   D1
0000126E  4242                     344              CLR.W   D2
00001270  3239 000018F8            345              MOVE.W  CBZPOSX,D1
00001276  33C1 00001904            346              MOVE.W  D1,SGMPOSX
0000127C  3439 000018FA            347              MOVE.W  CBZPOSY,D2
00001282  33C2 00001906            348              MOVE.W  D2,SGMPOSY
00001288  4EB9 0000166A            349              JSR     CINDMTRZ
0000128E  4EB9 000016BC            350              JSR     RSTCLD
00001294                           351              
00001294  4240                     352              CLR.W   D0
00001296  3039 00001C0E            353              MOVE.W  ESTDCBZ,D0
0000129C  B07C 0000                354              CMP.W   #0,D0
000012A0  6700 001A                355              BEQ     SIGDER
000012A4  B07C 0001                356              CMP.W   #1,D0
000012A8  6700 0036                357              BEQ     SIGARR
000012AC  B07C 0002                358              CMP.W   #2,D0
000012B0  6700 0052                359              BEQ     SIGIZQ
000012B4  B07C 0003                360              CMP.W   #3,D0
000012B8  6700 006E                361              BEQ     SIGABA
000012BC                           362              
000012BC  0679 0014 000018F8       363  SIGDER:     ADD.W   #CBZVEL,CBZPOSX               ;AUMENTAMOS LA POSICIÓN DE LA SERPIENTE 
000012C4  3239 000018F8            364              MOVE.W  CBZPOSX,D1
000012CA  3439 000018FA            365              MOVE.W  CBZPOSY,D2
000012D0  4EB9 0000166A            366              JSR     CINDMTRZ
000012D6  4EB9 000016A4            367              JSR     CBZOCPD  
000012DC  6000 006E                368              BRA     FIN
000012E0                           369              
000012E0  0479 0014 000018FA       370  SIGARR:     SUB.W   #CBZVEL,CBZPOSY              ;AUMENTAMOS LA POSICIÓN DE LA SERPIENTE
000012E8  3239 000018F8            371              MOVE.W  CBZPOSX,D1
000012EE  3439 000018FA            372              MOVE.W  CBZPOSY,D2 
000012F4  4EB9 0000166A            373              JSR     CINDMTRZ
000012FA  4EB9 000016A4            374              JSR     CBZOCPD  
00001300  6000 004A                375              BRA     FIN   
00001304                           376    
00001304  0479 0014 000018F8       377  SIGIZQ:     SUB.W   #CBZVEL,CBZPOSX              ;AUMENTAMOS LA POSICIÓN DE LA SERPIENTE 
0000130C  3239 000018F8            378              MOVE.W  CBZPOSX,D1
00001312  3439 000018FA            379              MOVE.W  CBZPOSY,D2
00001318  4EB9 0000166A            380              JSR     CINDMTRZ
0000131E  4EB9 000016A4            381              JSR     CBZOCPD  
00001324  6000 0026                382              BRA     FIN      
00001328                           383  
00001328  0679 0014 000018FA       384  SIGABA:     ADD.W   #CBZVEL,CBZPOSY               ;AUMENTAMOS LA POSICIÓN DE LA SERPIENTE 
00001330  3239 000018F8            385              MOVE.W  CBZPOSX,D1
00001336  3439 000018FA            386              MOVE.W  CBZPOSY,D2
0000133C  4EB9 0000166A            387              JSR     CINDMTRZ 
00001342  4EB9 000016A4            388              JSR     CBZOCPD  
00001348  6000 0002                389              BRA     FIN      
0000134C                           390              
0000134C                           391  FIN:            
0000134C  4C9F 0007                392              MOVEM.W (A7)+,D0-D2
00001350  4E75                     393              RTS
00001352                           394              
00001352                           395  ; ------------------------------------------------------------------------------
00001352                           396  HEADPLOT
00001352                           397  ; DIBUJAR CABEZA.
00001352                           398  ; INPUT    : NONE 
00001352                           399  ; OUTPUT   : NONE
00001352                           400  ; MODIFIES : NONE
00001352                           401  ; ------------------------------------------------------------------------------
00001352  3F00                     402             MOVE.W  D0,-(A7)                ; GUARDAMOS D0
00001354  3003                     403              MOVE.W  D3,D0                  ; PONEMOS EL INDICE DE LA CELDA EN D0 PARA CALCULAR SUS COORDENADAS
00001356  4EB9 00001728            404              JSR     CNVICOOR
0000135C  2F01                     405              MOVE.L  D1,-(A7)
0000135E                           406              
0000135E                           407              ; SET COLOR DEL CONTORNO CABEZA
0000135E  103C 0050                408              MOVE.B  #80,D0
00001362  223C 0000FF00            409              MOVE.L  #CBZPCOL,D1
00001368  4E4F                     410              TRAP    #15
0000136A                           411              
0000136A                           412              ; SET COLOR DEL RELLENO CABEZA
0000136A  103C 0051                413              MOVE.B  #81,D0
0000136E  223C 0000AA00            414              MOVE.L  #CBZFCOL,D1
00001374  4E4F                     415              TRAP    #15
00001376                           416              
00001376                           417              ; DIBUJAR CABEZA
00001376  103C 0057                418              MOVE.B  #87,D0
0000137A  221F                     419              MOVE.L  (A7)+,D1
0000137C  3F03                     420              MOVE.W  D3,-(A7)
0000137E  3601                     421              MOVE.W  D1,D3
00001380  0643 0014                422              ADD.W   #CBZWIDTH,D3
00001384  3802                     423              MOVE.W  D2,D4
00001386  0644 0014                424              ADD.W   #CBZHEIGH,D4
0000138A  4E4F                     425              TRAP    #15
0000138C                           426              
0000138C  2F01                     427              MOVE.L  D1,-(A7)
0000138E                           428              
0000138E                           429              ; SET COLOR DEL CONTORNO OJO
0000138E  103C 0050                430              MOVE.B  #80,D0
00001392  7200                     431              MOVE.L  #OJOPCOL,D1
00001394  4E4F                     432              TRAP    #15
00001396                           433              
00001396                           434              ; SET COLOR DEL RELLENO OJO
00001396  103C 0051                435              MOVE.B  #81,D0
0000139A  223C 00FFFFFF            436              MOVE.L  #OJOFCOL,D1
000013A0  4E4F                     437              TRAP    #15
000013A2                           438              
000013A2                           439              ; DIBUJAR OJO
000013A2  103C 0058                440              MOVE.B  #88,D0
000013A6  221F                     441              MOVE.L  (A7)+,D1
000013A8  2F01                     442              MOVE.L  D1,-(A7)
000013AA  2F02                     443              MOVE.L  D2,-(A7)
000013AC  5A41                     444              ADD.W   #OJOWIDTH/2,D1            
000013AE  3601                     445              MOVE.W  D1,D3
000013B0  0643 000A                446              ADD.W   #OJOWIDTH,D3
000013B4  5A42                     447              ADD.W   #OJOHEIGH/2,D2
000013B6  3802                     448              MOVE.W  D2,D4
000013B8  0644 000A                449              ADD.W   #OJOHEIGH,D4
000013BC  4E4F                     450              TRAP    #15
000013BE                           451  
000013BE                           452              ; DEFINIR COORDENADAS IRIS
000013BE  241F                     453              MOVE.L  (A7)+,D2
000013C0  221F                     454              MOVE.L  (A7)+,D1
000013C2  0641 000A                455              ADD.W   #OJOWIDTH,D1
000013C6  0642 000A                456              ADD.W   #OJOHEIGH,D2
000013CA  103C 0052                457              MOVE.B  #82,D0
000013CE  4E4F                     458              TRAP    #15
000013D0                           459              
000013D0                           460              
000013D0  361F                     461              MOVE.W  (A7)+,D3
000013D2  301F                     462              MOVE.W  (A7)+,D0
000013D4                           463  
000013D4                           464  
000013D4  4E75                     465              RTS
000013D6                           466  
000013D6                           467  
000013D6                           468  
000013D6                           469  
000013D6                           470  
000013D6                           471  
000013D6                           472  
000013D6                           473  
000013D6                           474  
000013D6                           475  
000013D6                           476  
000013D6                           477  
000013D6                           478  
000013D6                           479  
000013D6                           480  
000013D6                           481  
000013D6                           482  -------------------- end include --------------------
000013D6                           483              INCLUDE 'SEGSRP.X68'
000013D6                           484  
000013D6                           485  ; ------------------------------------------------------------------------------
000013D6                           486  SEGINIT
000013D6                           487  ; INICIALIZAR SEGMENTO.
000013D6                           488  ; INPUT    : NONE 
000013D6                           489  ; OUTPUT   : NONE
000013D6                           490  ; MODIFIES : NONE
000013D6                           491  ; ------------------------------------------------------------------------------
000013D6  33FC 012C 00001904       492              MOVE.W  #(PANWIDTH/2)-CBZWIDTH,(SGMPOSX)
000013DE  33FC 00F0 00001906       493              MOVE.W  #PANHEIGH/2,(SGMPOSY)
000013E6  4E75                     494              RTS
000013E8                           495              
000013E8                           496  ; ------------------------------------------------------------------------------
000013E8                           497  SEGUPD
000013E8                           498  ; ACTUALIZAR SEGMENTO.
000013E8                           499  ; INPUT    : NONE 
000013E8                           500  ; OUTPUT   : NONE
000013E8                           501  ; MODIFIES : NONE
000013E8                           502  ; ------------------------------------------------------------------------------
000013E8  48A7 6000                503              MOVEM.W D1-D2,-(A7)
000013EC                           504              
000013EC  3239 00001904            505              MOVE.W  SGMPOSX,D1
000013F2  33C1 00001900            506              MOVE.W  D1,COLPOSX
000013F8  3439 00001906            507              MOVE.W  SGMPOSY,D2
000013FE  33C2 00001902            508              MOVE.W  D2,COLPOSY
00001404  4EB9 0000166A            509              JSR     CINDMTRZ
0000140A  4EB9 000016BC            510              JSR     RSTCLD
00001410                           511              
00001410  4C9F 0006                512              MOVEM.W (A7)+,D1-D2            
00001414  4E75                     513              RTS
00001416                           514              
00001416                           515  ; ------------------------------------------------------------------------------
00001416                           516  SEGPLOT
00001416                           517  ; DIBUJAR SEGMENTO.
00001416                           518  ; INPUT    : NONE 
00001416                           519  ; OUTPUT   : NONE
00001416                           520  ; MODIFIES : NONE
00001416                           521  ; ------------------------------------------------------------------------------
00001416  3F00                     522              MOVE.W  D0,-(A7)
00001418  3003                     523              MOVE.W  D3,D0
0000141A  4EB9 00001728            524              JSR     CNVICOOR
00001420  2F01                     525              MOVE.L  D1,-(A7)
00001422                           526              
00001422  103C 0050                527              MOVE.B  #80,D0
00001426  223C 0000FF00            528              MOVE.L  #SGMPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DEL SEGMENTO
0000142C  4E4F                     529              TRAP    #15
0000142E                           530              
0000142E  103C 0051                531              MOVE.B  #81,D0
00001432  223C 0000AA00            532              MOVE.L  #SGMFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DEL SEGMENTO
00001438  4E4F                     533              TRAP    #15
0000143A                           534              
0000143A  103C 0057                535              MOVE.B  #87,D0
0000143E  221F                     536              MOVE.L  (A7)+,D1
00001440  3F03                     537              MOVE.W  D3,-(A7)
00001442  3601                     538              MOVE.W  D1,D3
00001444  0643 0014                539              ADD.W   #SIZECLDA,D3
00001448  3802                     540              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
0000144A  0644 0014                541              ADD.W   #SIZECLDA,D4
0000144E  4E4F                     542              TRAP    #15                     
00001450                           543                          
00001450  361F                     544              MOVE.W  (A7)+,D3  
00001452  301F                     545              MOVE.W  (A7)+,D0
00001454                           546  
00001454                           547  
00001454  4E75                     548              RTS
00001456                           549  
00001456                           550  
00001456                           551  
00001456                           552  
00001456                           553  
00001456                           554  
00001456                           555  
00001456                           556  
00001456                           557  
00001456                           558  -------------------- end include --------------------
00001456                           559              INCLUDE 'TAILSRP.X68'
00001456                           560     
00001456                           561  ; ------------------------------------------------------------------------------
00001456                           562  TAILINIT
00001456                           563  ; INICIALIZAR COLA.
00001456                           564  ; INPUT    : NONE 
00001456                           565  ; OUTPUT   : NONE
00001456                           566  ; MODIFIES : NONE
00001456                           567  ; ------------------------------------------------------------------------------
00001456  33FC 011D 00001900       568              MOVE.W  #(PANWIDTH/2)-CBZWIDTH-SGMWIDTH+(COLWIDTH/2),(COLPOSX)
0000145E  33FC 00F0 00001902       569              MOVE.W  #(PANHEIGH/2),(COLPOSY)
00001466  4E75                     570              RTS
00001468                           571              
00001468                           572              
00001468                           573  ; ------------------------------------------------------------------------------
00001468                           574  TAILUPD
00001468                           575  ; ACTUALIZAR COLA.
00001468                           576  ; INPUT    : NONE 
00001468                           577  ; OUTPUT   : NONE
00001468                           578  ; MODIFIES : NONE
00001468                           579  ; ------------------------------------------------------------------------------
00001468  48A7 6000                580              MOVEM.W D1-D2,-(A7)
0000146C                           581              
0000146C  3239 00001900            582              MOVE.W  COLPOSX,D1
00001472  3439 00001902            583              MOVE.W  COLPOSY,D2
00001478  4EB9 0000166A            584              JSR     CINDMTRZ
0000147E  4EB9 000016BC            585              JSR     RSTCLD 
00001484                           586              
00001484  4C9F 0006                587              MOVEM.W (A7)+,D1-D2            
00001488  4E75                     588              RTS
0000148A                           589              
0000148A                           590  ; ------------------------------------------------------------------------------
0000148A                           591  TAILPLOT
0000148A                           592  ; DIBUJAR COLA
0000148A                           593  ; INPUT    : NONE 
0000148A                           594  ; OUTPUT   : NONE
0000148A                           595  ; MODIFIES : NONE
0000148A                           596  ; ------------------------------------------------------------------------------
0000148A  3F00                     597              MOVE.W  D0,-(A7)
0000148C  3003                     598              MOVE.W  D3,D0
0000148E  4EB9 00001728            599              JSR     CNVICOOR
00001494  2F01                     600              MOVE.L  D1,-(A7)
00001496                           601              
00001496  103C 0050                602              MOVE.B  #80,D0
0000149A  223C 0000FF00            603              MOVE.L  #COLPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA COLA
000014A0  4E4F                     604              TRAP    #15
000014A2                           605              
000014A2  103C 0051                606              MOVE.B  #81,D0
000014A6  223C 0000AA00            607              MOVE.L  #COLFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA COLA
000014AC  4E4F                     608              TRAP    #15
000014AE                           609              
000014AE  103C 0057                610              MOVE.B  #87,D0
000014B2  221F                     611              MOVE.L  (A7)+,D1
000014B4  3F03                     612              MOVE.W  D3,-(A7)
000014B6  3601                     613              MOVE.W  D1,D3
000014B8  0643 0014                614              ADD.W   #SIZECLDA,D3
000014BC  3802                     615              MOVE.W  D2,D4                    
000014BE  0644 0014                616              ADD.W   #SIZECLDA,D4
000014C2  4E4F                     617              TRAP    #15                    ; DIBUJAMOS EL CUADRADO 
000014C4                           618                          
000014C4  361F                     619              MOVE.W  (A7)+,D3  
000014C6  301F                     620              MOVE.W  (A7)+,D0
000014C8                           621  
000014C8  4E75                     622              RTS
000014CA                           623  
000014CA                           624  
000014CA                           625  
000014CA                           626  
000014CA                           627  
000014CA                           628  
000014CA                           629  
000014CA                           630  
000014CA                           631  -------------------- end include --------------------
000014CA                           632              INCLUDE 'APPLE.X68'
000014CA                           633     
000014CA                           634  ; ------------------------------------------------------------------------------
000014CA                           635  APPLEINIT
000014CA                           636  ; Inicializa la manzana en una posición aleatoria
000014CA                           637  ; INPUT    : NONE 
000014CA                           638  ; OUTPUT   : NONE
000014CA                           639  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
000014CA                           640  ; ------------------------------------------------------------------------------
000014CA                           641  
000014CA                           642              ; Llama a la función para generar la posición aleatoria
000014CA  4EB9 000015B8            643              JSR     GENPOSMNZ
000014D0                           644  
000014D0                           645              ; Convierte las coordenadas de la manzana a índice de la matriz
000014D0  4EB9 0000166A            646              JSR     CINDMTRZ
000014D6                           647  
000014D6                           648              ; Verifica si la celda está ocupada o libre
000014D6                           649  CHECK:
000014D6  4EB9 00001764            650              JSR     CHECKCLD
000014DC  6700 0010                651              BEQ     MARKMNZ                  ; Si está libre
000014E0                           652  
000014E0                           653              ; Si la celda está ocupada
000014E0  4EB9 000015B8            654              JSR     GENPOSMNZ                ; Genera una nueva posición
000014E6  4EB9 0000166A            655              JSR     CINDMTRZ                 ; Convierte las nuevas coordenadas
000014EC  60E8                     656              BRA     CHECK                    ; Repite la comprobación
000014EE                           657  
000014EE                           658  MARKMNZ:
000014EE                           659              ; Marca la celda como ocupada con la manzana (estado 4)
000014EE  4EB9 00001712            660              JSR     MNZOCPD
000014F4                           661  
000014F4                           662              ; Dibuja la manzana en la pantalla
000014F4  4EB9 0000153A            663              JSR     APPLEPLOT
000014FA                           664  
000014FA  4E75                     665              RTS
000014FC                           666              
000014FC                           667              ;MOVE.W  #30,(MNZPOSX)   ;DE MOMENTO PONGO X E Y ELEGIDAS MANUALMENTE, EN TEORÍA DEBE SER ALEATORIO
000014FC                           668              ;MOVE.W  #30,(MNZPOSY)
000014FC                           669  
000014FC                           670  ; ------------------------------------------------------------------------------
000014FC                           671  APPLEUPD
000014FC                           672  ; Actualiza la posición de la manzana cuando la serpiente come
000014FC                           673  ; INPUT    : NONE 
000014FC                           674  ; OUTPUT   : NONE
000014FC                           675  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
000014FC                           676  ; ------------------------------------------------------------------------------
000014FC                           677  
000014FC                           678              ; Convierte las coordenadas actuales de la manzana a índice de la matriz
000014FC  4EB9 0000166A            679              JSR     CINDMTRZ
00001502                           680  
00001502                           681              ; Marca la celda anterior como vacía
00001502  4EB9 000016D0            682              JSR     MCLDVCIA
00001508                           683  
00001508                           684              ; Llama a la función para generar una nueva posición aleatoria
00001508  4EB9 000015B8            685              JSR     GENPOSMNZ
0000150E                           686  
0000150E                           687              ; Convierte las nuevas coordenadas de la manzana a índice de la matriz
0000150E  4EB9 0000166A            688              JSR     CINDMTRZ
00001514                           689  
00001514                           690  CHCKUPDT:
00001514  4EB9 00001764            691              JSR     CHECKCLD             ; Verifica si la celda está libre
0000151A  6700 0010                692              BEQ     NEWMNZ               ; Si está libre
0000151E                           693  
0000151E                           694              ; Si la celda está ocupada
0000151E  4EB9 000015B8            695              JSR     GENPOSMNZ            ; Genera una nueva posición
00001524  4EB9 0000166A            696              JSR     CINDMTRZ             ; Convierte las nuevas coordenadas
0000152A  60E8                     697              BRA     CHCKUPDT             ; Repite la comprobación
0000152C                           698  
0000152C                           699  NEWMNZ:
0000152C                           700              ; Marca la celda como ocupada con la manzana (estado 4)
0000152C  4EB9 00001712            701              JSR     MNZOCPD
00001532                           702  
00001532                           703              ; Dibuja la nueva manzana en la pantalla
00001532  4EB9 0000153A            704              JSR     APPLEPLOT
00001538                           705  
00001538  4E75                     706              RTS
0000153A                           707              
0000153A                           708  ; ------------------------------------------------------------------------------
0000153A                           709  APPLEPLOT
0000153A                           710  ; Dibuja la manzana
0000153A                           711  ; INPUT    : NONE 
0000153A                           712  ; OUTPUT   : NONE
0000153A                           713  ; MODIFIES : NONE
0000153A                           714  ; ------------------------------------------------------------------------------
0000153A  3F00                     715              MOVE.W  D0,-(A7)
0000153C  3003                     716              MOVE.W  D3,D0
0000153E  4EB9 00001728            717              JSR     CNVICOOR
00001544  2F01                     718              MOVE.L  D1,-(A7)                ; PRIMERO DEBEMOS DIBUJAR EL FONDO Y LUEGO LA MANZANA
00001546                           719              
00001546  103C 0050                720              MOVE.B  #80,D0
0000154A  223C 0090EE90            721              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
00001550  4E4F                     722              TRAP    #15
00001552                           723              
00001552  103C 0051                724              MOVE.B  #81,D0
00001556  223C 0090EE90            725              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
0000155C  4E4F                     726              TRAP    #15
0000155E                           727              
0000155E  103C 0057                728              MOVE.B  #87,D0
00001562  221F                     729              MOVE.L  (A7)+,D1
00001564  3F03                     730              MOVE.W  D3,-(A7)
00001566  3601                     731              MOVE.W  D1,D3
00001568  0643 0014                732              ADD.W   #SIZECLDA,D3
0000156C  3802                     733              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
0000156E  0644 0014                734              ADD.W   #SIZECLDA,D4
00001572  4E4F                     735              TRAP    #15                     
00001574                           736                          
00001574  361F                     737              MOVE.W  (A7)+,D3  
00001576  301F                     738              MOVE.W  (A7)+,D0
00001578                           739  
00001578  3F00                     740              MOVE.W  D0,-(A7)
0000157A  3003                     741              MOVE.W  D3,D0
0000157C  4EB9 00001728            742              JSR     CNVICOOR
00001582  2F01                     743              MOVE.L  D1,-(A7)
00001584                           744              
00001584  103C 0050                745              MOVE.B  #80,D0
00001588  223C 0000AAFF            746              MOVE.L  #MNZPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA MANZANA
0000158E  4E4F                     747              TRAP    #15
00001590                           748              
00001590  103C 0051                749              MOVE.B  #81,D0
00001594  223C 000000FF            750              MOVE.L  #MNZFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA MANZANA
0000159A  4E4F                     751              TRAP    #15
0000159C                           752              
0000159C  103C 0058                753              MOVE.B  #88,D0
000015A0  221F                     754              MOVE.L  (A7)+,D1
000015A2  3F03                     755              MOVE.W  D3,-(A7)
000015A4  3601                     756              MOVE.W  D1,D3
000015A6  0643 0014                757              ADD.W   #SIZECLDA,D3
000015AA  3802                     758              MOVE.W  D2,D4                    ; DIBUJAMOS EL CIRCULO
000015AC  0644 0014                759              ADD.W   #SIZECLDA,D4
000015B0  4E4F                     760              TRAP    #15                     
000015B2                           761                          
000015B2  361F                     762              MOVE.W  (A7)+,D3  
000015B4  301F                     763              MOVE.W  (A7)+,D0
000015B6                           764  
000015B6                           765  
000015B6  4E75                     766              RTS
000015B8                           767  ; ----------------------------------------------------------------------------
000015B8                           768  GENPOSMNZ
000015B8                           769  ; Genera una posición aleatoria para la manzana
000015B8                           770  ; INPUT: NONE
000015B8                           771  ; OUTPUT:
000015B8                           772  ; MODIFIES: MNZPOSX, MNZPOSY
000015B8                           773  ; ----------------------------------------------------------------------------
000015B8                           774  
000015B8  48E7 8000                775              MOVEM.L D0,-(A7)
000015BC                           776  
000015BC                           777              ; Genera la coordenada X aleatoria
000015BC  4EB8 111A                778              JSR     UTLRAND
000015C0  0240 001F                779              ANDI.W  #NUMCLMNS-1, D0       ; Asegura que esté en [0, NUMCLMNS-1]
000015C4  C0FC 0014                780              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
000015C8  3200                     781              MOVE.W  D0,D1
000015CA  33C0 000018F4            782              MOVE.W  D0, MNZPOSX           ; Guarda la coordenada X generada
000015D0                           783              
000015D0                           784              ; Generar coordenada Y aleatoria
000015D0  4EB8 111A                785              JSR     UTLRAND
000015D4  0240 0017                786              ANDI.W  #NUMFILAS-1, D0       ; Asegura que esté en el rango [0, NUMFILAS-1]
000015D8  C0FC 0014                787              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
000015DC  3400                     788              MOVE.W  D0,D2
000015DE  33C0 000018F6            789              MOVE.W  D0, MNZPOSY           ; Guarda la coordenada Y generada
000015E4                           790              
000015E4  4CDF 0001                791              MOVEM.L (A7)+,D0
000015E8  4E75                     792              RTS 
000015EA                           793  
000015EA                           794  
000015EA                           795  
000015EA                           796  -------------------- end include --------------------
000015EA                           797              INCLUDE 'SCORE.X68'
000015EA                           798     
000015EA                           799  ; ------------------------------------------------------------------------------
000015EA                           800  SCOINIT
000015EA                           801  ; INICIALIZAR MARCADOR.
000015EA                           802  ; INPUT    : NONE 
000015EA                           803  ; OUTPUT   : NONE
000015EA                           804  ; MODIFIES : NONE
000015EA                           805  ; ------------------------------------------------------------------------------
000015EA  4E75                     806              RTS
000015EC                           807              
000015EC                           808  ; ------------------------------------------------------------------------------
000015EC                           809  SCOUPD
000015EC                           810  ; ACTUALIZAR MARCADOR.
000015EC                           811  ; INPUT    : NONE 
000015EC                           812  ; OUTPUT   : NONE
000015EC                           813  ; MODIFIES : NONE
000015EC                           814  ; ------------------------------------------------------------------------------
000015EC  4E75                     815              RTS
000015EE                           816              
000015EE                           817  ; ------------------------------------------------------------------------------
000015EE                           818  SCOPLOT
000015EE                           819  ; DIBUJAR MARCADOR.
000015EE                           820  ; INPUT    : NONE 
000015EE                           821  ; OUTPUT   : NONE
000015EE                           822  ; MODIFIES : NONE
000015EE                           823  ; ------------------------------------------------------------------------------
000015EE  4E75                     824              RTS
000015F0                           825  
000015F0                           826  
000015F0                           827  
000015F0                           828  
000015F0                           829  -------------------- end include --------------------
000015F0                           830              INCLUDE 'MATRIZ.X68'
000015F0                           831  ; ----------------------------------------------------------------------------
000015F0                           832  ; MATRIZ
000015F0                           833  ; ----------------------------------------------------------------------------
000015F0                           834  
000015F0                           835  ;-----------------------------------------------------------------------------
000015F0                           836  MTZINIT
000015F0                           837  ; INICIALIZA LA MATRIZ, AL PRINCIPIO ESTÁ VACÍA
000015F0                           838  ; INPUT    : NONE
000015F0                           839  ; OUTPUT   : NONE
000015F0                           840  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
000015F0                           841  ; ----------------------------------------------------------------------------
000015F0                           842              
000015F0  48A7 E080                843              MOVEM.W D0-D2/A0,-(A7)
000015F4                           844              
000015F4  41F9 0000190E            845              LEA ESTDCLDS, A0       ; Apunta al inicio de ESTDCLDS
000015FA  303C 0300                846              MOVE.W #TCELDAS, D0    ; Número total de celdas
000015FE                           847  
000015FE                           848  CLNCLDS:
000015FE  4218                     849              CLR.B (A0)+            ; Coloca 0 en cada celda
00001600  5340                     850              SUBI.W #1, D0          ; Decrementa el contador de celdas
00001602  66FA                     851              BNE CLNCLDS            ; Repite hasta que esten vacías
00001604                           852              
00001604                           853              
00001604  3239 000018F8            854              MOVE.W  CBZPOSX, D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
0000160A  3439 000018FA            855              MOVE.W  CBZPOSY, D2
00001610  4EB9 0000166A            856              JSR     CINDMTRZ
00001616  4EB9 000016A4            857              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
0000161C                           858              
0000161C  3239 00001904            859              MOVE.W  SGMPOSX, D1
00001622  3439 00001906            860              MOVE.W  SGMPOSY, D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
00001628  4EB9 0000166A            861              JSR     CINDMTRZ
0000162E  4EB9 000016E6            862              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
00001634                           863              
00001634  3239 00001900            864              MOVE.W  COLPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA COLA
0000163A  3439 00001902            865              MOVE.W  COLPOSY, D2
00001640  4EB9 0000166A            866              JSR     CINDMTRZ
00001646  4EB9 000016FC            867              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
0000164C                           868              
0000164C  3239 000018F4            869              MOVE.W  MNZPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
00001652  3439 000018F6            870              MOVE.W  MNZPOSY, D2
00001658  4EB9 0000166A            871              JSR     CINDMTRZ
0000165E  4EB9 00001712            872              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
00001664                           873              
00001664                           874              
00001664  4C9F 0107                875              MOVEM.W (A7)+,D0-D2/A0
00001668                           876  
00001668  4E75                     877              RTS
0000166A                           878  
0000166A                           879  ;-----------------------------------------------------------------------------
0000166A                           880  CINDMTRZ
0000166A                           881  ; CALCULA EL ÍNDICE DE UNA CELDA
0000166A                           882  ; INPUT    : D1 = coordenada X pantalla, D2 = coordenada Y pantalla
0000166A                           883  ; OUTPUT   : D0 = índice de la celda en ESTDCLDS
0000166A                           884  ; MODIFIES : NONE
0000166A                           885  ; ----------------------------------------------------------------------------
0000166A                           886  
0000166A  48A7 7000                887               MOVEM.W D1-D3,-(A7)     ; Guarda los registros D1-D3 en la pila
0000166E                           888  
0000166E                           889              ; Divide X por SIZECLDA
0000166E  3601                     890              MOVE.W  D1, D3          ; Copia X a D3
00001670  4241                     891              CLR.W   D1              ; Inicializa el cociente de X
00001672                           892  
00001672  B67C 0014                893  DIVX:       CMP.W   #SIZECLDA, D3    ; Compara D3 con SIZECLDA
00001676  6D00 000A                894              BLT     ENDDIVX         ; Si D3 < SIZECLDA, salta a ENDDIVX
0000167A  0443 0014                895              SUB.W   #SIZECLDA, D3   ; Resta SIZECLDA de D3
0000167E  5241                     896              ADDQ.W  #1, D1          ; Incrementa el cociente de X
00001680  60F0                     897              BRA     DIVX            ; Repite el bucle
00001682                           898  
00001682                           899  ENDDIVX:
00001682                           900  
00001682                           901              ; Divide Y por SIZECLDA
00001682  3602                     902              MOVE.W  D2, D3          ; Copia Y a D3
00001684  4242                     903              CLR.W   D2              ; Inicializa el cociente de Y
00001686                           904  
00001686  B67C 0014                905  DIVY:       CMP.W   #SIZECLDA, D3    ; Compara D3 con SIZECLDA
0000168A  6D00 000A                906              BLT     ENDDIVY         ; Si D3 < SIZECLDA, salta a ENDDIVY
0000168E  0443 0014                907              SUB.W   #SIZECLDA, D3   ; Resta SIZECLDA de D3
00001692  5242                     908              ADDQ.W  #1, D2          ; Incrementa el cociente de Y
00001694  60F0                     909              BRA     DIVY            ; Repite el bucle
00001696                           910  
00001696                           911  ENDDIVY:
00001696                           912  
00001696                           913              ; Calcula el índice
00001696  4240                     914              CLR.W   D0
00001698  3002                     915              MOVE.W  D2, D0          ; D0 = Y_CELDA
0000169A  EB40                     916              ASL.W   #5, D0          ; D0 = Y_CELDA * NUMCLMNS (32 = 2^5)
0000169C  D041                     917              ADD.W   D1, D0          ; D0 = Y_CELDA * NUMCLMNS + X_CELDA
0000169E                           918  
0000169E  4C9F 000E                919              MOVEM.W (A7)+,D1-D3     ; Restaura los registros D1-D3 desde la pila
000016A2                           920  
000016A2  4E75                     921              RTS  
000016A4                           922              
000016A4                           923  ;-----------------------------------------------------------------------------
000016A4                           924  CBZOCPD
000016A4                           925  ; MARCA UNA CELDA COMO OCUPADA POR LA CABEZA
000016A4                           926  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016A4                           927  ; OUTPUT   : NONE
000016A4                           928  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016A4                           929  ; ----------------------------------------------------------------------------
000016A4                           930  
000016A4  48A7 0080                931              MOVEM.W A0,-(A7)
000016A8                           932  
000016A8  41F9 0000190E            933              LEA     ESTDCLDS, A0                ; Dirección de la matriz en A0
000016AE  11B9 00001908 0000       934              MOVE.B  TRZPLOT, (A0, D0.W)           ; Marca la celda como ocupada
000016B6                           935              
000016B6  4C9F 0100                936              MOVEM.W (A7)+,A0
000016BA                           937              
000016BA  4E75                     938              RTS
000016BC                           939              
000016BC                           940              
000016BC                           941              
000016BC                           942  ;-----------------------------------------------------------------------------
000016BC                           943  RSTCLD
000016BC                           944  ; RESTA 1 A LA CELDA PASADA POR PARÁMETRO
000016BC                           945  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016BC                           946  ; OUTPUT   : NONE
000016BC                           947  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016BC                           948  ; ----------------------------------------------------------------------------
000016BC                           949  
000016BC  48A7 0080                950              MOVEM.W A0,-(A7)
000016C0                           951  
000016C0  41F9 0000190E            952              LEA     ESTDCLDS, A0              ; Dirección de la matriz en A0
000016C6  5330 0000                953              SUBQ.B   #1, (A0, D0.W)           ; Marca la celda como ocupada
000016CA                           954              
000016CA  4C9F 0100                955              MOVEM.W (A7)+,A0
000016CE                           956              
000016CE  4E75                     957              RTS
000016D0                           958             
000016D0                           959  ;-----------------------------------------------------------------------------
000016D0                           960  MCLDVCIA
000016D0                           961  ; MARCA UNA CELDA COMO VACÍA
000016D0                           962  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016D0                           963  ; OUTPUT   : NONE
000016D0                           964  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016D0                           965  ; ----------------------------------------------------------------------------
000016D0                           966  
000016D0  48A7 0080                967              MOVEM.W A0,-(A7)
000016D4                           968  
000016D4  41F9 0000190E            969              LEA ESTDCLDS, A0                ; Direccion de la matriz en A0
000016DA  11BC 0000 0000           970              MOVE.B #0, (A0, D0.W)           ; Marca la celda como vacía
000016E0                           971              
000016E0  4C9F 0100                972              MOVEM.W (A7)+,A0
000016E4                           973              
000016E4  4E75                     974              RTS
000016E6                           975  
000016E6                           976  ;-----------------------------------------------------------------------------
000016E6                           977  SGMOCPD
000016E6                           978  ; MARCA UNA CELDA COMO OCUPADA POR EL SEGMENTO
000016E6                           979  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016E6                           980  ; OUTPUT   : NONE
000016E6                           981  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016E6                           982  ; ----------------------------------------------------------------------------
000016E6                           983  
000016E6  48A7 0080                984              MOVEM.W A0,-(A7)
000016EA                           985  
000016EA  41F9 0000190E            986              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
000016F0  11BC 0002 0000           987              MOVE.B #2, (A0, D0.W)           ; Marca la celda como ocupada
000016F6                           988              
000016F6  4C9F 0100                989              MOVEM.W (A7)+,A0
000016FA                           990              
000016FA  4E75                     991              RTS
000016FC                           992              
000016FC                           993  ;-----------------------------------------------------------------------------
000016FC                           994  COLOCPD
000016FC                           995  ; MARCA UNA CELDA COMO OCUPADA POR LA COLA
000016FC                           996  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016FC                           997  ; OUTPUT   : NONE
000016FC                           998  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016FC                           999  ; ----------------------------------------------------------------------------
000016FC                          1000  
000016FC  48A7 0080               1001              MOVEM.W A0,-(A7)
00001700                          1002  
00001700  41F9 0000190E           1003              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
00001706  11BC 0001 0000          1004              MOVE.B #1, (A0, D0.W)           ; Marca la celda como ocupada
0000170C                          1005              
0000170C  4C9F 0100               1006              MOVEM.W (A7)+,A0
00001710                          1007              
00001710  4E75                    1008              RTS
00001712                          1009  
00001712                          1010  
00001712                          1011  ;-----------------------------------------------------------------------------
00001712                          1012  MNZOCPD
00001712                          1013  ; MARCA UNA CELDA COMO OCUPADA POR LA MANZANA
00001712                          1014  ; INPUT    : D0 = índice de la celda en ESTDCLDS
00001712                          1015  ; OUTPUT   : NONE
00001712                          1016  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
00001712                          1017  ; ----------------------------------------------------------------------------
00001712                          1018  
00001712  48A7 0080               1019              MOVEM.W A0,-(A7)
00001716                          1020  
00001716  41F9 0000190E           1021              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
0000171C  11BC 0004 0000          1022              MOVE.B #4, (A0, D0.W)           ; Marca la celda como ocupada
00001722                          1023              
00001722  4C9F 0100               1024              MOVEM.W (A7)+,A0
00001726                          1025              
00001726  4E75                    1026              RTS
00001728                          1027  
00001728                          1028              
00001728                          1029  ;-----------------------------------------------------------------------------
00001728                          1030  CNVICOOR
00001728                          1031  ; Convierte un índice de celda a coordenadas de pantalla (X, Y)
00001728                          1032  ; INPUT    : D0 = índice de la celda en ESTADO_CELDAS
00001728                          1033  ; OUTPUT   : D1 = coordenada X, D2 = coordenada Y
00001728                          1034  ; MODIFIES : NONE
00001728                          1035  ; ----------------------------------------------------------------------------
00001728                          1036  
00001728  48A7 9800               1037              MOVEM.W D0/D3-D4,-(A7)
0000172C                          1038  
0000172C  3400                    1039              MOVE.W  D0,D2         ; Copia índice a D2 para calcular la fila
0000172E  EA4A                    1040              LSR.W   #5,D2         ; D2 = índice / NUM_COLUMNAS (32 = 2^5)
00001730  3200                    1041              MOVE.W  D0,D1         ; Copia índice a D1 para calcular la columna
00001732  C27C 001F               1042              AND.W   #$1F,D1       ; D1 = índice % NUM_COLUMNAS (31 = 0x1F) (CREO)
00001736                          1043  
00001736                          1044              ; Multiplica por TAMAÑO_CELDA = 10
00001736  363C 0014               1045              MOVE.W  #SIZECLDA, D3
0000173A  3801                    1046              MOVE.W  D1,D4         ; Copia D1 para multiplicar por 10
0000173C  4241                    1047              CLR.W   D1            ; Inicializa resultado
0000173E                          1048  
0000173E                          1049  
0000173E                          1050  MULTLOOPX: 
0000173E  B87C 0000               1051              CMP.W   #0, D4        ; ¿Quedan iteraciones?
00001742  6700 0008               1052              BEQ     ENDMULTX
00001746  D243                    1053              ADD.W   D3,D1         ; Suma TAMANO_CELDA (10) repetidamente
00001748                          1054  
00001748  5344                    1055              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
0000174A  60F2                    1056              BRA     MULTLOOPX     ; Repite mientras no sea 0
0000174C                          1057  ENDMULTX: 
0000174C  3802                    1058              MOVE.W  D2,D4         ; Copia D2 para multiplicar por 10
0000174E  4242                    1059              CLR.W   D2            ; Inicializa resultado
00001750                          1060  
00001750                          1061  MULTLOOPY: 
00001750  B87C 0000               1062              CMP.W   #0, D4        ; ¿Quedan iteraciones?
00001754  6700 0008               1063              BEQ     ENDMULTY
00001758  D443                    1064              ADD.W   D3,D2         ; Suma TAMANO_CELDA (10) repetidamente
0000175A  5344                    1065              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
0000175C  60F2                    1066              BRA     MULTLOOPY     ; Repite mientras no sea 0
0000175E                          1067  ENDMULTY:
0000175E  4C9F 0019               1068              MOVEM.W (A7)+,D0/D3-D4
00001762                          1069  
00001762  4E75                    1070              RTS
00001764                          1071  
00001764                          1072  ; ----------------------------------------------------------------------------
00001764                          1073  CHECKCLD
00001764                          1074  ; INPUT: D0 = índice de la celda
00001764                          1075  ; OUTPUT: D0 = 0 si está vacía, 1 si está ocupada
00001764                          1076  ; MODIFIES: Ninguno
00001764                          1077  ; ----------------------------------------------------------------------------
00001764                          1078  
00001764  41F9 0000190E           1079              LEA     ESTDCLDS, A0    ; Carga la dirección de la matriz ESTDCLDS
0000176A  1230 0000               1080              MOVE.B  (A0, D0.W),D1   ; Carga el estado de la celda en D1
0000176E  B23C 0000               1081              CMP.B   #0, D1          ; Compara si está vacía (0)
00001772  6700 0008               1082              BEQ     CLDFREE         ; Si está vacía
00001776  303C 0001               1083              MOVE.W  #1, D0          ; Si está ocupada, devuelve 1 (ocupada)
0000177A                          1084  
0000177A  4E75                    1085              RTS
0000177C                          1086  
0000177C                          1087  CLDFREE:
0000177C  303C 0000               1088              MOVE.W  #0, D0                 ; Devuelve 0 (libre)
00001780                          1089  
00001780  4E75                    1090              RTS
00001782                          1091  
00001782                          1092  
00001782                          1093  ;-----------------------------------------------------------------------------
00001782                          1094  FONPLOT
00001782                          1095  ; DIBUJADO DEL FONDO
00001782                          1096  ; INPUT    : NONE
00001782                          1097  ; OUTPUT   : NONE
00001782                          1098  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
00001782                          1099  ; ----------------------------------------------------------------------------
00001782                          1100  
00001782  3F00                    1101              MOVE.W  D0,-(A7)
00001784  3003                    1102              MOVE.W  D3,D0
00001786  4EB8 1728               1103              JSR     CNVICOOR
0000178A  2F01                    1104              MOVE.L  D1,-(A7)
0000178C                          1105              
0000178C  103C 0050               1106              MOVE.B  #80,D0
00001790  223C 0090EE90           1107              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
00001796  4E4F                    1108              TRAP    #15
00001798                          1109              
00001798  103C 0051               1110              MOVE.B  #81,D0
0000179C  223C 0090EE90           1111              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
000017A2  4E4F                    1112              TRAP    #15
000017A4                          1113              
000017A4  103C 0057               1114              MOVE.B  #87,D0
000017A8  221F                    1115              MOVE.L  (A7)+,D1
000017AA  3F03                    1116              MOVE.W  D3,-(A7)
000017AC  3601                    1117              MOVE.W  D1,D3
000017AE  0643 0014               1118              ADD.W   #SIZECLDA,D3
000017B2  3802                    1119              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
000017B4  0644 0014               1120              ADD.W   #SIZECLDA,D4
000017B8  4E4F                    1121              TRAP    #15                     
000017BA                          1122                          
000017BA  361F                    1123              MOVE.W  (A7)+,D3  
000017BC  301F                    1124              MOVE.W  (A7)+,D0
000017BE  4E75                    1125              RTS         
000017C0                          1126  
000017C0                          1127  
000017C0                          1128  
000017C0                          1129  ;-----------------------------------------------------------------------------
000017C0                          1130  MTZUPD
000017C0                          1131  ; ACTUALIZA LA MATRIZ CASILLA A CASILLA
000017C0                          1132  ; INPUT    : NONE
000017C0                          1133  ; OUTPUT   : NONE
000017C0                          1134  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
000017C0                          1135  ; ----------------------------------------------------------------------------
000017C0                          1136  
000017C0                          1137  
000017C0  48A7 E080               1138              MOVEM.W D0-D2/A0,-(A7)
000017C4                          1139              
000017C4  41F9 0000190E           1140              LEA ESTDCLDS, A0       ; Apunta al inicio de ESTDCLDS
000017CA  303C 0300               1141              MOVE.W #TCELDAS, D0    ; Número total de celdas
000017CE                          1142  
000017CE                          1143  .CLNCLDS:
000017CE  4218                    1144              CLR.B (A0)+            ; Coloca 0 en cada celda
000017D0  5340                    1145              SUBI.W #1, D0          ; Decrementa el contador de celdas
000017D2  66FA                    1146              BNE .CLNCLDS           ; Repite hasta que esten vacías
000017D4                          1147              
000017D4                          1148              
000017D4  3239 000018F8           1149              MOVE.W  CBZPOSX, D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
000017DA  3439 000018FA           1150              MOVE.W  CBZPOSY, D2
000017E0  4EB8 166A               1151              JSR     CINDMTRZ
000017E4  4EB8 16A4               1152              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
000017E8                          1153              
000017E8  3239 00001904           1154              MOVE.W  SGMPOSX, D1
000017EE  3439 00001906           1155              MOVE.W  SGMPOSY, D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
000017F4  4EB8 166A               1156              JSR     CINDMTRZ
000017F8  4EB8 16E6               1157              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
000017FC                          1158              
000017FC  3239 00001900           1159              MOVE.W  COLPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA COLA
00001802  3439 00001902           1160              MOVE.W  COLPOSY, D2
00001808  4EB8 166A               1161              JSR     CINDMTRZ
0000180C  4EB8 16FC               1162              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
00001810                          1163              
00001810  3239 000018F4           1164              MOVE.W  MNZPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
00001816  3439 000018F6           1165              MOVE.W  MNZPOSY, D2
0000181C  4EB8 166A               1166              JSR     CINDMTRZ
00001820  4EB8 1712               1167              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
00001824                          1168              
00001824                          1169              
00001824  4C9F 0107               1170              MOVEM.W (A7)+,D0-D2/A0
00001828                          1171  
00001828  4E75                    1172              RTS
0000182A                          1173  
0000182A                          1174  
0000182A                          1175  
0000182A                          1176  ;-----------------------------------------------------------------------------
0000182A                          1177  MTZPLOT
0000182A                          1178  ; DIBUJA LA MATRIZ CASILLA A CASILLA
0000182A                          1179  ; INPUT    : NONE
0000182A                          1180  ; OUTPUT   : NONE
0000182A                          1181  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
0000182A                          1182  ; ----------------------------------------------------------------------------
0000182A  48E7 F080               1183              MOVEM.L D0-D3/A0,-(A7)
0000182E                          1184  
0000182E  4240                    1185              CLR.W   D0
00001830  4243                    1186              CLR.W   D3
00001832  41F9 0000190E           1187              LEA     ESTDCLDS, A0            ; Apunta al inicio de ESTDCLDS
00001838  303C 0300               1188              MOVE.W  #TCELDAS, D0            ; Número total de celdas
0000183C  363C 0000               1189              MOVE.W  #0,D3                   ; LO UTILIZAMOS PARA SABER EL INDICE EN EL QUE NOS ENCONTRAMOS
00001840  4241                    1190              CLR.W   D1
00001842  4242                    1191              CLR.W   D2
00001844                          1192              
00001844                          1193  
00001844                          1194  PLOTCLDS:
00001844  1218                    1195              MOVE.B  (A0)+,D1                ; MOVEMOS EL VALOR DE LA CELDA A D1
00001846  B23C 0000               1196              CMP.B   #0,D1
0000184A  6700 0036               1197              BEQ     PLOTVAC                 ; SALTA A DIBUJAR POSICIÓN VACÍA
0000184E  B23C 0001               1198              CMP.B   #1,D1 
00001852  6700 0034               1199              BEQ     PLOTCOL                 ; SALTA A DIBUJAR COLA
00001856  B23C 0002               1200              CMP.B   #2,D1
0000185A  6700 0032               1201              BEQ     PLOTSEG                 ; SALTA A DIBUJAR SEGMENTO
0000185E  B239 00001908           1202              CMP.B   TRZPLOT,D1
00001864  6700 0016               1203              BEQ     PLOTCBZ                 ; SALTA A DIBUJAR CABEZA
00001868  B23C 0004               1204              CMP.B   #4,D1                 
0000186C  6700 0026               1205              BEQ     PLOTAPPLE               ; SALTA A DIBUJAR MANZANA
00001870                          1206    
00001870                          1207  DONEPLOT            
00001870  5243                    1208              ADDQ    #1,D3                   ; AUMENTAMOS EL INDICE DE CELDA PARA LA SIGUIENTE
00001872  5340                    1209              SUBI.W  #1, D0                  ; Decrementa el contador de celdas
00001874  66CE                    1210              BNE     PLOTCLDS                ; Repite hasta que esten vacías
00001876  4CDF 010F               1211              MOVEM.L (A7)+,D0-D3/A0
0000187A  4E75                    1212              RTS
0000187C                          1213  PLOTCBZ:
0000187C  4EB8 1352               1214              JSR     HEADPLOT
00001880  60EE                    1215              BRA     DONEPLOT
00001882                          1216  
00001882                          1217  PLOTVAC:    
00001882  4EB8 1782               1218              JSR     FONPLOT
00001886  60E8                    1219              BRA     DONEPLOT                ; DIBUJADO HECHO 
00001888                          1220  
00001888                          1221  PLOTCOL:   
00001888  4EB8 148A               1222              JSR     TAILPLOT 
0000188C  60E2                    1223              BRA     DONEPLOT                ; DIBUJADO HECHO 
0000188E                          1224              
0000188E                          1225  PLOTSEG:    
0000188E  4EB8 1416               1226              JSR     SEGPLOT
00001892  60DC                    1227              BRA     DONEPLOT                ; DIBUJADO HECHO    
00001894                          1228  
00001894                          1229  PLOTAPPLE:
00001894  4EB8 153A               1230              JSR     APPLEPLOT
00001898  60D6                    1231              BRA     DONEPLOT            
0000189A                          1232  
0000189A                          1233  
0000189A                          1234  
0000189A                          1235  
0000189A                          1236  
0000189A                          1237  
0000189A                          1238  
0000189A                          1239  
0000189A                          1240  
0000189A                          1241  
0000189A                          1242  
0000189A                          1243  
0000189A                          1244  
0000189A                          1245  
0000189A                          1246  -------------------- end include --------------------
0000189A                          1247  START:
0000189A                          1248                  
0000189A                          1249  ; --- INIZIALIZACIÓN ---------------------------------------------------------
0000189A                          1250  
0000189A  4EB8 1000               1251              JSR     SYSINIT
0000189E  4EB8 1104               1252              JSR     UTLINIT
000018A2  4EB8 1066               1253              JSR     KBDINIT
000018A6  4EB8 15F0               1254              JSR     MTZINIT
000018AA  4EB8 1238               1255              JSR     HEADINIT                
000018AE  4EB8 13D6               1256              JSR     SEGINIT
000018B2  4EB8 1456               1257              JSR     TAILINIT
000018B6  4EB8 15EA               1258              JSR     SCOINIT
000018BA  4EB8 14CA               1259              JSR     APPLEINIT
000018BE                          1260              
000018BE                          1261  
000018BE                          1262  .LOOP
000018BE                          1263  
000018BE                          1264  ; --- ACTUALIZAR -------------------------------------------------------------
000018BE                          1265  
000018BE                          1266  ; LEER DISPOSITIVOS DE ENTRADA
000018BE                          1267  
000018BE  4E41                    1268              TRAP    #1
000018C0                          1269  
000018C0                          1270  ; ACTUALIZAR LÓGICA DEL JUEGO
000018C0                          1271              
000018C0  4EB8 1468               1272              JSR     TAILUPD
000018C4  4EB8 13E8               1273              JSR     SEGUPD
000018C8  4EB8 1266               1274              JSR     HEADUPD
000018CC                          1275              ;JSR     APPLEUPD  
000018CC  4EB8 17C0               1276              JSR     MTZUPD
000018D0                          1277              
000018D0                          1278  ; --- SINCRONIZACIÓN ---------------------------------------------------------
000018D0                          1279              ; THE FOLLOWING SYNC STRATEGY IS ****WRONG****
000018D0  103C 0017               1280              MOVE.B  #23,D0
000018D4  7201                    1281              MOVE.L  #1,D1
000018D6  4E4F                    1282              TRAP    #15
000018D8                          1283  
000018D8                          1284  
000018D8                          1285  ;---DIBUJAR-------------------------------------------------------------------
000018D8  4EB8 1352               1286               JSR     HEADPLOT
000018DC  4EB8 1416               1287               JSR     SEGPLOT
000018E0  4EB8 148A               1288               JSR     TAILPLOT
000018E4  4EB8 153A               1289               JSR     APPLEPLOT
000018E8  4EB8 182A               1290               JSR     MTZPLOT
000018EC                          1291              
000018EC  4E40                    1292              TRAP    #0                      ; ACTUALIZA DOBLE BUFFER
000018EE                          1293  
000018EE                          1294  
000018EE  60CE                    1295              BRA     .LOOP
000018F0                          1296  
000018F0  FFFF FFFF               1297              SIMHALT
000018F4                          1298              
000018F4                          1299              INCLUDE 'VARS.X68'
000018F4                          1300  ; ----------------------------------------------------------------------------
000018F4                          1301  ; VARIABLES DEL JUEGO
000018F4                          1302  ; ----------------------------------------------------------------------------
000018F4                          1303  
000018F4                          1304  ; --- VARIABLES DE LA MANZANA ------------------------------------------------
000018F4                          1305  
000018F4                          1306  MNZPOSX     DS.W    1                       ; COORDENADA X DE LA MANZANA
000018F6                          1307  MNZPOSY     DS.W    1                       ; COORDENADA Y DE LA MANZANA
000018F8                          1308  
000018F8                          1309  ; --- VARIABLES DE LA SERPIENTE ----------------------------------------------
000018F8                          1310  
000018F8                          1311  CBZPOSX     DS.W    1                       ; COORDENADA X CABEZA
000018FA                          1312  CBZPOSY     DS.W    1                       ; COORDENADA Y CABEZA
000018FC                          1313  CBZVELX     DS.W    1                       ; VELOCIDAD X CABEZA
000018FE                          1314  CBZVELY     DS.W    1                       ; VELOCIDAD Y CABEZA
00001900                          1315  COLPOSX     DS.W    1                       ; COORDENADA X COLA
00001902                          1316  COLPOSY     DS.W    1                       ; COORDENADA Y COLA
00001904                          1317  SGMPOSX     DS.W    1                       ; COORDENADA X SEGMENTO
00001906                          1318  SGMPOSY     DS.W    1                       ; COORDENADA Y SEGMENTO
00001908                          1319  TRZPLOT     DS.B    1                       ; NÚMERO DE TROZOS A DIBUJAR
00001909                          1320  
00001909                          1321  ; --- VARIABLES DEL MARCADOR -------------------------------------------------
00001909                          1322  
0000190A                          1323  JGOPNTS     DS.W    1                       ; PUNTUACIÓN DEL JUEGO
0000190C                          1324  
0000190C                          1325  
0000190C                          1326  
0000190C                          1327  
0000190C                          1328  -------------------- end include --------------------
0000190C                          1329              INCLUDE 'LIB/UTLVARS.X68'
0000190C                          1330  ; =============================================================================
0000190C                          1331  ; UTILITY VARIABLES
0000190C                          1332  ; =============================================================================
0000190C                          1333  
0000190C                          1334  UTLRNDIX    DS.B    1                       ; NEXT INDEX TO RANDOM NUMBER
0000190E                          1335              DS.W    0
0000190E                          1336  -------------------- end include --------------------
0000190E                          1337              INCLUDE 'SYSVARS.X68'
0000190E                          1338  ; ----------------------------------------------------------------------------
0000190E                          1339  ; VARIABLES DEL SISTEMA
0000190E                          1340  ; ----------------------------------------------------------------------------
0000190E                          1341  
0000190E                          1342  ; --- VARIABLES DE LA MATRIZ -------------------------------------------------
0000190E                          1343  
0000190E                          1344  ESTDCLDS    DS.B    TCELDAS                 ; ESTADO DE LAS CELDAS 0=VACÍO  1=COLA   2=SEGMENTO  TRZPLOT=CABEZA  4?=MANZANA    
00001C0E                          1345  ESTDCBZ     DS.B    1                       ; 0= DERECHA, 1=ARRIBA, 2=IZQUIERDA, 3=ABAJO
00001C0F                          1346  
00001C0F                          1347  ; --- VARIABLES DE TECLADO ---------------------------------------------------
00001C0F                          1348  
00001C0F                          1349  KBDVAL      DS.B    1                       ; KEY STATE
00001C10                          1350  KBDEDGE     DS.B    1                       ; KEY EDGE
00001C12                          1351  LASTKEY     DS.L    1                       
00001C16                          1352  
00001C16                          1353  
00001C16                          1354  
00001C16                          1355  
00001C16                          1356  
00001C16                          1357  
00001C16                          1358  
00001C16                          1359  
00001C16                          1360  
00001C16                          1361  
00001C16                          1362  
00001C16                          1363  
00001C16                          1364  
00001C16                          1365  
00001C16                          1366  -------------------- end include --------------------
00001C16                          1367      
00001C16                          1368      
00001C16                          1369              END    START        

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
APPLEINIT           14CA
APPLEPLOT           153A
APPLEUPD            14FC
ARR                 10DA
CBZFCOL             AA00
CBZHEIGH            14
CBZOCPD             16A4
CBZPCOL             FF00
CBZPOSX             18F8
CBZPOSY             18FA
CBZVEL              14
CBZVELX             18FC
CBZVELY             18FE
CBZWIDTH            14
CHCKUPDT            1514
CHECK               14D6
CHECKCLD            1764
CINDMTRZ            166A
CLDFREE             177C
CLNCLDS             15FE
CNVICOOR            1728
COLFCOL             AA00
COLFND              90EE90
COLHEIGH            A
COLOCPD             16FC
COLPCOL             FF00
COLPOSX             1900
COLPOSY             1902
COLWIDTH            A
CONTINU             10FE
DER                 10CE
DIVX                1672
DIVY                1686
DONEPLOT            1870
DWN                 10F2
ENDDIVX             1682
ENDDIVY             1696
ENDMULTX            174C
ENDMULTY            175E
ESTDCBZ             1C0E
ESTDCLDS            190E
FIN                 134C
FONPLOT             1782
GENPOSMNZ           15B8
HEADINIT            1238
HEADPLOT            1352
HEADUPD             1266
IZQ                 10E6
JGOPNTS             190A
KBDDOWN             28
KBDEDGE             1C10
KBDINIT             1066
KBDLEFT             25
KBDRIGHT            27
KBDUP               26
KBDUPD              1074
KBDVAL              1C0F
LASTKEY             1C12
LNGINI              1
MARKMNZ             14EE
MAXSGM              1
MCLDVCIA            16D0
MNZFCOL             FF
MNZHEIGH            14
MNZOCPD             1712
MNZPCOL             AAFF
MNZPOSX             18F4
MNZPOSY             18F6
MNZWIDTH            14
MTZINIT             15F0
MTZPLOT             182A
MTZUPD              17C0
MTZUPD:CLNCLDS      17CE
MULTLOOPX           173E
MULTLOOPY           1750
NEWMNZ              152C
NUMCLMNS            20
NUMFILAS            18
OJOFCOL             FFFFFF
OJOHEIGH            A
OJOPCOL             0
OJOWIDTH            A
PANHEIGH            1E0
PANWIDTH            280
PLOTAPPLE           1894
PLOTCBZ             187C
PLOTCLDS            1844
PLOTCOL             1888
PLOTSEG             188E
PLOTVAC             1882
PNTSFCOL            1
PNTSTEXT            1
RSTCLD              16BC
SCOINIT             15EA
SCOPLOT             15EE
SCOUPD              15EC
SCRINIT             101E
SCRPLOT             104C
SEGINIT             13D6
SEGPLOT             1416
SEGUPD              13E8
SGMFCOL             AA00
SGMHEIGH            14
SGMOCPD             16E6
SGMPCOL             FF00
SGMPOSX             1904
SGMPOSY             1906
SGMWIDTH            14
SIGABA              1328
SIGARR              12E0
SIGDER              12BC
SIGIZQ              1304
SIZECLDA            14
START               189A
START:LOOP          18BE
SYSINIT             1000
TAILINIT            1456
TAILPLOT            148A
TAILUPD             1468
TCELDAS             300
TRZPLOT             1908
UTLINIT             1104
UTLRAND             111A
UTLRAND:RANDVEC     1138
UTLRNDIX            190C
