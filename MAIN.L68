0000188C Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 22/12/2024 18:05:36

00000000                             1  *-----------------------------------------------------------------------------
00000000                             2  * Title      : MAIN
00000000                             3  * Written by :
00000000                             4  * Date       :
00000000                             5  * Description:
00000000                             6  *-----------------------------------------------------------------------------
00000000                             7  
00001000                             8              ORG    $1000
00001000                             9              
00001000                            10              INCLUDE 'CONST.X68'
00001000                            11  ; ----------------------------------------------------------------------------
00001000                            12  ; CONSTANTES DEL JUEGO
00001000                            13  ; ----------------------------------------------------------------------------
00001000                            14     
00001000                            15  ; --- CONSTANTES DE LA MANZANA -----------------------------------------------
00001000                            16  
00001000  =00000014                 17  MNZWIDTH    EQU     20                      ; ANCHURA DE LA MANZANA (a determinar)
00001000  =00000014                 18  MNZHEIGH    EQU     20                      ; ALTURA DE LA MANZANA (a determinar)
00001000  =0000AAFF                 19  MNZPCOL     EQU     $0000AAFF               ; COLOR CONTORNO MANZANA (a determinar)
00001000  =000000FF                 20  MNZFCOL     EQU     $000000FF               ; COLOR RELLENO MANZANA (a determinar)
00001000                            21  
00001000                            22  ; --- CONSTANTES DE LA SERPIENTE ---------------------------------------------
00001000                            23  
00001000  =00000001                 24  MAXSGM      EQU     1                       ; TAMAÑO MÁXIMO DE SEGMENTOS (a determinar)
00001000  =00000001                 25  LNGINI      EQU     1                       ; LONGITUD INICIAL SERPIENTE (a determinar)
00001000  =00000014                 26  SGMWIDTH    EQU     20                      ; ANCHURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 27  SGMHEIGH    EQU     20                      ; ALTURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 28  CBZVEL      EQU     20                      ; VELOCIDAD DE LA CABEZA (a determinar)
00001000  =0000FF00                 29  SGMPCOL     EQU     $0000FF00               ; COLOR CONTORNO SEGMENTO (PROVISIONAL)
00001000  =0000AA00                 30  SGMFCOL     EQU     $0000AA00               ; COLOR RELLENO SEGMENTO (PROVISIONAL)
00001000  =0000000A                 31  COLWIDTH    EQU     10                      ; ANCHURA DE LA COLA (PROVISIONAL)
00001000  =0000000A                 32  COLHEIGH    EQU     10                      ; ALTURA DE LA COLA (PROVISIONAL)
00001000  =0000FF00                 33  COLPCOL     EQU     $0000FF00               ; COLOR CONTORNO COLA (PROVISIONAL)
00001000  =0000AA00                 34  COLFCOL     EQU     $0000AA00               ; COLOR RELLENO COLA (PROVISIONAL)
00001000  =00000014                 35  CBZWIDTH    EQU     20                      ; ANCHURA DE LA CABEZA (PROVISIONAL)
00001000  =00000014                 36  CBZHEIGH    EQU     20                      ; ALTURA DE LA CABEZA (PROVISIONAL)
00001000  =0000FF00                 37  CBZPCOL     EQU     $0000FF00               ; COLOR CONTORNO CABEZA (PROVISIONAL)
00001000  =0000AA00                 38  CBZFCOL     EQU     $0000AA00               ; COLOR RELLENO CABEZA (PROVISIONAL)
00001000  =0000000A                 39  OJOWIDTH    EQU     10                      ; ANCHURA DE OJO DE SERPIENTE
00001000  =0000000A                 40  OJOHEIGH    EQU     10                      ; ALTURA DE OJO DE SERPIENTE
00001000  =00000000                 41  OJOPCOL     EQU     $00000000               ; COLOR CONTORNO OJO
00001000  =00FFFFFF                 42  OJOFCOL     EQU     $00FFFFFF               ; COLOR RELLENO OJO
00001000                            43  
00001000                            44  
00001000                            45  
00001000                            46  ; --- CONSTANTES MARCADOR ----------------------------------------------------
00001000                            47  
00001000  =00000000                 48  PNTSFCOL    EQU     $00000000               ; COLOR FONDO MARCADOR (a determinar)
00001000  =00000065                 49  PNTSTEXT    EQU     0101                    ; COORDENADAS DEL MARCADOR (a determinar)
00001000                            50  
00001000                            51  
00001000                            52  
00001000                            53  
00001000                            54  
00001000                            55  
00001000                            56  
00001000                            57  -------------------- end include --------------------
00001000                            58              INCLUDE 'SYSCONST.X68'
00001000                            59  ; ----------------------------------------------------------------------------
00001000                            60  ; CONSTANTES DEL SISTEMA
00001000                            61  ; ----------------------------------------------------------------------------
00001000                            62  
00001000                            63  ; ---CONSTANTES DE LA PANTALLA------------------------------------------------
00001000                            64  
00001000  =00000280                 65  PANWIDTH    EQU     640                     ; ANCHO DE LA PANTALLA
00001000  =000001E0                 66  PANHEIGH    EQU     480                     ; ALTURA DE LA PANTALLA
00001000  =0090EE90                 67  COLFND      EQU     $90EE90                 ; COLOR DEL FONDO DE LA PANTALLA
00001000                            68  
00001000                            69  ; ---CONSTANTES DE LA MATRIZ--------------------------------------------------
00001000                            70  
00001000  =00000014                 71  SIZECLDA    EQU     20                      ; TAMAÑO DE CADA CELDA EN PIXELES
00001000  =00000020                 72  NUMCLMNS    EQU     32                      ; COLUMNAS DE CELDAS (640/10)
00001000  =00000018                 73  NUMFILAS    EQU     24                      ; FILAS DE CELDAS (480/10)
00001000  =00000300                 74  TCELDAS     EQU     768                     ; TOTAL DE CELDAS (64 * 48)
00001000                            75  
00001000                            76  ; ---CÓDIGOS DE TECLADO-------------------------------------------------------
00001000                            77  
00001000  =00000025                 78  KBDLEFT     EQU     $25
00001000  =00000026                 79  KBDUP       EQU     $26
00001000  =00000027                 80  KBDRIGHT    EQU     $27
00001000  =00000028                 81  KBDDOWN     EQU     $28
00001000                            82  
00001000                            83  
00001000                            84  -------------------- end include --------------------
00001000                            85              INCLUDE 'SYSTEM.X68'
00001000                            86   
00001000                            87   
00001000                            88  SYSINIT
00001000                            89  ; INICIA EL  SISTEMA
00001000                            90  ; INPUT    : NONE
00001000                            91  ; OUTPUT   : NONE
00001000                            92  ; MODIFIES : NONE
00001000                            93  ; ----------------------------------------------------------------------------
00001000  4EB9 0000101E             94              JSR     SCRINIT
00001006                            95              
00001006  21FC 0000104C 0080        96              MOVE.L  #SCRPLOT,($80)
0000100E  21FC 00001074 0084        97              MOVE.L  #KBDUPD,($84)
00001016                            98              
00001016  40E7                      99              MOVE.W  SR,-(A7)
00001018  0257 DFFF                100              ANDI.W  #$DFFF,(A7)
0000101C                           101              
0000101C  4E73                     102              RTE
0000101E                           103              
0000101E                           104  ; ------------------------------------------------------------------------------
0000101E                           105  SCRINIT
0000101E                           106  ; INIT SCREEN. SET SCREEN RESOLUTION, SET WINDOWED MODE, CLEAR SCREEN,
0000101E                           107  ; ENABLE DOUBLE BUFFER.
0000101E                           108  ; INPUT    : NONE
0000101E                           109  ; OUTPUT   : NONE
0000101E                           110  ; MODIFIES : NONE
0000101E                           111  ; ------------------------------------------------------------------------------
0000101E                           112  
0000101E  48E7 C000                113              MOVEM.L D0-D1,-(A7)
00001022                           114  
00001022                           115              ; SET SCREEN RESOLUTION
00001022  103C 0021                116              MOVE.B  #33,D0
00001026  223C 028001E0            117              MOVE.L  #PANWIDTH<<16|PANHEIGH,D1
0000102C  4E4F                     118              TRAP    #15
0000102E                           119              
0000102E                           120              ; SET WINDOWED MODE
0000102E  7201                     121              MOVE.L  #1,D1
00001030  4E4F                     122              TRAP    #15
00001032                           123              
00001032                           124              ; CLEAR SCREEN
00001032  103C 000B                125              MOVE.B  #11,D0
00001036  323C FF00                126              MOVE.W  #$FF00,D1
0000103A  4E4F                     127              TRAP    #15
0000103C                           128              
0000103C                           129              ; ENABLE DOUBLE BUFFER
0000103C  103C 005C                130              MOVE.B  #92,D0
00001040  123C 0011                131              MOVE.B  #17,D1
00001044  4E4F                     132              TRAP    #15
00001046                           133              
00001046  4CDF 0003                134              MOVEM.L (A7)+,D0-D1
0000104A                           135              
0000104A  4E75                     136              RTS    
0000104C                           137  
0000104C                           138  ; ------------------------------------------------------------------------------
0000104C                           139  SCRPLOT
0000104C                           140  ; UPDATES DOUBLE BUFFER
0000104C                           141  ; INPUT    : NONE
0000104C                           142  ; OUTPUT   : NONE
0000104C                           143  ; MODIFIES : NONE
0000104C                           144  ; ------------------------------------------------------------------------------
0000104C                           145  
0000104C  48A7 C000                146              MOVEM.W D0-D1,-(A7)
00001050                           147              
00001050                           148              ; SWITCH BUFFERS
00001050  103C 005E                149              MOVE.B  #94,D0
00001054  4E4F                     150              TRAP    #15
00001056                           151              
00001056                           152              ; CLEAR HIDDEN BUFFER
00001056  103C 000B                153              MOVE.B  #11,D0
0000105A  323C FF00                154              MOVE.W  #$FF00,D1
0000105E  4E4F                     155              TRAP    #15
00001060                           156              
00001060  4C9F 0003                157              MOVEM.W (A7)+,D0-D1
00001064                           158              
00001064  4E73                     159              RTE
00001066                           160          
00001066                           161  ; ------------------------------------------------------------------------------
00001066                           162  KBDINIT
00001066                           163  ; INIT KEYBOARD
00001066                           164  ; INPUT    : NONE
00001066                           165  ; OUTPUT   : NONE
00001066                           166  ; MODIFIES : NONE
00001066                           167  ; ------------------------------------------------------------------------------
00001066                           168  
00001066  4239 00001C05            169              CLR.B   (KBDVAL)
0000106C  4239 00001C06            170              CLR.B   (KBDEDGE)
00001072  4E75                     171              RTS
00001074                           172  
00001074                           173  ; ------------------------------------------------------------------------------
00001074                           174  KBDUPD
00001074                           175  ; UPDATE KEYBOARD INFO.  
00001074                           176  ; 7 -> PAUSE
00001074                           177  ; 6 -> FIRE 3
00001074                           178  ; 5 -> FIRE 2
00001074                           179  ; 4 -> FIRE 1
00001074                           180  ; 3 -> DOWN
00001074                           181  ; 2 -> RIGHT
00001074                           182  ; 1 -> UP
00001074                           183  ; 0 -> LEFT
00001074                           184  ; INPUT    : NONE
00001074                           185  ; OUTPUT   : NONE
00001074                           186  ; MODIFIES : NONE
00001074                           187  ; ------------------------------------------------------------------------------
00001074                           188  
00001074  48E7 F000                189              MOVEM.L D0-D3,-(A7)
00001078                           190  
00001078                           191              ; LEE ESTADO DEL TECLADO
00001078  103C 0013                192              MOVE.B  #19,D0
0000107C  223C 25262728            193              MOVE.L  #KBDLEFT<<24|KBDUP<<16|KBDRIGHT<<8|KBDDOWN,D1
00001082  4E4F                     194              TRAP    #15                  ; Lee las teclas y guarda en D1
00001084                           195  
00001084                           196              ; CONVERT TO DESIRED FORMAT
00001084  363C 0003                197              MOVE.W  #3,D3
00001088  4282                     198              CLR.L   D2
0000108A  E189                     199  .LOOP       LSL.L   #8,D1
0000108C  E312                     200              ROXL.B  #1,D2
0000108E  51CB FFFA                201              DBRA.W  D3,.LOOP
00001092                           202  
00001092                           203              ; PROCESA FLANCOS ASCENDENTES
00001092  1039 00001C05            204              MOVE.B  (KBDVAL),D0         ; Estado anterior
00001098  4600                     205              NOT.B   D0                   ; Invertir bits (teclas no presionadas)
0000109A  C002                     206              AND.B   D2,D0                ; Detectar flancos ascendentes
0000109C  13C0 00001C06            207              MOVE.B  D0,(KBDEDGE)         ; Almacena los flancos en KBDEDGE
000010A2                           208              
000010A2                           209              
000010A2                           210              ; ACTUALIZA EL ESTADO DE LA DIRECCIÓN
000010A2  1039 00001C06            211              MOVE.B  (KBDEDGE),D0         ; Lee teclas con flanco ascendente
000010A8                           212  
000010A8                           213              ; Detecta pulsaciones y actualiza ESTDCBZ
000010A8  0800 0003                214              BTST    #3,D0                  ; Verifica si la tecla IZQUIERDA está pulsada
000010AC  6700 000E                215              BEQ     CHKARR
000010B0  33FC 0002 00001C04       216              MOVE.W  #2,(ESTDCBZ)           ; Actualiza a IZQUIERDA
000010B8  6000 003A                217              BRA     CONTINU
000010BC                           218  
000010BC                           219  CHKARR:
000010BC  0800 0002                220              BTST    #2,D0                  ; Verifica si la tecla ARRIBA está pulsada
000010C0  6700 000E                221              BEQ     CHKDER
000010C4  33FC 0001 00001C04       222              MOVE.W  #1,(ESTDCBZ)           ; Actualiza a ARRIBA
000010CC  6000 0026                223              BRA     CONTINU
000010D0                           224  
000010D0                           225  CHKDER:
000010D0  0800 0001                226              BTST    #1,D0                  ; Verifica si la tecla DERECHA está pulsada
000010D4  6700 000E                227              BEQ     CHKDWN
000010D8  33FC 0000 00001C04       228              MOVE.W  #0,(ESTDCBZ)           ; Actualiza a DERECHA
000010E0  6000 0012                229              BRA     CONTINU
000010E4                           230  
000010E4                           231  CHKDWN:
000010E4  0800 0000                232              BTST    #0,D0                  ; Verifica si la tecla ABAJO está pulsada
000010E8  6700 000A                233              BEQ     CONTINU
000010EC  33FC 0003 00001C04       234              MOVE.W  #3,(ESTDCBZ)           ; Actualiza a ABAJO
000010F4                           235              
000010F4                           236  
000010F4                           237  CONTINU:
000010F4                           238              ; STORE KBDEDGE
000010F4  13C2 00001C05            239              MOVE.B  D2,(KBDVAL)
000010FA  4CDF 000F                240              MOVEM.L (A7)+,D0-D3
000010FE  4E73                     241              RTE
00001100                           242  
00001100                           243  
00001100                           244  
00001100                           245  ; CODIGO ANTERIOR
00001100                           246  
00001100                           247  
00001100                           248  
00001100                           249  
00001100                           250  
00001100                           251  
00001100                           252  
00001100                           253  
00001100                           254  
00001100                           255  
00001100                           256  
00001100                           257  
00001100                           258  
00001100                           259  
00001100                           260  
00001100                           261  
00001100                           262  
00001100                           263  
00001100                           264  
00001100                           265  
00001100                           266  
00001100                           267  
00001100                           268  
00001100                           269  
00001100                           270  
00001100                           271  
00001100                           272  
00001100                           273  
00001100                           274  
00001100                           275  
00001100                           276  
00001100                           277  
00001100                           278  
00001100                           279  
00001100                           280  -------------------- end include --------------------
00001100                           281              INCLUDE 'LIB/UTLCODE.X68'
00001100                           282  ; =============================================================================
00001100                           283  ; UTILITY CODE
00001100                           284  ; =============================================================================
00001100                           285  
00001100                           286  ; -----------------------------------------------------------------------------
00001100                           287  UTLINIT
00001100                           288  ; INITIALIZES UTILITY CODE
00001100                           289  ; INPUT    - NONE
00001100                           290  ; OUTPUT   - NONE
00001100                           291  ; MODIFIES - NONE
00001100                           292  ; -----------------------------------------------------------------------------
00001100  48E7 C000                293              MOVEM.L D0-D1,-(A7)
00001104  103C 0008                294              MOVE.B  #8,D0
00001108  4E4F                     295              TRAP    #15
0000110A  13C1 00001902            296              MOVE.B  D1,(UTLRNDIX)
00001110  4CDF 0003                297              MOVEM.L (A7)+,D0-D1
00001114  4E75                     298              RTS
00001116                           299  
00001116                           300  ; -----------------------------------------------------------------------------
00001116                           301  UTLRAND
00001116                           302  ; PROVIDES A PSEUDO-RANDOM BYTE
00001116                           303  ; INPUT    - NONE
00001116                           304  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
00001116                           305  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001116                           306  ; -----------------------------------------------------------------------------
00001116  2F08                     307              MOVE.L  A0,-(A7)
00001118  41F9 00001134            308              LEA     .RANDVEC,A0
0000111E  4280                     309              CLR.L   D0
00001120  1039 00001902            310              MOVE.B  (UTLRNDIX),D0
00001126  1030 0800                311              MOVE.B  (A0,D0.L),D0
0000112A  5239 00001902            312              ADDQ.B  #1,(UTLRNDIX)
00001130  205F                     313              MOVE.L  (A7)+,A0
00001132  4E75                     314              RTS
00001134                           315  
00001134                           316  
00001134= A2 EE 9A 0C F5 24 ...    317  .RANDVEC    DC.B    162, 238, 154, 12 , 245, 36 , 32 , 103
0000113C= 2A A3 51 26 E0 AC ...    318              DC.B    42 , 163, 81 , 38 , 224, 172, 19 , 69
00001144= 75 51 CA FD 33 EB ...    319              DC.B    117, 81 , 202, 253, 51 , 235, 108, 154
0000114C= 60 CC E7 B8 9A EB ...    320              DC.B    96 , 204, 231, 184, 154, 235, 34 , 203
00001154= 1D 76 B5 95 B0 89 ...    321              DC.B    29 , 118, 181, 149, 176, 137, 62 , 108
0000115C= 39 15 48 C9 6E CA ...    322              DC.B    57 , 21 , 72 , 201, 110, 202, 159, 41
00001164= 43 E7 E2 7C 37 25 ...    323              DC.B    67 , 231, 226, 124, 55 , 37 , 84 , 62
0000116C= E9 94 CE E9 E4 52 ...    324              DC.B    233, 148, 206, 233, 228, 82 , 243, 78
00001174= 37 6D 9A 84 A2 28 ...    325              DC.B    55 , 109, 154, 132, 162, 40 , 30 , 39
0000117C= 19 E2 C6 77 80 D4 ...    326              DC.B    25 , 226, 198, 119, 128, 212, 232, 225
00001184= 0A 5A 32 67 33 C2 ...    327              DC.B    10 , 90 , 50 , 103, 51 , 194, 222, 40
0000118C= 59 80 DC 0E 57 FC ...    328              DC.B    89 , 128, 220, 14 , 87 , 252, 243, 252
00001194= 8A AB BC F7 07 4D ...    329              DC.B    138, 171, 188, 247, 7  , 77 , 29 , 234
0000119C= EF D5 77 6E 1E BB ...    330              DC.B    239, 213, 119, 110, 30 , 187, 131, 23
000011A4= D6 E0 2A 8F BD 28 ...    331              DC.B    214, 224, 42 , 143, 189, 40 , 212, 130
000011AC= 13 4F 66 EC 0A 64 ...    332              DC.B    19 , 79 , 102, 236, 10 , 100, 122, 188
000011B4= 56 52 9A 16 9B 90 ...    333              DC.B    86 , 82 , 154, 22 , 155, 144, 7  , 199
000011BC= 06 8A A4 F7 01 DA ...    334              DC.B    6  , 138, 164, 247, 1  , 218, 166, 82
000011C4= F2 E7 77 28 B1 76 ...    335              DC.B    242, 231, 119, 40 , 177, 118, 220, 102
000011CC= A4 42 E3 81 B1 67 ...    336              DC.B    164, 66 , 227, 129, 177, 103, 165, 108
000011D4= BF CE FA 16 BF 38 ...    337              DC.B    191, 206, 250, 22 , 191, 56 , 30 , 161
000011DC= D1 8B 50 0C 5F 49 ...    338              DC.B    209, 139, 80 , 12 , 95 , 73 , 168, 56
000011E4= DE 4C 14 A2 40 DC ...    339              DC.B    222, 76 , 20 , 162, 64 , 220, 93 , 12
000011EC= B6 9B 0A 38 5D AB ...    340              DC.B    182, 155, 10 , 56 , 93 , 171, 89 , 6
000011F4= E2 1B DD 75 15 82 ...    341              DC.B    226, 27 , 221, 117, 21 , 130, 101, 18
000011FC= 8A 26 51 30 9F 47 ...    342              DC.B    138, 38 , 81 , 48 , 159, 71 , 57 , 21
00001204= 1E 8A BB 71 C6 6E ...    343              DC.B    30 , 138, 187, 113, 198, 110, 185, 152
0000120C= 9F 47 E5 34 94 27 ...    344              DC.B    159, 71 , 229, 52 , 148, 39 , 77 , 6
00001214= 7D 06 D6 BA 30 0F ...    345              DC.B    125, 6  , 214, 186, 48 , 15 , 212, 22
0000121C= EC 7F 7E 03 CF 2D ...    346              DC.B    236, 127, 126, 3  , 207, 45 , 193, 2
00001224= 94 5B 23 F2 8B CD ...    347              DC.B    148, 91 , 35 , 242, 139, 205, 248, 237
0000122C= 74 33 EC B9 0F D5 ...    348              DC.B    116, 51 , 236, 185, 15 , 213, 221, 6
0000122C= 74 33 EC B9 0F D5 ...    349  -------------------- end include --------------------
00001234                           350              INCLUDE 'HEADSRP.X68'
00001234                           351  
00001234                           352  ; ------------------------------------------------------------------------------
00001234                           353  HEADINIT
00001234                           354  ; INICIALIZAR CABEZA.
00001234                           355  ; INPUT    : NONE 
00001234                           356  ; OUTPUT   : NONE
00001234                           357  ; MODIFIES : NONE
00001234                           358  ; ------------------------------------------------------------------------------
00001234  33FC 0140 000018EE       359              MOVE.W  #PANWIDTH/2,(CBZPOSX)
0000123C  33FC 00F0 000018F0       360              MOVE.W  #PANHEIGH/2,(CBZPOSY)
00001244  4279 000018FE            361              CLR     (TRZPLOT)
0000124A  13FC 0003 000018FE       362              MOVE.B  #3,(TRZPLOT)
00001252  4279 00001C04            363              CLR.W   (ESTDCBZ)
00001258  33FC 0000 00001C04       364              MOVE.W  #0,(ESTDCBZ)
00001260  4E75                     365              RTS
00001262                           366              
00001262                           367  ; ------------------------------------------------------------------------------
00001262                           368  HEADUPD
00001262                           369  ; ACTUALIZAR CABEZA.
00001262                           370  ; INPUT    : NONE 
00001262                           371  ; OUTPUT   : NONE
00001262                           372  ; MODIFIES : NONE
00001262                           373  ; ------------------------------------------------------------------------------
00001262                           374  
00001262  48A7 E000                375              MOVEM.W D0-D2,-(A7)            ; Guardar registros
00001266                           376  
00001266                           377  
00001266                           378              ; Marcar celda actual como vacía
00001266  3239 000018EE            379              MOVE.W  (CBZPOSX),D1
0000126C  3439 000018F0            380              MOVE.W  (CBZPOSY),D2
00001272  4EB9 0000165C            381              JSR     CINDMTRZ
00001278  4EB9 000016C2            382              JSR     MCLDVCIA               ; Marcar celda vacía
0000127E                           383              
0000127E                           384              
0000127E                           385              ;CLR.W   D0
0000127E  3039 00001C04            386              MOVE.W  (ESTDCBZ),D0
00001284  B07C 0000                387              CMP.W   #0,D0
00001288  6700 001E                388              BEQ     SIGDER
0000128C  B07C 0001                389              CMP.W   #1,D0
00001290  6700 0022                390              BEQ     SIGARR
00001294  B07C 0002                391              CMP.W   #2,D0
00001298  6700 0026                392              BEQ     SIGIZQ
0000129C  B07C 0003                393              CMP.W   #3,D0
000012A0  6700 002A                394              BEQ     SIGABA
000012A4                           395  
000012A4                           396  
000012A4                           397  
000012A4                           398              ; Si no hay dirección válida, salir
000012A4  6000 0060                399              BRA     FIN
000012A8                           400  
000012A8                           401  SIGDER:
000012A8  0679 0014 000018EE       402              ADD.W   #CBZVEL, (CBZPOSX)
000012B0  6000 0022                403              BRA     UPDMTRZ
000012B4                           404  
000012B4                           405  SIGARR:
000012B4  0479 0014 000018F0       406              SUB.W   #CBZVEL, (CBZPOSY)
000012BC  6000 0016                407              BRA     UPDMTRZ
000012C0                           408  
000012C0                           409  SIGIZQ:
000012C0  0479 0014 000018EE       410              SUB.W   #CBZVEL, (CBZPOSX)
000012C8  6000 000A                411              BRA     UPDMTRZ
000012CC                           412  
000012CC                           413  SIGABA:
000012CC  0679 0014 000018F0       414              ADD.W   #CBZVEL, (CBZPOSY)
000012D4                           415  
000012D4                           416  UPDMTRZ:
000012D4                           417              ; Convertir posición nueva a índice
000012D4  3239 000018EE            418              MOVE.W  (CBZPOSX),D1
000012DA  3439 000018F0            419              MOVE.W  (CBZPOSY),D2
000012E0  4EB9 0000165C            420              JSR     CINDMTRZ
000012E6                           421  
000012E6                           422              ; Verificar colisiones
000012E6  4EB9 00001756            423              JSR     CHECKCLD
000012EC  B07C 0000                424              CMP.W   #0, D0                 ; Si celda está libre
000012F0  6700 0006                425              BEQ     MARKCLD
000012F4  6000 000C                426              BRA     GAMEOVER              ; Colisión consigo misma
000012F8                           427  
000012F8                           428  MARKCLD:
000012F8                           429              ; Marcar nueva posición como ocupada por la cabeza
000012F8  4EB9 00001696            430              JSR     CBZOCPD
000012FE  6000 0006                431              BRA     FIN
00001302                           432  
00001302                           433  GAMEOVER:
00001302                           434              ; Implementar lógica de fin de juego
00001302                           435              ; Por ahora, simplemente retornar
00001302  6000 0002                436              BRA     FIN
00001306                           437  
00001306                           438  FIN:
00001306  4C9F 0007                439              MOVEM.W (A7)+,D0-D2            ; Restaurar registros
0000130A                           440  
0000130A  4E75                     441      RTS
0000130C                           442              
0000130C                           443  ; ------------------------------------------------------------------------------
0000130C                           444  HEADPLOT
0000130C                           445  ; DIBUJAR CABEZA.
0000130C                           446  ; INPUT    : NONE 
0000130C                           447  ; OUTPUT   : NONE
0000130C                           448  ; MODIFIES : NONE
0000130C                           449  ; ------------------------------------------------------------------------------
0000130C                           450                         
0000130C  3F00                     451              MOVE.W  D0,-(A7)               ; GUARDAMOS D0
0000130E  3003                     452              MOVE.W  D3,D0                  ; PONEMOS EL INDICE DE LA CELDA EN D0 PARA CALCULAR SUS COORDENADAS
00001310  4EB9 0000171A            453              JSR     CNVICOOR
00001316  2F01                     454              MOVE.L  D1,-(A7)
00001318                           455              
00001318                           456              ; SET COLOR DEL CONTORNO CABEZA
00001318  103C 0050                457              MOVE.B  #80,D0
0000131C  223C 0000FF00            458              MOVE.L  #CBZPCOL,D1
00001322  4E4F                     459              TRAP    #15
00001324                           460              
00001324                           461              ; SET COLOR DEL RELLENO CABEZA
00001324  103C 0051                462              MOVE.B  #81,D0
00001328  223C 0000AA00            463              MOVE.L  #CBZFCOL,D1
0000132E  4E4F                     464              TRAP    #15
00001330                           465              
00001330                           466              ; DIBUJAR CABEZA
00001330  103C 0057                467              MOVE.B  #87,D0
00001334  221F                     468              MOVE.L  (A7)+,D1
00001336  3F03                     469              MOVE.W  D3,-(A7)
00001338  3601                     470              MOVE.W  D1,D3
0000133A  0643 0014                471              ADD.W   #CBZWIDTH,D3
0000133E  3802                     472              MOVE.W  D2,D4
00001340  0644 0014                473              ADD.W   #CBZHEIGH,D4
00001344  4E4F                     474              TRAP    #15
00001346                           475              
00001346  2F01                     476              MOVE.L  D1,-(A7)
00001348                           477              
00001348                           478              ; SET COLOR DEL CONTORNO OJO
00001348  103C 0050                479              MOVE.B  #80,D0
0000134C  7200                     480              MOVE.L  #OJOPCOL,D1
0000134E  4E4F                     481              TRAP    #15
00001350                           482              
00001350                           483              ; SET COLOR DEL RELLENO OJO
00001350  103C 0051                484              MOVE.B  #81,D0
00001354  223C 00FFFFFF            485              MOVE.L  #OJOFCOL,D1
0000135A  4E4F                     486              TRAP    #15
0000135C                           487              
0000135C                           488              ; DIBUJAR OJO
0000135C  103C 0058                489              MOVE.B  #88,D0
00001360  221F                     490              MOVE.L  (A7)+,D1
00001362  2F01                     491              MOVE.L  D1,-(A7)
00001364  2F02                     492              MOVE.L  D2,-(A7)
00001366  5A41                     493              ADD.W   #OJOWIDTH/2,D1            
00001368  3601                     494              MOVE.W  D1,D3
0000136A  0643 000A                495              ADD.W   #OJOWIDTH,D3
0000136E  5A42                     496              ADD.W   #OJOHEIGH/2,D2
00001370  3802                     497              MOVE.W  D2,D4
00001372  0644 000A                498              ADD.W   #OJOHEIGH,D4
00001376  4E4F                     499              TRAP    #15
00001378                           500  
00001378                           501              ; DEFINIR COORDENADAS IRIS
00001378  241F                     502              MOVE.L  (A7)+,D2
0000137A  221F                     503              MOVE.L  (A7)+,D1
0000137C  0641 000A                504              ADD.W   #OJOWIDTH,D1
00001380  0642 000A                505              ADD.W   #OJOHEIGH,D2
00001384  103C 0052                506              MOVE.B  #82,D0
00001388  4E4F                     507              TRAP    #15
0000138A                           508              
0000138A                           509              
0000138A  361F                     510              MOVE.W  (A7)+,D3
0000138C  301F                     511              MOVE.W  (A7)+,D0
0000138E                           512  
0000138E                           513  
0000138E  4E75                     514              RTS
00001390                           515  
00001390                           516  
00001390                           517  
00001390                           518  
00001390                           519  
00001390                           520  
00001390                           521  
00001390                           522  
00001390                           523  
00001390                           524  
00001390                           525  
00001390                           526  
00001390                           527  
00001390                           528  
00001390                           529  
00001390                           530  
00001390                           531  
00001390                           532  
00001390                           533  
00001390                           534  
00001390                           535  
00001390                           536  
00001390                           537  
00001390                           538  
00001390                           539  -------------------- end include --------------------
00001390                           540              INCLUDE 'SEGSRP.X68'
00001390                           541  
00001390                           542  ; ------------------------------------------------------------------------------
00001390                           543  SEGINIT
00001390                           544  ; INICIALIZAR SEGMENTO.
00001390                           545  ; INPUT    : NONE 
00001390                           546  ; OUTPUT   : NONE
00001390                           547  ; MODIFIES : NONE
00001390                           548  ; ------------------------------------------------------------------------------
00001390  33FC 012C 000018FA       549              MOVE.W  #(PANWIDTH/2)-CBZWIDTH,(SGMPOSX)
00001398  33FC 00F0 000018FC       550              MOVE.W  #PANHEIGH/2,(SGMPOSY)
000013A0  4E75                     551              RTS
000013A2                           552              
000013A2                           553  ; ------------------------------------------------------------------------------
000013A2                           554  SEGUPD
000013A2                           555  ; ACTUALIZAR SEGMENTO.
000013A2                           556  ; INPUT    : NONE 
000013A2                           557  ; OUTPUT   : NONE
000013A2                           558  ; MODIFIES : NONE
000013A2                           559  ; ------------------------------------------------------------------------------
000013A2  48A7 6000                560              MOVEM.W D1-D2,-(A7)
000013A6                           561              
000013A6  3239 000018FA            562              MOVE.W  SGMPOSX,D1
000013AC  33C1 000018F6            563              MOVE.W  D1,COLPOSX
000013B2  3439 000018FC            564              MOVE.W  SGMPOSY,D2
000013B8  33C2 000018F8            565              MOVE.W  D2,COLPOSY
000013BE  4EB9 0000165C            566              JSR     CINDMTRZ
000013C4  4EB9 000016AE            567              JSR     RSTCLD
000013CA                           568              
000013CA  4C9F 0006                569              MOVEM.W (A7)+,D1-D2            
000013CE  4E75                     570              RTS
000013D0                           571              
000013D0                           572  ; ------------------------------------------------------------------------------
000013D0                           573  SEGPLOT
000013D0                           574  ; DIBUJAR SEGMENTO.
000013D0                           575  ; INPUT    : NONE 
000013D0                           576  ; OUTPUT   : NONE
000013D0                           577  ; MODIFIES : NONE
000013D0                           578  ; ------------------------------------------------------------------------------
000013D0  3F00                     579              MOVE.W  D0,-(A7)
000013D2  3003                     580              MOVE.W  D3,D0
000013D4  4EB9 0000171A            581              JSR     CNVICOOR
000013DA  2F01                     582              MOVE.L  D1,-(A7)
000013DC                           583              
000013DC  103C 0050                584              MOVE.B  #80,D0
000013E0  223C 0000FF00            585              MOVE.L  #SGMPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DEL SEGMENTO
000013E6  4E4F                     586              TRAP    #15
000013E8                           587              
000013E8  103C 0051                588              MOVE.B  #81,D0
000013EC  223C 0000AA00            589              MOVE.L  #SGMFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DEL SEGMENTO
000013F2  4E4F                     590              TRAP    #15
000013F4                           591              
000013F4  103C 0057                592              MOVE.B  #87,D0
000013F8  221F                     593              MOVE.L  (A7)+,D1
000013FA  3F03                     594              MOVE.W  D3,-(A7)
000013FC  3601                     595              MOVE.W  D1,D3
000013FE  0643 0014                596              ADD.W   #SIZECLDA,D3
00001402  3802                     597              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
00001404  0644 0014                598              ADD.W   #SIZECLDA,D4
00001408  4E4F                     599              TRAP    #15                     
0000140A                           600                          
0000140A  361F                     601              MOVE.W  (A7)+,D3  
0000140C  301F                     602              MOVE.W  (A7)+,D0
0000140E                           603  
0000140E                           604  
0000140E  4E75                     605              RTS
00001410                           606  
00001410                           607  
00001410                           608  
00001410                           609  
00001410                           610  
00001410                           611  
00001410                           612  
00001410                           613  
00001410                           614  
00001410                           615  -------------------- end include --------------------
00001410                           616              INCLUDE 'TAILSRP.X68'
00001410                           617     
00001410                           618  ; ------------------------------------------------------------------------------
00001410                           619  TAILINIT
00001410                           620  ; INICIALIZAR COLA.
00001410                           621  ; INPUT    : NONE 
00001410                           622  ; OUTPUT   : NONE
00001410                           623  ; MODIFIES : NONE
00001410                           624  ; ------------------------------------------------------------------------------
00001410  33FC 011D 000018F6       625              MOVE.W  #(PANWIDTH/2)-CBZWIDTH-SGMWIDTH+(COLWIDTH/2),(COLPOSX)
00001418  33FC 00F0 000018F8       626              MOVE.W  #(PANHEIGH/2),(COLPOSY)
00001420  4E75                     627              RTS
00001422                           628              
00001422                           629              
00001422                           630  ; ------------------------------------------------------------------------------
00001422                           631  TAILUPD
00001422                           632  ; ACTUALIZAR COLA.
00001422                           633  ; INPUT    : NONE 
00001422                           634  ; OUTPUT   : NONE
00001422                           635  ; MODIFIES : NONE
00001422                           636  ; ------------------------------------------------------------------------------
00001422  48A7 6000                637              MOVEM.W D1-D2,-(A7)
00001426                           638              
00001426  3239 000018F6            639              MOVE.W  COLPOSX,D1
0000142C  3439 000018F8            640              MOVE.W  COLPOSY,D2
00001432  4EB9 0000165C            641              JSR     CINDMTRZ
00001438  4EB9 000016AE            642              JSR     RSTCLD 
0000143E                           643              
0000143E  4C9F 0006                644              MOVEM.W (A7)+,D1-D2            
00001442  4E75                     645              RTS
00001444                           646              
00001444                           647  ; ------------------------------------------------------------------------------
00001444                           648  TAILPLOT
00001444                           649  ; DIBUJAR COLA
00001444                           650  ; INPUT    : NONE 
00001444                           651  ; OUTPUT   : NONE
00001444                           652  ; MODIFIES : NONE
00001444                           653  ; ------------------------------------------------------------------------------
00001444  3F00                     654              MOVE.W  D0,-(A7)
00001446  3003                     655              MOVE.W  D3,D0
00001448  4EB9 0000171A            656              JSR     CNVICOOR
0000144E  2F01                     657              MOVE.L  D1,-(A7)
00001450                           658              
00001450  103C 0050                659              MOVE.B  #80,D0
00001454  223C 0000FF00            660              MOVE.L  #COLPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA COLA
0000145A  4E4F                     661              TRAP    #15
0000145C                           662              
0000145C  103C 0051                663              MOVE.B  #81,D0
00001460  223C 0000AA00            664              MOVE.L  #COLFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA COLA
00001466  4E4F                     665              TRAP    #15
00001468                           666              
00001468  103C 0057                667              MOVE.B  #87,D0
0000146C  221F                     668              MOVE.L  (A7)+,D1
0000146E  3F03                     669              MOVE.W  D3,-(A7)
00001470  3601                     670              MOVE.W  D1,D3
00001472  0643 0014                671              ADD.W   #SIZECLDA,D3
00001476  3802                     672              MOVE.W  D2,D4                    
00001478  0644 0014                673              ADD.W   #SIZECLDA,D4
0000147C  4E4F                     674              TRAP    #15                    ; DIBUJAMOS EL CUADRADO 
0000147E                           675                          
0000147E  361F                     676              MOVE.W  (A7)+,D3  
00001480  301F                     677              MOVE.W  (A7)+,D0
00001482                           678  
00001482  4E75                     679              RTS
00001484                           680  
00001484                           681  
00001484                           682  
00001484                           683  
00001484                           684  
00001484                           685  
00001484                           686  
00001484                           687  
00001484                           688  -------------------- end include --------------------
00001484                           689              INCLUDE 'APPLE.X68'
00001484                           690     
00001484                           691  ; ------------------------------------------------------------------------------
00001484                           692  APPLEINIT
00001484                           693  ; Inicializa la manzana en una posición aleatoria
00001484                           694  ; INPUT    : NONE 
00001484                           695  ; OUTPUT   : NONE
00001484                           696  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
00001484                           697  ; ------------------------------------------------------------------------------
00001484                           698  
00001484                           699              ; Llama a la función para generar la posición aleatoria
00001484  4EB9 00001572            700              JSR     GENPOSMNZ
0000148A                           701  
0000148A                           702              ; Convierte las coordenadas de la manzana a índice de la matriz
0000148A  4EB9 0000165C            703              JSR     CINDMTRZ
00001490                           704  
00001490                           705              ; Verifica si la celda está ocupada o libre
00001490                           706  CHECK:
00001490  4EB9 00001756            707              JSR     CHECKCLD
00001496  6700 0010                708              BEQ     MARKMNZ                  ; Si está libre
0000149A                           709  
0000149A                           710              ; Si la celda está ocupada
0000149A  4EB9 00001572            711              JSR     GENPOSMNZ                ; Genera una nueva posición
000014A0  4EB9 0000165C            712              JSR     CINDMTRZ                 ; Convierte las nuevas coordenadas
000014A6  60E8                     713              BRA     CHECK                    ; Repite la comprobación
000014A8                           714  
000014A8                           715  MARKMNZ:
000014A8                           716              ; Marca la celda como ocupada con la manzana (estado 4)
000014A8  4EB9 00001704            717              JSR     MNZOCPD
000014AE                           718  
000014AE                           719              ; Dibuja la manzana en la pantalla
000014AE  4EB9 000014F4            720              JSR     APPLEPLOT
000014B4                           721  
000014B4  4E75                     722              RTS
000014B6                           723              
000014B6                           724              ;MOVE.W  #30,(MNZPOSX)   ;DE MOMENTO PONGO X E Y ELEGIDAS MANUALMENTE, EN TEORÍA DEBE SER ALEATORIO
000014B6                           725              ;MOVE.W  #30,(MNZPOSY)
000014B6                           726  
000014B6                           727  ; ------------------------------------------------------------------------------
000014B6                           728  APPLEUPD
000014B6                           729  ; Actualiza la posición de la manzana cuando la serpiente come
000014B6                           730  ; INPUT    : NONE 
000014B6                           731  ; OUTPUT   : NONE
000014B6                           732  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
000014B6                           733  ; ------------------------------------------------------------------------------
000014B6                           734  
000014B6                           735              ; Convierte las coordenadas actuales de la manzana a índice de la matriz
000014B6  4EB9 0000165C            736              JSR     CINDMTRZ
000014BC                           737  
000014BC                           738              ; Marca la celda anterior como vacía
000014BC  4EB9 000016C2            739              JSR     MCLDVCIA
000014C2                           740  
000014C2                           741              ; Llama a la función para generar una nueva posición aleatoria
000014C2  4EB9 00001572            742              JSR     GENPOSMNZ
000014C8                           743  
000014C8                           744              ; Convierte las nuevas coordenadas de la manzana a índice de la matriz
000014C8  4EB9 0000165C            745              JSR     CINDMTRZ
000014CE                           746  
000014CE                           747  CHCKUPDT:
000014CE  4EB9 00001756            748              JSR     CHECKCLD             ; Verifica si la celda está libre
000014D4  6700 0010                749              BEQ     NEWMNZ               ; Si está libre
000014D8                           750  
000014D8                           751              ; Si la celda está ocupada
000014D8  4EB9 00001572            752              JSR     GENPOSMNZ            ; Genera una nueva posición
000014DE  4EB9 0000165C            753              JSR     CINDMTRZ             ; Convierte las nuevas coordenadas
000014E4  60E8                     754              BRA     CHCKUPDT             ; Repite la comprobación
000014E6                           755  
000014E6                           756  NEWMNZ:
000014E6                           757              ; Marca la celda como ocupada con la manzana (estado 4)
000014E6  4EB9 00001704            758              JSR     MNZOCPD
000014EC                           759  
000014EC                           760              ; Dibuja la nueva manzana en la pantalla
000014EC  4EB9 000014F4            761              JSR     APPLEPLOT
000014F2                           762  
000014F2  4E75                     763              RTS
000014F4                           764              
000014F4                           765  ; ------------------------------------------------------------------------------
000014F4                           766  APPLEPLOT
000014F4                           767  ; Dibuja la manzana
000014F4                           768  ; INPUT    : NONE 
000014F4                           769  ; OUTPUT   : NONE
000014F4                           770  ; MODIFIES : NONE
000014F4                           771  ; ------------------------------------------------------------------------------
000014F4  3F00                     772              MOVE.W  D0,-(A7)
000014F6  3003                     773              MOVE.W  D3,D0
000014F8  4EB9 0000171A            774              JSR     CNVICOOR
000014FE  2F01                     775              MOVE.L  D1,-(A7)                ; PRIMERO DEBEMOS DIBUJAR EL FONDO Y LUEGO LA MANZANA
00001500                           776              
00001500  103C 0050                777              MOVE.B  #80,D0
00001504  223C 0090EE90            778              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
0000150A  4E4F                     779              TRAP    #15
0000150C                           780              
0000150C  103C 0051                781              MOVE.B  #81,D0
00001510  223C 0090EE90            782              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
00001516  4E4F                     783              TRAP    #15
00001518                           784              
00001518  103C 0057                785              MOVE.B  #87,D0
0000151C  221F                     786              MOVE.L  (A7)+,D1
0000151E  3F03                     787              MOVE.W  D3,-(A7)
00001520  3601                     788              MOVE.W  D1,D3
00001522  0643 0014                789              ADD.W   #SIZECLDA,D3
00001526  3802                     790              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
00001528  0644 0014                791              ADD.W   #SIZECLDA,D4
0000152C  4E4F                     792              TRAP    #15                     
0000152E                           793                          
0000152E  361F                     794              MOVE.W  (A7)+,D3  
00001530  301F                     795              MOVE.W  (A7)+,D0
00001532                           796  
00001532  3F00                     797              MOVE.W  D0,-(A7)
00001534  3003                     798              MOVE.W  D3,D0
00001536  4EB9 0000171A            799              JSR     CNVICOOR
0000153C  2F01                     800              MOVE.L  D1,-(A7)
0000153E                           801              
0000153E  103C 0050                802              MOVE.B  #80,D0
00001542  223C 0000AAFF            803              MOVE.L  #MNZPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA MANZANA
00001548  4E4F                     804              TRAP    #15
0000154A                           805              
0000154A  103C 0051                806              MOVE.B  #81,D0
0000154E  223C 000000FF            807              MOVE.L  #MNZFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA MANZANA
00001554  4E4F                     808              TRAP    #15
00001556                           809              
00001556  103C 0058                810              MOVE.B  #88,D0
0000155A  221F                     811              MOVE.L  (A7)+,D1
0000155C  3F03                     812              MOVE.W  D3,-(A7)
0000155E  3601                     813              MOVE.W  D1,D3
00001560  0643 0014                814              ADD.W   #SIZECLDA,D3
00001564  3802                     815              MOVE.W  D2,D4                    ; DIBUJAMOS EL CIRCULO
00001566  0644 0014                816              ADD.W   #SIZECLDA,D4
0000156A  4E4F                     817              TRAP    #15                     
0000156C                           818                          
0000156C  361F                     819              MOVE.W  (A7)+,D3  
0000156E  301F                     820              MOVE.W  (A7)+,D0
00001570                           821  
00001570                           822  
00001570  4E75                     823              RTS
00001572                           824  ; ----------------------------------------------------------------------------
00001572                           825  GENPOSMNZ
00001572                           826  ; Genera una posición aleatoria para la manzana
00001572                           827  ; INPUT: NONE
00001572                           828  ; OUTPUT:
00001572                           829  ; MODIFIES: MNZPOSX, MNZPOSY
00001572                           830  ; ----------------------------------------------------------------------------
00001572                           831  
00001572  48E7 8000                832              MOVEM.L D0,-(A7)
00001576                           833  
00001576                           834              ; Genera la coordenada X aleatoria
00001576  4EB8 1116                835              JSR     UTLRAND
0000157A  0240 001F                836              ANDI.W  #NUMCLMNS-1, D0       ; Asegura que esté en [0, NUMCLMNS-1]
0000157E  C0FC 0014                837              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
00001582  3200                     838              MOVE.W  D0,D1
00001584  33C0 000018EA            839              MOVE.W  D0, MNZPOSX           ; Guarda la coordenada X generada
0000158A                           840              
0000158A                           841              ; Generar coordenada Y aleatoria
0000158A  4EB8 1116                842              JSR     UTLRAND
0000158E  0240 0017                843              ANDI.W  #NUMFILAS-1, D0       ; Asegura que esté en el rango [0, NUMFILAS-1]
00001592  C0FC 0014                844              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
00001596  3400                     845              MOVE.W  D0,D2
00001598  33C0 000018EC            846              MOVE.W  D0, MNZPOSY           ; Guarda la coordenada Y generada
0000159E                           847              
0000159E  4CDF 0001                848              MOVEM.L (A7)+,D0
000015A2  4E75                     849              RTS 
000015A4                           850  
000015A4                           851  
000015A4                           852  
000015A4                           853  -------------------- end include --------------------
000015A4                           854              INCLUDE 'SCORE.X68'
000015A4                           855     
000015A4                           856  ; ------------------------------------------------------------------------------
000015A4                           857  SCOINIT
000015A4                           858  ; INICIALIZAR MARCADOR.
000015A4                           859  ; INPUT    : NONE 
000015A4                           860  ; OUTPUT   : NONE
000015A4                           861  ; MODIFIES : NONE
000015A4                           862  ; ------------------------------------------------------------------------------
000015A4  4279 00001900            863              CLR.W   (JGOPNTS)
000015AA  4E75                     864              RTS
000015AC                           865              
000015AC                           866  ; ------------------------------------------------------------------------------
000015AC                           867  SCOUPD
000015AC                           868  ; ACTUALIZAR MARCADOR.
000015AC                           869  ; INPUT    : NONE 
000015AC                           870  ; OUTPUT   : NONE
000015AC                           871  ; MODIFIES : NONE
000015AC                           872  ; ------------------------------------------------------------------------------
000015AC  4E75                     873              RTS
000015AE                           874              
000015AE                           875  ; ------------------------------------------------------------------------------
000015AE                           876  SCOPLOT
000015AE                           877  ; DIBUJAR MARCADOR.
000015AE                           878  ; INPUT    : NONE 
000015AE                           879  ; OUTPUT   : NONE
000015AE                           880  ; MODIFIES : NONE
000015AE                           881  ; ------------------------------------------------------------------------------
000015AE  48E7 C040                882             MOVEM.L  D0-D1/A1,-(A7)
000015B2                           883             ; SET COLOR DE FONDO
000015B2  103C 0051                884             MOVE.B   #81,D0
000015B6  223C 0090EE90            885             MOVE.L   #COLFND,D1
000015BC  4E4F                     886             TRAP     #15
000015BE                           887             
000015BE                           888             
000015BE                           889             
000015BE                           890             ; DIBUJAR LINEA DE PUNTUACIÓN
000015BE  43F9 000015D8            891              LEA     .TXT1,A1
000015C4  4281                     892              CLR.L   D1
000015C6  3239 00001900            893              MOVE.W  (JGOPNTS),D1
000015CC  103C 0011                894              MOVE.B  #17,D0
000015D0  4E4F                     895              TRAP    #15
000015D2                           896              
000015D2  4CDF 0203                897              MOVEM.L (A7)+,D0-D1/A1
000015D6  4E75                     898              RTS
000015D8                           899  
000015D8                           900  
000015D8= 50 55 4E 54 4F 53 ...    901  .TXT1       DC.B    'PUNTOS : ',0
000015E2                           902  
000015E2                           903  
000015E2                           904  -------------------- end include --------------------
000015E2                           905              INCLUDE 'MATRIZ.X68'
000015E2                           906  ; ----------------------------------------------------------------------------
000015E2                           907  ; MATRIZ
000015E2                           908  ; ----------------------------------------------------------------------------
000015E2                           909  
000015E2                           910  ;-----------------------------------------------------------------------------
000015E2                           911  MTZINIT
000015E2                           912  ; INICIALIZA LA MATRIZ, AL PRINCIPIO ESTÁ VACÍA
000015E2                           913  ; INPUT    : NONE
000015E2                           914  ; OUTPUT   : NONE
000015E2                           915  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
000015E2                           916  ; ----------------------------------------------------------------------------
000015E2                           917              
000015E2  48A7 E080                918              MOVEM.W D0-D2/A0,-(A7)
000015E6                           919              
000015E6  41F9 00001904            920              LEA ESTDCLDS, A0       ; Apunta al inicio de ESTDCLDS
000015EC  303C 0300                921              MOVE.W #TCELDAS, D0    ; Número total de celdas
000015F0                           922  
000015F0                           923  CLNCLDS:
000015F0  4218                     924              CLR.B (A0)+            ; Coloca 0 en cada celda
000015F2  5340                     925              SUBI.W #1, D0          ; Decrementa el contador de celdas
000015F4  66FA                     926              BNE CLNCLDS            ; Repite hasta que esten vacías
000015F6                           927              
000015F6                           928              
000015F6  3239 000018EE            929              MOVE.W  CBZPOSX, D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
000015FC  3439 000018F0            930              MOVE.W  CBZPOSY, D2
00001602  4EB9 0000165C            931              JSR     CINDMTRZ
00001608  4EB9 00001696            932              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
0000160E                           933              
0000160E  3239 000018FA            934              MOVE.W  SGMPOSX, D1
00001614  3439 000018FC            935              MOVE.W  SGMPOSY, D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
0000161A  4EB9 0000165C            936              JSR     CINDMTRZ
00001620  4EB9 000016D8            937              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
00001626                           938              
00001626  3239 000018F6            939              MOVE.W  COLPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA COLA
0000162C  3439 000018F8            940              MOVE.W  COLPOSY, D2
00001632  4EB9 0000165C            941              JSR     CINDMTRZ
00001638  4EB9 000016EE            942              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
0000163E                           943              
0000163E  3239 000018EA            944              MOVE.W  MNZPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
00001644  3439 000018EC            945              MOVE.W  MNZPOSY, D2
0000164A  4EB9 0000165C            946              JSR     CINDMTRZ
00001650  4EB9 00001704            947              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
00001656                           948              
00001656                           949              
00001656  4C9F 0107                950              MOVEM.W (A7)+,D0-D2/A0
0000165A                           951  
0000165A  4E75                     952              RTS
0000165C                           953  
0000165C                           954  ;-----------------------------------------------------------------------------
0000165C                           955  CINDMTRZ
0000165C                           956  ; CALCULA EL ÍNDICE DE UNA CELDA
0000165C                           957  ; INPUT    : D1 = coordenada X pantalla, D2 = coordenada Y pantalla
0000165C                           958  ; OUTPUT   : D0 = índice de la celda en ESTDCLDS
0000165C                           959  ; MODIFIES : NONE
0000165C                           960  ; ----------------------------------------------------------------------------
0000165C                           961  
0000165C  48A7 7000                962               MOVEM.W D1-D3,-(A7)     ; Guarda los registros D1-D3 en la pila
00001660                           963  
00001660                           964              ; Divide X por SIZECLDA
00001660  3601                     965              MOVE.W  D1, D3          ; Copia X a D3
00001662  4241                     966              CLR.W   D1              ; Inicializa el cociente de X
00001664                           967  
00001664  B67C 0014                968  DIVX:       CMP.W   #SIZECLDA, D3    ; Compara D3 con SIZECLDA
00001668  6D00 000A                969              BLT     ENDDIVX         ; Si D3 < SIZECLDA, salta a ENDDIVX
0000166C  0443 0014                970              SUB.W   #SIZECLDA, D3   ; Resta SIZECLDA de D3
00001670  5241                     971              ADDQ.W  #1, D1          ; Incrementa el cociente de X
00001672  60F0                     972              BRA     DIVX            ; Repite el bucle
00001674                           973  
00001674                           974  ENDDIVX:
00001674                           975  
00001674                           976              ; Divide Y por SIZECLDA
00001674  3602                     977              MOVE.W  D2, D3          ; Copia Y a D3
00001676  4242                     978              CLR.W   D2              ; Inicializa el cociente de Y
00001678                           979  
00001678  B67C 0014                980  DIVY:       CMP.W   #SIZECLDA, D3    ; Compara D3 con SIZECLDA
0000167C  6D00 000A                981              BLT     ENDDIVY         ; Si D3 < SIZECLDA, salta a ENDDIVY
00001680  0443 0014                982              SUB.W   #SIZECLDA, D3   ; Resta SIZECLDA de D3
00001684  5242                     983              ADDQ.W  #1, D2          ; Incrementa el cociente de Y
00001686  60F0                     984              BRA     DIVY            ; Repite el bucle
00001688                           985  
00001688                           986  ENDDIVY:
00001688                           987  
00001688                           988              ; Calcula el índice
00001688  4240                     989              CLR.W   D0
0000168A  3002                     990              MOVE.W  D2, D0          ; D0 = Y_CELDA
0000168C  EB40                     991              ASL.W   #5, D0          ; D0 = Y_CELDA * NUMCLMNS (32 = 2^5)
0000168E  D041                     992              ADD.W   D1, D0          ; D0 = Y_CELDA * NUMCLMNS + X_CELDA
00001690                           993  
00001690  4C9F 000E                994              MOVEM.W (A7)+,D1-D3     ; Restaura los registros D1-D3 desde la pila
00001694                           995  
00001694  4E75                     996              RTS  
00001696                           997              
00001696                           998  ;-----------------------------------------------------------------------------
00001696                           999  CBZOCPD
00001696                          1000  ; MARCA UNA CELDA COMO OCUPADA POR LA CABEZA
00001696                          1001  ; INPUT    : D0 = índice de la celda en ESTDCLDS
00001696                          1002  ; OUTPUT   : NONE
00001696                          1003  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
00001696                          1004  ; ----------------------------------------------------------------------------
00001696                          1005  
00001696  48A7 0080               1006              MOVEM.W A0,-(A7)
0000169A                          1007  
0000169A  41F9 00001904           1008              LEA     ESTDCLDS, A0                ; Dirección de la matriz en A0
000016A0  11B9 000018FE 0000      1009              MOVE.B  TRZPLOT, (A0, D0.W)           ; Marca la celda como ocupada
000016A8                          1010              
000016A8  4C9F 0100               1011              MOVEM.W (A7)+,A0
000016AC                          1012              
000016AC  4E75                    1013              RTS
000016AE                          1014              
000016AE                          1015              
000016AE                          1016              
000016AE                          1017  ;-----------------------------------------------------------------------------
000016AE                          1018  RSTCLD
000016AE                          1019  ; RESTA 1 A LA CELDA PASADA POR PARÁMETRO
000016AE                          1020  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016AE                          1021  ; OUTPUT   : NONE
000016AE                          1022  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016AE                          1023  ; ----------------------------------------------------------------------------
000016AE                          1024  
000016AE  48A7 0080               1025              MOVEM.W A0,-(A7)
000016B2                          1026  
000016B2  41F9 00001904           1027              LEA     ESTDCLDS, A0              ; Dirección de la matriz en A0
000016B8  5330 0000               1028              SUBQ.B   #1, (A0, D0.W)           ; Marca la celda como ocupada
000016BC                          1029              
000016BC  4C9F 0100               1030              MOVEM.W (A7)+,A0
000016C0                          1031              
000016C0  4E75                    1032              RTS
000016C2                          1033             
000016C2                          1034  ;-----------------------------------------------------------------------------
000016C2                          1035  MCLDVCIA
000016C2                          1036  ; MARCA UNA CELDA COMO VACÍA
000016C2                          1037  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016C2                          1038  ; OUTPUT   : NONE
000016C2                          1039  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016C2                          1040  ; ----------------------------------------------------------------------------
000016C2                          1041  
000016C2  48A7 0080               1042              MOVEM.W A0,-(A7)
000016C6                          1043  
000016C6  41F9 00001904           1044              LEA ESTDCLDS, A0                ; Direccion de la matriz en A0
000016CC  11BC 0000 0000          1045              MOVE.B #0, (A0, D0.W)           ; Marca la celda como vacía
000016D2                          1046              
000016D2  4C9F 0100               1047              MOVEM.W (A7)+,A0
000016D6                          1048              
000016D6  4E75                    1049              RTS
000016D8                          1050  
000016D8                          1051  ;-----------------------------------------------------------------------------
000016D8                          1052  SGMOCPD
000016D8                          1053  ; MARCA UNA CELDA COMO OCUPADA POR EL SEGMENTO
000016D8                          1054  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016D8                          1055  ; OUTPUT   : NONE
000016D8                          1056  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016D8                          1057  ; ----------------------------------------------------------------------------
000016D8                          1058  
000016D8  48A7 0080               1059              MOVEM.W A0,-(A7)
000016DC                          1060  
000016DC  41F9 00001904           1061              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
000016E2  11BC 0002 0000          1062              MOVE.B #2, (A0, D0.W)           ; Marca la celda como ocupada
000016E8                          1063              
000016E8  4C9F 0100               1064              MOVEM.W (A7)+,A0
000016EC                          1065              
000016EC  4E75                    1066              RTS
000016EE                          1067              
000016EE                          1068  ;-----------------------------------------------------------------------------
000016EE                          1069  COLOCPD
000016EE                          1070  ; MARCA UNA CELDA COMO OCUPADA POR LA COLA
000016EE                          1071  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016EE                          1072  ; OUTPUT   : NONE
000016EE                          1073  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016EE                          1074  ; ----------------------------------------------------------------------------
000016EE                          1075  
000016EE  48A7 0080               1076              MOVEM.W A0,-(A7)
000016F2                          1077  
000016F2  41F9 00001904           1078              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
000016F8  11BC 0001 0000          1079              MOVE.B #1, (A0, D0.W)           ; Marca la celda como ocupada
000016FE                          1080              
000016FE  4C9F 0100               1081              MOVEM.W (A7)+,A0
00001702                          1082              
00001702  4E75                    1083              RTS
00001704                          1084  
00001704                          1085  
00001704                          1086  ;-----------------------------------------------------------------------------
00001704                          1087  MNZOCPD
00001704                          1088  ; MARCA UNA CELDA COMO OCUPADA POR LA MANZANA
00001704                          1089  ; INPUT    : D0 = índice de la celda en ESTDCLDS
00001704                          1090  ; OUTPUT   : NONE
00001704                          1091  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
00001704                          1092  ; ----------------------------------------------------------------------------
00001704                          1093  
00001704  48A7 0080               1094              MOVEM.W A0,-(A7)
00001708                          1095  
00001708  41F9 00001904           1096              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
0000170E  11BC 0004 0000          1097              MOVE.B #4, (A0, D0.W)           ; Marca la celda como ocupada
00001714                          1098              
00001714  4C9F 0100               1099              MOVEM.W (A7)+,A0
00001718                          1100              
00001718  4E75                    1101              RTS
0000171A                          1102  
0000171A                          1103              
0000171A                          1104  ;-----------------------------------------------------------------------------
0000171A                          1105  CNVICOOR
0000171A                          1106  ; Convierte un índice de celda a coordenadas de pantalla (X, Y)
0000171A                          1107  ; INPUT    : D0 = índice de la celda en ESTADO_CELDAS
0000171A                          1108  ; OUTPUT   : D1 = coordenada X, D2 = coordenada Y
0000171A                          1109  ; MODIFIES : NONE
0000171A                          1110  ; ----------------------------------------------------------------------------
0000171A                          1111  
0000171A  48A7 9800               1112              MOVEM.W D0/D3-D4,-(A7)
0000171E                          1113  
0000171E  3400                    1114              MOVE.W  D0,D2         ; Copia índice a D2 para calcular la fila
00001720  EA4A                    1115              LSR.W   #5,D2         ; D2 = índice / NUM_COLUMNAS (32 = 2^5)
00001722  3200                    1116              MOVE.W  D0,D1         ; Copia índice a D1 para calcular la columna
00001724  C27C 001F               1117              AND.W   #$1F,D1       ; D1 = índice % NUM_COLUMNAS (31 = 0x1F) (CREO)
00001728                          1118  
00001728                          1119              ; Multiplica por TAMAÑO_CELDA = 10
00001728  363C 0014               1120              MOVE.W  #SIZECLDA, D3
0000172C  3801                    1121              MOVE.W  D1,D4         ; Copia D1 para multiplicar por 10
0000172E  4241                    1122              CLR.W   D1            ; Inicializa resultado
00001730                          1123  
00001730                          1124  
00001730                          1125  MULTLOOPX: 
00001730  B87C 0000               1126              CMP.W   #0, D4        ; ¿Quedan iteraciones?
00001734  6700 0008               1127              BEQ     ENDMULTX
00001738  D243                    1128              ADD.W   D3,D1         ; Suma TAMANO_CELDA (10) repetidamente
0000173A                          1129  
0000173A  5344                    1130              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
0000173C  60F2                    1131              BRA     MULTLOOPX     ; Repite mientras no sea 0
0000173E                          1132  ENDMULTX: 
0000173E  3802                    1133              MOVE.W  D2,D4         ; Copia D2 para multiplicar por 10
00001740  4242                    1134              CLR.W   D2            ; Inicializa resultado
00001742                          1135  
00001742                          1136  MULTLOOPY: 
00001742  B87C 0000               1137              CMP.W   #0, D4        ; ¿Quedan iteraciones?
00001746  6700 0008               1138              BEQ     ENDMULTY
0000174A  D443                    1139              ADD.W   D3,D2         ; Suma TAMANO_CELDA (10) repetidamente
0000174C  5344                    1140              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
0000174E  60F2                    1141              BRA     MULTLOOPY     ; Repite mientras no sea 0
00001750                          1142  ENDMULTY:
00001750  4C9F 0019               1143              MOVEM.W (A7)+,D0/D3-D4
00001754                          1144  
00001754  4E75                    1145              RTS
00001756                          1146  
00001756                          1147  ; ----------------------------------------------------------------------------
00001756                          1148  CHECKCLD
00001756                          1149  ; INPUT: D0 = índice de la celda
00001756                          1150  ; OUTPUT: D0 = 0 si está vacía, 1 si está ocupada
00001756                          1151  ; MODIFIES: Ninguno
00001756                          1152  ; ----------------------------------------------------------------------------
00001756                          1153  
00001756  41F9 00001904           1154              LEA     ESTDCLDS, A0    ; Carga la dirección de la matriz ESTDCLDS
0000175C  1230 0000               1155              MOVE.B  (A0, D0.W),D1   ; Carga el estado de la celda en D1
00001760  B23C 0000               1156              CMP.B   #0, D1          ; Compara si está vacía (0)
00001764  6700 0008               1157              BEQ     CLDFREE         ; Si está vacía
00001768  303C 0001               1158              MOVE.W  #1, D0          ; Si está ocupada, devuelve 1 (ocupada)
0000176C                          1159  
0000176C  4E75                    1160              RTS
0000176E                          1161  
0000176E                          1162  CLDFREE:
0000176E  303C 0000               1163              MOVE.W  #0, D0                 ; Devuelve 0 (libre)
00001772                          1164  
00001772  4E75                    1165              RTS
00001774                          1166  
00001774                          1167  
00001774                          1168  ;-----------------------------------------------------------------------------
00001774                          1169  FONPLOT
00001774                          1170  ; DIBUJADO DEL FONDO
00001774                          1171  ; INPUT    : NONE
00001774                          1172  ; OUTPUT   : NONE
00001774                          1173  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
00001774                          1174  ; ----------------------------------------------------------------------------
00001774                          1175  
00001774  3F00                    1176              MOVE.W  D0,-(A7)
00001776  3003                    1177              MOVE.W  D3,D0
00001778  4EB8 171A               1178              JSR     CNVICOOR
0000177C  2F01                    1179              MOVE.L  D1,-(A7)
0000177E                          1180              
0000177E  103C 0050               1181              MOVE.B  #80,D0
00001782  223C 0090EE90           1182              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
00001788  4E4F                    1183              TRAP    #15
0000178A                          1184              
0000178A  103C 0051               1185              MOVE.B  #81,D0
0000178E  223C 0090EE90           1186              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
00001794  4E4F                    1187              TRAP    #15
00001796                          1188              
00001796  103C 0057               1189              MOVE.B  #87,D0
0000179A  221F                    1190              MOVE.L  (A7)+,D1
0000179C  3F03                    1191              MOVE.W  D3,-(A7)
0000179E  3601                    1192              MOVE.W  D1,D3
000017A0  0643 0014               1193              ADD.W   #SIZECLDA,D3
000017A4  3802                    1194              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
000017A6  0644 0014               1195              ADD.W   #SIZECLDA,D4
000017AA  4E4F                    1196              TRAP    #15                     
000017AC                          1197                          
000017AC  361F                    1198              MOVE.W  (A7)+,D3  
000017AE  301F                    1199              MOVE.W  (A7)+,D0
000017B0  4E75                    1200              RTS         
000017B2                          1201  
000017B2                          1202  
000017B2                          1203  
000017B2                          1204  ;-----------------------------------------------------------------------------
000017B2                          1205  MTZUPD
000017B2                          1206  ; ACTUALIZA LA MATRIZ CASILLA A CASILLA
000017B2                          1207  ; INPUT    : NONE
000017B2                          1208  ; OUTPUT   : NONE
000017B2                          1209  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
000017B2                          1210  ; ----------------------------------------------------------------------------
000017B2                          1211  
000017B2                          1212  
000017B2  48A7 E080               1213              MOVEM.W D0-D2/A0,-(A7)
000017B6                          1214              
000017B6  41F9 00001904           1215              LEA ESTDCLDS, A0       ; Apunta al inicio de ESTDCLDS
000017BC  303C 0300               1216              MOVE.W #TCELDAS, D0    ; Número total de celdas
000017C0                          1217  
000017C0                          1218  .CLNCLDS:
000017C0  4218                    1219              CLR.B (A0)+            ; Coloca 0 en cada celda
000017C2  5340                    1220              SUBI.W #1, D0          ; Decrementa el contador de celdas
000017C4  66FA                    1221              BNE .CLNCLDS           ; Repite hasta que esten vacías
000017C6                          1222              
000017C6                          1223              
000017C6  3239 000018EE           1224              MOVE.W  CBZPOSX, D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
000017CC  3439 000018F0           1225              MOVE.W  CBZPOSY, D2
000017D2  4EB8 165C               1226              JSR     CINDMTRZ
000017D6  4EB8 1696               1227              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
000017DA                          1228              
000017DA  3239 000018FA           1229              MOVE.W  SGMPOSX, D1
000017E0  3439 000018FC           1230              MOVE.W  SGMPOSY, D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
000017E6  4EB8 165C               1231              JSR     CINDMTRZ
000017EA  4EB8 16D8               1232              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
000017EE                          1233              
000017EE  3239 000018F6           1234              MOVE.W  COLPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA COLA
000017F4  3439 000018F8           1235              MOVE.W  COLPOSY, D2
000017FA  4EB8 165C               1236              JSR     CINDMTRZ
000017FE  4EB8 16EE               1237              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
00001802                          1238              
00001802  3239 000018EA           1239              MOVE.W  MNZPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
00001808  3439 000018EC           1240              MOVE.W  MNZPOSY, D2
0000180E  4EB8 165C               1241              JSR     CINDMTRZ
00001812  4EB8 1704               1242              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
00001816                          1243              
00001816                          1244              
00001816  4C9F 0107               1245              MOVEM.W (A7)+,D0-D2/A0
0000181A                          1246  
0000181A  4E75                    1247              RTS
0000181C                          1248  
0000181C                          1249  
0000181C                          1250  
0000181C                          1251  ;-----------------------------------------------------------------------------
0000181C                          1252  MTZPLOT
0000181C                          1253  ; DIBUJA LA MATRIZ CASILLA A CASILLA
0000181C                          1254  ; INPUT    : NONE
0000181C                          1255  ; OUTPUT   : NONE
0000181C                          1256  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
0000181C                          1257  ; ----------------------------------------------------------------------------
0000181C  48E7 F080               1258              MOVEM.L D0-D3/A0,-(A7)
00001820                          1259  
00001820  4240                    1260              CLR.W   D0
00001822  4243                    1261              CLR.W   D3
00001824  41F9 00001904           1262              LEA     ESTDCLDS, A0            ; Apunta al inicio de ESTDCLDS
0000182A  303C 0300               1263              MOVE.W  #TCELDAS, D0            ; Número total de celdas
0000182E  363C 0000               1264              MOVE.W  #0,D3                   ; LO UTILIZAMOS PARA SABER EL INDICE EN EL QUE NOS ENCONTRAMOS
00001832  4241                    1265              CLR.W   D1
00001834  4242                    1266              CLR.W   D2
00001836                          1267              
00001836                          1268  
00001836                          1269  PLOTCLDS:
00001836  1218                    1270              MOVE.B  (A0)+,D1                ; MOVEMOS EL VALOR DE LA CELDA A D1
00001838  B23C 0000               1271              CMP.B   #0,D1
0000183C  6700 0036               1272              BEQ     PLOTVAC                 ; SALTA A DIBUJAR POSICIÓN VACÍA
00001840  B23C 0001               1273              CMP.B   #1,D1 
00001844  6700 0034               1274              BEQ     PLOTCOL                 ; SALTA A DIBUJAR COLA
00001848  B23C 0002               1275              CMP.B   #2,D1
0000184C  6700 0032               1276              BEQ     PLOTSEG                 ; SALTA A DIBUJAR SEGMENTO
00001850  B239 000018FE           1277              CMP.B   TRZPLOT,D1
00001856  6700 0016               1278              BEQ     PLOTCBZ                 ; SALTA A DIBUJAR CABEZA
0000185A  B23C 0004               1279              CMP.B   #4,D1                 
0000185E  6700 0026               1280              BEQ     PLOTAPPLE               ; SALTA A DIBUJAR MANZANA
00001862                          1281    
00001862                          1282  DONEPLOT            
00001862  5243                    1283              ADDQ    #1,D3                   ; AUMENTAMOS EL INDICE DE CELDA PARA LA SIGUIENTE
00001864  5340                    1284              SUBI.W  #1, D0                  ; Decrementa el contador de celdas
00001866  66CE                    1285              BNE     PLOTCLDS                ; Repite hasta que esten vacías
00001868  4CDF 010F               1286              MOVEM.L (A7)+,D0-D3/A0
0000186C  4E75                    1287              RTS
0000186E                          1288  PLOTCBZ:
0000186E  4EB8 130C               1289              JSR     HEADPLOT
00001872  60EE                    1290              BRA     DONEPLOT
00001874                          1291  
00001874                          1292  PLOTVAC:    
00001874  4EB8 1774               1293              JSR     FONPLOT
00001878  60E8                    1294              BRA     DONEPLOT                ; DIBUJADO HECHO 
0000187A                          1295  
0000187A                          1296  PLOTCOL:   
0000187A  4EB8 1444               1297              JSR     TAILPLOT 
0000187E  60E2                    1298              BRA     DONEPLOT                ; DIBUJADO HECHO 
00001880                          1299              
00001880                          1300  PLOTSEG:    
00001880  4EB8 13D0               1301              JSR     SEGPLOT
00001884  60DC                    1302              BRA     DONEPLOT                ; DIBUJADO HECHO    
00001886                          1303  
00001886                          1304  PLOTAPPLE:
00001886  4EB8 14F4               1305              JSR     APPLEPLOT
0000188A  60D6                    1306              BRA     DONEPLOT            
0000188C                          1307  
0000188C                          1308  
0000188C                          1309  
0000188C                          1310  
0000188C                          1311  
0000188C                          1312  
0000188C                          1313  
0000188C                          1314  
0000188C                          1315  
0000188C                          1316  
0000188C                          1317  
0000188C                          1318  
0000188C                          1319  
0000188C                          1320  
0000188C                          1321  -------------------- end include --------------------
0000188C                          1322  START:
0000188C                          1323                  
0000188C                          1324  ; --- INIZIALIZACIÓN ---------------------------------------------------------
0000188C                          1325  
0000188C  4EB8 1000               1326              JSR     SYSINIT
00001890  4EB8 1100               1327              JSR     UTLINIT
00001894  4EB8 1066               1328              JSR     KBDINIT
00001898  4EB8 15E2               1329              JSR     MTZINIT
0000189C  4EB8 1234               1330              JSR     HEADINIT                
000018A0  4EB8 1390               1331              JSR     SEGINIT
000018A4  4EB8 1410               1332              JSR     TAILINIT
000018A8  4EB8 15A4               1333              JSR     SCOINIT
000018AC  4EB8 1484               1334              JSR     APPLEINIT
000018B0                          1335              
000018B0                          1336  
000018B0                          1337  .LOOP
000018B0                          1338  
000018B0                          1339  ; --- ACTUALIZAR -------------------------------------------------------------
000018B0                          1340  
000018B0                          1341  ; LEER DISPOSITIVOS DE ENTRADA
000018B0                          1342  
000018B0  4E41                    1343              TRAP    #1
000018B2                          1344  
000018B2                          1345  ; ACTUALIZAR LÓGICA DEL JUEGO
000018B2                          1346              
000018B2  4EB8 1422               1347              JSR     TAILUPD
000018B6  4EB8 13A2               1348              JSR     SEGUPD
000018BA  4EB8 1262               1349              JSR     HEADUPD
000018BE                          1350              ;JSR     APPLEUPD  
000018BE  4EB8 17B2               1351              JSR     MTZUPD
000018C2                          1352              
000018C2                          1353  ; --- SINCRONIZACIÓN ---------------------------------------------------------
000018C2                          1354              ; THE FOLLOWING SYNC STRATEGY IS ****WRONG****
000018C2  103C 0017               1355              MOVE.B  #23,D0
000018C6  7201                    1356              MOVE.L  #1,D1
000018C8  4E4F                    1357              TRAP    #15
000018CA                          1358  
000018CA                          1359  
000018CA                          1360  ;---DIBUJAR-------------------------------------------------------------------
000018CA  4EB8 130C               1361               JSR    HEADPLOT
000018CE  4EB8 13D0               1362               JSR    SEGPLOT
000018D2  4EB8 1444               1363               JSR    TAILPLOT
000018D6  4EB8 14F4               1364               JSR    APPLEPLOT
000018DA  4EB8 181C               1365               JSR    MTZPLOT
000018DE  4EB8 15AE               1366               JSR    SCOPLOT
000018E2                          1367              
000018E2  4E40                    1368              TRAP    #0                      ; ACTUALIZA DOBLE BUFFER
000018E4                          1369  
000018E4                          1370  
000018E4  60CA                    1371              BRA     .LOOP
000018E6                          1372  
000018E6  FFFF FFFF               1373              SIMHALT
000018EA                          1374              
000018EA                          1375              INCLUDE 'VARS.X68'
000018EA                          1376  ; ----------------------------------------------------------------------------
000018EA                          1377  ; VARIABLES DEL JUEGO
000018EA                          1378  ; ----------------------------------------------------------------------------
000018EA                          1379  
000018EA                          1380  ; --- VARIABLES DE LA MANZANA ------------------------------------------------
000018EA                          1381  
000018EA                          1382  MNZPOSX     DS.W    1                       ; COORDENADA X DE LA MANZANA
000018EC                          1383  MNZPOSY     DS.W    1                       ; COORDENADA Y DE LA MANZANA
000018EE                          1384  
000018EE                          1385  ; --- VARIABLES DE LA SERPIENTE ----------------------------------------------
000018EE                          1386  
000018EE                          1387  CBZPOSX     DS.W    1                       ; COORDENADA X CABEZA
000018F0                          1388  CBZPOSY     DS.W    1                       ; COORDENADA Y CABEZA
000018F2                          1389  CBZVELX     DS.W    1                       ; VELOCIDAD X CABEZA
000018F4                          1390  CBZVELY     DS.W    1                       ; VELOCIDAD Y CABEZA
000018F6                          1391  COLPOSX     DS.W    1                       ; COORDENADA X COLA
000018F8                          1392  COLPOSY     DS.W    1                       ; COORDENADA Y COLA
000018FA                          1393  SGMPOSX     DS.W    1                       ; COORDENADA X SEGMENTO
000018FC                          1394  SGMPOSY     DS.W    1                       ; COORDENADA Y SEGMENTO
000018FE                          1395  TRZPLOT     DS.B    1                       ; NÚMERO DE TROZOS A DIBUJAR
000018FF                          1396  
000018FF                          1397  ; --- VARIABLES DEL MARCADOR -------------------------------------------------
000018FF                          1398  
00001900                          1399  JGOPNTS     DS.W    1                       ; PUNTUACIÓN DEL JUEGO
00001902                          1400  
00001902                          1401  
00001902                          1402  
00001902                          1403  
00001902                          1404  -------------------- end include --------------------
00001902                          1405              INCLUDE 'LIB/UTLVARS.X68'
00001902                          1406  ; =============================================================================
00001902                          1407  ; UTILITY VARIABLES
00001902                          1408  ; =============================================================================
00001902                          1409  
00001902                          1410  UTLRNDIX    DS.B    1                       ; NEXT INDEX TO RANDOM NUMBER
00001904                          1411              DS.W    0
00001904                          1412  -------------------- end include --------------------
00001904                          1413              INCLUDE 'SYSVARS.X68'
00001904                          1414  ; ----------------------------------------------------------------------------
00001904                          1415  ; VARIABLES DEL SISTEMA
00001904                          1416  ; ----------------------------------------------------------------------------
00001904                          1417  
00001904                          1418  ; --- VARIABLES DE LA MATRIZ -------------------------------------------------
00001904                          1419  
00001904                          1420  ESTDCLDS    DS.B    TCELDAS                 ; ESTADO DE LAS CELDAS 0=VACÍO  1=COLA   2=SEGMENTO  TRZPLOT=CABEZA  4?=MANZANA    
00001C04                          1421  ESTDCBZ     DS.B    1                       ; 0= DERECHA, 1=ARRIBA, 2=IZQUIERDA, 3=ABAJO
00001C05                          1422  
00001C05                          1423  ; --- VARIABLES DE TECLADO ---------------------------------------------------
00001C05                          1424  
00001C05                          1425  KBDVAL      DS.B    1
00001C06                          1426  KBDEDGE     DS.B    1                       ; KEY EDGE
00001C08                          1427  LASTKEY     DS.L    1                       
00001C0C                          1428  
00001C0C                          1429  
00001C0C                          1430  
00001C0C                          1431  
00001C0C                          1432  
00001C0C                          1433  
00001C0C                          1434  
00001C0C                          1435  
00001C0C                          1436  
00001C0C                          1437  
00001C0C                          1438  
00001C0C                          1439  
00001C0C                          1440  
00001C0C                          1441  
00001C0C                          1442  
00001C0C                          1443  
00001C0C                          1444  -------------------- end include --------------------
00001C0C                          1445      
00001C0C                          1446      
00001C0C                          1447              END    START        

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
APPLEINIT           1484
APPLEPLOT           14F4
APPLEUPD            14B6
CBZFCOL             AA00
CBZHEIGH            14
CBZOCPD             1696
CBZPCOL             FF00
CBZPOSX             18EE
CBZPOSY             18F0
CBZVEL              14
CBZVELX             18F2
CBZVELY             18F4
CBZWIDTH            14
CHCKUPDT            14CE
CHECK               1490
CHECKCLD            1756
CHKARR              10BC
CHKDER              10D0
CHKDWN              10E4
CINDMTRZ            165C
CLDFREE             176E
CLNCLDS             15F0
CNVICOOR            171A
COLFCOL             AA00
COLFND              90EE90
COLHEIGH            A
COLOCPD             16EE
COLPCOL             FF00
COLPOSX             18F6
COLPOSY             18F8
COLWIDTH            A
CONTINU             10F4
DIVX                1664
DIVY                1678
DONEPLOT            1862
ENDDIVX             1674
ENDDIVY             1688
ENDMULTX            173E
ENDMULTY            1750
ESTDCBZ             1C04
ESTDCLDS            1904
FIN                 1306
FONPLOT             1774
GAMEOVER            1302
GENPOSMNZ           1572
HEADINIT            1234
HEADPLOT            130C
HEADUPD             1262
JGOPNTS             1900
KBDDOWN             28
KBDEDGE             1C06
KBDINIT             1066
KBDLEFT             25
KBDRIGHT            27
KBDUP               26
KBDUPD              1074
KBDUPD:LOOP         108A
KBDVAL              1C05
LASTKEY             1C08
LNGINI              1
MARKCLD             12F8
MARKMNZ             14A8
MAXSGM              1
MCLDVCIA            16C2
MNZFCOL             FF
MNZHEIGH            14
MNZOCPD             1704
MNZPCOL             AAFF
MNZPOSX             18EA
MNZPOSY             18EC
MNZWIDTH            14
MTZINIT             15E2
MTZPLOT             181C
MTZUPD              17B2
MTZUPD:CLNCLDS      17C0
MULTLOOPX           1730
MULTLOOPY           1742
NEWMNZ              14E6
NUMCLMNS            20
NUMFILAS            18
OJOFCOL             FFFFFF
OJOHEIGH            A
OJOPCOL             0
OJOWIDTH            A
PANHEIGH            1E0
PANWIDTH            280
PLOTAPPLE           1886
PLOTCBZ             186E
PLOTCLDS            1836
PLOTCOL             187A
PLOTSEG             1880
PLOTVAC             1874
PNTSFCOL            0
PNTSTEXT            65
RSTCLD              16AE
SCOINIT             15A4
SCOPLOT             15AE
SCOPLOT:TXT1        15D8
SCOUPD              15AC
SCRINIT             101E
SCRPLOT             104C
SEGINIT             1390
SEGPLOT             13D0
SEGUPD              13A2
SGMFCOL             AA00
SGMHEIGH            14
SGMOCPD             16D8
SGMPCOL             FF00
SGMPOSX             18FA
SGMPOSY             18FC
SGMWIDTH            14
SIGABA              12CC
SIGARR              12B4
SIGDER              12A8
SIGIZQ              12C0
SIZECLDA            14
START               188C
START:LOOP          18B0
SYSINIT             1000
TAILINIT            1410
TAILPLOT            1444
TAILUPD             1422
TCELDAS             300
TRZPLOT             18FE
UPDMTRZ             12D4
UTLINIT             1100
UTLRAND             1116
UTLRAND:RANDVEC     1134
UTLRNDIX            1902
