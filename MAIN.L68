000018E4 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 26/12/2024 16:28:19

00000000                             1  *-----------------------------------------------------------------------------
00000000                             2  * Title      : MAIN
00000000                             3  * Written by :
00000000                             4  * Date       :
00000000                             5  * Description:
00000000                             6  *-----------------------------------------------------------------------------
00000000                             7  
00001000                             8              ORG    $1000
00001000                             9              
00001000                            10              INCLUDE 'CONST.X68'
00001000                            11  ; ----------------------------------------------------------------------------
00001000                            12  ; CONSTANTES DEL JUEGO
00001000                            13  ; ----------------------------------------------------------------------------
00001000                            14     
00001000                            15  ; --- CONSTANTES DE LA MANZANA -----------------------------------------------
00001000                            16  
00001000  =00000014                 17  MNZWIDTH    EQU     20                      ; ANCHURA DE LA MANZANA (a determinar)
00001000  =00000014                 18  MNZHEIGH    EQU     20                      ; ALTURA DE LA MANZANA (a determinar)
00001000  =0000AAFF                 19  MNZPCOL     EQU     $0000AAFF               ; COLOR CONTORNO MANZANA (a determinar)
00001000  =000000FF                 20  MNZFCOL     EQU     $000000FF               ; COLOR RELLENO MANZANA (a determinar)
00001000                            21  
00001000                            22  ; --- CONSTANTES DE LA SERPIENTE ---------------------------------------------
00001000                            23  
00001000  =00000001                 24  MAXSGM      EQU     1                       ; TAMAÑO MÁXIMO DE SEGMENTOS (a determinar)
00001000  =00000001                 25  LNGINI      EQU     1                       ; LONGITUD INICIAL SERPIENTE (a determinar)
00001000  =00000014                 26  SGMWIDTH    EQU     20                      ; ANCHURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 27  SGMHEIGH    EQU     20                      ; ALTURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 28  CBZVEL      EQU     20                      ; VELOCIDAD DE LA CABEZA (a determinar)
00001000  =0000FF00                 29  SGMPCOL     EQU     $0000FF00               ; COLOR CONTORNO SEGMENTO (PROVISIONAL)
00001000  =0000AA00                 30  SGMFCOL     EQU     $0000AA00               ; COLOR RELLENO SEGMENTO (PROVISIONAL)
00001000  =0000000A                 31  COLWIDTH    EQU     10                      ; ANCHURA DE LA COLA (PROVISIONAL)
00001000  =0000000A                 32  COLHEIGH    EQU     10                      ; ALTURA DE LA COLA (PROVISIONAL)
00001000  =0000FF00                 33  COLPCOL     EQU     $0000FF00               ; COLOR CONTORNO COLA (PROVISIONAL)
00001000  =0000AA00                 34  COLFCOL     EQU     $0000AA00               ; COLOR RELLENO COLA (PROVISIONAL)
00001000  =00000014                 35  CBZWIDTH    EQU     20                      ; ANCHURA DE LA CABEZA (PROVISIONAL)
00001000  =00000014                 36  CBZHEIGH    EQU     20                      ; ALTURA DE LA CABEZA (PROVISIONAL)
00001000  =0000FF00                 37  CBZPCOL     EQU     $0000FF00               ; COLOR CONTORNO CABEZA (PROVISIONAL)
00001000  =0000AA00                 38  CBZFCOL     EQU     $0000AA00               ; COLOR RELLENO CABEZA (PROVISIONAL)
00001000  =0000000A                 39  OJOWIDTH    EQU     10                      ; ANCHURA DE OJO DE SERPIENTE
00001000  =0000000A                 40  OJOHEIGH    EQU     10                      ; ALTURA DE OJO DE SERPIENTE
00001000  =00000000                 41  OJOPCOL     EQU     $00000000               ; COLOR CONTORNO OJO
00001000  =00FFFFFF                 42  OJOFCOL     EQU     $00FFFFFF               ; COLOR RELLENO OJO
00001000                            43  
00001000                            44  
00001000                            45  
00001000                            46  ; --- CONSTANTES MARCADOR ----------------------------------------------------
00001000                            47  
00001000  =00000000                 48  PNTSFCOL    EQU     $00000000               ; COLOR FONDO MARCADOR (a determinar)
00001000  =00000065                 49  PNTSTEXT    EQU     0101                    ; COORDENADAS DEL MARCADOR (a determinar)
00001000                            50  
00001000                            51  
00001000                            52  
00001000                            53  
00001000                            54  
00001000                            55  
00001000                            56  
00001000                            57  -------------------- end include --------------------
00001000                            58              INCLUDE 'SYSCONST.X68'
00001000                            59  ; ----------------------------------------------------------------------------
00001000                            60  ; CONSTANTES DEL SISTEMA
00001000                            61  ; ----------------------------------------------------------------------------
00001000                            62  
00001000                            63  ; ---CONSTANTES DE LA PANTALLA------------------------------------------------
00001000                            64  
00001000  =00000280                 65  PANWIDTH    EQU     640                     ; ANCHO DE LA PANTALLA
00001000  =000001E0                 66  PANHEIGH    EQU     480                     ; ALTURA DE LA PANTALLA
00001000  =0090EE90                 67  COLFND      EQU     $90EE90                 ; COLOR DEL FONDO DE LA PANTALLA
00001000                            68  
00001000                            69  ; ---CONSTANTES DE LA MATRIZ--------------------------------------------------
00001000                            70  
00001000  =00000014                 71  SIZECLDA    EQU     20                      ; TAMAÑO DE CADA CELDA EN PIXELES
00001000  =00000020                 72  NUMCLMNS    EQU     32                      ; COLUMNAS DE CELDAS (640/10)
00001000  =00000018                 73  NUMFILAS    EQU     24                      ; FILAS DE CELDAS (480/10)
00001000  =00000300                 74  TCELDAS     EQU     768                     ; TOTAL DE CELDAS (64 * 48)
00001000                            75  
00001000                            76  ; ---CÓDIGOS DE TECLADO-------------------------------------------------------
00001000                            77  
00001000  =00000025                 78  KBDLEFT     EQU     $25
00001000  =00000026                 79  KBDUP       EQU     $26
00001000  =00000027                 80  KBDRIGHT    EQU     $27
00001000  =00000028                 81  KBDDOWN     EQU     $28
00001000                            82  
00001000                            83  
00001000                            84  -------------------- end include --------------------
00001000                            85              INCLUDE 'SYSTEM.X68'
00001000                            86   
00001000                            87   
00001000                            88  SYSINIT
00001000                            89  ; INICIA EL  SISTEMA
00001000                            90  ; INPUT    : NONE
00001000                            91  ; OUTPUT   : NONE
00001000                            92  ; MODIFIES : NONE
00001000                            93  ; ----------------------------------------------------------------------------
00001000  4EB9 0000101E             94              JSR     SCRINIT
00001006                            95              
00001006  21FC 0000104C 0080        96              MOVE.L  #SCRPLOT,($80)
0000100E  21FC 00001074 0084        97              MOVE.L  #KBDUPD,($84)
00001016                            98              
00001016  40E7                      99              MOVE.W  SR,-(A7)
00001018  0257 DFFF                100              ANDI.W  #$DFFF,(A7)
0000101C                           101              
0000101C  4E73                     102              RTE
0000101E                           103              
0000101E                           104  ; ------------------------------------------------------------------------------
0000101E                           105  SCRINIT
0000101E                           106  ; INIT SCREEN. SET SCREEN RESOLUTION, SET WINDOWED MODE, CLEAR SCREEN,
0000101E                           107  ; ENABLE DOUBLE BUFFER.
0000101E                           108  ; INPUT    : NONE
0000101E                           109  ; OUTPUT   : NONE
0000101E                           110  ; MODIFIES : NONE
0000101E                           111  ; ------------------------------------------------------------------------------
0000101E                           112  
0000101E  48E7 C000                113              MOVEM.L D0-D1,-(A7)
00001022                           114  
00001022                           115              ; SET SCREEN RESOLUTION
00001022  103C 0021                116              MOVE.B  #33,D0
00001026  223C 028001E0            117              MOVE.L  #PANWIDTH<<16|PANHEIGH,D1
0000102C  4E4F                     118              TRAP    #15
0000102E                           119              
0000102E                           120              ; SET WINDOWED MODE
0000102E  7201                     121              MOVE.L  #1,D1
00001030  4E4F                     122              TRAP    #15
00001032                           123              
00001032                           124              ; CLEAR SCREEN
00001032  103C 000B                125              MOVE.B  #11,D0
00001036  323C FF00                126              MOVE.W  #$FF00,D1
0000103A  4E4F                     127              TRAP    #15
0000103C                           128              
0000103C                           129              ; ENABLE DOUBLE BUFFER
0000103C  103C 005C                130              MOVE.B  #92,D0
00001040  123C 0011                131              MOVE.B  #17,D1
00001044  4E4F                     132              TRAP    #15
00001046                           133              
00001046  4CDF 0003                134              MOVEM.L (A7)+,D0-D1
0000104A                           135              
0000104A  4E75                     136              RTS    
0000104C                           137  
0000104C                           138  ; ------------------------------------------------------------------------------
0000104C                           139  SCRPLOT
0000104C                           140  ; UPDATES DOUBLE BUFFER
0000104C                           141  ; INPUT    : NONE
0000104C                           142  ; OUTPUT   : NONE
0000104C                           143  ; MODIFIES : NONE
0000104C                           144  ; ------------------------------------------------------------------------------
0000104C                           145  
0000104C  48A7 C000                146              MOVEM.W D0-D1,-(A7)
00001050                           147              
00001050                           148              ; SWITCH BUFFERS
00001050  103C 005E                149              MOVE.B  #94,D0
00001054  4E4F                     150              TRAP    #15
00001056                           151              
00001056                           152              ; CLEAR HIDDEN BUFFER
00001056  103C 000B                153              MOVE.B  #11,D0
0000105A  323C FF00                154              MOVE.W  #$FF00,D1
0000105E  4E4F                     155              TRAP    #15
00001060                           156              
00001060  4C9F 0003                157              MOVEM.W (A7)+,D0-D1
00001064                           158              
00001064  4E73                     159              RTE
00001066                           160          
00001066                           161  ; ------------------------------------------------------------------------------
00001066                           162  KBDINIT
00001066                           163  ; INIT KEYBOARD
00001066                           164  ; INPUT    : NONE
00001066                           165  ; OUTPUT   : NONE
00001066                           166  ; MODIFIES : NONE
00001066                           167  ; ------------------------------------------------------------------------------
00001066                           168  
00001066  4239 00001C5D            169              CLR.B   (KBDVAL)
0000106C  4239 00001C5E            170              CLR.B   (KBDEDGE)
00001072  4E75                     171              RTS
00001074                           172  
00001074                           173  ; ------------------------------------------------------------------------------
00001074                           174  KBDUPD
00001074                           175  ; UPDATE KEYBOARD INFO.  
00001074                           176  ; 7 -> PAUSE
00001074                           177  ; 6 -> FIRE 3
00001074                           178  ; 5 -> FIRE 2
00001074                           179  ; 4 -> FIRE 1
00001074                           180  ; 3 -> DOWN
00001074                           181  ; 2 -> RIGHT
00001074                           182  ; 1 -> UP
00001074                           183  ; 0 -> LEFT
00001074                           184  ; INPUT    : NONE
00001074                           185  ; OUTPUT   : NONE
00001074                           186  ; MODIFIES : NONE
00001074                           187  ; ------------------------------------------------------------------------------
00001074                           188  
00001074  48E7 C000                189              MOVEM.L D0-D1,-(A7)
00001078                           190  
00001078                           191              ; LEE ESTADO DEL TECLADO
00001078  103C 0013                192              MOVE.B  #19,D0
0000107C  223C 25262728            193              MOVE.L  #KBDLEFT<<24|KBDUP<<16|KBDRIGHT<<8|KBDDOWN,D1
00001082  4E4F                     194              TRAP    #15                  ; Lee las teclas y guarda en D1
00001084                           195  
00001084  B2BC 000000FF            196              CMP.L   #$000000FF,D1
0000108A  6700 0048                197              BEQ     DWN
0000108E  B2BC 0000FF00            198              CMP.L   #$0000FF00,D1
00001094  6700 001A                199              BEQ     DER
00001098  B2BC 00FF0000            200              CMP.L   #$00FF0000,D1
0000109E  6700 001C                201              BEQ     ARR
000010A2  B2BC FF000000            202              CMP.L   #$FF000000,D1
000010A8  6700 001E                203              BEQ     IZQ
000010AC                           204  
000010AC                           205              ; Si no hay pulsaciones, mantener estado
000010AC  6000 002E                206              BRA     CONTINU
000010B0                           207  
000010B0  33FC 0000 00001C5C       208  DER:        MOVE.W  #0,(ESTDCBZ)           ; Actualiza estado a DERECHA
000010B8  6000 0022                209              BRA     CONTINU
000010BC                           210              
000010BC  33FC 0001 00001C5C       211  ARR:        MOVE.W  #1,(ESTDCBZ)           ; Actualiza estado a ARRIBA
000010C4  6000 0016                212              BRA     CONTINU
000010C8                           213  
000010C8  33FC 0002 00001C5C       214  IZQ:        MOVE.W  #2,(ESTDCBZ)           ; Actualiza estado a IZQUIERDA
000010D0  6000 000A                215              BRA     CONTINU                    
000010D4                           216  
000010D4  33FC 0003 00001C5C       217  DWN:        MOVE.W  #3,(ESTDCBZ)           ; Actualiza estado a ABAJO
000010DC                           218  
000010DC                           219  CONTINU:
000010DC  4CDF 0003                220              MOVEM.L (A7)+,D0-D1
000010E0  4E73                     221              RTE
000010E2                           222              
000010E2                           223  ; RESIDUOS CODIGO ANTERIOR 
000010E2                           224  
000010E2                           225              ;MOVE.B  D2,(KBDVAL)
000010E2                           226              
000010E2                           227  
000010E2                           228  
000010E2                           229  
000010E2                           230  
000010E2                           231  ; CODIGO ANTERIOR ANTERIOR
000010E2                           232  
000010E2                           233  
000010E2                           234  
000010E2                           235  
000010E2                           236  
000010E2                           237  
000010E2                           238  
000010E2                           239  
000010E2                           240  
000010E2                           241  
000010E2                           242  
000010E2                           243  
000010E2                           244  
000010E2                           245  
000010E2                           246  
000010E2                           247  
000010E2                           248  
000010E2                           249  
000010E2                           250  
000010E2                           251  
000010E2                           252  
000010E2                           253  
000010E2                           254  
000010E2                           255  
000010E2                           256  
000010E2                           257  
000010E2                           258  
000010E2                           259  
000010E2                           260  
000010E2                           261  
000010E2                           262  
000010E2                           263  
000010E2                           264  
000010E2                           265  
000010E2                           266  
000010E2                           267  
000010E2                           268  
000010E2                           269  
000010E2                           270  -------------------- end include --------------------
000010E2                           271              INCLUDE 'LIB/UTLCODE.X68'
000010E2                           272  ; =============================================================================
000010E2                           273  ; UTILITY CODE
000010E2                           274  ; =============================================================================
000010E2                           275  
000010E2                           276  ; -----------------------------------------------------------------------------
000010E2                           277  UTLINIT
000010E2                           278  ; INITIALIZES UTILITY CODE
000010E2                           279  ; INPUT    - NONE
000010E2                           280  ; OUTPUT   - NONE
000010E2                           281  ; MODIFIES - NONE
000010E2                           282  ; -----------------------------------------------------------------------------
000010E2  48E7 C000                283              MOVEM.L D0-D1,-(A7)
000010E6  103C 0008                284              MOVE.B  #8,D0
000010EA  4E4F                     285              TRAP    #15
000010EC  13C1 0000195A            286              MOVE.B  D1,(UTLRNDIX)
000010F2  4CDF 0003                287              MOVEM.L (A7)+,D0-D1
000010F6  4E75                     288              RTS
000010F8                           289  
000010F8                           290  ; -----------------------------------------------------------------------------
000010F8                           291  UTLRAND
000010F8                           292  ; PROVIDES A PSEUDO-RANDOM BYTE
000010F8                           293  ; INPUT    - NONE
000010F8                           294  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
000010F8                           295  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000010F8                           296  ; -----------------------------------------------------------------------------
000010F8  2F08                     297              MOVE.L  A0,-(A7)
000010FA  41F9 00001116            298              LEA     .RANDVEC,A0
00001100  4280                     299              CLR.L   D0
00001102  1039 0000195A            300              MOVE.B  (UTLRNDIX),D0
00001108  1030 0800                301              MOVE.B  (A0,D0.L),D0
0000110C  5239 0000195A            302              ADDQ.B  #1,(UTLRNDIX)
00001112  205F                     303              MOVE.L  (A7)+,A0
00001114  4E75                     304              RTS
00001116                           305  
00001116                           306  
00001116= A2 EE 9A 0C F5 24 ...    307  .RANDVEC    DC.B    162, 238, 154, 12 , 245, 36 , 32 , 103
0000111E= 2A A3 51 26 E0 AC ...    308              DC.B    42 , 163, 81 , 38 , 224, 172, 19 , 69
00001126= 75 51 CA FD 33 EB ...    309              DC.B    117, 81 , 202, 253, 51 , 235, 108, 154
0000112E= 60 CC E7 B8 9A EB ...    310              DC.B    96 , 204, 231, 184, 154, 235, 34 , 203
00001136= 1D 76 B5 95 B0 89 ...    311              DC.B    29 , 118, 181, 149, 176, 137, 62 , 108
0000113E= 39 15 48 C9 6E CA ...    312              DC.B    57 , 21 , 72 , 201, 110, 202, 159, 41
00001146= 43 E7 E2 7C 37 25 ...    313              DC.B    67 , 231, 226, 124, 55 , 37 , 84 , 62
0000114E= E9 94 CE E9 E4 52 ...    314              DC.B    233, 148, 206, 233, 228, 82 , 243, 78
00001156= 37 6D 9A 84 A2 28 ...    315              DC.B    55 , 109, 154, 132, 162, 40 , 30 , 39
0000115E= 19 E2 C6 77 80 D4 ...    316              DC.B    25 , 226, 198, 119, 128, 212, 232, 225
00001166= 0A 5A 32 67 33 C2 ...    317              DC.B    10 , 90 , 50 , 103, 51 , 194, 222, 40
0000116E= 59 80 DC 0E 57 FC ...    318              DC.B    89 , 128, 220, 14 , 87 , 252, 243, 252
00001176= 8A AB BC F7 07 4D ...    319              DC.B    138, 171, 188, 247, 7  , 77 , 29 , 234
0000117E= EF D5 77 6E 1E BB ...    320              DC.B    239, 213, 119, 110, 30 , 187, 131, 23
00001186= D6 E0 2A 8F BD 28 ...    321              DC.B    214, 224, 42 , 143, 189, 40 , 212, 130
0000118E= 13 4F 66 EC 0A 64 ...    322              DC.B    19 , 79 , 102, 236, 10 , 100, 122, 188
00001196= 56 52 9A 16 9B 90 ...    323              DC.B    86 , 82 , 154, 22 , 155, 144, 7  , 199
0000119E= 06 8A A4 F7 01 DA ...    324              DC.B    6  , 138, 164, 247, 1  , 218, 166, 82
000011A6= F2 E7 77 28 B1 76 ...    325              DC.B    242, 231, 119, 40 , 177, 118, 220, 102
000011AE= A4 42 E3 81 B1 67 ...    326              DC.B    164, 66 , 227, 129, 177, 103, 165, 108
000011B6= BF CE FA 16 BF 38 ...    327              DC.B    191, 206, 250, 22 , 191, 56 , 30 , 161
000011BE= D1 8B 50 0C 5F 49 ...    328              DC.B    209, 139, 80 , 12 , 95 , 73 , 168, 56
000011C6= DE 4C 14 A2 40 DC ...    329              DC.B    222, 76 , 20 , 162, 64 , 220, 93 , 12
000011CE= B6 9B 0A 38 5D AB ...    330              DC.B    182, 155, 10 , 56 , 93 , 171, 89 , 6
000011D6= E2 1B DD 75 15 82 ...    331              DC.B    226, 27 , 221, 117, 21 , 130, 101, 18
000011DE= 8A 26 51 30 9F 47 ...    332              DC.B    138, 38 , 81 , 48 , 159, 71 , 57 , 21
000011E6= 1E 8A BB 71 C6 6E ...    333              DC.B    30 , 138, 187, 113, 198, 110, 185, 152
000011EE= 9F 47 E5 34 94 27 ...    334              DC.B    159, 71 , 229, 52 , 148, 39 , 77 , 6
000011F6= 7D 06 D6 BA 30 0F ...    335              DC.B    125, 6  , 214, 186, 48 , 15 , 212, 22
000011FE= EC 7F 7E 03 CF 2D ...    336              DC.B    236, 127, 126, 3  , 207, 45 , 193, 2
00001206= 94 5B 23 F2 8B CD ...    337              DC.B    148, 91 , 35 , 242, 139, 205, 248, 237
0000120E= 74 33 EC B9 0F D5 ...    338              DC.B    116, 51 , 236, 185, 15 , 213, 221, 6
0000120E= 74 33 EC B9 0F D5 ...    339  -------------------- end include --------------------
00001216                           340              INCLUDE 'HEADSRP.X68'
00001216                           341  
00001216                           342  ; ------------------------------------------------------------------------------
00001216                           343  HEADINIT
00001216                           344  ; INICIALIZAR CABEZA.
00001216                           345  ; INPUT    : NONE 
00001216                           346  ; OUTPUT   : NONE
00001216                           347  ; MODIFIES : NONE
00001216                           348  ; ------------------------------------------------------------------------------
00001216  33FC 0140 00001946       349              MOVE.W  #PANWIDTH/2,(CBZPOSX)
0000121E  33FC 00F0 00001948       350              MOVE.W  #PANHEIGH/2,(CBZPOSY)
00001226  4279 00001956            351              CLR     (TRZPLOT)
0000122C  13FC 0003 00001956       352              MOVE.B  #3,(TRZPLOT)
00001234  4279 00001C5C            353              CLR.W   (ESTDCBZ)
0000123A  33FC 0000 00001C5C       354              MOVE.W  #0,(ESTDCBZ)
00001242  4E75                     355              RTS
00001244                           356              
00001244                           357  ; ------------------------------------------------------------------------------
00001244                           358  HEADUPD
00001244                           359  ; ACTUALIZAR CABEZA.
00001244                           360  ; INPUT    : NONE 
00001244                           361  ; OUTPUT   : NONE
00001244                           362  ; MODIFIES : NONE
00001244                           363  ; ------------------------------------------------------------------------------
00001244                           364  
00001244  48A7 E000                365              MOVEM.W D0-D2,-(A7)            ; Guardar registros
00001248                           366  
00001248                           367  
00001248                           368              ; Marcar celda actual como vacía
00001248  3239 00001946            369              MOVE.W  (CBZPOSX),D1
0000124E  3439 00001948            370              MOVE.W  (CBZPOSY),D2
00001254  4EB9 000016B4            371              JSR     CINDMTRZ
0000125A  4EB9 0000171A            372              JSR     MCLDVCIA               ; RESTAMOS 1 A LA CELDA ACTUAL
00001260                           373              
00001260                           374              
00001260                           375              ; Actualiza la posición de la cabeza según ESTDCBZ
00001260                           376              ;CLR.W   D0
00001260  3039 00001C5C            377              MOVE.W  (ESTDCBZ),D0
00001266  B07C 0000                378              CMP.W   #0,D0
0000126A  6700 001E                379              BEQ     SIGDER
0000126E  B07C 0001                380              CMP.W   #1,D0
00001272  6700 0022                381              BEQ     SIGARR
00001276  B07C 0002                382              CMP.W   #2,D0
0000127A  6700 0026                383              BEQ     SIGIZQ
0000127E  B07C 0003                384              CMP.W   #3,D0
00001282  6700 002A                385              BEQ     SIGABA
00001286                           386  
00001286                           387  
00001286                           388  
00001286                           389              ; Si no hay dirección válida, sale
00001286  6000 0072                390              BRA     FIN
0000128A                           391  
0000128A                           392  SIGDER:
0000128A  0679 0014 00001946       393              ADD.W   #CBZVEL,(CBZPOSX)
00001292  6000 0022                394              BRA     CHKCOL
00001296                           395  
00001296                           396  SIGARR:
00001296  0479 0014 00001948       397              SUB.W   #CBZVEL,(CBZPOSY)
0000129E  6000 0016                398              BRA     CHKCOL
000012A2                           399  
000012A2                           400  SIGIZQ:
000012A2  0479 0014 00001946       401              SUB.W   #CBZVEL,(CBZPOSX)
000012AA  6000 000A                402              BRA     CHKCOL
000012AE                           403  
000012AE                           404  SIGABA:
000012AE  0679 0014 00001948       405              ADD.W   #CBZVEL,(CBZPOSY)
000012B6                           406              
000012B6                           407  CHKCOL:
000012B6                           408              ; Verifica la colisión con la manzana
000012B6  3239 00001946            409              MOVE.W  (CBZPOSX),D1
000012BC  3439 00001948            410              MOVE.W  (CBZPOSY),D2
000012C2  B279 00001942            411              CMP.W   (MNZPOSX),D1
000012C8  6600 0018                412              BNE     NOCOL
000012CC  B479 00001944            413              CMP.W   (MNZPOSY),D2
000012D2  6600 000E                414              BNE     NOCOL
000012D6                           415              
000012D6                           416              ; Colisión detectada
000012D6  4EB9 000014F6            417              JSR     APPLEUPD
000012DC  4EB9 000015EC            418              JSR     SCOUPD
000012E2                           419              ;JSR     SEGADD
000012E2                           420              
000012E2                           421  
000012E2                           422  NOCOL:
000012E2                           423              ; Convierte la posición nueva a índice
000012E2  3239 00001946            424              MOVE.W  (CBZPOSX),D1
000012E8  3439 00001948            425              MOVE.W  (CBZPOSY),D2
000012EE  4EB9 000016B4            426              JSR     CINDMTRZ
000012F4  4EB9 000016EE            427              JSR     CBZOCPD                 ; Marca la celda como ocupada
000012FA                           428  
000012FA                           429  
000012FA                           430  FIN:
000012FA  4C9F 0007                431              MOVEM.W (A7)+,D0-D2
000012FE                           432  
000012FE  4E75                     433              RTS
00001300                           434              
00001300                           435  ; ------------------------------------------------------------------------------
00001300                           436  HEADPLOT
00001300                           437  ; DIBUJAR CABEZA.
00001300                           438  ; INPUT    : NONE 
00001300                           439  ; OUTPUT   : NONE
00001300                           440  ; MODIFIES : NONE
00001300                           441  ; ------------------------------------------------------------------------------
00001300                           442                         
00001300  3F00                     443              MOVE.W  D0,-(A7)               ; GUARDAMOS D0
00001302  3003                     444              MOVE.W  D3,D0                  ; PONEMOS EL INDICE DE LA CELDA EN D0 PARA CALCULAR SUS COORDENADAS
00001304  4EB9 00001772            445              JSR     CNVICOOR
0000130A  2F01                     446              MOVE.L  D1,-(A7)
0000130C                           447              
0000130C                           448              ; SET COLOR DEL CONTORNO CABEZA
0000130C  103C 0050                449              MOVE.B  #80,D0
00001310  223C 0000FF00            450              MOVE.L  #CBZPCOL,D1
00001316  4E4F                     451              TRAP    #15
00001318                           452              
00001318                           453              ; SET COLOR DEL RELLENO CABEZA
00001318  103C 0051                454              MOVE.B  #81,D0
0000131C  223C 0000AA00            455              MOVE.L  #CBZFCOL,D1
00001322  4E4F                     456              TRAP    #15
00001324                           457              
00001324                           458              ; DIBUJAR CABEZA
00001324  103C 0057                459              MOVE.B  #87,D0
00001328  221F                     460              MOVE.L  (A7)+,D1
0000132A  3F03                     461              MOVE.W  D3,-(A7)
0000132C  3601                     462              MOVE.W  D1,D3
0000132E  0643 0014                463              ADD.W   #CBZWIDTH,D3
00001332  3802                     464              MOVE.W  D2,D4
00001334  0644 0014                465              ADD.W   #CBZHEIGH,D4
00001338  4E4F                     466              TRAP    #15
0000133A                           467              
0000133A  2F01                     468              MOVE.L  D1,-(A7)
0000133C                           469              
0000133C                           470              ; SET COLOR DEL CONTORNO OJO
0000133C  103C 0050                471              MOVE.B  #80,D0
00001340  7200                     472              MOVE.L  #OJOPCOL,D1
00001342  4E4F                     473              TRAP    #15
00001344                           474              
00001344                           475              ; SET COLOR DEL RELLENO OJO
00001344  103C 0051                476              MOVE.B  #81,D0
00001348  223C 00FFFFFF            477              MOVE.L  #OJOFCOL,D1
0000134E  4E4F                     478              TRAP    #15
00001350                           479              
00001350                           480              ; DIBUJAR OJO
00001350  103C 0058                481              MOVE.B  #88,D0
00001354  221F                     482              MOVE.L  (A7)+,D1
00001356  2F01                     483              MOVE.L  D1,-(A7)
00001358  2F02                     484              MOVE.L  D2,-(A7)
0000135A  5A41                     485              ADD.W   #OJOWIDTH/2,D1            
0000135C  3601                     486              MOVE.W  D1,D3
0000135E  0643 000A                487              ADD.W   #OJOWIDTH,D3
00001362  5A42                     488              ADD.W   #OJOHEIGH/2,D2
00001364  3802                     489              MOVE.W  D2,D4
00001366  0644 000A                490              ADD.W   #OJOHEIGH,D4
0000136A  4E4F                     491              TRAP    #15                     ; DIBUJAMOS EL PRIMER OJO
0000136C                           492              
0000136C                           493  
0000136C                           494              ; DEFINIR COORDENADAS IRIS
0000136C  241F                     495              MOVE.L  (A7)+,D2
0000136E  221F                     496              MOVE.L  (A7)+,D1
00001370  0641 000A                497              ADD.W   #OJOWIDTH,D1
00001374  0642 000A                498              ADD.W   #OJOHEIGH,D2
00001378  103C 0052                499              MOVE.B  #82,D0
0000137C  4E4F                     500              TRAP    #15                     ; DIBUJAMOS EL PRIMER IRIS
0000137E                           501              
0000137E  361F                     502              MOVE.W  (A7)+,D3
00001380  301F                     503              MOVE.W  (A7)+,D0
00001382                           504  
00001382  4E75                     505              RTS
00001384                           506  
00001384                           507  
00001384                           508  
00001384                           509  
00001384                           510  
00001384                           511  
00001384                           512  
00001384                           513  
00001384                           514  
00001384                           515  
00001384                           516  
00001384                           517  
00001384                           518  
00001384                           519  
00001384                           520  
00001384                           521  
00001384                           522  
00001384                           523  
00001384                           524  
00001384                           525  
00001384                           526  
00001384                           527  
00001384                           528  
00001384                           529  
00001384                           530  
00001384                           531  
00001384                           532  
00001384                           533  
00001384                           534  
00001384                           535  
00001384                           536  
00001384                           537  -------------------- end include --------------------
00001384                           538              INCLUDE 'SEGSRP.X68'
00001384                           539  
00001384                           540  ; ------------------------------------------------------------------------------
00001384                           541  SEGINIT
00001384                           542  ; INICIALIZAR SEGMENTO.
00001384                           543  ; INPUT    : NONE 
00001384                           544  ; OUTPUT   : NONE
00001384                           545  ; MODIFIES : NONE
00001384                           546  ; ------------------------------------------------------------------------------
00001384  33FC 012C 00001952       547              MOVE.W  #(PANWIDTH/2)-CBZWIDTH,(SGMPOSX)
0000138C  33FC 00F0 00001954       548              MOVE.W  #PANHEIGH/2,(SGMPOSY)
00001394  4E75                     549              RTS
00001396                           550              
00001396                           551  ; ------------------------------------------------------------------------------
00001396                           552  SEGUPD
00001396                           553  ; ACTUALIZAR SEGMENTO.
00001396                           554  ; INPUT    : NONE 
00001396                           555  ; OUTPUT   : NONE
00001396                           556  ; MODIFIES : NONE
00001396                           557  ; ------------------------------------------------------------------------------
00001396                           558  
00001396  48A7 6000                559              MOVEM.W D1-D2,-(A7)
0000139A                           560              
0000139A                           561              ; Marcar posición anterior del segmento como vacía
0000139A  3239 00001952            562              MOVE.W  (SGMPOSX),D1             ; Cargar posición X actual del segmento
000013A0  3439 00001954            563              MOVE.W  (SGMPOSY),D2             ; Cargar posición Y actual del segmento
000013A6  4EB9 000016B4            564              JSR     CINDMTRZ                ; Obtener índice de celda en D0
000013AC  4EB9 0000171A            565              JSR     MCLDVCIA                ; Marcar celda como vacía
000013B2                           566              
000013B2                           567              ; Actualizar posición del segmento para seguir a la cabeza
000013B2  33F9 00001946 00001952   568              MOVE.W  (CBZPOSX),(SGMPOSX)        ; Actualizar X del segmento con la X de la cabeza
000013BC  33F9 00001948 00001954   569              MOVE.W  (CBZPOSY),(SGMPOSY)        ; Actualizar Y del segmento con la Y de la cabeza
000013C6                           570  
000013C6                           571              ; Marcar nueva posición del segmento como ocupada
000013C6  3239 00001952            572              MOVE.W  (SGMPOSX),D1             ; Cargar nueva posición X
000013CC  3439 00001954            573              MOVE.W  (SGMPOSY),D2             ; Cargar nueva posición Y
000013D2  4EB9 000016B4            574              JSR     CINDMTRZ                ; Obtener índice de celda en D0
000013D8  4EB9 00001730            575              JSR     SGMOCPD                 ; Marcar celda como ocupada por segmento
000013DE                           576              
000013DE  4C9F 0006                577              MOVEM.W (A7)+,D1-D2            
000013E2  4E75                     578              RTS
000013E4                           579  
000013E4                           580   ;INTENTO DE AUMENTO SERPIENTE
000013E4                           581  
000013E4                           582  
000013E4                           583  ;CODIGO ANTIGUO
000013E4                           584              
000013E4                           585              
000013E4                           586              
000013E4                           587  ; ------------------------------------------------------------------------------
000013E4                           588  SEGPLOT
000013E4                           589  ; DIBUJAR SEGMENTO.
000013E4                           590  ; INPUT    : NONE 
000013E4                           591  ; OUTPUT   : NONE
000013E4                           592  ; MODIFIES : NONE
000013E4                           593  ; ------------------------------------------------------------------------------
000013E4  3F00                     594              MOVE.W  D0,-(A7)
000013E6  3003                     595              MOVE.W  D3,D0
000013E8  4EB9 00001772            596              JSR     CNVICOOR
000013EE  2F01                     597              MOVE.L  D1,-(A7)
000013F0                           598              
000013F0  103C 0050                599              MOVE.B  #80,D0
000013F4  223C 0000FF00            600              MOVE.L  #SGMPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DEL SEGMENTO
000013FA  4E4F                     601              TRAP    #15
000013FC                           602              
000013FC  103C 0051                603              MOVE.B  #81,D0
00001400  223C 0000AA00            604              MOVE.L  #SGMFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DEL SEGMENTO
00001406  4E4F                     605              TRAP    #15
00001408                           606              
00001408  103C 0057                607              MOVE.B  #87,D0
0000140C  221F                     608              MOVE.L  (A7)+,D1
0000140E  3F03                     609              MOVE.W  D3,-(A7)
00001410  3601                     610              MOVE.W  D1,D3
00001412  0643 0014                611              ADD.W   #SIZECLDA,D3
00001416  3802                     612              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
00001418  0644 0014                613              ADD.W   #SIZECLDA,D4
0000141C  4E4F                     614              TRAP    #15                     
0000141E                           615                          
0000141E  361F                     616              MOVE.W  (A7)+,D3  
00001420  301F                     617              MOVE.W  (A7)+,D0
00001422                           618  
00001422  4E75                     619              RTS
00001424                           620              
00001424                           621  
00001424                           622  
00001424                           623  
00001424                           624  
00001424                           625  
00001424                           626  
00001424                           627  
00001424                           628  
00001424                           629  
00001424                           630  
00001424                           631  
00001424                           632  
00001424                           633  -------------------- end include --------------------
00001424                           634              INCLUDE 'TAILSRP.X68'
00001424                           635     
00001424                           636  ; ------------------------------------------------------------------------------
00001424                           637  TAILINIT
00001424                           638  ; INICIALIZAR COLA.
00001424                           639  ; INPUT    : NONE 
00001424                           640  ; OUTPUT   : NONE
00001424                           641  ; MODIFIES : NONE
00001424                           642  ; ------------------------------------------------------------------------------
00001424                           643  
00001424  33FC 011D 0000194E       644              MOVE.W  #(PANWIDTH/2)-CBZWIDTH-SGMWIDTH+(COLWIDTH/2),(COLPOSX)
0000142C  33FC 00F0 00001950       645              MOVE.W  #(PANHEIGH/2),(COLPOSY)
00001434                           646              
00001434  4E75                     647              RTS
00001436                           648              
00001436                           649              
00001436                           650  ; ------------------------------------------------------------------------------
00001436                           651  TAILUPD
00001436                           652  ; ACTUALIZAR COLA.
00001436                           653  ; INPUT    : NONE 
00001436                           654  ; OUTPUT   : NONE
00001436                           655  ; MODIFIES : NONE
00001436                           656  ; ------------------------------------------------------------------------------
00001436  48A7 6000                657              MOVEM.W D1-D2,-(A7)
0000143A                           658              
0000143A                           659              ; Marca la posición actual de la cola como vacía
0000143A  3239 0000194E            660              MOVE.W  (COLPOSX),D1
00001440  3439 00001950            661              MOVE.W  (COLPOSY),D2
00001446  4EB9 000016B4            662              JSR     CINDMTRZ
0000144C  4EB9 0000171A            663              JSR     MCLDVCIA
00001452                           664              ; Actualiza la posición de la cola para seguir al último segmento
00001452  33F9 00001952 0000194E   665              MOVE.W  (SGMPOSX),(COLPOSX)
0000145C  33F9 00001954 00001950   666              MOVE.W  (SGMPOSY),(COLPOSY)
00001466                           667  
00001466                           668              ; Marca la nueva posición como cola
00001466  3239 0000194E            669              MOVE.W  (COLPOSX),D1
0000146C  3439 00001950            670              MOVE.W  (COLPOSY),D2
00001472  4EB9 000016B4            671              JSR     CINDMTRZ
00001478  4EB9 00001746            672              JSR     COLOCPD
0000147E                           673  
0000147E                           674  ; CRECER SEGMENTOS
0000147E                           675              
0000147E                           676  
0000147E                           677  FINUPD
0000147E  4C9F 0006                678              MOVEM.W (A7)+,D1-D2
00001482  4E75                     679              RTS
00001484                           680              
00001484                           681  ; ------------------------------------------------------------------------------
00001484                           682  TAILPLOT
00001484                           683  ; DIBUJAR COLA
00001484                           684  ; INPUT    : NONE 
00001484                           685  ; OUTPUT   : NONE
00001484                           686  ; MODIFIES : NONE
00001484                           687  ; ------------------------------------------------------------------------------
00001484                           688  
00001484  3F00                     689              MOVE.W  D0,-(A7)
00001486  3003                     690              MOVE.W  D3,D0
00001488  4EB9 00001772            691              JSR     CNVICOOR
0000148E  2F01                     692              MOVE.L  D1,-(A7)
00001490                           693              
00001490  103C 0050                694              MOVE.B  #80,D0
00001494  223C 0000FF00            695              MOVE.L  #COLPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA COLA
0000149A  4E4F                     696              TRAP    #15
0000149C                           697              
0000149C  103C 0051                698              MOVE.B  #81,D0
000014A0  223C 0000AA00            699              MOVE.L  #COLFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA COLA
000014A6  4E4F                     700              TRAP    #15
000014A8                           701              
000014A8  103C 0057                702              MOVE.B  #87,D0
000014AC  221F                     703              MOVE.L  (A7)+,D1
000014AE  3F03                     704              MOVE.W  D3,-(A7)
000014B0  3601                     705              MOVE.W  D1,D3
000014B2  0643 0014                706              ADD.W   #SIZECLDA,D3
000014B6  3802                     707              MOVE.W  D2,D4                    
000014B8  0644 0014                708              ADD.W   #SIZECLDA,D4
000014BC  4E4F                     709              TRAP    #15                    ; DIBUJAMOS EL CUADRADO 
000014BE                           710                          
000014BE  361F                     711              MOVE.W  (A7)+,D3  
000014C0  301F                     712              MOVE.W  (A7)+,D0
000014C2                           713  
000014C2  4E75                     714              RTS
000014C4                           715  
000014C4                           716  
000014C4                           717              ; Itera sobre cada segmento de la cola y lo dibuja
000014C4                           718              ; Convierte la posición de segmento actual a coordenadas
000014C4                           719  
000014C4                           720              ; Dibuja segmento actual
000014C4                           721  
000014C4                           722              ; Ir al siguiente segmento
000014C4                           723              ; (Lógica de iteración según cómo estén almacenados los segmentos)
000014C4                           724  
000014C4                           725  
000014C4                           726  
000014C4                           727  
000014C4                           728  
000014C4                           729  
000014C4                           730  
000014C4                           731  
000014C4                           732  
000014C4                           733  
000014C4                           734  
000014C4                           735  
000014C4                           736  
000014C4                           737  
000014C4                           738  
000014C4                           739  
000014C4                           740  
000014C4                           741  
000014C4                           742  
000014C4                           743  
000014C4                           744  
000014C4                           745  -------------------- end include --------------------
000014C4                           746              INCLUDE 'APPLE.X68'
000014C4                           747     
000014C4                           748  ; ------------------------------------------------------------------------------
000014C4                           749  APPLEINIT
000014C4                           750  ; Inicializa la manzana en una posición aleatoria
000014C4                           751  ; INPUT    : NONE 
000014C4                           752  ; OUTPUT   : NONE
000014C4                           753  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
000014C4                           754  ; ------------------------------------------------------------------------------
000014C4                           755  
000014C4                           756              ; Llama a la función para generar la posición aleatoria
000014C4  4EB9 000015B2            757              JSR     GENPOSMNZ
000014CA                           758  
000014CA                           759              ; Convierte las coordenadas de la manzana a índice de la matriz
000014CA  4EB9 000016B4            760              JSR     CINDMTRZ
000014D0                           761  
000014D0                           762              ; Verifica si la celda está ocupada o libre
000014D0                           763  CHECK:
000014D0  4EB9 000017AE            764              JSR     CHECKCLD
000014D6  6700 0010                765              BEQ     MARKMNZ                  ; Si está libre
000014DA                           766  
000014DA                           767              ; Si la celda está ocupada
000014DA  4EB9 000015B2            768              JSR     GENPOSMNZ                ; Genera una nueva posición
000014E0  4EB9 000016B4            769              JSR     CINDMTRZ                 ; Convierte las nuevas coordenadas
000014E6  60E8                     770              BRA     CHECK                    ; Repite la comprobación
000014E8                           771  
000014E8                           772  MARKMNZ:
000014E8                           773              ; Marca la celda como ocupada con la manzana (estado 4)
000014E8  4EB9 0000175C            774              JSR     MNZOCPD
000014EE                           775  
000014EE                           776              ; Dibuja la manzana en la pantalla
000014EE  4EB9 00001534            777              JSR     APPLEPLOT
000014F4                           778  
000014F4  4E75                     779              RTS
000014F6                           780  
000014F6                           781  ; ------------------------------------------------------------------------------
000014F6                           782  APPLEUPD
000014F6                           783  ; Actualiza la posición de la manzana cuando la serpiente come
000014F6                           784  ; INPUT    : NONE 
000014F6                           785  ; OUTPUT   : NONE
000014F6                           786  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
000014F6                           787  ; ------------------------------------------------------------------------------
000014F6                           788  
000014F6                           789  
000014F6                           790              ; Convierte las coordenadas actuales de la manzana a índice de la matriz
000014F6  4EB9 000016B4            791              JSR     CINDMTRZ
000014FC                           792  
000014FC                           793              ; Marca la celda anterior como vacía
000014FC  4EB9 0000171A            794              JSR     MCLDVCIA
00001502                           795  
00001502                           796              ; Llama a la función para generar una nueva posición aleatoria
00001502  4EB9 000015B2            797              JSR     GENPOSMNZ
00001508                           798  
00001508                           799              ; Convierte las nuevas coordenadas de la manzana a índice de la matriz
00001508  4EB9 000016B4            800              JSR     CINDMTRZ
0000150E                           801  
0000150E                           802  CHCKUPDT:
0000150E  4EB9 000017AE            803              JSR     CHECKCLD             ; Verifica si la celda está libre
00001514  6700 0010                804              BEQ     NEWMNZ               ; Si está libre
00001518                           805  
00001518                           806              ; Si la celda está ocupada
00001518  4EB9 000015B2            807              JSR     GENPOSMNZ            ; Genera una nueva posición
0000151E  4EB9 000016B4            808              JSR     CINDMTRZ             ; Convierte las nuevas coordenadas
00001524  60E8                     809              BRA     CHCKUPDT             ; Repite la comprobación
00001526                           810  
00001526                           811  NEWMNZ:
00001526                           812              ; Marca la celda como ocupada con la manzana (estado 4)
00001526  4EB9 0000175C            813              JSR     MNZOCPD
0000152C                           814  
0000152C                           815              ; Dibuja la nueva manzana en la pantalla
0000152C  4EB9 00001534            816              JSR     APPLEPLOT
00001532                           817  
00001532  4E75                     818              RTS
00001534                           819              
00001534                           820  ; ------------------------------------------------------------------------------
00001534                           821  APPLEPLOT
00001534                           822  ; Dibuja la manzana
00001534                           823  ; INPUT    : NONE 
00001534                           824  ; OUTPUT   : NONE
00001534                           825  ; MODIFIES : NONE
00001534                           826  ; ------------------------------------------------------------------------------
00001534  3F00                     827              MOVE.W  D0,-(A7)
00001536  3003                     828              MOVE.W  D3,D0
00001538  4EB9 00001772            829              JSR     CNVICOOR
0000153E  2F01                     830              MOVE.L  D1,-(A7)                ; PRIMERO DEBEMOS DIBUJAR EL FONDO Y LUEGO LA MANZANA
00001540                           831              
00001540  103C 0050                832              MOVE.B  #80,D0
00001544  223C 0090EE90            833              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
0000154A  4E4F                     834              TRAP    #15
0000154C                           835              
0000154C  103C 0051                836              MOVE.B  #81,D0
00001550  223C 0090EE90            837              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
00001556  4E4F                     838              TRAP    #15
00001558                           839              
00001558  103C 0057                840              MOVE.B  #87,D0
0000155C  221F                     841              MOVE.L  (A7)+,D1
0000155E  3F03                     842              MOVE.W  D3,-(A7)
00001560  3601                     843              MOVE.W  D1,D3
00001562  0643 0014                844              ADD.W   #SIZECLDA,D3
00001566  3802                     845              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
00001568  0644 0014                846              ADD.W   #SIZECLDA,D4
0000156C  4E4F                     847              TRAP    #15                     
0000156E                           848                          
0000156E  361F                     849              MOVE.W  (A7)+,D3  
00001570  301F                     850              MOVE.W  (A7)+,D0
00001572                           851  
00001572  3F00                     852              MOVE.W  D0,-(A7)
00001574  3003                     853              MOVE.W  D3,D0
00001576  4EB9 00001772            854              JSR     CNVICOOR
0000157C  2F01                     855              MOVE.L  D1,-(A7)
0000157E                           856              
0000157E  103C 0050                857              MOVE.B  #80,D0
00001582  223C 0000AAFF            858              MOVE.L  #MNZPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA MANZANA
00001588  4E4F                     859              TRAP    #15
0000158A                           860              
0000158A  103C 0051                861              MOVE.B  #81,D0
0000158E  223C 000000FF            862              MOVE.L  #MNZFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA MANZANA
00001594  4E4F                     863              TRAP    #15
00001596                           864              
00001596  103C 0058                865              MOVE.B  #88,D0
0000159A  221F                     866              MOVE.L  (A7)+,D1
0000159C  3F03                     867              MOVE.W  D3,-(A7)
0000159E  3601                     868              MOVE.W  D1,D3
000015A0  0643 0014                869              ADD.W   #SIZECLDA,D3
000015A4  3802                     870              MOVE.W  D2,D4                    ; DIBUJAMOS EL CIRCULO
000015A6  0644 0014                871              ADD.W   #SIZECLDA,D4
000015AA  4E4F                     872              TRAP    #15                     
000015AC                           873                          
000015AC  361F                     874              MOVE.W  (A7)+,D3  
000015AE  301F                     875              MOVE.W  (A7)+,D0
000015B0                           876  
000015B0                           877  
000015B0  4E75                     878              RTS
000015B2                           879  ; ----------------------------------------------------------------------------
000015B2                           880  GENPOSMNZ
000015B2                           881  ; Genera una posición aleatoria para la manzana
000015B2                           882  ; INPUT: NONE
000015B2                           883  ; OUTPUT:
000015B2                           884  ; MODIFIES: MNZPOSX, MNZPOSY
000015B2                           885  ; ----------------------------------------------------------------------------
000015B2                           886  
000015B2  48E7 8000                887              MOVEM.L D0,-(A7)
000015B6                           888  
000015B6                           889              ; Genera la coordenada X aleatoria
000015B6  4EB8 10F8                890              JSR     UTLRAND
000015BA  0240 001F                891              ANDI.W  #NUMCLMNS-1, D0       ; Asegura que esté en [0, NUMCLMNS-1]
000015BE  C0FC 0014                892              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
000015C2  3200                     893              MOVE.W  D0,D1
000015C4  33C0 00001942            894              MOVE.W  D0, MNZPOSX           ; Guarda la coordenada X generada
000015CA                           895              
000015CA                           896              ; Generar coordenada Y aleatoria
000015CA  4EB8 10F8                897              JSR     UTLRAND
000015CE  0240 0017                898              ANDI.W  #NUMFILAS-1, D0       ; Asegura que esté en el rango [0, NUMFILAS-1]
000015D2  C0FC 0014                899              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
000015D6  3400                     900              MOVE.W  D0,D2
000015D8  33C0 00001944            901              MOVE.W  D0, MNZPOSY           ; Guarda la coordenada Y generada
000015DE                           902              
000015DE  4CDF 0001                903              MOVEM.L (A7)+,D0
000015E2  4E75                     904              RTS 
000015E4                           905  
000015E4                           906  
000015E4                           907  
000015E4                           908  
000015E4                           909  
000015E4                           910  
000015E4                           911  -------------------- end include --------------------
000015E4                           912              INCLUDE 'SCORE.X68'
000015E4                           913     
000015E4                           914  ; ------------------------------------------------------------------------------
000015E4                           915  SCOINIT
000015E4                           916  ; INICIALIZAR MARCADOR.
000015E4                           917  ; INPUT    : NONE 
000015E4                           918  ; OUTPUT   : NONE
000015E4                           919  ; MODIFIES : NONE
000015E4                           920  ; ------------------------------------------------------------------------------
000015E4  4279 00001958            921              CLR.W   (JGOPNTS)
000015EA  4E75                     922              RTS
000015EC                           923              
000015EC                           924  ; ------------------------------------------------------------------------------
000015EC                           925  SCOUPD
000015EC                           926  ; ACTUALIZAR MARCADOR.
000015EC                           927  ; INPUT    : NONE 
000015EC                           928  ; OUTPUT   : NONE
000015EC                           929  ; MODIFIES : NONE
000015EC                           930  ; ------------------------------------------------------------------------------
000015EC                           931              
000015EC  48E7 8000                932              MOVEM.L D0,-(A7)
000015F0                           933              
000015F0                           934              ;Incrementa el marcador
000015F0  3039 00001958            935              MOVE.W  (JGOPNTS),D0
000015F6  0640 0019                936              ADD.W  #25,D0
000015FA  33C0 00001958            937              MOVE.W  D0,(JGOPNTS)
00001600                           938              
00001600  4CDF 0001                939              MOVEM.L (A7)+,D0
00001604                           940  
00001604  4E75                     941              RTS
00001606                           942              
00001606                           943  ; ------------------------------------------------------------------------------
00001606                           944  SCOPLOT
00001606                           945  ; DIBUJAR MARCADOR.
00001606                           946  ; INPUT    : NONE 
00001606                           947  ; OUTPUT   : NONE
00001606                           948  ; MODIFIES : NONE
00001606                           949  ; ------------------------------------------------------------------------------
00001606  48E7 C040                950             MOVEM.L  D0-D1/A1,-(A7)
0000160A                           951             ; SET COLOR DE FONDO
0000160A  103C 0051                952             MOVE.B   #81,D0
0000160E  223C 0090EE90            953             MOVE.L   #COLFND,D1
00001614  4E4F                     954             TRAP     #15
00001616                           955             
00001616                           956             
00001616                           957             
00001616                           958             ; DIBUJAR LINEA DE PUNTUACIÓN
00001616  43F9 00001630            959              LEA     .TXT1,A1
0000161C  4281                     960              CLR.L   D1
0000161E  3239 00001958            961              MOVE.W  (JGOPNTS),D1
00001624  103C 0011                962              MOVE.B  #17,D0
00001628  4E4F                     963              TRAP    #15
0000162A                           964              
0000162A  4CDF 0203                965              MOVEM.L (A7)+,D0-D1/A1
0000162E  4E75                     966              RTS
00001630                           967  
00001630                           968  
00001630= 50 55 4E 54 4F 53 ...    969  .TXT1       DC.B    'PUNTOS : ',0
0000163A                           970  
0000163A                           971  
0000163A                           972  
0000163A                           973  
0000163A                           974  -------------------- end include --------------------
0000163A                           975              INCLUDE 'MATRIZ.X68'
0000163A                           976  ; ----------------------------------------------------------------------------
0000163A                           977  ; MATRIZ
0000163A                           978  ; ----------------------------------------------------------------------------
0000163A                           979  
0000163A                           980  ;-----------------------------------------------------------------------------
0000163A                           981  MTZINIT
0000163A                           982  ; INICIALIZA LA MATRIZ, AL PRINCIPIO ESTÁ VACÍA
0000163A                           983  ; INPUT    : NONE
0000163A                           984  ; OUTPUT   : NONE
0000163A                           985  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
0000163A                           986  ; ----------------------------------------------------------------------------
0000163A                           987              
0000163A  48A7 E080                988              MOVEM.W D0-D2/A0,-(A7)
0000163E                           989              
0000163E  41F9 0000195C            990              LEA ESTDCLDS, A0       ; Apunta al inicio de ESTDCLDS
00001644  303C 0300                991              MOVE.W #TCELDAS, D0    ; Número total de celdas
00001648                           992  
00001648                           993  CLNCLDS:
00001648  4218                     994              CLR.B (A0)+            ; Coloca 0 en cada celda
0000164A  5340                     995              SUBI.W #1, D0          ; Decrementa el contador de celdas
0000164C  66FA                     996              BNE CLNCLDS            ; Repite hasta que esten vacías
0000164E                           997              
0000164E                           998              
0000164E  3239 00001946            999              MOVE.W  CBZPOSX, D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
00001654  3439 00001948           1000              MOVE.W  CBZPOSY, D2
0000165A  4EB9 000016B4           1001              JSR     CINDMTRZ
00001660  4EB9 000016EE           1002              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
00001666                          1003              
00001666  3239 00001952           1004              MOVE.W  SGMPOSX, D1
0000166C  3439 00001954           1005              MOVE.W  SGMPOSY, D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
00001672  4EB9 000016B4           1006              JSR     CINDMTRZ
00001678  4EB9 00001730           1007              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
0000167E                          1008              
0000167E  3239 0000194E           1009              MOVE.W  COLPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA COLA
00001684  3439 00001950           1010              MOVE.W  COLPOSY, D2
0000168A  4EB9 000016B4           1011              JSR     CINDMTRZ
00001690  4EB9 00001746           1012              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
00001696                          1013              
00001696  3239 00001942           1014              MOVE.W  MNZPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
0000169C  3439 00001944           1015              MOVE.W  MNZPOSY, D2
000016A2  4EB9 000016B4           1016              JSR     CINDMTRZ
000016A8  4EB9 0000175C           1017              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
000016AE                          1018              
000016AE                          1019              
000016AE  4C9F 0107               1020              MOVEM.W (A7)+,D0-D2/A0
000016B2                          1021  
000016B2  4E75                    1022              RTS
000016B4                          1023  
000016B4                          1024  ;-----------------------------------------------------------------------------
000016B4                          1025  CINDMTRZ
000016B4                          1026  ; CALCULA EL ÍNDICE DE UNA CELDA
000016B4                          1027  ; INPUT    : D1 = coordenada X pantalla, D2 = coordenada Y pantalla
000016B4                          1028  ; OUTPUT   : D0 = índice de la celda en ESTDCLDS
000016B4                          1029  ; MODIFIES : NONE
000016B4                          1030  ; ----------------------------------------------------------------------------
000016B4                          1031  
000016B4  48A7 7000               1032               MOVEM.W D1-D3,-(A7)     ; Guarda los registros D1-D3 en la pila
000016B8                          1033  
000016B8                          1034              ; Divide X por SIZECLDA
000016B8  3601                    1035              MOVE.W  D1, D3          ; Copia X a D3
000016BA  4241                    1036              CLR.W   D1              ; Inicializa el cociente de X
000016BC                          1037  
000016BC  B67C 0014               1038  DIVX:       CMP.W   #SIZECLDA, D3    ; Compara D3 con SIZECLDA
000016C0  6D00 000A               1039              BLT     ENDDIVX         ; Si D3 < SIZECLDA, salta a ENDDIVX
000016C4  0443 0014               1040              SUB.W   #SIZECLDA, D3   ; Resta SIZECLDA de D3
000016C8  5241                    1041              ADDQ.W  #1, D1          ; Incrementa el cociente de X
000016CA  60F0                    1042              BRA     DIVX            ; Repite el bucle
000016CC                          1043  
000016CC                          1044  ENDDIVX:
000016CC                          1045  
000016CC                          1046              ; Divide Y por SIZECLDA
000016CC  3602                    1047              MOVE.W  D2, D3          ; Copia Y a D3
000016CE  4242                    1048              CLR.W   D2              ; Inicializa el cociente de Y
000016D0                          1049  
000016D0  B67C 0014               1050  DIVY:       CMP.W   #SIZECLDA, D3    ; Compara D3 con SIZECLDA
000016D4  6D00 000A               1051              BLT     ENDDIVY         ; Si D3 < SIZECLDA, salta a ENDDIVY
000016D8  0443 0014               1052              SUB.W   #SIZECLDA, D3   ; Resta SIZECLDA de D3
000016DC  5242                    1053              ADDQ.W  #1, D2          ; Incrementa el cociente de Y
000016DE  60F0                    1054              BRA     DIVY            ; Repite el bucle
000016E0                          1055  
000016E0                          1056  ENDDIVY:
000016E0                          1057  
000016E0                          1058              ; Calcula el índice
000016E0  4240                    1059              CLR.W   D0
000016E2  3002                    1060              MOVE.W  D2, D0          ; D0 = Y_CELDA
000016E4  EB40                    1061              ASL.W   #5, D0          ; D0 = Y_CELDA * NUMCLMNS (32 = 2^5)
000016E6  D041                    1062              ADD.W   D1, D0          ; D0 = Y_CELDA * NUMCLMNS + X_CELDA
000016E8                          1063  
000016E8  4C9F 000E               1064              MOVEM.W (A7)+,D1-D3     ; Restaura los registros D1-D3 desde la pila
000016EC                          1065  
000016EC  4E75                    1066              RTS  
000016EE                          1067              
000016EE                          1068  ;-----------------------------------------------------------------------------
000016EE                          1069  CBZOCPD
000016EE                          1070  ; MARCA UNA CELDA COMO OCUPADA POR LA CABEZA
000016EE                          1071  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000016EE                          1072  ; OUTPUT   : NONE
000016EE                          1073  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000016EE                          1074  ; ----------------------------------------------------------------------------
000016EE                          1075  
000016EE  48A7 0080               1076              MOVEM.W A0,-(A7)
000016F2                          1077  
000016F2  41F9 0000195C           1078              LEA     ESTDCLDS, A0                ; Dirección de la matriz en A0
000016F8  11B9 00001956 0000      1079              MOVE.B  TRZPLOT, (A0, D0.W)           ; Marca la celda como ocupada
00001700                          1080              
00001700  4C9F 0100               1081              MOVEM.W (A7)+,A0
00001704                          1082              
00001704  4E75                    1083              RTS
00001706                          1084              
00001706                          1085              
00001706                          1086              
00001706                          1087  ;-----------------------------------------------------------------------------
00001706                          1088  RSTCLD
00001706                          1089  ; RESTA 1 A LA CELDA PASADA POR PARÁMETRO
00001706                          1090  ; INPUT    : D0 = índice de la celda en ESTDCLDS
00001706                          1091  ; OUTPUT   : NONE
00001706                          1092  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
00001706                          1093  ; ----------------------------------------------------------------------------
00001706                          1094  
00001706  48A7 0080               1095              MOVEM.W A0,-(A7)
0000170A                          1096  
0000170A  41F9 0000195C           1097              LEA     ESTDCLDS, A0              ; Dirección de la matriz en A0
00001710  5330 0000               1098              SUBQ.B   #1, (A0, D0.W)           ; Marca la celda como ocupada
00001714                          1099              
00001714  4C9F 0100               1100              MOVEM.W (A7)+,A0
00001718                          1101              
00001718  4E75                    1102              RTS
0000171A                          1103             
0000171A                          1104  ;-----------------------------------------------------------------------------
0000171A                          1105  MCLDVCIA
0000171A                          1106  ; MARCA UNA CELDA COMO VACÍA
0000171A                          1107  ; INPUT    : D0 = índice de la celda en ESTDCLDS
0000171A                          1108  ; OUTPUT   : NONE
0000171A                          1109  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
0000171A                          1110  ; ----------------------------------------------------------------------------
0000171A                          1111  
0000171A  48A7 0080               1112              MOVEM.W A0,-(A7)
0000171E                          1113  
0000171E  41F9 0000195C           1114              LEA ESTDCLDS, A0                ; Direccion de la matriz en A0
00001724  11BC 0000 0000          1115              MOVE.B #0, (A0, D0.W)           ; Marca la celda como vacía
0000172A                          1116              
0000172A  4C9F 0100               1117              MOVEM.W (A7)+,A0
0000172E                          1118              
0000172E  4E75                    1119              RTS
00001730                          1120  
00001730                          1121  ;-----------------------------------------------------------------------------
00001730                          1122  SGMOCPD
00001730                          1123  ; MARCA UNA CELDA COMO OCUPADA POR EL SEGMENTO
00001730                          1124  ; INPUT    : D0 = índice de la celda en ESTDCLDS
00001730                          1125  ; OUTPUT   : NONE
00001730                          1126  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
00001730                          1127  ; ----------------------------------------------------------------------------
00001730                          1128  
00001730  48A7 0080               1129              MOVEM.W A0,-(A7)
00001734                          1130  
00001734  41F9 0000195C           1131              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
0000173A  11BC 0002 0000          1132              MOVE.B #2, (A0, D0.W)           ; Marca la celda como ocupada
00001740                          1133              
00001740  4C9F 0100               1134              MOVEM.W (A7)+,A0
00001744                          1135              
00001744  4E75                    1136              RTS
00001746                          1137              
00001746                          1138  ;-----------------------------------------------------------------------------
00001746                          1139  COLOCPD
00001746                          1140  ; MARCA UNA CELDA COMO OCUPADA POR LA COLA
00001746                          1141  ; INPUT    : D0 = índice de la celda en ESTDCLDS
00001746                          1142  ; OUTPUT   : NONE
00001746                          1143  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
00001746                          1144  ; ----------------------------------------------------------------------------
00001746                          1145  
00001746  48A7 0080               1146              MOVEM.W A0,-(A7)
0000174A                          1147  
0000174A  41F9 0000195C           1148              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
00001750  11BC 0001 0000          1149              MOVE.B #1, (A0, D0.W)           ; Marca la celda como ocupada
00001756                          1150              
00001756  4C9F 0100               1151              MOVEM.W (A7)+,A0
0000175A                          1152              
0000175A  4E75                    1153              RTS
0000175C                          1154  
0000175C                          1155  
0000175C                          1156  ;-----------------------------------------------------------------------------
0000175C                          1157  MNZOCPD
0000175C                          1158  ; MARCA UNA CELDA COMO OCUPADA POR LA MANZANA
0000175C                          1159  ; INPUT    : D0 = índice de la celda en ESTDCLDS
0000175C                          1160  ; OUTPUT   : NONE
0000175C                          1161  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
0000175C                          1162  ; ----------------------------------------------------------------------------
0000175C                          1163  
0000175C  48A7 0080               1164              MOVEM.W A0,-(A7)
00001760                          1165  
00001760  41F9 0000195C           1166              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
00001766  11BC 0004 0000          1167              MOVE.B #4, (A0, D0.W)           ; Marca la celda como ocupada
0000176C                          1168              
0000176C  4C9F 0100               1169              MOVEM.W (A7)+,A0
00001770                          1170              
00001770  4E75                    1171              RTS
00001772                          1172  
00001772                          1173              
00001772                          1174  ;-----------------------------------------------------------------------------
00001772                          1175  CNVICOOR
00001772                          1176  ; Convierte un índice de celda a coordenadas de pantalla (X, Y)
00001772                          1177  ; INPUT    : D0 = índice de la celda en ESTADO_CELDAS
00001772                          1178  ; OUTPUT   : D1 = coordenada X, D2 = coordenada Y
00001772                          1179  ; MODIFIES : NONE
00001772                          1180  ; ----------------------------------------------------------------------------
00001772                          1181  
00001772  48A7 9800               1182              MOVEM.W D0/D3-D4,-(A7)
00001776                          1183  
00001776  3400                    1184              MOVE.W  D0,D2         ; Copia índice a D2 para calcular la fila
00001778  EA4A                    1185              LSR.W   #5,D2         ; D2 = índice / NUM_COLUMNAS (32 = 2^5)
0000177A  3200                    1186              MOVE.W  D0,D1         ; Copia índice a D1 para calcular la columna
0000177C  C27C 001F               1187              AND.W   #$1F,D1       ; D1 = índice % NUM_COLUMNAS (31 = 0x1F) (CREO)
00001780                          1188  
00001780                          1189              ; Multiplica por TAMAÑO_CELDA = 10
00001780  363C 0014               1190              MOVE.W  #SIZECLDA, D3
00001784  3801                    1191              MOVE.W  D1,D4         ; Copia D1 para multiplicar por 10
00001786  4241                    1192              CLR.W   D1            ; Inicializa resultado
00001788                          1193  
00001788                          1194  
00001788                          1195  MULTLOOPX: 
00001788  B87C 0000               1196              CMP.W   #0, D4        ; ¿Quedan iteraciones?
0000178C  6700 0008               1197              BEQ     ENDMULTX
00001790  D243                    1198              ADD.W   D3,D1         ; Suma TAMANO_CELDA (10) repetidamente
00001792                          1199  
00001792  5344                    1200              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
00001794  60F2                    1201              BRA     MULTLOOPX     ; Repite mientras no sea 0
00001796                          1202  ENDMULTX: 
00001796  3802                    1203              MOVE.W  D2,D4         ; Copia D2 para multiplicar por 10
00001798  4242                    1204              CLR.W   D2            ; Inicializa resultado
0000179A                          1205  
0000179A                          1206  MULTLOOPY: 
0000179A  B87C 0000               1207              CMP.W   #0, D4        ; ¿Quedan iteraciones?
0000179E  6700 0008               1208              BEQ     ENDMULTY
000017A2  D443                    1209              ADD.W   D3,D2         ; Suma TAMANO_CELDA (10) repetidamente
000017A4  5344                    1210              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
000017A6  60F2                    1211              BRA     MULTLOOPY     ; Repite mientras no sea 0
000017A8                          1212  ENDMULTY:
000017A8  4C9F 0019               1213              MOVEM.W (A7)+,D0/D3-D4
000017AC                          1214  
000017AC  4E75                    1215              RTS
000017AE                          1216  
000017AE                          1217  ; ----------------------------------------------------------------------------
000017AE                          1218  CHECKCLD
000017AE                          1219  ; INPUT: D0 = índice de la celda
000017AE                          1220  ; OUTPUT: D0 = 0 si está vacía, 1 si está ocupada
000017AE                          1221  ; MODIFIES: Ninguno
000017AE                          1222  ; ----------------------------------------------------------------------------
000017AE                          1223  
000017AE  41F9 0000195C           1224              LEA     ESTDCLDS, A0    ; Carga la dirección de la matriz ESTDCLDS
000017B4  1230 0000               1225              MOVE.B  (A0, D0.W),D1   ; Carga el estado de la celda en D1
000017B8  B23C 0000               1226              CMP.B   #0, D1          ; Compara si está vacía (0)
000017BC  6700 0008               1227              BEQ     CLDFREE         ; Si está vacía
000017C0  303C 0001               1228              MOVE.W  #1, D0          ; Si está ocupada, devuelve 1 (ocupada)
000017C4                          1229  
000017C4  4E75                    1230              RTS
000017C6                          1231  
000017C6                          1232  CLDFREE:
000017C6  303C 0000               1233              MOVE.W  #0, D0                 ; Devuelve 0 (libre)
000017CA                          1234  
000017CA  4E75                    1235              RTS
000017CC                          1236  
000017CC                          1237  
000017CC                          1238  ;-----------------------------------------------------------------------------
000017CC                          1239  FONPLOT
000017CC                          1240  ; DIBUJADO DEL FONDO
000017CC                          1241  ; INPUT    : NONE
000017CC                          1242  ; OUTPUT   : NONE
000017CC                          1243  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
000017CC                          1244  ; ----------------------------------------------------------------------------
000017CC                          1245  
000017CC  3F00                    1246              MOVE.W  D0,-(A7)
000017CE  3003                    1247              MOVE.W  D3,D0
000017D0  4EB8 1772               1248              JSR     CNVICOOR
000017D4  2F01                    1249              MOVE.L  D1,-(A7)
000017D6                          1250              
000017D6  103C 0050               1251              MOVE.B  #80,D0
000017DA  223C 0090EE90           1252              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
000017E0  4E4F                    1253              TRAP    #15
000017E2                          1254              
000017E2  103C 0051               1255              MOVE.B  #81,D0
000017E6  223C 0090EE90           1256              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
000017EC  4E4F                    1257              TRAP    #15
000017EE                          1258              
000017EE  103C 0057               1259              MOVE.B  #87,D0
000017F2  221F                    1260              MOVE.L  (A7)+,D1
000017F4  3F03                    1261              MOVE.W  D3,-(A7)
000017F6  3601                    1262              MOVE.W  D1,D3
000017F8  0643 0014               1263              ADD.W   #SIZECLDA,D3
000017FC  3802                    1264              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
000017FE  0644 0014               1265              ADD.W   #SIZECLDA,D4
00001802  4E4F                    1266              TRAP    #15                     
00001804                          1267                          
00001804  361F                    1268              MOVE.W  (A7)+,D3  
00001806  301F                    1269              MOVE.W  (A7)+,D0
00001808  4E75                    1270              RTS         
0000180A                          1271  
0000180A                          1272  
0000180A                          1273  
0000180A                          1274  ;-----------------------------------------------------------------------------
0000180A                          1275  MTZUPD
0000180A                          1276  ; ACTUALIZA LA MATRIZ CASILLA A CASILLA
0000180A                          1277  ; INPUT    : NONE
0000180A                          1278  ; OUTPUT   : NONE
0000180A                          1279  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
0000180A                          1280  ; ----------------------------------------------------------------------------
0000180A                          1281  
0000180A                          1282  
0000180A  48A7 E080               1283              MOVEM.W D0-D2/A0,-(A7)
0000180E                          1284              
0000180E  41F9 0000195C           1285              LEA ESTDCLDS, A0       ; Apunta al inicio de ESTDCLDS
00001814  303C 0300               1286              MOVE.W #TCELDAS, D0    ; Número total de celdas
00001818                          1287  
00001818                          1288  .CLNCLDS:
00001818  4218                    1289              CLR.B (A0)+            ; Coloca 0 en cada celda
0000181A  5340                    1290              SUBI.W #1, D0          ; Decrementa el contador de celdas
0000181C  66FA                    1291              BNE .CLNCLDS           ; Repite hasta que esten vacías
0000181E                          1292              
0000181E                          1293              
0000181E  3239 00001946           1294              MOVE.W  CBZPOSX, D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
00001824  3439 00001948           1295              MOVE.W  CBZPOSY, D2
0000182A  4EB8 16B4               1296              JSR     CINDMTRZ
0000182E  4EB8 16EE               1297              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
00001832                          1298              
00001832  3239 00001952           1299              MOVE.W  SGMPOSX, D1
00001838  3439 00001954           1300              MOVE.W  SGMPOSY, D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
0000183E  4EB8 16B4               1301              JSR     CINDMTRZ
00001842  4EB8 1730               1302              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
00001846                          1303              
00001846  3239 0000194E           1304              MOVE.W  COLPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA COLA
0000184C  3439 00001950           1305              MOVE.W  COLPOSY, D2
00001852  4EB8 16B4               1306              JSR     CINDMTRZ
00001856  4EB8 1746               1307              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
0000185A                          1308              
0000185A  3239 00001942           1309              MOVE.W  MNZPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
00001860  3439 00001944           1310              MOVE.W  MNZPOSY, D2
00001866  4EB8 16B4               1311              JSR     CINDMTRZ
0000186A  4EB8 175C               1312              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
0000186E                          1313              
0000186E                          1314              
0000186E  4C9F 0107               1315              MOVEM.W (A7)+,D0-D2/A0
00001872                          1316  
00001872  4E75                    1317              RTS
00001874                          1318  
00001874                          1319  
00001874                          1320  
00001874                          1321  ;-----------------------------------------------------------------------------
00001874                          1322  MTZPLOT
00001874                          1323  ; DIBUJA LA MATRIZ CASILLA A CASILLA
00001874                          1324  ; INPUT    : NONE
00001874                          1325  ; OUTPUT   : NONE
00001874                          1326  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
00001874                          1327  ; ----------------------------------------------------------------------------
00001874  48E7 F080               1328              MOVEM.L D0-D3/A0,-(A7)
00001878                          1329  
00001878  4240                    1330              CLR.W   D0
0000187A  4243                    1331              CLR.W   D3
0000187C  41F9 0000195C           1332              LEA     ESTDCLDS, A0            ; Apunta al inicio de ESTDCLDS
00001882  303C 0300               1333              MOVE.W  #TCELDAS, D0            ; Número total de celdas
00001886  363C 0000               1334              MOVE.W  #0,D3                   ; LO UTILIZAMOS PARA SABER EL INDICE EN EL QUE NOS ENCONTRAMOS
0000188A  4241                    1335              CLR.W   D1
0000188C  4242                    1336              CLR.W   D2
0000188E                          1337              
0000188E                          1338  
0000188E                          1339  PLOTCLDS:
0000188E  1218                    1340              MOVE.B  (A0)+,D1                ; MOVEMOS EL VALOR DE LA CELDA A D1
00001890  B23C 0000               1341              CMP.B   #0,D1
00001894  6700 0036               1342              BEQ     PLOTVAC                 ; SALTA A DIBUJAR POSICIÓN VACÍA
00001898  B23C 0001               1343              CMP.B   #1,D1 
0000189C  6700 0034               1344              BEQ     PLOTCOL                 ; SALTA A DIBUJAR COLA
000018A0  B23C 0002               1345              CMP.B   #2,D1
000018A4  6700 0032               1346              BEQ     PLOTSEG                 ; SALTA A DIBUJAR SEGMENTO
000018A8  B239 00001956           1347              CMP.B   TRZPLOT,D1
000018AE  6700 0016               1348              BEQ     PLOTCBZ                 ; SALTA A DIBUJAR CABEZA
000018B2  B23C 0004               1349              CMP.B   #4,D1                 
000018B6  6700 0026               1350              BEQ     PLOTAPPLE               ; SALTA A DIBUJAR MANZANA
000018BA                          1351    
000018BA                          1352  DONEPLOT            
000018BA  5243                    1353              ADDQ    #1,D3                   ; AUMENTAMOS EL INDICE DE CELDA PARA LA SIGUIENTE
000018BC  5340                    1354              SUBI.W  #1, D0                  ; Decrementa el contador de celdas
000018BE  66CE                    1355              BNE     PLOTCLDS                ; Repite hasta que esten vacías
000018C0  4CDF 010F               1356              MOVEM.L (A7)+,D0-D3/A0
000018C4  4E75                    1357              RTS
000018C6                          1358  PLOTCBZ:
000018C6  4EB8 1300               1359              JSR     HEADPLOT
000018CA  60EE                    1360              BRA     DONEPLOT
000018CC                          1361  
000018CC                          1362  PLOTVAC:    
000018CC  4EB8 17CC               1363              JSR     FONPLOT
000018D0  60E8                    1364              BRA     DONEPLOT                ; DIBUJADO HECHO 
000018D2                          1365  
000018D2                          1366  PLOTCOL:   
000018D2  4EB8 1484               1367              JSR     TAILPLOT 
000018D6  60E2                    1368              BRA     DONEPLOT                ; DIBUJADO HECHO 
000018D8                          1369              
000018D8                          1370  PLOTSEG:    
000018D8  4EB8 13E4               1371              JSR     SEGPLOT
000018DC  60DC                    1372              BRA     DONEPLOT                ; DIBUJADO HECHO    
000018DE                          1373  
000018DE                          1374  PLOTAPPLE:
000018DE  4EB8 1534               1375              JSR     APPLEPLOT
000018E2  60D6                    1376              BRA     DONEPLOT            
000018E4                          1377  
000018E4                          1378  
000018E4                          1379  
000018E4                          1380  
000018E4                          1381  
000018E4                          1382  
000018E4                          1383  
000018E4                          1384  
000018E4                          1385  
000018E4                          1386  
000018E4                          1387  
000018E4                          1388  
000018E4                          1389  
000018E4                          1390  
000018E4                          1391  -------------------- end include --------------------
000018E4                          1392  START:
000018E4                          1393                  
000018E4                          1394  ; --- INIZIALIZACIÓN ---------------------------------------------------------
000018E4                          1395  
000018E4  4EB8 1000               1396              JSR     SYSINIT
000018E8  4EB8 10E2               1397              JSR     UTLINIT
000018EC  4EB8 1066               1398              JSR     KBDINIT
000018F0  4EB8 163A               1399              JSR     MTZINIT
000018F4  4EB8 1216               1400              JSR     HEADINIT                
000018F8  4EB8 1384               1401              JSR     SEGINIT
000018FC  4EB8 1424               1402              JSR     TAILINIT
00001900  4EB8 15E4               1403              JSR     SCOINIT
00001904  4EB8 14C4               1404              JSR     APPLEINIT
00001908                          1405              
00001908                          1406  
00001908                          1407  .LOOP
00001908                          1408  
00001908                          1409  ; --- ACTUALIZAR -------------------------------------------------------------
00001908                          1410  
00001908                          1411  ; LEER DISPOSITIVOS DE ENTRADA
00001908                          1412  
00001908  4E41                    1413              TRAP    #1
0000190A                          1414  
0000190A                          1415  ; ACTUALIZAR LÓGICA DEL JUEGO
0000190A                          1416              
0000190A  4EB8 1436               1417              JSR     TAILUPD
0000190E  4EB8 1396               1418              JSR     SEGUPD
00001912  4EB8 1244               1419              JSR     HEADUPD
00001916                          1420              ;JSR     APPLEUPD  
00001916  4EB8 180A               1421              JSR     MTZUPD
0000191A                          1422              ;JSR     SCOUPD
0000191A                          1423              
0000191A                          1424  ; --- SINCRONIZACIÓN ---------------------------------------------------------
0000191A                          1425              ; THE FOLLOWING SYNC STRATEGY IS ****WRONG****
0000191A  103C 0017               1426              MOVE.B  #23,D0
0000191E  7201                    1427              MOVE.L  #1,D1
00001920  4E4F                    1428              TRAP    #15
00001922                          1429  
00001922                          1430  
00001922                          1431  ;---DIBUJAR-------------------------------------------------------------------
00001922  4EB8 1300               1432               JSR    HEADPLOT
00001926  4EB8 13E4               1433               JSR    SEGPLOT
0000192A  4EB8 1484               1434               JSR    TAILPLOT
0000192E  4EB8 1534               1435               JSR    APPLEPLOT
00001932  4EB8 1874               1436               JSR    MTZPLOT
00001936  4EB8 1606               1437               JSR    SCOPLOT
0000193A                          1438              
0000193A  4E40                    1439              TRAP    #0                      ; ACTUALIZA DOBLE BUFFER
0000193C                          1440  
0000193C                          1441  
0000193C  60CA                    1442              BRA     .LOOP
0000193E                          1443  
0000193E  FFFF FFFF               1444              SIMHALT
00001942                          1445              
00001942                          1446              INCLUDE 'VARS.X68'
00001942                          1447  ; ----------------------------------------------------------------------------
00001942                          1448  ; VARIABLES DEL JUEGO
00001942                          1449  ; ----------------------------------------------------------------------------
00001942                          1450  
00001942                          1451  ; --- VARIABLES DE LA MANZANA ------------------------------------------------
00001942                          1452  
00001942                          1453  MNZPOSX     DS.W    1                       ; COORDENADA X DE LA MANZANA
00001944                          1454  MNZPOSY     DS.W    1                       ; COORDENADA Y DE LA MANZANA
00001946                          1455  
00001946                          1456  ; --- VARIABLES DE LA SERPIENTE ----------------------------------------------
00001946                          1457  
00001946                          1458  CBZPOSX     DS.W    1                       ; COORDENADA X CABEZA
00001948                          1459  CBZPOSY     DS.W    1                       ; COORDENADA Y CABEZA
0000194A                          1460  CBZVELX     DS.W    1                       ; VELOCIDAD X CABEZA
0000194C                          1461  CBZVELY     DS.W    1                       ; VELOCIDAD Y CABEZA
0000194E                          1462  COLPOSX     DS.W    1                       ; COORDENADA X COLA
00001950                          1463  COLPOSY     DS.W    1                       ; COORDENADA Y COLA
00001952                          1464  SGMPOSX     DS.W    1                       ; COORDENADA X SEGMENTO
00001954                          1465  SGMPOSY     DS.W    1                       ; COORDENADA Y SEGMENTO
00001956                          1466  TRZPLOT     DS.B    1                       ; NÚMERO DE TROZOS A DIBUJAR
00001957                          1467  
00001957                          1468  
00001957                          1469  
00001957                          1470  
00001957                          1471  ; --- VARIABLES DEL MARCADOR -------------------------------------------------
00001957                          1472  
00001958                          1473  JGOPNTS     DS.W    1                       ; PUNTUACIÓN DEL JUEGO
0000195A                          1474  
0000195A                          1475  
0000195A                          1476  
0000195A                          1477  
0000195A                          1478  
0000195A                          1479  
0000195A                          1480  
0000195A                          1481  
0000195A                          1482  
0000195A                          1483  -------------------- end include --------------------
0000195A                          1484              INCLUDE 'LIB/UTLVARS.X68'
0000195A                          1485  ; =============================================================================
0000195A                          1486  ; UTILITY VARIABLES
0000195A                          1487  ; =============================================================================
0000195A                          1488  
0000195A                          1489  UTLRNDIX    DS.B    1                       ; NEXT INDEX TO RANDOM NUMBER
0000195C                          1490              DS.W    0
0000195C                          1491  -------------------- end include --------------------
0000195C                          1492              INCLUDE 'SYSVARS.X68'
0000195C                          1493  ; ----------------------------------------------------------------------------
0000195C                          1494  ; VARIABLES DEL SISTEMA
0000195C                          1495  ; ----------------------------------------------------------------------------
0000195C                          1496  
0000195C                          1497  ; --- VARIABLES DE LA MATRIZ -------------------------------------------------
0000195C                          1498  
0000195C                          1499  ESTDCLDS    DS.B    TCELDAS                 ; ESTADO DE LAS CELDAS 0=VACÍO  1=COLA   2=SEGMENTO  TRZPLOT=CABEZA  4?=MANZANA    
00001C5C                          1500  ESTDCBZ     DS.B    1                       ; 0= DERECHA, 1=ARRIBA, 2=IZQUIERDA, 3=ABAJO
00001C5D                          1501  
00001C5D                          1502  ; --- VARIABLES DE TECLADO ---------------------------------------------------
00001C5D                          1503  
00001C5D                          1504  KBDVAL      DS.B    1
00001C5E                          1505  KBDEDGE     DS.B    1                       ; KEY EDGE
00001C60                          1506  LASTKEY     DS.L    1                       
00001C64                          1507  
00001C64                          1508  
00001C64                          1509  
00001C64                          1510  
00001C64                          1511  
00001C64                          1512  
00001C64                          1513  
00001C64                          1514  
00001C64                          1515  
00001C64                          1516  
00001C64                          1517  
00001C64                          1518  
00001C64                          1519  
00001C64                          1520  
00001C64                          1521  
00001C64                          1522  
00001C64                          1523  -------------------- end include --------------------
00001C64                          1524      
00001C64                          1525      
00001C64                          1526              END    START        

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
APPLEINIT           14C4
APPLEPLOT           1534
APPLEUPD            14F6
ARR                 10BC
CBZFCOL             AA00
CBZHEIGH            14
CBZOCPD             16EE
CBZPCOL             FF00
CBZPOSX             1946
CBZPOSY             1948
CBZVEL              14
CBZVELX             194A
CBZVELY             194C
CBZWIDTH            14
CHCKUPDT            150E
CHECK               14D0
CHECKCLD            17AE
CHKCOL              12B6
CINDMTRZ            16B4
CLDFREE             17C6
CLNCLDS             1648
CNVICOOR            1772
COLFCOL             AA00
COLFND              90EE90
COLHEIGH            A
COLOCPD             1746
COLPCOL             FF00
COLPOSX             194E
COLPOSY             1950
COLWIDTH            A
CONTINU             10DC
DER                 10B0
DIVX                16BC
DIVY                16D0
DONEPLOT            18BA
DWN                 10D4
ENDDIVX             16CC
ENDDIVY             16E0
ENDMULTX            1796
ENDMULTY            17A8
ESTDCBZ             1C5C
ESTDCLDS            195C
FIN                 12FA
FINUPD              147E
FONPLOT             17CC
GENPOSMNZ           15B2
HEADINIT            1216
HEADPLOT            1300
HEADUPD             1244
IZQ                 10C8
JGOPNTS             1958
KBDDOWN             28
KBDEDGE             1C5E
KBDINIT             1066
KBDLEFT             25
KBDRIGHT            27
KBDUP               26
KBDUPD              1074
KBDVAL              1C5D
LASTKEY             1C60
LNGINI              1
MARKMNZ             14E8
MAXSGM              1
MCLDVCIA            171A
MNZFCOL             FF
MNZHEIGH            14
MNZOCPD             175C
MNZPCOL             AAFF
MNZPOSX             1942
MNZPOSY             1944
MNZWIDTH            14
MTZINIT             163A
MTZPLOT             1874
MTZUPD              180A
MTZUPD:CLNCLDS      1818
MULTLOOPX           1788
MULTLOOPY           179A
NEWMNZ              1526
NOCOL               12E2
NUMCLMNS            20
NUMFILAS            18
OJOFCOL             FFFFFF
OJOHEIGH            A
OJOPCOL             0
OJOWIDTH            A
PANHEIGH            1E0
PANWIDTH            280
PLOTAPPLE           18DE
PLOTCBZ             18C6
PLOTCLDS            188E
PLOTCOL             18D2
PLOTSEG             18D8
PLOTVAC             18CC
PNTSFCOL            0
PNTSTEXT            65
RSTCLD              1706
SCOINIT             15E4
SCOPLOT             1606
SCOPLOT:TXT1        1630
SCOUPD              15EC
SCRINIT             101E
SCRPLOT             104C
SEGINIT             1384
SEGPLOT             13E4
SEGUPD              1396
SGMFCOL             AA00
SGMHEIGH            14
SGMOCPD             1730
SGMPCOL             FF00
SGMPOSX             1952
SGMPOSY             1954
SGMWIDTH            14
SIGABA              12AE
SIGARR              1296
SIGDER              128A
SIGIZQ              12A2
SIZECLDA            14
START               18E4
START:LOOP          1908
SYSINIT             1000
TAILINIT            1424
TAILPLOT            1484
TAILUPD             1436
TCELDAS             300
TRZPLOT             1956
UTLINIT             10E2
UTLRAND             10F8
UTLRAND:RANDVEC     1116
UTLRNDIX            195A
