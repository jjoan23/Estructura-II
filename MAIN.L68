00001970 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 29/12/2024 12:30:35

00000000                             1  *-----------------------------------------------------------------------------
00000000                             2  * Title      : MAIN
00000000                             3  * Written by :
00000000                             4  * Date       :
00000000                             5  * Description:
00000000                             6  *-----------------------------------------------------------------------------
00000000                             7  
00001000                             8              ORG    $1000
00001000                             9              
00001000                            10              INCLUDE 'CONST.X68'
00001000                            11  ; ----------------------------------------------------------------------------
00001000                            12  ; CONSTANTES DEL JUEGO
00001000                            13  ; ----------------------------------------------------------------------------
00001000                            14     
00001000                            15  ; --- CONSTANTES DE LA MANZANA -----------------------------------------------
00001000                            16  
00001000  =00000014                 17  MNZWIDTH    EQU     20                      ; ANCHURA DE LA MANZANA (a determinar)
00001000  =00000014                 18  MNZHEIGH    EQU     20                      ; ALTURA DE LA MANZANA (a determinar)
00001000  =0000AAFF                 19  MNZPCOL     EQU     $0000AAFF               ; COLOR CONTORNO MANZANA (a determinar)
00001000  =000000FF                 20  MNZFCOL     EQU     $000000FF               ; COLOR RELLENO MANZANA (a determinar)
00001000                            21  
00001000                            22  ; --- CONSTANTES DE LA SERPIENTE ---------------------------------------------
00001000                            23  
00001000  =00000001                 24  MAXSGM      EQU     1                       ; TAMAÑO MÁXIMO DE SEGMENTOS (a determinar)
00001000  =00000001                 25  LNGINI      EQU     1                       ; LONGITUD INICIAL SERPIENTE (a determinar)
00001000  =00000014                 26  CBZVEL      EQU     20                      ; VELOCIDAD DE LA CABEZA (a determinar)
00001000  =00000014                 27  SGMWIDTH    EQU     20                      ; ANCHURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 28  SGMHEIGH    EQU     20                      ; ALTURA DE UN SEGMENTO (PROVISIONAL)
00001000  =0000FF00                 29  SGMPCOL     EQU     $0000FF00               ; COLOR CONTORNO SEGMENTO (PROVISIONAL)
00001000  =0000AA00                 30  SGMFCOL     EQU     $0000AA00               ; COLOR RELLENO SEGMENTO (PROVISIONAL)
00001000  =0000000A                 31  COLWIDTH    EQU     10                      ; ANCHURA DE LA COLA (PROVISIONAL)
00001000  =0000000A                 32  COLHEIGH    EQU     10                      ; ALTURA DE LA COLA (PROVISIONAL)
00001000  =0000FF00                 33  COLPCOL     EQU     $0000FF00               ; COLOR CONTORNO COLA (PROVISIONAL)
00001000  =0000AA00                 34  COLFCOL     EQU     $0000AA00               ; COLOR RELLENO COLA (PROVISIONAL)
00001000  =00000014                 35  CBZWIDTH    EQU     20                      ; ANCHURA DE LA CABEZA (PROVISIONAL)
00001000  =00000014                 36  CBZHEIGH    EQU     20                      ; ALTURA DE LA CABEZA (PROVISIONAL)
00001000  =0000FF00                 37  CBZPCOL     EQU     $0000FF00               ; COLOR CONTORNO CABEZA (PROVISIONAL)
00001000  =0000AA00                 38  CBZFCOL     EQU     $0000AA00               ; COLOR RELLENO CABEZA (PROVISIONAL)
00001000  =0000000A                 39  OJOWIDTH    EQU     10                      ; ANCHURA DE OJO DE SERPIENTE
00001000  =0000000A                 40  OJOHEIGH    EQU     10                      ; ALTURA DE OJO DE SERPIENTE
00001000  =00000000                 41  OJOPCOL     EQU     $00000000               ; COLOR CONTORNO OJO
00001000  =00FFFFFF                 42  OJOFCOL     EQU     $00FFFFFF               ; COLOR RELLENO OJO
00001000                            43  
00001000                            44  
00001000                            45  
00001000                            46  ; --- CONSTANTES MARCADOR ----------------------------------------------------
00001000                            47  
00001000  =00000000                 48  PNTSFCOL    EQU     $00000000               ; COLOR FONDO MARCADOR (a determinar)
00001000  =00000065                 49  PNTSTEXT    EQU     0101                    ; COORDENADAS DEL MARCADOR (a determinar)
00001000                            50  
00001000                            51  
00001000                            52  
00001000                            53  
00001000                            54  
00001000                            55  
00001000                            56  
00001000                            57  
00001000                            58  
00001000                            59  -------------------- end include --------------------
00001000                            60              INCLUDE 'SYSCONST.X68'
00001000                            61  ; ----------------------------------------------------------------------------
00001000                            62  ; CONSTANTES DEL SISTEMA
00001000                            63  ; ----------------------------------------------------------------------------
00001000                            64  
00001000                            65  ; ---CONSTANTES DE LA PANTALLA------------------------------------------------
00001000                            66  
00001000  =00000280                 67  PANWIDTH    EQU     640                     ; ANCHO DE LA PANTALLA
00001000  =000001E0                 68  PANHEIGH    EQU     480                     ; ALTURA DE LA PANTALLA
00001000  =0090EE90                 69  COLFND      EQU     $90EE90                 ; COLOR DEL FONDO DE LA PANTALLA
00001000                            70  
00001000                            71  ; ---CONSTANTES DE LA MATRIZ--------------------------------------------------
00001000                            72  
00001000  =00000014                 73  SIZECLDA    EQU     20                      ; TAMAÑO DE CADA CELDA EN PIXELES
00001000  =00000020                 74  NUMCLMNS    EQU     32                      ; COLUMNAS DE CELDAS (640/10)
00001000  =00000018                 75  NUMFILAS    EQU     24                      ; FILAS DE CELDAS (480/10)
00001000  =00000300                 76  TCELDAS     EQU     768                     ; TOTAL DE CELDAS (64 * 48)
00001000                            77  
00001000                            78  ; ---CÓDIGOS DE TECLADO-------------------------------------------------------
00001000                            79  
00001000  =00000025                 80  KBDLEFT     EQU     $25
00001000  =00000026                 81  KBDUP       EQU     $26
00001000  =00000027                 82  KBDRIGHT    EQU     $27
00001000  =00000028                 83  KBDDOWN     EQU     $28
00001000                            84  
00001000                            85  
00001000                            86  -------------------- end include --------------------
00001000                            87              INCLUDE 'SYSTEM.X68'
00001000                            88   
00001000                            89   
00001000                            90  SYSINIT
00001000                            91  ; INICIA EL  SISTEMA
00001000                            92  ; INPUT    : NONE
00001000                            93  ; OUTPUT   : NONE
00001000                            94  ; MODIFIES : NONE
00001000                            95  ; ----------------------------------------------------------------------------
00001000                            96              
00001000  21FC 00001072 0080        97              MOVE.L  #SCRPLOT,($80)
00001008  21FC 0000109A 0084        98              MOVE.L  #KBDUPD,($84)
00001010  21FC 0000106A 0064        99              MOVE.L  #SCRTIM,($64)
00001018                           100              
00001018  4EB9 00001026            101              JSR     SCRINIT
0000101E  40E7                     102              MOVE.W  SR,-(A7)
00001020  0257 D8FF                103              ANDI.W  #$D8FF,(A7)
00001024                           104              
00001024  4E73                     105              RTE
00001026                           106              
00001026                           107  ; ------------------------------------------------------------------------------
00001026                           108  SCRINIT
00001026                           109  ; INIT SCREEN. SET SCREEN RESOLUTION, SET WINDOWED MODE, CLEAR SCREEN,
00001026                           110  ; ENABLE DOUBLE BUFFER, ENABLED TIMED INTERRUPT.
00001026                           111  ; INPUT    : NONE
00001026                           112  ; OUTPUT   : NONE
00001026                           113  ; MODIFIES : NONE
00001026                           114  ; ------------------------------------------------------------------------------
00001026                           115  
00001026  48E7 C000                116              MOVEM.L D0-D1,-(A7)
0000102A                           117  
0000102A                           118              ; SET SCREEN RESOLUTION
0000102A  103C 0021                119              MOVE.B  #33,D0
0000102E  223C 028001E0            120              MOVE.L  #PANWIDTH<<16|PANHEIGH,D1
00001034  4E4F                     121              TRAP    #15
00001036                           122              
00001036                           123              ; SET WINDOWED MODE
00001036  7201                     124              MOVE.L  #1,D1
00001038  4E4F                     125              TRAP    #15
0000103A                           126              
0000103A                           127              ; CLEAR SCREEN
0000103A  103C 000B                128              MOVE.B  #11,D0
0000103E  323C FF00                129              MOVE.W  #$FF00,D1
00001042  4E4F                     130              TRAP    #15
00001044                           131              
00001044                           132              ; ENABLE DOUBLE BUFFER
00001044  103C 005C                133              MOVE.B  #92,D0
00001048  123C 0011                134              MOVE.B  #17,D1
0000104C  4E4F                     135              TRAP    #15
0000104E                           136              
0000104E                           137              ; ENABLE TIMED INTERRUPT
0000104E  103C 0020                138              MOVE.B  #32,D0
00001052  123C 0006                139              MOVE.B  #6,D1
00001056  143C 0081                140              MOVE.B  #$81,D2
0000105A  7614                     141              MOVE.L  #20,D3                  ; CON 20 SE CONSIUGUEN 50 FPS
0000105C  4E4F                     142              TRAP    #15
0000105E                           143              
0000105E                           144              ; CLEAR INTERRUPT COUNTER
0000105E  4239 00001CFC            145              CLR.B   (SCRINTCT)
00001064                           146              
00001064  4CDF 0003                147              MOVEM.L (A7)+,D0-D1
00001068                           148              
00001068  4E75                     149              RTS    
0000106A                           150              
0000106A                           151  ; ------------------------------------------------------------------------------
0000106A                           152  SCRTIM
0000106A                           153  ; TIMED INTERRUPT SERVICE ROUTINE
0000106A                           154  ; INPUT    : NONE
0000106A                           155  ; OUTPUT   : NONE
0000106A                           156  ; MODIFIES : NONE
0000106A                           157  ; ------------------------------------------------------------------------------
0000106A  5239 00001CFC            158              ADDQ.B  #1,(SCRINTCT)
00001070  4E73                     159              RTE
00001072                           160              
00001072                           161  
00001072                           162  ; ------------------------------------------------------------------------------
00001072                           163  SCRPLOT
00001072                           164  ; UPDATES DOUBLE BUFFER
00001072                           165  ; INPUT    : NONE
00001072                           166  ; OUTPUT   : NONE
00001072                           167  ; MODIFIES : NONE
00001072                           168  ; ------------------------------------------------------------------------------
00001072                           169  
00001072  48A7 C000                170              MOVEM.W D0-D1,-(A7)
00001076                           171              
00001076                           172              ; SWITCH BUFFERS
00001076  103C 005E                173              MOVE.B  #94,D0
0000107A  4E4F                     174              TRAP    #15
0000107C                           175              
0000107C                           176              ; CLEAR HIDDEN BUFFER
0000107C  103C 000B                177              MOVE.B  #11,D0
00001080  323C FF00                178              MOVE.W  #$FF00,D1
00001084  4E4F                     179              TRAP    #15
00001086                           180              
00001086  4C9F 0003                181              MOVEM.W (A7)+,D0-D1
0000108A                           182              
0000108A  4E73                     183              RTE
0000108C                           184          
0000108C                           185  ; ------------------------------------------------------------------------------
0000108C                           186  KBDINIT
0000108C                           187  ; INIT KEYBOARD
0000108C                           188  ; INPUT    : NONE
0000108C                           189  ; OUTPUT   : NONE
0000108C                           190  ; MODIFIES : NONE
0000108C                           191  ; ------------------------------------------------------------------------------
0000108C                           192  
0000108C  4239 00001CF5            193              CLR.B   (KBDVAL)
00001092  4239 00001CF6            194              CLR.B   (KBDEDGE)
00001098  4E75                     195              RTS
0000109A                           196  
0000109A                           197  ; ------------------------------------------------------------------------------
0000109A                           198  KBDUPD
0000109A                           199  ; UPDATE KEYBOARD INFO.  
0000109A                           200  ; 7 -> PAUSE
0000109A                           201  ; 6 -> FIRE 3
0000109A                           202  ; 5 -> FIRE 2
0000109A                           203  ; 4 -> FIRE 1
0000109A                           204  ; 3 -> DOWN
0000109A                           205  ; 2 -> RIGHT
0000109A                           206  ; 1 -> UP
0000109A                           207  ; 0 -> LEFT
0000109A                           208  ; INPUT    : NONE
0000109A                           209  ; OUTPUT   : NONE
0000109A                           210  ; MODIFIES : NONE
0000109A                           211  ; ------------------------------------------------------------------------------
0000109A                           212  
0000109A  48E7 C000                213              MOVEM.L D0-D1,-(A7)
0000109E                           214  
0000109E                           215              ; LEE ESTADO DEL TECLADO
0000109E  103C 0013                216              MOVE.B  #19,D0
000010A2  223C 25262728            217              MOVE.L  #KBDLEFT<<24|KBDUP<<16|KBDRIGHT<<8|KBDDOWN,D1
000010A8  4E4F                     218              TRAP    #15                  ; Lee las teclas y guarda en D1
000010AA                           219  
000010AA  B2BC 000000FF            220              CMP.L   #$000000FF,D1
000010B0  6700 0048                221              BEQ     DWN
000010B4  B2BC 0000FF00            222              CMP.L   #$0000FF00,D1
000010BA  6700 001A                223              BEQ     DER
000010BE  B2BC 00FF0000            224              CMP.L   #$00FF0000,D1
000010C4  6700 001C                225              BEQ     ARR
000010C8  B2BC FF000000            226              CMP.L   #$FF000000,D1
000010CE  6700 001E                227              BEQ     IZQ
000010D2                           228  
000010D2                           229              ; Si no hay pulsaciones, mantener estado
000010D2  6000 002E                230              BRA     CONTINU
000010D6                           231  
000010D6  33FC 0000 00001CF4       232  DER:        MOVE.W  #0,(ESTDCBZ)           ; Actualiza estado a DERECHA
000010DE  6000 0022                233              BRA     CONTINU
000010E2                           234              
000010E2  33FC 0001 00001CF4       235  ARR:        MOVE.W  #1,(ESTDCBZ)           ; Actualiza estado a ARRIBA
000010EA  6000 0016                236              BRA     CONTINU
000010EE                           237  
000010EE  33FC 0002 00001CF4       238  IZQ:        MOVE.W  #2,(ESTDCBZ)           ; Actualiza estado a IZQUIERDA
000010F6  6000 000A                239              BRA     CONTINU                    
000010FA                           240  
000010FA  33FC 0003 00001CF4       241  DWN:        MOVE.W  #3,(ESTDCBZ)           ; Actualiza estado a ABAJO
00001102                           242  
00001102                           243  CONTINU:
00001102  4CDF 0003                244              MOVEM.L (A7)+,D0-D1
00001106  4E73                     245              RTE
00001108                           246              
00001108                           247  ; RESIDUOS CODIGO ANTERIOR 
00001108                           248  
00001108                           249              ;MOVE.B  D2,(KBDVAL)
00001108                           250              
00001108                           251  
00001108                           252  
00001108                           253  
00001108                           254  
00001108                           255  ; CODIGO ANTERIOR ANTERIOR
00001108                           256  
00001108                           257  
00001108                           258  
00001108                           259  
00001108                           260  
00001108                           261  
00001108                           262  
00001108                           263  
00001108                           264  
00001108                           265  
00001108                           266  
00001108                           267  
00001108                           268  
00001108                           269  
00001108                           270  
00001108                           271  
00001108                           272  
00001108                           273  
00001108                           274  
00001108                           275  
00001108                           276  
00001108                           277  
00001108                           278  
00001108                           279  
00001108                           280  
00001108                           281  
00001108                           282  
00001108                           283  
00001108                           284  
00001108                           285  
00001108                           286  
00001108                           287  
00001108                           288  
00001108                           289  
00001108                           290  
00001108                           291  
00001108                           292  
00001108                           293  
00001108                           294  
00001108                           295  -------------------- end include --------------------
00001108                           296              INCLUDE 'LIB/UTLCODE.X68'
00001108                           297  ; =============================================================================
00001108                           298  ; UTILITY CODE
00001108                           299  ; =============================================================================
00001108                           300  
00001108                           301  ; -----------------------------------------------------------------------------
00001108                           302  UTLINIT
00001108                           303  ; INITIALIZES UTILITY CODE
00001108                           304  ; INPUT    - NONE
00001108                           305  ; OUTPUT   - NONE
00001108                           306  ; MODIFIES - NONE
00001108                           307  ; -----------------------------------------------------------------------------
00001108  48E7 C000                308              MOVEM.L D0-D1,-(A7)
0000110C  103C 0008                309              MOVE.B  #8,D0
00001110  4E4F                     310              TRAP    #15
00001112  13C1 000019F2            311              MOVE.B  D1,(UTLRNDIX)
00001118  4CDF 0003                312              MOVEM.L (A7)+,D0-D1
0000111C  4E75                     313              RTS
0000111E                           314  
0000111E                           315  ; -----------------------------------------------------------------------------
0000111E                           316  UTLRAND
0000111E                           317  ; PROVIDES A PSEUDO-RANDOM BYTE
0000111E                           318  ; INPUT    - NONE
0000111E                           319  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
0000111E                           320  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000111E                           321  ; -----------------------------------------------------------------------------
0000111E  2F08                     322              MOVE.L  A0,-(A7)
00001120  41F9 0000113C            323              LEA     .RANDVEC,A0
00001126  4280                     324              CLR.L   D0
00001128  1039 000019F2            325              MOVE.B  (UTLRNDIX),D0
0000112E  1030 0800                326              MOVE.B  (A0,D0.L),D0
00001132  5239 000019F2            327              ADDQ.B  #1,(UTLRNDIX)
00001138  205F                     328              MOVE.L  (A7)+,A0
0000113A  4E75                     329              RTS
0000113C                           330  
0000113C                           331  
0000113C= A2 EE 9A 0C F5 24 ...    332  .RANDVEC    DC.B    162, 238, 154, 12 , 245, 36 , 32 , 103
00001144= 2A A3 51 26 E0 AC ...    333              DC.B    42 , 163, 81 , 38 , 224, 172, 19 , 69
0000114C= 75 51 CA FD 33 EB ...    334              DC.B    117, 81 , 202, 253, 51 , 235, 108, 154
00001154= 60 CC E7 B8 9A EB ...    335              DC.B    96 , 204, 231, 184, 154, 235, 34 , 203
0000115C= 1D 76 B5 95 B0 89 ...    336              DC.B    29 , 118, 181, 149, 176, 137, 62 , 108
00001164= 39 15 48 C9 6E CA ...    337              DC.B    57 , 21 , 72 , 201, 110, 202, 159, 41
0000116C= 43 E7 E2 7C 37 25 ...    338              DC.B    67 , 231, 226, 124, 55 , 37 , 84 , 62
00001174= E9 94 CE E9 E4 52 ...    339              DC.B    233, 148, 206, 233, 228, 82 , 243, 78
0000117C= 37 6D 9A 84 A2 28 ...    340              DC.B    55 , 109, 154, 132, 162, 40 , 30 , 39
00001184= 19 E2 C6 77 80 D4 ...    341              DC.B    25 , 226, 198, 119, 128, 212, 232, 225
0000118C= 0A 5A 32 67 33 C2 ...    342              DC.B    10 , 90 , 50 , 103, 51 , 194, 222, 40
00001194= 59 80 DC 0E 57 FC ...    343              DC.B    89 , 128, 220, 14 , 87 , 252, 243, 252
0000119C= 8A AB BC F7 07 4D ...    344              DC.B    138, 171, 188, 247, 7  , 77 , 29 , 234
000011A4= EF D5 77 6E 1E BB ...    345              DC.B    239, 213, 119, 110, 30 , 187, 131, 23
000011AC= D6 E0 2A 8F BD 28 ...    346              DC.B    214, 224, 42 , 143, 189, 40 , 212, 130
000011B4= 13 4F 66 EC 0A 64 ...    347              DC.B    19 , 79 , 102, 236, 10 , 100, 122, 188
000011BC= 56 52 9A 16 9B 90 ...    348              DC.B    86 , 82 , 154, 22 , 155, 144, 7  , 199
000011C4= 06 8A A4 F7 01 DA ...    349              DC.B    6  , 138, 164, 247, 1  , 218, 166, 82
000011CC= F2 E7 77 28 B1 76 ...    350              DC.B    242, 231, 119, 40 , 177, 118, 220, 102
000011D4= A4 42 E3 81 B1 67 ...    351              DC.B    164, 66 , 227, 129, 177, 103, 165, 108
000011DC= BF CE FA 16 BF 38 ...    352              DC.B    191, 206, 250, 22 , 191, 56 , 30 , 161
000011E4= D1 8B 50 0C 5F 49 ...    353              DC.B    209, 139, 80 , 12 , 95 , 73 , 168, 56
000011EC= DE 4C 14 A2 40 DC ...    354              DC.B    222, 76 , 20 , 162, 64 , 220, 93 , 12
000011F4= B6 9B 0A 38 5D AB ...    355              DC.B    182, 155, 10 , 56 , 93 , 171, 89 , 6
000011FC= E2 1B DD 75 15 82 ...    356              DC.B    226, 27 , 221, 117, 21 , 130, 101, 18
00001204= 8A 26 51 30 9F 47 ...    357              DC.B    138, 38 , 81 , 48 , 159, 71 , 57 , 21
0000120C= 1E 8A BB 71 C6 6E ...    358              DC.B    30 , 138, 187, 113, 198, 110, 185, 152
00001214= 9F 47 E5 34 94 27 ...    359              DC.B    159, 71 , 229, 52 , 148, 39 , 77 , 6
0000121C= 7D 06 D6 BA 30 0F ...    360              DC.B    125, 6  , 214, 186, 48 , 15 , 212, 22
00001224= EC 7F 7E 03 CF 2D ...    361              DC.B    236, 127, 126, 3  , 207, 45 , 193, 2
0000122C= 94 5B 23 F2 8B CD ...    362              DC.B    148, 91 , 35 , 242, 139, 205, 248, 237
00001234= 74 33 EC B9 0F D5 ...    363              DC.B    116, 51 , 236, 185, 15 , 213, 221, 6
00001234= 74 33 EC B9 0F D5 ...    364  -------------------- end include --------------------
0000123C                           365              INCLUDE 'HEADSRP.X68'
0000123C                           366  
0000123C                           367  ; ------------------------------------------------------------------------------
0000123C                           368  HEADINIT
0000123C                           369  ; INICIALIZAR CABEZA.
0000123C                           370  ; INPUT    : NONE 
0000123C                           371  ; OUTPUT   : NONE
0000123C                           372  ; MODIFIES : NONE
0000123C                           373  ; ------------------------------------------------------------------------------
0000123C  33FC 0140 000019DC       374              MOVE.W  #PANWIDTH/2,(CBZPOSX)
00001244  33FC 00F0 000019DE       375              MOVE.W  #PANHEIGH/2,(CBZPOSY)
0000124C                           376              ;ADD.W   #20,(CBZVEL)
0000124C  4279 00001CF4            377              CLR.W   (ESTDCBZ)
00001252  33FC 0000 00001CF4       378              MOVE.W  #0,(ESTDCBZ)
0000125A  4E75                     379              RTS
0000125C                           380              
0000125C                           381  ; ------------------------------------------------------------------------------
0000125C                           382  HEADUPD
0000125C                           383  ; ACTUALIZAR CABEZA.
0000125C                           384  ; INPUT    : NONE 
0000125C                           385  ; OUTPUT   : NONE
0000125C                           386  ; MODIFIES : NONE
0000125C                           387  ; ------------------------------------------------------------------------------
0000125C                           388  
0000125C  48A7 E000                389              MOVEM.W D0-D2,-(A7)
00001260                           390  
00001260                           391              ; Marcar celda actual como vacía
00001260  3239 000019DC            392              MOVE.W  (CBZPOSX),D1
00001266  3439 000019DE            393              MOVE.W  (CBZPOSY),D2
0000126C  4EB9 00001744            394              JSR     CINDMTRZ
00001272  4EB9 00001794            395              JSR     MCLDVCIA
00001278                           396              
00001278                           397              
00001278                           398              ; Actualiza la posición de la cabeza según ESTDCBZ
00001278  3039 00001CF4            399              MOVE.W  (ESTDCBZ),D0
0000127E  B07C 0000                400              CMP.W   #0,D0
00001282  6700 001E                401              BEQ     SIGDER
00001286  B07C 0001                402              CMP.W   #1,D0
0000128A  6700 0022                403              BEQ     SIGARR
0000128E  B07C 0002                404              CMP.W   #2,D0
00001292  6700 0026                405              BEQ     SIGIZQ
00001296  B07C 0003                406              CMP.W   #3,D0
0000129A  6700 002A                407              BEQ     SIGABA
0000129E                           408  
0000129E                           409              ; Si no hay dirección válida, sale
0000129E  6000 0072                410              BRA     FIN
000012A2                           411  
000012A2                           412  SIGDER:
000012A2  0679 0014 000019DC       413              ADD.W   #CBZVEL,(CBZPOSX)
000012AA  6000 0022                414              BRA     CHKCOL
000012AE                           415  
000012AE                           416  SIGARR:
000012AE  0479 0014 000019DE       417              SUB.W   #CBZVEL,(CBZPOSY)
000012B6  6000 0016                418              BRA     CHKCOL
000012BA                           419  
000012BA                           420  SIGIZQ:
000012BA  0479 0014 000019DC       421              SUB.W   #CBZVEL,(CBZPOSX)
000012C2  6000 000A                422              BRA     CHKCOL
000012C6                           423  
000012C6                           424  SIGABA:
000012C6  0679 0014 000019DE       425              ADD.W   #CBZVEL,(CBZPOSY)
000012CE                           426              
000012CE                           427  CHKCOL:
000012CE                           428              ; Verifica la colisión con la manzana
000012CE  3239 000019DC            429              MOVE.W  (CBZPOSX),D1
000012D4  3439 000019DE            430              MOVE.W  (CBZPOSY),D2
000012DA  B279 000019D8            431              CMP.W   (MNZPOSX),D1
000012E0  6600 0018                432              BNE     NOCOL
000012E4  B479 000019DA            433              CMP.W   (MNZPOSY),D2
000012EA  6600 000E                434              BNE     NOCOL
000012EE                           435              
000012EE                           436              ; Colisión detectada
000012EE  4EB9 0000156E            437              JSR     APPLEUPD
000012F4  4EB9 00001664            438              JSR     SCOUPD
000012FA                           439              ;ADDQ.W  #2,(CBZVEL)
000012FA                           440  
000012FA                           441  NOCOL:
000012FA                           442              ; Convierte la posición nueva a índice
000012FA  3239 000019DC            443              MOVE.W  (CBZPOSX),D1
00001300  3439 000019DE            444              MOVE.W  (CBZPOSY),D2
00001306  4EB9 00001744            445              JSR     CINDMTRZ
0000130C  4EB9 0000177E            446              JSR     CBZOCPD                 ; Marca la celda como ocupada
00001312                           447  
00001312                           448  
00001312                           449  FIN:
00001312  4C9F 0007                450              MOVEM.W (A7)+,D0-D2
00001316                           451  
00001316  4E75                     452              RTS
00001318                           453              
00001318                           454  ; ------------------------------------------------------------------------------
00001318                           455  HEADPLOT
00001318                           456  ; DIBUJAR CABEZA.
00001318                           457  ; INPUT    : NONE 
00001318                           458  ; OUTPUT   : NONE
00001318                           459  ; MODIFIES : NONE
00001318                           460  ; ------------------------------------------------------------------------------
00001318                           461                         
00001318  3F00                     462              MOVE.W  D0,-(A7)               ; GUARDAMOS D0
0000131A  3003                     463              MOVE.W  D3,D0                  ; PONEMOS EL INDICE DE LA CELDA EN D0 PARA CALCULAR SUS COORDENADAS
0000131C  4EB9 000017EC            464              JSR     CNVICOOR
00001322  2F01                     465              MOVE.L  D1,-(A7)
00001324                           466              
00001324                           467              ; SET COLOR DEL CONTORNO CABEZA
00001324  103C 0050                468              MOVE.B  #80,D0
00001328  223C 0000FF00            469              MOVE.L  #CBZPCOL,D1
0000132E  4E4F                     470              TRAP    #15
00001330                           471              
00001330                           472              ; SET COLOR DEL RELLENO CABEZA
00001330  103C 0051                473              MOVE.B  #81,D0
00001334  223C 0000AA00            474              MOVE.L  #CBZFCOL,D1
0000133A  4E4F                     475              TRAP    #15
0000133C                           476              
0000133C                           477              ; DIBUJAR CABEZA
0000133C  103C 0057                478              MOVE.B  #87,D0
00001340  221F                     479              MOVE.L  (A7)+,D1
00001342  3F03                     480              MOVE.W  D3,-(A7)
00001344  3601                     481              MOVE.W  D1,D3
00001346  0643 0014                482              ADD.W   #CBZWIDTH,D3
0000134A  3802                     483              MOVE.W  D2,D4
0000134C  0644 0014                484              ADD.W   #CBZHEIGH,D4
00001350  4E4F                     485              TRAP    #15
00001352                           486              
00001352  2F01                     487              MOVE.L  D1,-(A7)
00001354                           488              
00001354                           489              ; SET COLOR DEL CONTORNO OJO
00001354  103C 0050                490              MOVE.B  #80,D0
00001358  7200                     491              MOVE.L  #OJOPCOL,D1
0000135A  4E4F                     492              TRAP    #15
0000135C                           493              
0000135C                           494              ; SET COLOR DEL RELLENO OJO
0000135C  103C 0051                495              MOVE.B  #81,D0
00001360  223C 00FFFFFF            496              MOVE.L  #OJOFCOL,D1
00001366  4E4F                     497              TRAP    #15
00001368                           498              
00001368                           499              ; DIBUJAR OJO
00001368  103C 0058                500              MOVE.B  #88,D0
0000136C  221F                     501              MOVE.L  (A7)+,D1
0000136E  2F01                     502              MOVE.L  D1,-(A7)
00001370  2F02                     503              MOVE.L  D2,-(A7)
00001372  5A41                     504              ADD.W   #OJOWIDTH/2,D1            
00001374  3601                     505              MOVE.W  D1,D3
00001376  0643 000A                506              ADD.W   #OJOWIDTH,D3
0000137A  5A42                     507              ADD.W   #OJOHEIGH/2,D2
0000137C  3802                     508              MOVE.W  D2,D4
0000137E  0644 000A                509              ADD.W   #OJOHEIGH,D4
00001382  4E4F                     510              TRAP    #15                     ; DIBUJAMOS EL PRIMER OJO
00001384                           511              
00001384                           512  
00001384                           513              ; DEFINIR COORDENADAS IRIS
00001384  241F                     514              MOVE.L  (A7)+,D2
00001386  221F                     515              MOVE.L  (A7)+,D1
00001388  0641 000A                516              ADD.W   #OJOWIDTH,D1
0000138C  0642 000A                517              ADD.W   #OJOHEIGH,D2
00001390  103C 0052                518              MOVE.B  #82,D0
00001394  4E4F                     519              TRAP    #15                     ; DIBUJAMOS EL PRIMER IRIS
00001396                           520              
00001396  361F                     521              MOVE.W  (A7)+,D3
00001398  301F                     522              MOVE.W  (A7)+,D0
0000139A                           523  
0000139A  4E75                     524              RTS
0000139C                           525  
0000139C                           526  
0000139C                           527  
0000139C                           528  
0000139C                           529  
0000139C                           530  
0000139C                           531  
0000139C                           532  
0000139C                           533  
0000139C                           534  
0000139C                           535  
0000139C                           536  
0000139C                           537  
0000139C                           538  
0000139C                           539  
0000139C                           540  
0000139C                           541  
0000139C                           542  
0000139C                           543  
0000139C                           544  
0000139C                           545  
0000139C                           546  
0000139C                           547  
0000139C                           548  
0000139C                           549  
0000139C                           550  
0000139C                           551  
0000139C                           552  
0000139C                           553  
0000139C                           554  
0000139C                           555  
0000139C                           556  
0000139C                           557  
0000139C                           558  
0000139C                           559  
0000139C                           560  
0000139C                           561  
0000139C                           562  
0000139C                           563  -------------------- end include --------------------
0000139C                           564              INCLUDE 'SEGSRP.X68'
0000139C                           565  
0000139C                           566  ; ------------------------------------------------------------------------------
0000139C                           567  SEGINIT
0000139C                           568  ; INICIALIZAR SEGMENTO.
0000139C                           569  ; INPUT    : NONE 
0000139C                           570  ; OUTPUT   : NONE
0000139C                           571  ; MODIFIES : NONE
0000139C                           572  ; ------------------------------------------------------------------------------
0000139C  33FC 012C 000019E8       573              MOVE.W  #(PANWIDTH/2)-CBZWIDTH,(SGMPOSX)
000013A4  33FC 00F0 000019EA       574              MOVE.W  #PANHEIGH/2,(SGMPOSY)
000013AC  33F9 000019E8 000019EC   575              MOVE.W  (SGMPOSX),(SGMPOSX2)
000013B6  33F9 000019EA 000019EE   576              MOVE.W  (SGMPOSY),(SGMPOSY2)
000013C0  0479 0014 000019EC       577              SUB.W   #SGMWIDTH,(SGMPOSX2)
000013C8  4E75                     578              RTS
000013CA                           579              
000013CA                           580  ; ------------------------------------------------------------------------------
000013CA                           581  SEGUPD
000013CA                           582  ; ACTUALIZAR SEGMENTO.
000013CA                           583  ; INPUT    : NONE 
000013CA                           584  ; OUTPUT   : NONE
000013CA                           585  ; MODIFIES : NONE
000013CA                           586  ; ------------------------------------------------------------------------------
000013CA                           587  
000013CA  48A7 6000                588              MOVEM.W D1-D2,-(A7)
000013CE                           589              
000013CE                           590              ; Marcar posición anterior del segmento como vacía
000013CE  3239 000019E8            591              MOVE.W  (SGMPOSX),D1             ; Cargar posición X actual del segmento2
000013D4  3439 000019EA            592              MOVE.W  (SGMPOSY),D2             ; Cargar posición Y actual del segmento2
000013DA  4EB9 00001744            593              JSR     CINDMTRZ                ; Obtener índice de celda en D0
000013E0  4EB9 00001794            594              JSR     MCLDVCIA                ; Marcar celda como vacía
000013E6                           595              
000013E6                           596              ; Marcar posición anterior del segmento como vacía
000013E6  3239 000019EC            597              MOVE.W  (SGMPOSX2),D1             ; Cargar posición X actual del segmento2
000013EC  3439 000019EE            598              MOVE.W  (SGMPOSY2),D2             ; Cargar posición Y actual del segmento2
000013F2  4EB9 00001744            599              JSR     CINDMTRZ                ; Obtener índice de celda en D0
000013F8  4EB9 00001794            600              JSR     MCLDVCIA                ; Marcar celda como vacía
000013FE                           601              
000013FE                           602              ; Actualizar posición del segmento para seguir a la cabeza
000013FE  33F9 000019E8 000019EC   603              MOVE.W  (SGMPOSX),(SGMPOSX2)    ; MARCAMOS LOS SEGMENTOS COMO SEGUNDA COORDENADA X
00001408  33F9 000019EA 000019EE   604              MOVE.W  (SGMPOSY),(SGMPOSY2)    ; MARCAMOS LOS SEGMENTOS COMO SEGUNDA COORDENADA Y
00001412  33F9 000019DC 000019E8   605              MOVE.W  (CBZPOSX),(SGMPOSX)        ; Actualizar X del segmento con la X de la cabeza
0000141C  33F9 000019DE 000019EA   606              MOVE.W  (CBZPOSY),(SGMPOSY)        ; Actualizar Y del segmento con la Y de la cabeza
00001426                           607  
00001426                           608              ; Marcar nueva posición del segmento como ocupada
00001426  3239 000019E8            609              MOVE.W  (SGMPOSX),D1             ; Cargar nueva posición X
0000142C  3439 000019EA            610              MOVE.W  (SGMPOSY),D2             ; Cargar nueva posición Y
00001432  4EB9 00001744            611              JSR     CINDMTRZ                ; Obtener índice de celda en D0
00001438  4EB9 000017AA            612              JSR     SGMOCPD                 ; Marcar celda como ocupada por segmento
0000143E                           613              
0000143E  3239 000019EC            614              MOVE.W  (SGMPOSX2),D1             ; Cargar nueva posición X DEL SEGMENTO 2
00001444  3439 000019EE            615              MOVE.W  (SGMPOSY2),D2             ; Cargar nueva posición Y DEL SEGMENTO 2
0000144A  4EB9 00001744            616              JSR     CINDMTRZ                ; Obtener índice de celda en D0
00001450  4EB9 000017AA            617              JSR     SGMOCPD                 ; Marcar celda como ocupada por segmento
00001456                           618              
00001456  4C9F 0006                619              MOVEM.W (A7)+,D1-D2            
0000145A  4E75                     620              RTS
0000145C                           621  ;CODIGO ANTIGUO
0000145C                           622              
0000145C                           623              
0000145C                           624              
0000145C                           625  ; ------------------------------------------------------------------------------
0000145C                           626  SEGPLOT
0000145C                           627  ; DIBUJAR SEGMENTO.
0000145C                           628  ; INPUT    : NONE 
0000145C                           629  ; OUTPUT   : NONE
0000145C                           630  ; MODIFIES : NONE
0000145C                           631  ; ------------------------------------------------------------------------------
0000145C  3F00                     632              MOVE.W  D0,-(A7)
0000145E  3003                     633              MOVE.W  D3,D0
00001460  4EB9 000017EC            634              JSR     CNVICOOR
00001466  2F01                     635              MOVE.L  D1,-(A7)
00001468                           636              
00001468  103C 0050                637              MOVE.B  #80,D0
0000146C  223C 0000FF00            638              MOVE.L  #SGMPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DEL SEGMENTO
00001472  4E4F                     639              TRAP    #15
00001474                           640              
00001474  103C 0051                641              MOVE.B  #81,D0
00001478  223C 0000AA00            642              MOVE.L  #SGMFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DEL SEGMENTO
0000147E  4E4F                     643              TRAP    #15
00001480                           644              
00001480  103C 0057                645              MOVE.B  #87,D0
00001484  221F                     646              MOVE.L  (A7)+,D1
00001486  3F03                     647              MOVE.W  D3,-(A7)
00001488  3601                     648              MOVE.W  D1,D3
0000148A  0643 0014                649              ADD.W   #SIZECLDA,D3
0000148E  3802                     650              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
00001490  0644 0014                651              ADD.W   #SIZECLDA,D4
00001494  4E4F                     652              TRAP    #15                     
00001496                           653                          
00001496  361F                     654              MOVE.W  (A7)+,D3  
00001498  301F                     655              MOVE.W  (A7)+,D0
0000149A                           656  
0000149A  4E75                     657              RTS
0000149C                           658  
0000149C                           659  -------------------- end include --------------------
0000149C                           660              INCLUDE 'TAILSRP.X68'
0000149C                           661     
0000149C                           662  ; ------------------------------------------------------------------------------
0000149C                           663  TAILINIT
0000149C                           664  ; INICIALIZAR COLA.
0000149C                           665  ; INPUT    : NONE 
0000149C                           666  ; OUTPUT   : NONE
0000149C                           667  ; MODIFIES : NONE
0000149C                           668  ; ------------------------------------------------------------------------------
0000149C                           669  
0000149C  33FC 011D 000019E4       670              MOVE.W  #(PANWIDTH/2)-CBZWIDTH-SGMWIDTH+(COLWIDTH/2),(COLPOSX)
000014A4  33FC 00F0 000019E6       671              MOVE.W  #(PANHEIGH/2),(COLPOSY)
000014AC                           672              
000014AC  4E75                     673              RTS
000014AE                           674              
000014AE                           675              
000014AE                           676  ; ------------------------------------------------------------------------------
000014AE                           677  TAILUPD
000014AE                           678  ; ACTUALIZAR COLA.
000014AE                           679  ; INPUT    : NONE 
000014AE                           680  ; OUTPUT   : NONE
000014AE                           681  ; MODIFIES : NONE
000014AE                           682  ; ------------------------------------------------------------------------------
000014AE  48A7 6000                683              MOVEM.W D1-D2,-(A7)
000014B2                           684              
000014B2                           685              ; Marca la posición actual de la cola como vacía
000014B2  3239 000019E4            686              MOVE.W  (COLPOSX),D1
000014B8  3439 000019E6            687              MOVE.W  (COLPOSY),D2
000014BE  4EB9 00001744            688              JSR     CINDMTRZ
000014C4  4EB9 00001794            689              JSR     MCLDVCIA
000014CA                           690              ; Actualiza la posición de la cola para seguir al último segmento
000014CA  33F9 000019EC 000019E4   691              MOVE.W  (SGMPOSX2),(COLPOSX)
000014D4  33F9 000019EE 000019E6   692              MOVE.W  (SGMPOSY2),(COLPOSY)    ; MARCAMOS LA COOORDENADA DE LA COLA COMO COORDENADA DEL SEGMENTO 2
000014DE                           693              ; Marca la nueva posición como cola
000014DE  3239 000019E4            694              MOVE.W  (COLPOSX),D1
000014E4  3439 000019E6            695              MOVE.W  (COLPOSY),D2
000014EA  4EB9 00001744            696              JSR     CINDMTRZ
000014F0  4EB9 000017C0            697              JSR     COLOCPD
000014F6                           698  
000014F6                           699  FINUPD
000014F6  4C9F 0006                700              MOVEM.W (A7)+,D1-D2
000014FA  4E75                     701              RTS
000014FC                           702              
000014FC                           703  ; ------------------------------------------------------------------------------
000014FC                           704  TAILPLOT
000014FC                           705  ; DIBUJAR COLA
000014FC                           706  ; INPUT    : NONE 
000014FC                           707  ; OUTPUT   : NONE
000014FC                           708  ; MODIFIES : NONE
000014FC                           709  ; ------------------------------------------------------------------------------
000014FC                           710  
000014FC  3F00                     711              MOVE.W  D0,-(A7)
000014FE  3003                     712              MOVE.W  D3,D0
00001500  4EB9 000017EC            713              JSR     CNVICOOR
00001506  2F01                     714              MOVE.L  D1,-(A7)
00001508                           715              
00001508  103C 0050                716              MOVE.B  #80,D0
0000150C  223C 0000FF00            717              MOVE.L  #COLPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA COLA
00001512  4E4F                     718              TRAP    #15
00001514                           719              
00001514  103C 0051                720              MOVE.B  #81,D0
00001518  223C 0000AA00            721              MOVE.L  #COLFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA COLA
0000151E  4E4F                     722              TRAP    #15
00001520                           723              
00001520  103C 0057                724              MOVE.B  #87,D0
00001524  221F                     725              MOVE.L  (A7)+,D1
00001526  3F03                     726              MOVE.W  D3,-(A7)
00001528  3601                     727              MOVE.W  D1,D3
0000152A  0643 0014                728              ADD.W   #SIZECLDA,D3
0000152E  3802                     729              MOVE.W  D2,D4                    
00001530  0644 0014                730              ADD.W   #SIZECLDA,D4
00001534  4E4F                     731              TRAP    #15                    ; DIBUJAMOS EL CUADRADO 
00001536                           732                          
00001536  361F                     733              MOVE.W  (A7)+,D3  
00001538  301F                     734              MOVE.W  (A7)+,D0
0000153A                           735  
0000153A  4E75                     736              RTS
0000153C                           737  
0000153C                           738  
0000153C                           739  -------------------- end include --------------------
0000153C                           740              INCLUDE 'APPLE.X68'
0000153C                           741     
0000153C                           742  ; ------------------------------------------------------------------------------
0000153C                           743  APPLEINIT
0000153C                           744  ; Inicializa la manzana en una posición aleatoria
0000153C                           745  ; INPUT    : NONE 
0000153C                           746  ; OUTPUT   : NONE
0000153C                           747  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
0000153C                           748  ; ------------------------------------------------------------------------------
0000153C                           749  
0000153C                           750              ; Llama a la función para generar la posición aleatoria
0000153C  4EB9 0000162A            751              JSR     GENPOSMNZ
00001542                           752  
00001542                           753              ; Convierte las coordenadas de la manzana a índice de la matriz
00001542  4EB9 00001744            754              JSR     CINDMTRZ
00001548                           755  
00001548                           756              ; Verifica si la celda está ocupada o libre
00001548                           757  CHECK:
00001548  4EB9 00001828            758              JSR     CHECKCLD
0000154E  6700 0010                759              BEQ     MARKMNZ                  ; Si está libre
00001552                           760  
00001552                           761              ; Si la celda está ocupada
00001552  4EB9 0000162A            762              JSR     GENPOSMNZ                ; Genera una nueva posición
00001558  4EB9 00001744            763              JSR     CINDMTRZ                 ; Convierte las nuevas coordenadas
0000155E  60E8                     764              BRA     CHECK                    ; Repite la comprobación
00001560                           765  
00001560                           766  MARKMNZ:
00001560                           767              ; Marca la celda como ocupada con la manzana (estado 4)
00001560  4EB9 000017D6            768              JSR     MNZOCPD
00001566                           769  
00001566                           770              ; Dibuja la manzana en la pantalla
00001566  4EB9 000015AC            771              JSR     APPLEPLOT
0000156C                           772  
0000156C  4E75                     773              RTS
0000156E                           774  
0000156E                           775  ; ------------------------------------------------------------------------------
0000156E                           776  APPLEUPD
0000156E                           777  ; Actualiza la posición de la manzana cuando la serpiente come
0000156E                           778  ; INPUT    : NONE 
0000156E                           779  ; OUTPUT   : NONE
0000156E                           780  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
0000156E                           781  ; ------------------------------------------------------------------------------
0000156E                           782  
0000156E                           783  
0000156E                           784              ; Convierte las coordenadas actuales de la manzana a índice de la matriz
0000156E  4EB9 00001744            785              JSR     CINDMTRZ
00001574                           786  
00001574                           787              ; Marca la celda anterior como vacía
00001574  4EB9 00001794            788              JSR     MCLDVCIA
0000157A                           789  
0000157A                           790              ; Llama a la función para generar una nueva posición aleatoria
0000157A  4EB9 0000162A            791              JSR     GENPOSMNZ
00001580                           792  
00001580                           793              ; Convierte las nuevas coordenadas de la manzana a índice de la matriz
00001580  4EB9 00001744            794              JSR     CINDMTRZ
00001586                           795  
00001586                           796  CHCKUPDT:
00001586  4EB9 00001828            797              JSR     CHECKCLD             ; Verifica si la celda está libre
0000158C  6700 0010                798              BEQ     NEWMNZ               ; Si está libre
00001590                           799  
00001590                           800              ; Si la celda está ocupada
00001590  4EB9 0000162A            801              JSR     GENPOSMNZ            ; Genera una nueva posición
00001596  4EB9 00001744            802              JSR     CINDMTRZ             ; Convierte las nuevas coordenadas
0000159C  60E8                     803              BRA     CHCKUPDT             ; Repite la comprobación
0000159E                           804  
0000159E                           805  NEWMNZ:
0000159E                           806              ; Marca la celda como ocupada con la manzana (estado 4)
0000159E  4EB9 000017D6            807              JSR     MNZOCPD
000015A4                           808  
000015A4                           809              ; Dibuja la nueva manzana en la pantalla
000015A4  4EB9 000015AC            810              JSR     APPLEPLOT
000015AA                           811  
000015AA  4E75                     812              RTS
000015AC                           813              
000015AC                           814  ; ------------------------------------------------------------------------------
000015AC                           815  APPLEPLOT
000015AC                           816  ; Dibuja la manzana
000015AC                           817  ; INPUT    : NONE 
000015AC                           818  ; OUTPUT   : NONE
000015AC                           819  ; MODIFIES : NONE
000015AC                           820  ; ------------------------------------------------------------------------------
000015AC  3F00                     821              MOVE.W  D0,-(A7)
000015AE  3003                     822              MOVE.W  D3,D0
000015B0  4EB9 000017EC            823              JSR     CNVICOOR
000015B6  2F01                     824              MOVE.L  D1,-(A7)                ; PRIMERO DEBEMOS DIBUJAR EL FONDO Y LUEGO LA MANZANA
000015B8                           825              
000015B8  103C 0050                826              MOVE.B  #80,D0
000015BC  223C 0090EE90            827              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
000015C2  4E4F                     828              TRAP    #15
000015C4                           829              
000015C4  103C 0051                830              MOVE.B  #81,D0
000015C8  223C 0090EE90            831              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
000015CE  4E4F                     832              TRAP    #15
000015D0                           833              
000015D0  103C 0057                834              MOVE.B  #87,D0
000015D4  221F                     835              MOVE.L  (A7)+,D1
000015D6  3F03                     836              MOVE.W  D3,-(A7)
000015D8  3601                     837              MOVE.W  D1,D3
000015DA  0643 0014                838              ADD.W   #SIZECLDA,D3
000015DE  3802                     839              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
000015E0  0644 0014                840              ADD.W   #SIZECLDA,D4
000015E4  4E4F                     841              TRAP    #15                     
000015E6                           842                          
000015E6  361F                     843              MOVE.W  (A7)+,D3  
000015E8  301F                     844              MOVE.W  (A7)+,D0
000015EA                           845  
000015EA  3F00                     846              MOVE.W  D0,-(A7)
000015EC  3003                     847              MOVE.W  D3,D0
000015EE  4EB9 000017EC            848              JSR     CNVICOOR
000015F4  2F01                     849              MOVE.L  D1,-(A7)
000015F6                           850              
000015F6  103C 0050                851              MOVE.B  #80,D0
000015FA  223C 0000AAFF            852              MOVE.L  #MNZPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA MANZANA
00001600  4E4F                     853              TRAP    #15
00001602                           854              
00001602  103C 0051                855              MOVE.B  #81,D0
00001606  223C 000000FF            856              MOVE.L  #MNZFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA MANZANA
0000160C  4E4F                     857              TRAP    #15
0000160E                           858              
0000160E  103C 0058                859              MOVE.B  #88,D0
00001612  221F                     860              MOVE.L  (A7)+,D1
00001614  3F03                     861              MOVE.W  D3,-(A7)
00001616  3601                     862              MOVE.W  D1,D3
00001618  0643 0014                863              ADD.W   #SIZECLDA,D3
0000161C  3802                     864              MOVE.W  D2,D4                    ; DIBUJAMOS EL CIRCULO
0000161E  0644 0014                865              ADD.W   #SIZECLDA,D4
00001622  4E4F                     866              TRAP    #15                     
00001624                           867                          
00001624  361F                     868              MOVE.W  (A7)+,D3  
00001626  301F                     869              MOVE.W  (A7)+,D0
00001628                           870  
00001628                           871  
00001628  4E75                     872              RTS
0000162A                           873  ; ----------------------------------------------------------------------------
0000162A                           874  GENPOSMNZ
0000162A                           875  ; Genera una posición aleatoria para la manzana
0000162A                           876  ; INPUT: NONE
0000162A                           877  ; OUTPUT:
0000162A                           878  ; MODIFIES: MNZPOSX, MNZPOSY
0000162A                           879  ; ----------------------------------------------------------------------------
0000162A                           880  
0000162A  48E7 8000                881              MOVEM.L D0,-(A7)
0000162E                           882  
0000162E                           883              ; Genera la coordenada X aleatoria
0000162E  4EB8 111E                884              JSR     UTLRAND
00001632  0240 001F                885              ANDI.W  #NUMCLMNS-1, D0       ; Asegura que esté en [0, NUMCLMNS-1]
00001636  C0FC 0014                886              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
0000163A  3200                     887              MOVE.W  D0,D1
0000163C  33C0 000019D8            888              MOVE.W  D0, MNZPOSX           ; Guarda la coordenada X generada
00001642                           889              
00001642                           890              ; Generar coordenada Y aleatoria
00001642  4EB8 111E                891              JSR     UTLRAND
00001646  0240 0017                892              ANDI.W  #NUMFILAS-1, D0       ; Asegura que esté en el rango [0, NUMFILAS-1]
0000164A  C0FC 0014                893              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
0000164E  3400                     894              MOVE.W  D0,D2
00001650  33C0 000019DA            895              MOVE.W  D0, MNZPOSY           ; Guarda la coordenada Y generada
00001656                           896              
00001656  4CDF 0001                897              MOVEM.L (A7)+,D0
0000165A  4E75                     898              RTS 
0000165C                           899  
0000165C                           900  
0000165C                           901  
0000165C                           902  
0000165C                           903  
0000165C                           904  
0000165C                           905  -------------------- end include --------------------
0000165C                           906              INCLUDE 'SCORE.X68'
0000165C                           907     
0000165C                           908  ; ------------------------------------------------------------------------------
0000165C                           909  SCOINIT
0000165C                           910  ; INICIALIZAR MARCADOR.
0000165C                           911  ; INPUT    : NONE 
0000165C                           912  ; OUTPUT   : NONE
0000165C                           913  ; MODIFIES : NONE
0000165C                           914  ; ------------------------------------------------------------------------------
0000165C  4279 000019F0            915              CLR.W   (JGOPNTS)
00001662  4E75                     916              RTS
00001664                           917              
00001664                           918  ; ------------------------------------------------------------------------------
00001664                           919  SCOUPD
00001664                           920  ; ACTUALIZAR MARCADOR.
00001664                           921  ; INPUT    : NONE 
00001664                           922  ; OUTPUT   : NONE
00001664                           923  ; MODIFIES : NONE
00001664                           924  ; ------------------------------------------------------------------------------
00001664                           925              
00001664  48E7 8000                926              MOVEM.L D0,-(A7)
00001668                           927              
00001668                           928              ;Incrementa el marcador
00001668  3039 000019F0            929              MOVE.W  (JGOPNTS),D0
0000166E  0640 0019                930              ADD.W  #25,D0
00001672  33C0 000019F0            931              MOVE.W  D0,(JGOPNTS)
00001678                           932              
00001678  4CDF 0001                933              MOVEM.L (A7)+,D0
0000167C                           934  
0000167C  4E75                     935              RTS
0000167E                           936              
0000167E                           937  ; ------------------------------------------------------------------------------
0000167E                           938  SCOPLOT
0000167E                           939  ; DIBUJAR MARCADOR.
0000167E                           940  ; INPUT    : NONE 
0000167E                           941  ; OUTPUT   : NONE
0000167E                           942  ; MODIFIES : NONE
0000167E                           943  ; ------------------------------------------------------------------------------
0000167E  48E7 C040                944             MOVEM.L  D0-D1/A1,-(A7)
00001682                           945             ; SET COLOR DE FONDO
00001682  103C 0051                946             MOVE.B   #81,D0
00001686  223C 0090EE90            947             MOVE.L   #COLFND,D1
0000168C  4E4F                     948             TRAP     #15
0000168E                           949             
0000168E                           950             
0000168E                           951             
0000168E                           952             ; DIBUJAR LINEA DE PUNTUACIÓN
0000168E  43F9 000016A8            953              LEA     .TXT1,A1
00001694  4281                     954              CLR.L   D1
00001696  3239 000019F0            955              MOVE.W  (JGOPNTS),D1
0000169C  103C 0011                956              MOVE.B  #17,D0
000016A0  4E4F                     957              TRAP    #15
000016A2                           958              
000016A2  4CDF 0203                959              MOVEM.L (A7)+,D0-D1/A1
000016A6  4E75                     960              RTS
000016A8                           961  
000016A8                           962  
000016A8= 50 55 4E 54 4F 53 ...    963  .TXT1       DC.B    'PUNTOS : ',0
000016B2                           964  
000016B2                           965  
000016B2                           966  
000016B2                           967  
000016B2                           968  -------------------- end include --------------------
000016B2                           969              INCLUDE 'MATRIZ.X68'
000016B2                           970  ; ----------------------------------------------------------------------------
000016B2                           971  ; MATRIZ
000016B2                           972  ; ----------------------------------------------------------------------------
000016B2                           973  
000016B2                           974  ;-----------------------------------------------------------------------------
000016B2                           975  MTZINIT
000016B2                           976  ; INICIALIZA LA MATRIZ, AL PRINCIPIO ESTÁ VACÍA
000016B2                           977  ; INPUT    : NONE
000016B2                           978  ; OUTPUT   : NONE
000016B2                           979  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
000016B2                           980  ; ----------------------------------------------------------------------------
000016B2                           981              
000016B2  48A7 E080                982              MOVEM.W D0-D2/A0,-(A7)
000016B6                           983              
000016B6  41F9 000019F4            984              LEA ESTDCLDS,A0       ; Apunta al inicio de ESTDCLDS
000016BC  303C 0300                985              MOVE.W #TCELDAS,D0    ; Número total de celdas
000016C0                           986  
000016C0                           987  CLNCLDS:
000016C0  4218                     988              CLR.B (A0)+            ; Coloca 0 en cada celda
000016C2  5340                     989              SUBI.W #1, D0          ; Decrementa el contador de celdas
000016C4  66FA                     990              BNE CLNCLDS            ; Repite hasta que esten vacías
000016C6                           991              
000016C6                           992              
000016C6  3239 000019DC            993              MOVE.W  (CBZPOSX),D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
000016CC  3439 000019DE            994              MOVE.W  (CBZPOSY),D2
000016D2  4EB9 00001744            995              JSR     CINDMTRZ
000016D8  4EB9 0000177E            996              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
000016DE                           997              
000016DE  3239 000019E8            998              MOVE.W  (SGMPOSX),D1
000016E4  3439 000019EA            999              MOVE.W  (SGMPOSY),D2             ; VEMOS LA POSICIÓN DEL SEGMENTO
000016EA  4EB9 00001744           1000              JSR     CINDMTRZ
000016F0  4EB9 000017AA           1001              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
000016F6                          1002              
000016F6  3239 000019EC           1003              MOVE.W  (SGMPOSX2),D1
000016FC  3439 000019EE           1004              MOVE.W  (SGMPOSY2),D2            ; VEMOS LA POSICIÓN DEL SEGMENTO 2
00001702  4EB9 00001744           1005              JSR     CINDMTRZ
00001708  4EB9 000017AA           1006              JSR     SGMOCPD                 ; MARCAMOS LA POSICION DEL SEGMENTO 2
0000170E                          1007              
0000170E  3239 000019E4           1008              MOVE.W  (COLPOSX),D1             ; VEMOS LA POSICIÓN DE LA COLA
00001714  3439 000019E6           1009              MOVE.W  (COLPOSY),D2
0000171A  4EB9 00001744           1010              JSR     CINDMTRZ
00001720  4EB9 000017C0           1011              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
00001726                          1012              
00001726  3239 000019D8           1013              MOVE.W  (MNZPOSX),D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
0000172C  3439 000019DA           1014              MOVE.W  (MNZPOSY),D2
00001732  4EB9 00001744           1015              JSR     CINDMTRZ
00001738  4EB9 000017D6           1016              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
0000173E                          1017              
0000173E                          1018              
0000173E  4C9F 0107               1019              MOVEM.W (A7)+,D0-D2/A0
00001742                          1020  
00001742  4E75                    1021              RTS
00001744                          1022  
00001744                          1023  ;-----------------------------------------------------------------------------
00001744                          1024  CINDMTRZ
00001744                          1025  ; CALCULA EL ÍNDICE DE UNA CELDA
00001744                          1026  ; INPUT    : D1 = coordenada X pantalla, D2 = coordenada Y pantalla
00001744                          1027  ; OUTPUT   : D0 = índice de la celda en ESTDCLDS
00001744                          1028  ; MODIFIES : NONE
00001744                          1029  ; ----------------------------------------------------------------------------
00001744                          1030  
00001744  48A7 7000               1031               MOVEM.W D1-D3,-(A7)     ; Guarda los registros D1-D3 en la pila
00001748                          1032  
00001748                          1033              ; Divide X por SIZECLDA
00001748  3601                    1034              MOVE.W  D1,D3          ; Copia X a D3
0000174A  4241                    1035              CLR.W   D1              ; Inicializa el cociente de X
0000174C                          1036  
0000174C  B67C 0014               1037  DIVX:       CMP.W   #SIZECLDA,D3    ; Compara D3 con SIZECLDA
00001750  6D00 000A               1038              BLT     ENDDIVX         ; Si D3 < SIZECLDA, salta a ENDDIVX
00001754  0443 0014               1039              SUB.W   #SIZECLDA,D3   ; Resta SIZECLDA de D3
00001758  5241                    1040              ADDQ.W  #1,D1          ; Incrementa el cociente de X
0000175A  60F0                    1041              BRA     DIVX            ; Repite el bucle
0000175C                          1042  
0000175C                          1043  ENDDIVX:
0000175C                          1044  
0000175C                          1045              ; Divide Y por SIZECLDA
0000175C  3602                    1046              MOVE.W  D2,D3          ; Copia Y a D3
0000175E  4242                    1047              CLR.W   D2              ; Inicializa el cociente de Y
00001760                          1048  
00001760  B67C 0014               1049  DIVY:       CMP.W   #SIZECLDA,D3    ; Compara D3 con SIZECLDA
00001764  6D00 000A               1050              BLT     ENDDIVY         ; Si D3 < SIZECLDA, salta a ENDDIVY
00001768  0443 0014               1051              SUB.W   #SIZECLDA,D3   ; Resta SIZECLDA de D3
0000176C  5242                    1052              ADDQ.W  #1, D2          ; Incrementa el cociente de Y
0000176E  60F0                    1053              BRA     DIVY            ; Repite el bucle
00001770                          1054  
00001770                          1055  ENDDIVY:
00001770                          1056  
00001770                          1057              ; Calcula el índice
00001770  4240                    1058              CLR.W   D0
00001772  3002                    1059              MOVE.W  D2, D0          ; D0 = Y_CELDA
00001774  EB40                    1060              ASL.W   #5, D0          ; D0 = Y_CELDA * NUMCLMNS (32 = 2^5)
00001776  D041                    1061              ADD.W   D1, D0          ; D0 = Y_CELDA * NUMCLMNS + X_CELDA
00001778                          1062  
00001778  4C9F 000E               1063              MOVEM.W (A7)+,D1-D3     ; Restaura los registros D1-D3 desde la pila
0000177C                          1064  
0000177C  4E75                    1065              RTS  
0000177E                          1066              
0000177E                          1067  ;-----------------------------------------------------------------------------
0000177E                          1068  CBZOCPD
0000177E                          1069  ; MARCA UNA CELDA COMO OCUPADA POR LA CABEZA
0000177E                          1070  ; INPUT    : D0 = índice de la celda en ESTDCLDS
0000177E                          1071  ; OUTPUT   : NONE
0000177E                          1072  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
0000177E                          1073  ; ----------------------------------------------------------------------------
0000177E                          1074  
0000177E  48A7 0080               1075              MOVEM.W A0,-(A7)
00001782                          1076  
00001782  41F9 000019F4           1077              LEA     ESTDCLDS,A0                ; Dirección de la matriz en A0
00001788  11BC 0003 0000          1078              MOVE.B  #3,(A0, D0.W)           ; Marca la celda como ocupada
0000178E                          1079              
0000178E  4C9F 0100               1080              MOVEM.W (A7)+,A0
00001792                          1081              
00001792  4E75                    1082              RTS
00001794                          1083              
00001794                          1084              
00001794                          1085              
00001794                          1086             
00001794                          1087  ;-----------------------------------------------------------------------------
00001794                          1088  MCLDVCIA
00001794                          1089  ; MARCA UNA CELDA COMO VACÍA
00001794                          1090  ; INPUT    : D0 = índice de la celda en ESTDCLDS
00001794                          1091  ; OUTPUT   : NONE
00001794                          1092  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
00001794                          1093  ; ----------------------------------------------------------------------------
00001794                          1094  
00001794  48A7 0080               1095              MOVEM.W A0,-(A7)
00001798                          1096  
00001798  41F9 000019F4           1097              LEA     ESTDCLDS,A0                ; Direccion de la matriz en A0
0000179E  11BC 0000 0000          1098              MOVE.B  #0,(A0,D0.W)           ; Marca la celda como vacía
000017A4                          1099              
000017A4  4C9F 0100               1100              MOVEM.W (A7)+,A0
000017A8                          1101              
000017A8  4E75                    1102              RTS
000017AA                          1103  
000017AA                          1104  ;-----------------------------------------------------------------------------
000017AA                          1105  SGMOCPD
000017AA                          1106  ; MARCA UNA CELDA COMO OCUPADA POR EL SEGMENTO
000017AA                          1107  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000017AA                          1108  ; OUTPUT   : NONE
000017AA                          1109  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000017AA                          1110  ; ----------------------------------------------------------------------------
000017AA                          1111  
000017AA  48A7 0080               1112              MOVEM.W A0,-(A7)
000017AE                          1113  
000017AE  41F9 000019F4           1114              LEA ESTDCLDS,A0                ; Dirección de la matriz en A0
000017B4  11BC 0002 0000          1115              MOVE.B #2,(A0,D0.W)           ; Marca la celda como ocupada
000017BA                          1116              
000017BA  4C9F 0100               1117              MOVEM.W (A7)+,A0
000017BE                          1118              
000017BE  4E75                    1119              RTS
000017C0                          1120              
000017C0                          1121  ;-----------------------------------------------------------------------------
000017C0                          1122  COLOCPD
000017C0                          1123  ; MARCA UNA CELDA COMO OCUPADA POR LA COLA
000017C0                          1124  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000017C0                          1125  ; OUTPUT   : NONE
000017C0                          1126  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000017C0                          1127  ; ----------------------------------------------------------------------------
000017C0                          1128  
000017C0  48A7 0080               1129              MOVEM.W A0,-(A7)
000017C4                          1130  
000017C4  41F9 000019F4           1131              LEA ESTDCLDS,A0                ; Dirección de la matriz en A0
000017CA  11BC 0001 0000          1132              MOVE.B #1,(A0,D0.W)           ; Marca la celda como ocupada
000017D0                          1133              
000017D0  4C9F 0100               1134              MOVEM.W (A7)+,A0
000017D4                          1135              
000017D4  4E75                    1136              RTS
000017D6                          1137  
000017D6                          1138  
000017D6                          1139  ;-----------------------------------------------------------------------------
000017D6                          1140  MNZOCPD
000017D6                          1141  ; MARCA UNA CELDA COMO OCUPADA POR LA MANZANA
000017D6                          1142  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000017D6                          1143  ; OUTPUT   : NONE
000017D6                          1144  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000017D6                          1145  ; ----------------------------------------------------------------------------
000017D6                          1146  
000017D6  48A7 0080               1147              MOVEM.W A0,-(A7)
000017DA                          1148  
000017DA  41F9 000019F4           1149              LEA ESTDCLDS,A0                ; Dirección de la matriz en A0
000017E0  11BC 0004 0000          1150              MOVE.B #4,(A0,D0.W)           ; Marca la celda como ocupada
000017E6                          1151              
000017E6  4C9F 0100               1152              MOVEM.W (A7)+,A0
000017EA                          1153              
000017EA  4E75                    1154              RTS
000017EC                          1155  
000017EC                          1156              
000017EC                          1157  ;-----------------------------------------------------------------------------
000017EC                          1158  CNVICOOR
000017EC                          1159  ; Convierte un índice de celda a coordenadas de pantalla (X, Y)
000017EC                          1160  ; INPUT    : D0 = índice de la celda en ESTADO_CELDAS
000017EC                          1161  ; OUTPUT   : D1 = coordenada X, D2 = coordenada Y
000017EC                          1162  ; MODIFIES : NONE
000017EC                          1163  ; ----------------------------------------------------------------------------
000017EC                          1164  
000017EC  48A7 9800               1165              MOVEM.W D0/D3-D4,-(A7)
000017F0                          1166  
000017F0  3400                    1167              MOVE.W  D0,D2         ; Copia índice a D2 para calcular la fila
000017F2  EA4A                    1168              LSR.W   #5,D2         ; D2 = índice / NUM_COLUMNAS (32 = 2^5)
000017F4  3200                    1169              MOVE.W  D0,D1         ; Copia índice a D1 para calcular la columna
000017F6  C27C 001F               1170              AND.W   #$1F,D1       ; D1 = índice % NUM_COLUMNAS (31 = 0x1F) (CREO)
000017FA                          1171  
000017FA                          1172              ; Multiplica por TAMAÑO_CELDA = 10
000017FA  363C 0014               1173              MOVE.W  #SIZECLDA, D3
000017FE  3801                    1174              MOVE.W  D1,D4         ; Copia D1 para multiplicar por 10
00001800  4241                    1175              CLR.W   D1            ; Inicializa resultado
00001802                          1176  
00001802                          1177  
00001802                          1178  MULTLOOPX: 
00001802  B87C 0000               1179              CMP.W   #0,D4        ; ¿Quedan iteraciones?
00001806  6700 0008               1180              BEQ     ENDMULTX
0000180A  D243                    1181              ADD.W   D3,D1         ; Suma TAMANO_CELDA (10) repetidamente
0000180C                          1182  
0000180C  5344                    1183              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
0000180E  60F2                    1184              BRA     MULTLOOPX     ; Repite mientras no sea 0
00001810                          1185  ENDMULTX: 
00001810  3802                    1186              MOVE.W  D2,D4         ; Copia D2 para multiplicar por 10
00001812  4242                    1187              CLR.W   D2            ; Inicializa resultado
00001814                          1188  
00001814                          1189  MULTLOOPY: 
00001814  B87C 0000               1190              CMP.W   #0,D4        ; ¿Quedan iteraciones?
00001818  6700 0008               1191              BEQ     ENDMULTY
0000181C  D443                    1192              ADD.W   D3,D2         ; Suma TAMANO_CELDA (10) repetidamente
0000181E  5344                    1193              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
00001820  60F2                    1194              BRA     MULTLOOPY     ; Repite mientras no sea 0
00001822                          1195  ENDMULTY:
00001822  4C9F 0019               1196              MOVEM.W (A7)+,D0/D3-D4
00001826                          1197  
00001826  4E75                    1198              RTS
00001828                          1199  
00001828                          1200  ; ----------------------------------------------------------------------------
00001828                          1201  CHECKCLD
00001828                          1202  ; INPUT: D0 = índice de la celda
00001828                          1203  ; OUTPUT: D0 = 0 si está vacía, 1 si está ocupada
00001828                          1204  ; MODIFIES: Ninguno
00001828                          1205  ; ----------------------------------------------------------------------------
00001828                          1206  
00001828  41F9 000019F4           1207              LEA     ESTDCLDS,A0    ; Carga la dirección de la matriz ESTDCLDS
0000182E  1230 0000               1208              MOVE.B  (A0,D0.W),D1   ; Carga el estado de la celda en D1
00001832  B23C 0000               1209              CMP.B   #0,D1          ; Compara si está vacía (0)
00001836  6700 0008               1210              BEQ     CLDFREE         ; Si está vacía
0000183A  303C 0001               1211              MOVE.W  #1,D0          ; Si está ocupada, devuelve 1 (ocupada)
0000183E                          1212  
0000183E  4E75                    1213              RTS
00001840                          1214  
00001840                          1215  CLDFREE:
00001840  303C 0000               1216              MOVE.W  #0,D0                 ; Devuelve 0 (libre)
00001844                          1217  
00001844  4E75                    1218              RTS
00001846                          1219  
00001846                          1220  
00001846                          1221  ;-----------------------------------------------------------------------------
00001846                          1222  FONPLOT
00001846                          1223  ; DIBUJADO DEL FONDO
00001846                          1224  ; INPUT    : NONE
00001846                          1225  ; OUTPUT   : NONE
00001846                          1226  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
00001846                          1227  ; ----------------------------------------------------------------------------
00001846                          1228  
00001846  3F00                    1229              MOVE.W  D0,-(A7)
00001848  3003                    1230              MOVE.W  D3,D0
0000184A  4EB8 17EC               1231              JSR     CNVICOOR
0000184E  2F01                    1232              MOVE.L  D1,-(A7)
00001850                          1233              
00001850  103C 0050               1234              MOVE.B  #80,D0
00001854  223C 0090EE90           1235              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
0000185A  4E4F                    1236              TRAP    #15
0000185C                          1237              
0000185C  103C 0051               1238              MOVE.B  #81,D0
00001860  223C 0090EE90           1239              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
00001866  4E4F                    1240              TRAP    #15
00001868                          1241              
00001868  103C 0057               1242              MOVE.B  #87,D0
0000186C  221F                    1243              MOVE.L  (A7)+,D1
0000186E  3F03                    1244              MOVE.W  D3,-(A7)
00001870  3601                    1245              MOVE.W  D1,D3
00001872  0643 0014               1246              ADD.W   #SIZECLDA,D3
00001876  3802                    1247              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
00001878  0644 0014               1248              ADD.W   #SIZECLDA,D4
0000187C  4E4F                    1249              TRAP    #15                     
0000187E                          1250                          
0000187E  361F                    1251              MOVE.W  (A7)+,D3  
00001880  301F                    1252              MOVE.W  (A7)+,D0
00001882  4E75                    1253              RTS         
00001884                          1254  
00001884                          1255  
00001884                          1256  
00001884                          1257  ;-----------------------------------------------------------------------------
00001884                          1258  MTZUPD
00001884                          1259  ; ACTUALIZA LA MATRIZ CASILLA A CASILLA
00001884                          1260  ; INPUT    : NONE
00001884                          1261  ; OUTPUT   : NONE
00001884                          1262  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
00001884                          1263  ; ----------------------------------------------------------------------------
00001884                          1264  
00001884                          1265  
00001884  48A7 E080               1266              MOVEM.W D0-D2/A0,-(A7)
00001888                          1267              
00001888  41F9 000019F4           1268              LEA ESTDCLDS,A0       ; Apunta al inicio de ESTDCLDS
0000188E  303C 0300               1269              MOVE.W #TCELDAS,D0    ; Número total de celdas
00001892                          1270  
00001892                          1271  .CLNCLDS:
00001892  4218                    1272              CLR.B (A0)+            ; Coloca 0 en cada celda
00001894  5340                    1273              SUBI.W #1,D0          ; Decrementa el contador de celdas
00001896  66FA                    1274              BNE .CLNCLDS           ; Repite hasta que esten vacías
00001898                          1275              
00001898                          1276              
00001898  3239 000019DC           1277              MOVE.W  (CBZPOSX),D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
0000189E  3439 000019DE           1278              MOVE.W  (CBZPOSY),D2
000018A4  4EB8 1744               1279              JSR     CINDMTRZ
000018A8  4EB8 177E               1280              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
000018AC                          1281              
000018AC  3239 000019E8           1282              MOVE.W  (SGMPOSX),D1
000018B2  3439 000019EA           1283              MOVE.W  (SGMPOSY),D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
000018B8  4EB8 1744               1284              JSR     CINDMTRZ
000018BC  4EB8 17AA               1285              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
000018C0                          1286              
000018C0  3239 000019EC           1287              MOVE.W  (SGMPOSX2),D1
000018C6  3439 000019EE           1288              MOVE.W  (SGMPOSY2),D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
000018CC  4EB8 1744               1289              JSR     CINDMTRZ
000018D0  4EB8 17AA               1290              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
000018D4                          1291              
000018D4  3239 000019E4           1292              MOVE.W  (COLPOSX),D1             ; VEMOS LA POSICIÓN INICIAL DE LA COLA
000018DA  3439 000019E6           1293              MOVE.W  (COLPOSY),D2
000018E0  4EB8 1744               1294              JSR     CINDMTRZ
000018E4  4EB8 17C0               1295              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
000018E8                          1296              
000018E8  3239 000019D8           1297              MOVE.W  (MNZPOSX),D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
000018EE  3439 000019DA           1298              MOVE.W  (MNZPOSY),D2
000018F4  4EB8 1744               1299              JSR     CINDMTRZ
000018F8  4EB8 17D6               1300              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
000018FC                          1301              
000018FC                          1302              
000018FC  4C9F 0107               1303              MOVEM.W (A7)+,D0-D2/A0
00001900                          1304  
00001900  4E75                    1305              RTS
00001902                          1306  
00001902                          1307  
00001902                          1308  
00001902                          1309  ;-----------------------------------------------------------------------------
00001902                          1310  MTZPLOT
00001902                          1311  ; DIBUJA LA MATRIZ CASILLA A CASILLA
00001902                          1312  ; INPUT    : NONE
00001902                          1313  ; OUTPUT   : NONE
00001902                          1314  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
00001902                          1315  ; ----------------------------------------------------------------------------
00001902  48E7 F080               1316              MOVEM.L D0-D3/A0,-(A7)
00001906                          1317  
00001906  4240                    1318              CLR.W   D0
00001908  4243                    1319              CLR.W   D3
0000190A  41F9 000019F4           1320              LEA     ESTDCLDS,A0            ; Apunta al inicio de ESTDCLDS
00001910  303C 0300               1321              MOVE.W  #TCELDAS,D0            ; Número total de celdas
00001914  363C 0000               1322              MOVE.W  #0,D3                   ; LO UTILIZAMOS PARA SABER EL INDICE EN EL QUE NOS ENCONTRAMOS
00001918  4241                    1323              CLR.W   D1
0000191A  4242                    1324              CLR.W   D2
0000191C                          1325              
0000191C                          1326  
0000191C                          1327  PLOTCLDS:
0000191C  1218                    1328              MOVE.B  (A0)+,D1                ; MOVEMOS EL VALOR DE LA CELDA A D1
0000191E  B23C 0000               1329              CMP.B   #0,D1
00001922  6700 0034               1330              BEQ     PLOTVAC                 ; SALTA A DIBUJAR POSICIÓN VACÍA
00001926  B23C 0001               1331              CMP.B   #1,D1 
0000192A  6700 0032               1332              BEQ     PLOTCOL                 ; SALTA A DIBUJAR COLA
0000192E  B23C 0002               1333              CMP.B   #2,D1
00001932  6700 0030               1334              BEQ     PLOTSEG                 ; SALTA A DIBUJAR SEGMENTO
00001936  B23C 0003               1335              CMP.B   #3,D1
0000193A  6700 0016               1336              BEQ     PLOTCBZ                 ; SALTA A DIBUJAR CABEZA
0000193E  B23C 0004               1337              CMP.B   #4,D1                 
00001942  6700 0026               1338              BEQ     PLOTAPPLE               ; SALTA A DIBUJAR MANZANA
00001946                          1339    
00001946                          1340  DONEPLOT            
00001946  5243                    1341              ADDQ    #1,D3                   ; AUMENTAMOS EL INDICE DE CELDA PARA LA SIGUIENTE
00001948  5340                    1342              SUBI.W  #1,D0                  ; Decrementa el contador de celdas
0000194A  66D0                    1343              BNE     PLOTCLDS                ; Repite hasta que esten vacías
0000194C  4CDF 010F               1344              MOVEM.L (A7)+,D0-D3/A0
00001950  4E75                    1345              RTS
00001952                          1346  PLOTCBZ:
00001952  4EB8 1318               1347              JSR     HEADPLOT
00001956  60EE                    1348              BRA     DONEPLOT
00001958                          1349  
00001958                          1350  PLOTVAC:    
00001958  4EB8 1846               1351              JSR     FONPLOT
0000195C  60E8                    1352              BRA     DONEPLOT                ; DIBUJADO HECHO 
0000195E                          1353  
0000195E                          1354  PLOTCOL:   
0000195E  4EB8 14FC               1355              JSR     TAILPLOT 
00001962  60E2                    1356              BRA     DONEPLOT                ; DIBUJADO HECHO 
00001964                          1357              
00001964                          1358  PLOTSEG:    
00001964  4EB8 145C               1359              JSR     SEGPLOT
00001968  60DC                    1360              BRA     DONEPLOT                ; DIBUJADO HECHO    
0000196A                          1361  
0000196A                          1362  PLOTAPPLE:
0000196A  4EB8 15AC               1363              JSR     APPLEPLOT
0000196E  60D6                    1364              BRA     DONEPLOT            
00001970                          1365  
00001970                          1366  
00001970                          1367  
00001970                          1368  
00001970                          1369  
00001970                          1370  
00001970                          1371  
00001970                          1372  
00001970                          1373  
00001970                          1374  
00001970                          1375  
00001970                          1376  
00001970                          1377  
00001970                          1378  
00001970                          1379  
00001970                          1380  
00001970                          1381  
00001970                          1382  
00001970                          1383  
00001970                          1384  
00001970                          1385  
00001970                          1386  -------------------- end include --------------------
00001970                          1387  START:
00001970                          1388                  
00001970                          1389  ; --- INIZIALIZACIÓN ---------------------------------------------------------
00001970                          1390  
00001970  007C 0700               1391              ORI.W   #$0700,SR
00001974  4EB8 1000               1392              JSR     SYSINIT
00001978  4EB8 1108               1393              JSR     UTLINIT
0000197C  4EB8 108C               1394              JSR     KBDINIT
00001980  4EB8 16B2               1395              JSR     MTZINIT
00001984  4EB8 123C               1396              JSR     HEADINIT                
00001988  4EB8 139C               1397              JSR     SEGINIT
0000198C  4EB8 149C               1398              JSR     TAILINIT
00001990  4EB8 165C               1399              JSR     SCOINIT
00001994  4EB8 153C               1400              JSR     APPLEINIT
00001998                          1401              
00001998                          1402  
00001998                          1403  .LOOP
00001998                          1404  
00001998                          1405  ; --- ACTUALIZAR -------------------------------------------------------------
00001998                          1406  
00001998                          1407  ; LEER DISPOSITIVOS DE ENTRADA
00001998                          1408  
00001998  4E41                    1409              TRAP    #1
0000199A                          1410  
0000199A                          1411  ; ACTUALIZAR LÓGICA DEL JUEGO
0000199A                          1412              
0000199A  4EB8 14AE               1413              JSR     TAILUPD
0000199E  4EB8 13CA               1414              JSR     SEGUPD
000019A2  4EB8 125C               1415              JSR     HEADUPD
000019A6  4EB8 1884               1416              JSR     MTZUPD
000019AA                          1417              
000019AA                          1418  ; --- SINCRONIZACIÓN ---------------------------------------------------------
000019AA                          1419              
000019AA  4A39 00001CFC           1420  .WINT       TST.B   (SCRINTCT)
000019B0  67F8                    1421              BEQ     .WINT   
000019B2  4239 00001CFC           1422              CLR.B   (SCRINTCT)         
000019B8                          1423  
000019B8                          1424  
000019B8                          1425  ;---DIBUJAR-------------------------------------------------------------------
000019B8  4EB8 1318               1426               JSR    HEADPLOT
000019BC  4EB8 145C               1427               JSR    SEGPLOT
000019C0  4EB8 14FC               1428               JSR    TAILPLOT
000019C4  4EB8 15AC               1429               JSR    APPLEPLOT
000019C8  4EB8 1902               1430               JSR    MTZPLOT
000019CC  4EB8 167E               1431               JSR    SCOPLOT
000019D0                          1432              
000019D0  4E40                    1433              TRAP    #0                      ; ACTUALIZA DOBLE BUFFER
000019D2                          1434  
000019D2                          1435  
000019D2  60C4                    1436              BRA     .LOOP
000019D4                          1437  
000019D4  FFFF FFFF               1438              SIMHALT
000019D8                          1439              
000019D8                          1440              INCLUDE 'VARS.X68'
000019D8                          1441  ; ----------------------------------------------------------------------------
000019D8                          1442  ; VARIABLES DEL JUEGO
000019D8                          1443  ; ----------------------------------------------------------------------------
000019D8                          1444  
000019D8                          1445  ; --- VARIABLES DE LA MANZANA ------------------------------------------------
000019D8                          1446  
000019D8                          1447  MNZPOSX     DS.W    1                       ; COORDENADA X DE LA MANZANA
000019DA                          1448  MNZPOSY     DS.W    1                       ; COORDENADA Y DE LA MANZANA
000019DC                          1449  
000019DC                          1450  ; --- VARIABLES DE LA SERPIENTE ----------------------------------------------
000019DC                          1451  
000019DC                          1452  CBZPOSX     DS.W    1                       ; COORDENADA X CABEZA
000019DE                          1453  CBZPOSY     DS.W    1                       ; COORDENADA Y CABEZA
000019E0                          1454  CBZVELX     DS.W    1                       ; VELOCIDAD X CABEZA
000019E2                          1455  CBZVELY     DS.W    1                       ; VELOCIDAD Y CABEZA
000019E4                          1456  COLPOSX     DS.W    1                       ; COORDENADA X COLA
000019E6                          1457  COLPOSY     DS.W    1                       ; COORDENADA Y COLA
000019E8                          1458  SGMPOSX     DS.W    1                       ; COORDENADA X SEGMENTO
000019EA                          1459  SGMPOSY     DS.W    1                       ; COORDENADA Y SEGMENTO
000019EC                          1460  SGMPOSX2    DS.W    1                       ; COORDENADA X SEGMENTO 2
000019EE                          1461  SGMPOSY2    DS.W    1                       ; COORDENADA Y SEGMENTO 2
000019F0                          1462  ;TRZPLOT     DS.B    1                       ; NÚMERO DE TROZOS A DIBUJAR
000019F0                          1463  
000019F0                          1464  ; --- VARIABLES DEL MARCADOR -------------------------------------------------
000019F0                          1465  
000019F0                          1466  JGOPNTS     DS.W    1                       ; PUNTUACIÓN DEL JUEGO
000019F2                          1467  
000019F2                          1468  
000019F2                          1469  
000019F2                          1470  
000019F2                          1471  
000019F2                          1472  
000019F2                          1473  
000019F2                          1474  
000019F2                          1475  
000019F2                          1476  
000019F2                          1477  
000019F2                          1478  
000019F2                          1479  
000019F2                          1480  
000019F2                          1481  
000019F2                          1482  -------------------- end include --------------------
000019F2                          1483              INCLUDE 'LIB/UTLVARS.X68'
000019F2                          1484  ; =============================================================================
000019F2                          1485  ; UTILITY VARIABLES
000019F2                          1486  ; =============================================================================
000019F2                          1487  
000019F2                          1488  UTLRNDIX    DS.B    1                       ; NEXT INDEX TO RANDOM NUMBER
000019F4                          1489              DS.W    0
000019F4                          1490  -------------------- end include --------------------
000019F4                          1491              INCLUDE 'SYSVARS.X68'
000019F4                          1492  ; ----------------------------------------------------------------------------
000019F4                          1493  ; VARIABLES DEL SISTEMA
000019F4                          1494  ; ----------------------------------------------------------------------------
000019F4                          1495  
000019F4                          1496  ; --- VARIABLES DE LA MATRIZ -------------------------------------------------
000019F4                          1497  
000019F4                          1498  ESTDCLDS    DS.B    TCELDAS                 ; ESTADO DE LAS CELDAS 0=VACÍO  1=COLA   2=SEGMENTO  TRZPLOT=CABEZA  4?=MANZANA    
00001CF4                          1499  ESTDCBZ     DS.B    1                       ; 0= DERECHA, 1=ARRIBA, 2=IZQUIERDA, 3=ABAJO
00001CF5                          1500  
00001CF5                          1501  ; --- VARIABLES DE TECLADO ---------------------------------------------------
00001CF5                          1502  
00001CF5                          1503  KBDVAL      DS.B    1
00001CF6                          1504  KBDEDGE     DS.B    1                       ; KEY EDGE
00001CF8                          1505  LASTKEY     DS.L    1                       
00001CFC                          1506  
00001CFC                          1507  ;--- TIMED INTERRUPT RELATED VARIABLES ---------------------------------------
00001CFC                          1508              
00001CFC                          1509  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER
00001CFE                          1510              DS.W    0
00001CFE                          1511  
00001CFE                          1512  
00001CFE                          1513  
00001CFE                          1514  
00001CFE                          1515  
00001CFE                          1516  
00001CFE                          1517  
00001CFE                          1518  
00001CFE                          1519  
00001CFE                          1520  
00001CFE                          1521  
00001CFE                          1522  
00001CFE                          1523  
00001CFE                          1524  
00001CFE                          1525  -------------------- end include --------------------
00001CFE                          1526      
00001CFE                          1527      
00001CFE                          1528              END    START        

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
APPLEINIT           153C
APPLEPLOT           15AC
APPLEUPD            156E
ARR                 10E2
CBZFCOL             AA00
CBZHEIGH            14
CBZOCPD             177E
CBZPCOL             FF00
CBZPOSX             19DC
CBZPOSY             19DE
CBZVEL              14
CBZVELX             19E0
CBZVELY             19E2
CBZWIDTH            14
CHCKUPDT            1586
CHECK               1548
CHECKCLD            1828
CHKCOL              12CE
CINDMTRZ            1744
CLDFREE             1840
CLNCLDS             16C0
CNVICOOR            17EC
COLFCOL             AA00
COLFND              90EE90
COLHEIGH            A
COLOCPD             17C0
COLPCOL             FF00
COLPOSX             19E4
COLPOSY             19E6
COLWIDTH            A
CONTINU             1102
DER                 10D6
DIVX                174C
DIVY                1760
DONEPLOT            1946
DWN                 10FA
ENDDIVX             175C
ENDDIVY             1770
ENDMULTX            1810
ENDMULTY            1822
ESTDCBZ             1CF4
ESTDCLDS            19F4
FIN                 1312
FINUPD              14F6
FONPLOT             1846
GENPOSMNZ           162A
HEADINIT            123C
HEADPLOT            1318
HEADUPD             125C
IZQ                 10EE
JGOPNTS             19F0
KBDDOWN             28
KBDEDGE             1CF6
KBDINIT             108C
KBDLEFT             25
KBDRIGHT            27
KBDUP               26
KBDUPD              109A
KBDVAL              1CF5
LASTKEY             1CF8
LNGINI              1
MARKMNZ             1560
MAXSGM              1
MCLDVCIA            1794
MNZFCOL             FF
MNZHEIGH            14
MNZOCPD             17D6
MNZPCOL             AAFF
MNZPOSX             19D8
MNZPOSY             19DA
MNZWIDTH            14
MTZINIT             16B2
MTZPLOT             1902
MTZUPD              1884
MTZUPD:CLNCLDS      1892
MULTLOOPX           1802
MULTLOOPY           1814
NEWMNZ              159E
NOCOL               12FA
NUMCLMNS            20
NUMFILAS            18
OJOFCOL             FFFFFF
OJOHEIGH            A
OJOPCOL             0
OJOWIDTH            A
PANHEIGH            1E0
PANWIDTH            280
PLOTAPPLE           196A
PLOTCBZ             1952
PLOTCLDS            191C
PLOTCOL             195E
PLOTSEG             1964
PLOTVAC             1958
PNTSFCOL            0
PNTSTEXT            65
SCOINIT             165C
SCOPLOT             167E
SCOPLOT:TXT1        16A8
SCOUPD              1664
SCRINIT             1026
SCRINTCT            1CFC
SCRPLOT             1072
SCRTIM              106A
SEGINIT             139C
SEGPLOT             145C
SEGUPD              13CA
SGMFCOL             AA00
SGMHEIGH            14
SGMOCPD             17AA
SGMPCOL             FF00
SGMPOSX             19E8
SGMPOSX2            19EC
SGMPOSY             19EA
SGMPOSY2            19EE
SGMWIDTH            14
SIGABA              12C6
SIGARR              12AE
SIGDER              12A2
SIGIZQ              12BA
SIZECLDA            14
START               1970
START:LOOP          1998
START:WINT          19AA
SYSINIT             1000
TAILINIT            149C
TAILPLOT            14FC
TAILUPD             14AE
TCELDAS             300
UTLINIT             1108
UTLRAND             111E
UTLRAND:RANDVEC     113C
UTLRNDIX            19F2
