0000196A Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 28/12/2024 18:57:16

00000000                             1  *-----------------------------------------------------------------------------
00000000                             2  * Title      : MAIN
00000000                             3  * Written by :
00000000                             4  * Date       :
00000000                             5  * Description:
00000000                             6  *-----------------------------------------------------------------------------
00000000                             7  
00001000                             8              ORG    $1000
00001000                             9              
00001000                            10              INCLUDE 'CONST.X68'
00001000                            11  ; ----------------------------------------------------------------------------
00001000                            12  ; CONSTANTES DEL JUEGO
00001000                            13  ; ----------------------------------------------------------------------------
00001000                            14     
00001000                            15  ; --- CONSTANTES DE LA MANZANA -----------------------------------------------
00001000                            16  
00001000  =00000014                 17  MNZWIDTH    EQU     20                      ; ANCHURA DE LA MANZANA (a determinar)
00001000  =00000014                 18  MNZHEIGH    EQU     20                      ; ALTURA DE LA MANZANA (a determinar)
00001000  =0000AAFF                 19  MNZPCOL     EQU     $0000AAFF               ; COLOR CONTORNO MANZANA (a determinar)
00001000  =000000FF                 20  MNZFCOL     EQU     $000000FF               ; COLOR RELLENO MANZANA (a determinar)
00001000                            21  
00001000                            22  ; --- CONSTANTES DE LA SERPIENTE ---------------------------------------------
00001000                            23  
00001000  =00000001                 24  MAXSGM      EQU     1                       ; TAMAÑO MÁXIMO DE SEGMENTOS (a determinar)
00001000  =00000001                 25  LNGINI      EQU     1                       ; LONGITUD INICIAL SERPIENTE (a determinar)
00001000  =00000014                 26  SGMWIDTH    EQU     20                      ; ANCHURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 27  SGMHEIGH    EQU     20                      ; ALTURA DE UN SEGMENTO (PROVISIONAL)
00001000  =00000014                 28  CBZVEL      EQU     20                      ; VELOCIDAD DE LA CABEZA (a determinar)
00001000  =0000FF00                 29  SGMPCOL     EQU     $0000FF00               ; COLOR CONTORNO SEGMENTO (PROVISIONAL)
00001000  =0000AA00                 30  SGMFCOL     EQU     $0000AA00               ; COLOR RELLENO SEGMENTO (PROVISIONAL)
00001000  =0000000A                 31  COLWIDTH    EQU     10                      ; ANCHURA DE LA COLA (PROVISIONAL)
00001000  =0000000A                 32  COLHEIGH    EQU     10                      ; ALTURA DE LA COLA (PROVISIONAL)
00001000  =0000FF00                 33  COLPCOL     EQU     $0000FF00               ; COLOR CONTORNO COLA (PROVISIONAL)
00001000  =0000AA00                 34  COLFCOL     EQU     $0000AA00               ; COLOR RELLENO COLA (PROVISIONAL)
00001000  =00000014                 35  CBZWIDTH    EQU     20                      ; ANCHURA DE LA CABEZA (PROVISIONAL)
00001000  =00000014                 36  CBZHEIGH    EQU     20                      ; ALTURA DE LA CABEZA (PROVISIONAL)
00001000  =0000FF00                 37  CBZPCOL     EQU     $0000FF00               ; COLOR CONTORNO CABEZA (PROVISIONAL)
00001000  =0000AA00                 38  CBZFCOL     EQU     $0000AA00               ; COLOR RELLENO CABEZA (PROVISIONAL)
00001000  =0000000A                 39  OJOWIDTH    EQU     10                      ; ANCHURA DE OJO DE SERPIENTE
00001000  =0000000A                 40  OJOHEIGH    EQU     10                      ; ALTURA DE OJO DE SERPIENTE
00001000  =00000000                 41  OJOPCOL     EQU     $00000000               ; COLOR CONTORNO OJO
00001000  =00FFFFFF                 42  OJOFCOL     EQU     $00FFFFFF               ; COLOR RELLENO OJO
00001000                            43  
00001000                            44  
00001000                            45  
00001000                            46  ; --- CONSTANTES MARCADOR ----------------------------------------------------
00001000                            47  
00001000  =00000000                 48  PNTSFCOL    EQU     $00000000               ; COLOR FONDO MARCADOR (a determinar)
00001000  =00000065                 49  PNTSTEXT    EQU     0101                    ; COORDENADAS DEL MARCADOR (a determinar)
00001000                            50  
00001000                            51  
00001000                            52  
00001000                            53  
00001000                            54  
00001000                            55  
00001000                            56  
00001000                            57  -------------------- end include --------------------
00001000                            58              INCLUDE 'SYSCONST.X68'
00001000                            59  ; ----------------------------------------------------------------------------
00001000                            60  ; CONSTANTES DEL SISTEMA
00001000                            61  ; ----------------------------------------------------------------------------
00001000                            62  
00001000                            63  ; ---CONSTANTES DE LA PANTALLA------------------------------------------------
00001000                            64  
00001000  =00000280                 65  PANWIDTH    EQU     640                     ; ANCHO DE LA PANTALLA
00001000  =000001E0                 66  PANHEIGH    EQU     480                     ; ALTURA DE LA PANTALLA
00001000  =0090EE90                 67  COLFND      EQU     $90EE90                 ; COLOR DEL FONDO DE LA PANTALLA
00001000                            68  
00001000                            69  ; ---CONSTANTES DE LA MATRIZ--------------------------------------------------
00001000                            70  
00001000  =00000014                 71  SIZECLDA    EQU     20                      ; TAMAÑO DE CADA CELDA EN PIXELES
00001000  =00000020                 72  NUMCLMNS    EQU     32                      ; COLUMNAS DE CELDAS (640/10)
00001000  =00000018                 73  NUMFILAS    EQU     24                      ; FILAS DE CELDAS (480/10)
00001000  =00000300                 74  TCELDAS     EQU     768                     ; TOTAL DE CELDAS (64 * 48)
00001000                            75  
00001000                            76  ; ---CÓDIGOS DE TECLADO-------------------------------------------------------
00001000                            77  
00001000  =00000025                 78  KBDLEFT     EQU     $25
00001000  =00000026                 79  KBDUP       EQU     $26
00001000  =00000027                 80  KBDRIGHT    EQU     $27
00001000  =00000028                 81  KBDDOWN     EQU     $28
00001000                            82  
00001000                            83  
00001000                            84  -------------------- end include --------------------
00001000                            85              INCLUDE 'SYSTEM.X68'
00001000                            86   
00001000                            87   
00001000                            88  SYSINIT
00001000                            89  ; INICIA EL  SISTEMA
00001000                            90  ; INPUT    : NONE
00001000                            91  ; OUTPUT   : NONE
00001000                            92  ; MODIFIES : NONE
00001000                            93  ; ----------------------------------------------------------------------------
00001000                            94              
00001000  21FC 00001072 0080        95              MOVE.L  #SCRPLOT,($80)
00001008  21FC 0000109A 0084        96              MOVE.L  #KBDUPD,($84)
00001010  21FC 0000106A 0064        97              MOVE.L  #SCRTIM,($64)
00001018                            98              
00001018  4EB9 00001026             99              JSR     SCRINIT
0000101E  40E7                     100              MOVE.W  SR,-(A7)
00001020  0257 D8FF                101              ANDI.W  #$D8FF,(A7)
00001024                           102              
00001024  4E73                     103              RTE
00001026                           104              
00001026                           105  ; ------------------------------------------------------------------------------
00001026                           106  SCRINIT
00001026                           107  ; INIT SCREEN. SET SCREEN RESOLUTION, SET WINDOWED MODE, CLEAR SCREEN,
00001026                           108  ; ENABLE DOUBLE BUFFER, ENABLED TIMED INTERRUPT.
00001026                           109  ; INPUT    : NONE
00001026                           110  ; OUTPUT   : NONE
00001026                           111  ; MODIFIES : NONE
00001026                           112  ; ------------------------------------------------------------------------------
00001026                           113  
00001026  48E7 C000                114              MOVEM.L D0-D1,-(A7)
0000102A                           115  
0000102A                           116              ; SET SCREEN RESOLUTION
0000102A  103C 0021                117              MOVE.B  #33,D0
0000102E  223C 028001E0            118              MOVE.L  #PANWIDTH<<16|PANHEIGH,D1
00001034  4E4F                     119              TRAP    #15
00001036                           120              
00001036                           121              ; SET WINDOWED MODE
00001036  7201                     122              MOVE.L  #1,D1
00001038  4E4F                     123              TRAP    #15
0000103A                           124              
0000103A                           125              ; CLEAR SCREEN
0000103A  103C 000B                126              MOVE.B  #11,D0
0000103E  323C FF00                127              MOVE.W  #$FF00,D1
00001042  4E4F                     128              TRAP    #15
00001044                           129              
00001044                           130              ; ENABLE DOUBLE BUFFER
00001044  103C 005C                131              MOVE.B  #92,D0
00001048  123C 0011                132              MOVE.B  #17,D1
0000104C  4E4F                     133              TRAP    #15
0000104E                           134              
0000104E                           135              ; ENABLE TIMED INTERRUPT
0000104E  103C 0020                136              MOVE.B  #32,D0
00001052  123C 0006                137              MOVE.B  #6,D1
00001056  143C 0081                138              MOVE.B  #$81,D2
0000105A  7614                     139              MOVE.L  #20,D3                  ; CON 20 SE CONSIUGUEN 50 FPS
0000105C  4E4F                     140              TRAP    #15
0000105E                           141              
0000105E                           142              ; CLEAR INTERRUPT COUNTER
0000105E  4239 00001CF8            143              CLR.B   (SCRINTCT)
00001064                           144              
00001064  4CDF 0003                145              MOVEM.L (A7)+,D0-D1
00001068                           146              
00001068  4E75                     147              RTS    
0000106A                           148              
0000106A                           149  ; ------------------------------------------------------------------------------
0000106A                           150  SCRTIM
0000106A                           151  ; TIMED INTERRUPT SERVICE ROUTINE
0000106A                           152  ; INPUT    : NONE
0000106A                           153  ; OUTPUT   : NONE
0000106A                           154  ; MODIFIES : NONE
0000106A                           155  ; ------------------------------------------------------------------------------
0000106A  5239 00001CF8            156              ADDQ.B  #1,(SCRINTCT)
00001070  4E73                     157              RTE
00001072                           158              
00001072                           159  
00001072                           160  ; ------------------------------------------------------------------------------
00001072                           161  SCRPLOT
00001072                           162  ; UPDATES DOUBLE BUFFER
00001072                           163  ; INPUT    : NONE
00001072                           164  ; OUTPUT   : NONE
00001072                           165  ; MODIFIES : NONE
00001072                           166  ; ------------------------------------------------------------------------------
00001072                           167  
00001072  48A7 C000                168              MOVEM.W D0-D1,-(A7)
00001076                           169              
00001076                           170              ; SWITCH BUFFERS
00001076  103C 005E                171              MOVE.B  #94,D0
0000107A  4E4F                     172              TRAP    #15
0000107C                           173              
0000107C                           174              ; CLEAR HIDDEN BUFFER
0000107C  103C 000B                175              MOVE.B  #11,D0
00001080  323C FF00                176              MOVE.W  #$FF00,D1
00001084  4E4F                     177              TRAP    #15
00001086                           178              
00001086  4C9F 0003                179              MOVEM.W (A7)+,D0-D1
0000108A                           180              
0000108A  4E73                     181              RTE
0000108C                           182          
0000108C                           183  ; ------------------------------------------------------------------------------
0000108C                           184  KBDINIT
0000108C                           185  ; INIT KEYBOARD
0000108C                           186  ; INPUT    : NONE
0000108C                           187  ; OUTPUT   : NONE
0000108C                           188  ; MODIFIES : NONE
0000108C                           189  ; ------------------------------------------------------------------------------
0000108C                           190  
0000108C  4239 00001CF1            191              CLR.B   (KBDVAL)
00001092  4239 00001CF2            192              CLR.B   (KBDEDGE)
00001098  4E75                     193              RTS
0000109A                           194  
0000109A                           195  ; ------------------------------------------------------------------------------
0000109A                           196  KBDUPD
0000109A                           197  ; UPDATE KEYBOARD INFO.  
0000109A                           198  ; 7 -> PAUSE
0000109A                           199  ; 6 -> FIRE 3
0000109A                           200  ; 5 -> FIRE 2
0000109A                           201  ; 4 -> FIRE 1
0000109A                           202  ; 3 -> DOWN
0000109A                           203  ; 2 -> RIGHT
0000109A                           204  ; 1 -> UP
0000109A                           205  ; 0 -> LEFT
0000109A                           206  ; INPUT    : NONE
0000109A                           207  ; OUTPUT   : NONE
0000109A                           208  ; MODIFIES : NONE
0000109A                           209  ; ------------------------------------------------------------------------------
0000109A                           210  
0000109A  48E7 C000                211              MOVEM.L D0-D1,-(A7)
0000109E                           212  
0000109E                           213              ; LEE ESTADO DEL TECLADO
0000109E  103C 0013                214              MOVE.B  #19,D0
000010A2  223C 25262728            215              MOVE.L  #KBDLEFT<<24|KBDUP<<16|KBDRIGHT<<8|KBDDOWN,D1
000010A8  4E4F                     216              TRAP    #15                  ; Lee las teclas y guarda en D1
000010AA                           217  
000010AA  B2BC 000000FF            218              CMP.L   #$000000FF,D1
000010B0  6700 0048                219              BEQ     DWN
000010B4  B2BC 0000FF00            220              CMP.L   #$0000FF00,D1
000010BA  6700 001A                221              BEQ     DER
000010BE  B2BC 00FF0000            222              CMP.L   #$00FF0000,D1
000010C4  6700 001C                223              BEQ     ARR
000010C8  B2BC FF000000            224              CMP.L   #$FF000000,D1
000010CE  6700 001E                225              BEQ     IZQ
000010D2                           226  
000010D2                           227              ; Si no hay pulsaciones, mantener estado
000010D2  6000 002E                228              BRA     CONTINU
000010D6                           229  
000010D6  33FC 0000 00001CF0       230  DER:        MOVE.W  #0,(ESTDCBZ)           ; Actualiza estado a DERECHA
000010DE  6000 0022                231              BRA     CONTINU
000010E2                           232              
000010E2  33FC 0001 00001CF0       233  ARR:        MOVE.W  #1,(ESTDCBZ)           ; Actualiza estado a ARRIBA
000010EA  6000 0016                234              BRA     CONTINU
000010EE                           235  
000010EE  33FC 0002 00001CF0       236  IZQ:        MOVE.W  #2,(ESTDCBZ)           ; Actualiza estado a IZQUIERDA
000010F6  6000 000A                237              BRA     CONTINU                    
000010FA                           238  
000010FA  33FC 0003 00001CF0       239  DWN:        MOVE.W  #3,(ESTDCBZ)           ; Actualiza estado a ABAJO
00001102                           240  
00001102                           241  CONTINU:
00001102  4CDF 0003                242              MOVEM.L (A7)+,D0-D1
00001106  4E73                     243              RTE
00001108                           244              
00001108                           245  ; RESIDUOS CODIGO ANTERIOR 
00001108                           246  
00001108                           247              ;MOVE.B  D2,(KBDVAL)
00001108                           248              
00001108                           249  
00001108                           250  
00001108                           251  
00001108                           252  
00001108                           253  ; CODIGO ANTERIOR ANTERIOR
00001108                           254  
00001108                           255  
00001108                           256  
00001108                           257  
00001108                           258  
00001108                           259  
00001108                           260  
00001108                           261  
00001108                           262  
00001108                           263  
00001108                           264  
00001108                           265  
00001108                           266  
00001108                           267  
00001108                           268  
00001108                           269  
00001108                           270  
00001108                           271  
00001108                           272  
00001108                           273  
00001108                           274  
00001108                           275  
00001108                           276  
00001108                           277  
00001108                           278  
00001108                           279  
00001108                           280  
00001108                           281  
00001108                           282  
00001108                           283  
00001108                           284  
00001108                           285  
00001108                           286  
00001108                           287  
00001108                           288  
00001108                           289  
00001108                           290  
00001108                           291  
00001108                           292  
00001108                           293  -------------------- end include --------------------
00001108                           294              INCLUDE 'LIB/UTLCODE.X68'
00001108                           295  ; =============================================================================
00001108                           296  ; UTILITY CODE
00001108                           297  ; =============================================================================
00001108                           298  
00001108                           299  ; -----------------------------------------------------------------------------
00001108                           300  UTLINIT
00001108                           301  ; INITIALIZES UTILITY CODE
00001108                           302  ; INPUT    - NONE
00001108                           303  ; OUTPUT   - NONE
00001108                           304  ; MODIFIES - NONE
00001108                           305  ; -----------------------------------------------------------------------------
00001108  48E7 C000                306              MOVEM.L D0-D1,-(A7)
0000110C  103C 0008                307              MOVE.B  #8,D0
00001110  4E4F                     308              TRAP    #15
00001112  13C1 000019EE            309              MOVE.B  D1,(UTLRNDIX)
00001118  4CDF 0003                310              MOVEM.L (A7)+,D0-D1
0000111C  4E75                     311              RTS
0000111E                           312  
0000111E                           313  ; -----------------------------------------------------------------------------
0000111E                           314  UTLRAND
0000111E                           315  ; PROVIDES A PSEUDO-RANDOM BYTE
0000111E                           316  ; INPUT    - NONE
0000111E                           317  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
0000111E                           318  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000111E                           319  ; -----------------------------------------------------------------------------
0000111E  2F08                     320              MOVE.L  A0,-(A7)
00001120  41F9 0000113C            321              LEA     .RANDVEC,A0
00001126  4280                     322              CLR.L   D0
00001128  1039 000019EE            323              MOVE.B  (UTLRNDIX),D0
0000112E  1030 0800                324              MOVE.B  (A0,D0.L),D0
00001132  5239 000019EE            325              ADDQ.B  #1,(UTLRNDIX)
00001138  205F                     326              MOVE.L  (A7)+,A0
0000113A  4E75                     327              RTS
0000113C                           328  
0000113C                           329  
0000113C= A2 EE 9A 0C F5 24 ...    330  .RANDVEC    DC.B    162, 238, 154, 12 , 245, 36 , 32 , 103
00001144= 2A A3 51 26 E0 AC ...    331              DC.B    42 , 163, 81 , 38 , 224, 172, 19 , 69
0000114C= 75 51 CA FD 33 EB ...    332              DC.B    117, 81 , 202, 253, 51 , 235, 108, 154
00001154= 60 CC E7 B8 9A EB ...    333              DC.B    96 , 204, 231, 184, 154, 235, 34 , 203
0000115C= 1D 76 B5 95 B0 89 ...    334              DC.B    29 , 118, 181, 149, 176, 137, 62 , 108
00001164= 39 15 48 C9 6E CA ...    335              DC.B    57 , 21 , 72 , 201, 110, 202, 159, 41
0000116C= 43 E7 E2 7C 37 25 ...    336              DC.B    67 , 231, 226, 124, 55 , 37 , 84 , 62
00001174= E9 94 CE E9 E4 52 ...    337              DC.B    233, 148, 206, 233, 228, 82 , 243, 78
0000117C= 37 6D 9A 84 A2 28 ...    338              DC.B    55 , 109, 154, 132, 162, 40 , 30 , 39
00001184= 19 E2 C6 77 80 D4 ...    339              DC.B    25 , 226, 198, 119, 128, 212, 232, 225
0000118C= 0A 5A 32 67 33 C2 ...    340              DC.B    10 , 90 , 50 , 103, 51 , 194, 222, 40
00001194= 59 80 DC 0E 57 FC ...    341              DC.B    89 , 128, 220, 14 , 87 , 252, 243, 252
0000119C= 8A AB BC F7 07 4D ...    342              DC.B    138, 171, 188, 247, 7  , 77 , 29 , 234
000011A4= EF D5 77 6E 1E BB ...    343              DC.B    239, 213, 119, 110, 30 , 187, 131, 23
000011AC= D6 E0 2A 8F BD 28 ...    344              DC.B    214, 224, 42 , 143, 189, 40 , 212, 130
000011B4= 13 4F 66 EC 0A 64 ...    345              DC.B    19 , 79 , 102, 236, 10 , 100, 122, 188
000011BC= 56 52 9A 16 9B 90 ...    346              DC.B    86 , 82 , 154, 22 , 155, 144, 7  , 199
000011C4= 06 8A A4 F7 01 DA ...    347              DC.B    6  , 138, 164, 247, 1  , 218, 166, 82
000011CC= F2 E7 77 28 B1 76 ...    348              DC.B    242, 231, 119, 40 , 177, 118, 220, 102
000011D4= A4 42 E3 81 B1 67 ...    349              DC.B    164, 66 , 227, 129, 177, 103, 165, 108
000011DC= BF CE FA 16 BF 38 ...    350              DC.B    191, 206, 250, 22 , 191, 56 , 30 , 161
000011E4= D1 8B 50 0C 5F 49 ...    351              DC.B    209, 139, 80 , 12 , 95 , 73 , 168, 56
000011EC= DE 4C 14 A2 40 DC ...    352              DC.B    222, 76 , 20 , 162, 64 , 220, 93 , 12
000011F4= B6 9B 0A 38 5D AB ...    353              DC.B    182, 155, 10 , 56 , 93 , 171, 89 , 6
000011FC= E2 1B DD 75 15 82 ...    354              DC.B    226, 27 , 221, 117, 21 , 130, 101, 18
00001204= 8A 26 51 30 9F 47 ...    355              DC.B    138, 38 , 81 , 48 , 159, 71 , 57 , 21
0000120C= 1E 8A BB 71 C6 6E ...    356              DC.B    30 , 138, 187, 113, 198, 110, 185, 152
00001214= 9F 47 E5 34 94 27 ...    357              DC.B    159, 71 , 229, 52 , 148, 39 , 77 , 6
0000121C= 7D 06 D6 BA 30 0F ...    358              DC.B    125, 6  , 214, 186, 48 , 15 , 212, 22
00001224= EC 7F 7E 03 CF 2D ...    359              DC.B    236, 127, 126, 3  , 207, 45 , 193, 2
0000122C= 94 5B 23 F2 8B CD ...    360              DC.B    148, 91 , 35 , 242, 139, 205, 248, 237
00001234= 74 33 EC B9 0F D5 ...    361              DC.B    116, 51 , 236, 185, 15 , 213, 221, 6
00001234= 74 33 EC B9 0F D5 ...    362  -------------------- end include --------------------
0000123C                           363              INCLUDE 'HEADSRP.X68'
0000123C                           364  
0000123C                           365  ; ------------------------------------------------------------------------------
0000123C                           366  HEADINIT
0000123C                           367  ; INICIALIZAR CABEZA.
0000123C                           368  ; INPUT    : NONE 
0000123C                           369  ; OUTPUT   : NONE
0000123C                           370  ; MODIFIES : NONE
0000123C                           371  ; ------------------------------------------------------------------------------
0000123C  33FC 0140 000019D6       372              MOVE.W  #PANWIDTH/2,(CBZPOSX)
00001244  33FC 00F0 000019D8       373              MOVE.W  #PANHEIGH/2,(CBZPOSY)
0000124C  4279 000019EA            374              CLR     (TRZPLOT)
00001252  13FC 0003 000019EA       375              MOVE.B  #3,(TRZPLOT)
0000125A  4279 00001CF0            376              CLR.W   (ESTDCBZ)
00001260  33FC 0000 00001CF0       377              MOVE.W  #0,(ESTDCBZ)
00001268  4E75                     378              RTS
0000126A                           379              
0000126A                           380  ; ------------------------------------------------------------------------------
0000126A                           381  HEADUPD
0000126A                           382  ; ACTUALIZAR CABEZA.
0000126A                           383  ; INPUT    : NONE 
0000126A                           384  ; OUTPUT   : NONE
0000126A                           385  ; MODIFIES : NONE
0000126A                           386  ; ------------------------------------------------------------------------------
0000126A                           387  
0000126A  48A7 E000                388              MOVEM.W D0-D2,-(A7)            ; Guardar registros
0000126E                           389  
0000126E                           390  
0000126E                           391              ; Marcar celda actual como vacía
0000126E  3239 000019D6            392              MOVE.W  (CBZPOSX),D1
00001274  3439 000019D8            393              MOVE.W  (CBZPOSY),D2
0000127A  4EB9 0000173A            394              JSR     CINDMTRZ
00001280  4EB9 000017A0            395              JSR     MCLDVCIA               ; RESTAMOS 1 A LA CELDA ACTUAL
00001286                           396              
00001286                           397              
00001286                           398              ; Actualiza la posición de la cabeza según ESTDCBZ
00001286                           399              ;CLR.W   D0
00001286  3039 00001CF0            400              MOVE.W  (ESTDCBZ),D0
0000128C  B07C 0000                401              CMP.W   #0,D0
00001290  6700 001E                402              BEQ     SIGDER
00001294  B07C 0001                403              CMP.W   #1,D0
00001298  6700 0022                404              BEQ     SIGARR
0000129C  B07C 0002                405              CMP.W   #2,D0
000012A0  6700 0026                406              BEQ     SIGIZQ
000012A4  B07C 0003                407              CMP.W   #3,D0
000012A8  6700 002A                408              BEQ     SIGABA
000012AC                           409  
000012AC                           410  
000012AC                           411  
000012AC                           412              ; Si no hay dirección válida, sale
000012AC  6000 0072                413              BRA     FIN
000012B0                           414  
000012B0                           415  SIGDER:
000012B0  0679 0014 000019D6       416              ADD.W   #CBZVEL,(CBZPOSX)
000012B8  6000 0022                417              BRA     CHKCOL
000012BC                           418  
000012BC                           419  SIGARR:
000012BC  0479 0014 000019D8       420              SUB.W   #CBZVEL,(CBZPOSY)
000012C4  6000 0016                421              BRA     CHKCOL
000012C8                           422  
000012C8                           423  SIGIZQ:
000012C8  0479 0014 000019D6       424              SUB.W   #CBZVEL,(CBZPOSX)
000012D0  6000 000A                425              BRA     CHKCOL
000012D4                           426  
000012D4                           427  SIGABA:
000012D4  0679 0014 000019D8       428              ADD.W   #CBZVEL,(CBZPOSY)
000012DC                           429              
000012DC                           430  CHKCOL:
000012DC                           431              ; Verifica la colisión con la manzana
000012DC  3239 000019D6            432              MOVE.W  (CBZPOSX),D1
000012E2  3439 000019D8            433              MOVE.W  (CBZPOSY),D2
000012E8  B279 000019D2            434              CMP.W   (MNZPOSX),D1
000012EE  6600 0018                435              BNE     NOCOL
000012F2  B479 000019D4            436              CMP.W   (MNZPOSY),D2
000012F8  6600 000E                437              BNE     NOCOL
000012FC                           438              
000012FC                           439              ; Colisión detectada
000012FC  4EB9 00001564            440              JSR     APPLEUPD
00001302  4EB9 0000165A            441              JSR     SCOUPD
00001308                           442              ;JSR     SEGADD
00001308                           443              
00001308                           444  
00001308                           445  NOCOL:
00001308                           446              ; Convierte la posición nueva a índice
00001308  3239 000019D6            447              MOVE.W  (CBZPOSX),D1
0000130E  3439 000019D8            448              MOVE.W  (CBZPOSY),D2
00001314  4EB9 0000173A            449              JSR     CINDMTRZ
0000131A  4EB9 00001774            450              JSR     CBZOCPD                 ; Marca la celda como ocupada
00001320                           451  
00001320                           452  
00001320                           453  FIN:
00001320  4C9F 0007                454              MOVEM.W (A7)+,D0-D2
00001324                           455  
00001324  4E75                     456              RTS
00001326                           457              
00001326                           458  ; ------------------------------------------------------------------------------
00001326                           459  HEADPLOT
00001326                           460  ; DIBUJAR CABEZA.
00001326                           461  ; INPUT    : NONE 
00001326                           462  ; OUTPUT   : NONE
00001326                           463  ; MODIFIES : NONE
00001326                           464  ; ------------------------------------------------------------------------------
00001326                           465                         
00001326  3F00                     466              MOVE.W  D0,-(A7)               ; GUARDAMOS D0
00001328  3003                     467              MOVE.W  D3,D0                  ; PONEMOS EL INDICE DE LA CELDA EN D0 PARA CALCULAR SUS COORDENADAS
0000132A  4EB9 000017F8            468              JSR     CNVICOOR
00001330  2F01                     469              MOVE.L  D1,-(A7)
00001332                           470              
00001332                           471              ; SET COLOR DEL CONTORNO CABEZA
00001332  103C 0050                472              MOVE.B  #80,D0
00001336  223C 0000FF00            473              MOVE.L  #CBZPCOL,D1
0000133C  4E4F                     474              TRAP    #15
0000133E                           475              
0000133E                           476              ; SET COLOR DEL RELLENO CABEZA
0000133E  103C 0051                477              MOVE.B  #81,D0
00001342  223C 0000AA00            478              MOVE.L  #CBZFCOL,D1
00001348  4E4F                     479              TRAP    #15
0000134A                           480              
0000134A                           481              ; DIBUJAR CABEZA
0000134A  103C 0057                482              MOVE.B  #87,D0
0000134E  221F                     483              MOVE.L  (A7)+,D1
00001350  3F03                     484              MOVE.W  D3,-(A7)
00001352  3601                     485              MOVE.W  D1,D3
00001354  0643 0014                486              ADD.W   #CBZWIDTH,D3
00001358  3802                     487              MOVE.W  D2,D4
0000135A  0644 0014                488              ADD.W   #CBZHEIGH,D4
0000135E  4E4F                     489              TRAP    #15
00001360                           490              
00001360  2F01                     491              MOVE.L  D1,-(A7)
00001362                           492              
00001362                           493              ; SET COLOR DEL CONTORNO OJO
00001362  103C 0050                494              MOVE.B  #80,D0
00001366  7200                     495              MOVE.L  #OJOPCOL,D1
00001368  4E4F                     496              TRAP    #15
0000136A                           497              
0000136A                           498              ; SET COLOR DEL RELLENO OJO
0000136A  103C 0051                499              MOVE.B  #81,D0
0000136E  223C 00FFFFFF            500              MOVE.L  #OJOFCOL,D1
00001374  4E4F                     501              TRAP    #15
00001376                           502              
00001376                           503              ; DIBUJAR OJO
00001376  103C 0058                504              MOVE.B  #88,D0
0000137A  221F                     505              MOVE.L  (A7)+,D1
0000137C  2F01                     506              MOVE.L  D1,-(A7)
0000137E  2F02                     507              MOVE.L  D2,-(A7)
00001380  5A41                     508              ADD.W   #OJOWIDTH/2,D1            
00001382  3601                     509              MOVE.W  D1,D3
00001384  0643 000A                510              ADD.W   #OJOWIDTH,D3
00001388  5A42                     511              ADD.W   #OJOHEIGH/2,D2
0000138A  3802                     512              MOVE.W  D2,D4
0000138C  0644 000A                513              ADD.W   #OJOHEIGH,D4
00001390  4E4F                     514              TRAP    #15                     ; DIBUJAMOS EL PRIMER OJO
00001392                           515              
00001392                           516  
00001392                           517              ; DEFINIR COORDENADAS IRIS
00001392  241F                     518              MOVE.L  (A7)+,D2
00001394  221F                     519              MOVE.L  (A7)+,D1
00001396  0641 000A                520              ADD.W   #OJOWIDTH,D1
0000139A  0642 000A                521              ADD.W   #OJOHEIGH,D2
0000139E  103C 0052                522              MOVE.B  #82,D0
000013A2  4E4F                     523              TRAP    #15                     ; DIBUJAMOS EL PRIMER IRIS
000013A4                           524              
000013A4  361F                     525              MOVE.W  (A7)+,D3
000013A6  301F                     526              MOVE.W  (A7)+,D0
000013A8                           527  
000013A8  4E75                     528              RTS
000013AA                           529  
000013AA                           530  
000013AA                           531  
000013AA                           532  
000013AA                           533  
000013AA                           534  
000013AA                           535  
000013AA                           536  
000013AA                           537  
000013AA                           538  
000013AA                           539  
000013AA                           540  
000013AA                           541  
000013AA                           542  
000013AA                           543  
000013AA                           544  
000013AA                           545  
000013AA                           546  
000013AA                           547  
000013AA                           548  
000013AA                           549  
000013AA                           550  
000013AA                           551  
000013AA                           552  
000013AA                           553  
000013AA                           554  
000013AA                           555  
000013AA                           556  
000013AA                           557  
000013AA                           558  
000013AA                           559  
000013AA                           560  -------------------- end include --------------------
000013AA                           561              INCLUDE 'SEGSRP.X68'
000013AA                           562  
000013AA                           563  ; ------------------------------------------------------------------------------
000013AA                           564  SEGINIT
000013AA                           565  ; INICIALIZAR SEGMENTO.
000013AA                           566  ; INPUT    : NONE 
000013AA                           567  ; OUTPUT   : NONE
000013AA                           568  ; MODIFIES : NONE
000013AA                           569  ; ------------------------------------------------------------------------------
000013AA  33FC 012C 000019E2       570              MOVE.W  #(PANWIDTH/2)-CBZWIDTH,(SGMPOSX)
000013B2  33FC 00F0 000019E4       571              MOVE.W  #PANHEIGH/2,(SGMPOSY)
000013BA  33F9 000019E2 000019E6   572              MOVE.W  (SGMPOSX),(SGMPOSX2)
000013C4  33F9 000019E4 000019E8   573              MOVE.W  (SGMPOSY),(SGMPOSY2)
000013CE  0479 0014 000019E6       574              SUB.W   #SGMWIDTH,(SGMPOSX2)
000013D6  4E75                     575              RTS
000013D8                           576              
000013D8                           577  ; ------------------------------------------------------------------------------
000013D8                           578  SEGUPD
000013D8                           579  ; ACTUALIZAR SEGMENTO.
000013D8                           580  ; INPUT    : NONE 
000013D8                           581  ; OUTPUT   : NONE
000013D8                           582  ; MODIFIES : NONE
000013D8                           583  ; ------------------------------------------------------------------------------
000013D8                           584  
000013D8  48A7 6000                585              MOVEM.W D1-D2,-(A7)
000013DC                           586              
000013DC                           587              ; Marcar posición anterior del segmento como vacía
000013DC  3239 000019E6            588              MOVE.W  (SGMPOSX2),D1             ; Cargar posición X actual del segmento2
000013E2  3439 000019E8            589              MOVE.W  (SGMPOSY2),D2             ; Cargar posición Y actual del segmento2
000013E8  4EB9 0000173A            590              JSR     CINDMTRZ                ; Obtener índice de celda en D0
000013EE  4EB9 000017A0            591              JSR     MCLDVCIA                ; Marcar celda como vacía
000013F4                           592              
000013F4                           593              ; Actualizar posición del segmento para seguir a la cabeza
000013F4  33F9 000019E2 000019E6   594              MOVE.W  (SGMPOSX),(SGMPOSX2)    ; MARCAMOS LOS SEGMENTOS COMO SEGUNDA COORDENADA X
000013FE  33F9 000019E4 000019E8   595              MOVE.W  (SGMPOSY),(SGMPOSY2)    ; MARCAMOS LOS SEGMENTOS COMO SEGUNDA COORDENADA Y
00001408  33F9 000019D6 000019E2   596              MOVE.W  (CBZPOSX),(SGMPOSX)        ; Actualizar X del segmento con la X de la cabeza
00001412  33F9 000019D8 000019E4   597              MOVE.W  (CBZPOSY),(SGMPOSY)        ; Actualizar Y del segmento con la Y de la cabeza
0000141C                           598  
0000141C                           599              ; Marcar nueva posición del segmento como ocupada
0000141C  3239 000019E2            600              MOVE.W  (SGMPOSX),D1             ; Cargar nueva posición X
00001422  3439 000019E4            601              MOVE.W  (SGMPOSY),D2             ; Cargar nueva posición Y
00001428  4EB9 0000173A            602              JSR     CINDMTRZ                ; Obtener índice de celda en D0
0000142E  4EB9 000017B6            603              JSR     SGMOCPD                 ; Marcar celda como ocupada por segmento
00001434                           604              
00001434  3239 000019E6            605              MOVE.W  (SGMPOSX2),D1             ; Cargar nueva posición X DEL SEGMENTO 2
0000143A  3439 000019E8            606              MOVE.W  (SGMPOSY2),D2             ; Cargar nueva posición Y DEL SEGMENTO 2
00001440  4EB9 0000173A            607              JSR     CINDMTRZ                ; Obtener índice de celda en D0
00001446  4EB9 000017B6            608              JSR     SGMOCPD                 ; Marcar celda como ocupada por segmento
0000144C                           609              
0000144C  4C9F 0006                610              MOVEM.W (A7)+,D1-D2            
00001450  4E75                     611              RTS
00001452                           612  
00001452                           613   ;INTENTO DE AUMENTO SERPIENTE
00001452                           614  
00001452                           615  
00001452                           616  ;CODIGO ANTIGUO
00001452                           617              
00001452                           618              
00001452                           619              
00001452                           620  ; ------------------------------------------------------------------------------
00001452                           621  SEGPLOT
00001452                           622  ; DIBUJAR SEGMENTO.
00001452                           623  ; INPUT    : NONE 
00001452                           624  ; OUTPUT   : NONE
00001452                           625  ; MODIFIES : NONE
00001452                           626  ; ------------------------------------------------------------------------------
00001452  3F00                     627              MOVE.W  D0,-(A7)
00001454  3003                     628              MOVE.W  D3,D0
00001456  4EB9 000017F8            629              JSR     CNVICOOR
0000145C  2F01                     630              MOVE.L  D1,-(A7)
0000145E                           631              
0000145E  103C 0050                632              MOVE.B  #80,D0
00001462  223C 0000FF00            633              MOVE.L  #SGMPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DEL SEGMENTO
00001468  4E4F                     634              TRAP    #15
0000146A                           635              
0000146A  103C 0051                636              MOVE.B  #81,D0
0000146E  223C 0000AA00            637              MOVE.L  #SGMFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DEL SEGMENTO
00001474  4E4F                     638              TRAP    #15
00001476                           639              
00001476  103C 0057                640              MOVE.B  #87,D0
0000147A  221F                     641              MOVE.L  (A7)+,D1
0000147C  3F03                     642              MOVE.W  D3,-(A7)
0000147E  3601                     643              MOVE.W  D1,D3
00001480  0643 0014                644              ADD.W   #SIZECLDA,D3
00001484  3802                     645              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
00001486  0644 0014                646              ADD.W   #SIZECLDA,D4
0000148A  4E4F                     647              TRAP    #15                     
0000148C                           648                          
0000148C  361F                     649              MOVE.W  (A7)+,D3  
0000148E  301F                     650              MOVE.W  (A7)+,D0
00001490                           651  
00001490  4E75                     652              RTS
00001492                           653              
00001492                           654  
00001492                           655  
00001492                           656  
00001492                           657  
00001492                           658  
00001492                           659  
00001492                           660  
00001492                           661  
00001492                           662  
00001492                           663  
00001492                           664  
00001492                           665  
00001492                           666  
00001492                           667  -------------------- end include --------------------
00001492                           668              INCLUDE 'TAILSRP.X68'
00001492                           669     
00001492                           670  ; ------------------------------------------------------------------------------
00001492                           671  TAILINIT
00001492                           672  ; INICIALIZAR COLA.
00001492                           673  ; INPUT    : NONE 
00001492                           674  ; OUTPUT   : NONE
00001492                           675  ; MODIFIES : NONE
00001492                           676  ; ------------------------------------------------------------------------------
00001492                           677  
00001492  33FC 011D 000019DE       678              MOVE.W  #(PANWIDTH/2)-CBZWIDTH-SGMWIDTH+(COLWIDTH/2),(COLPOSX)
0000149A  33FC 00F0 000019E0       679              MOVE.W  #(PANHEIGH/2),(COLPOSY)
000014A2                           680              
000014A2  4E75                     681              RTS
000014A4                           682              
000014A4                           683              
000014A4                           684  ; ------------------------------------------------------------------------------
000014A4                           685  TAILUPD
000014A4                           686  ; ACTUALIZAR COLA.
000014A4                           687  ; INPUT    : NONE 
000014A4                           688  ; OUTPUT   : NONE
000014A4                           689  ; MODIFIES : NONE
000014A4                           690  ; ------------------------------------------------------------------------------
000014A4  48A7 6000                691              MOVEM.W D1-D2,-(A7)
000014A8                           692              
000014A8                           693              ; Marca la posición actual de la cola como vacía
000014A8  3239 000019DE            694              MOVE.W  (COLPOSX),D1
000014AE  3439 000019E0            695              MOVE.W  (COLPOSY),D2
000014B4  4EB9 0000173A            696              JSR     CINDMTRZ
000014BA  4EB9 000017A0            697              JSR     MCLDVCIA
000014C0                           698              ; Actualiza la posición de la cola para seguir al último segmento
000014C0  33F9 000019E6 000019DE   699              MOVE.W  (SGMPOSX2),(COLPOSX)
000014CA  33F9 000019E8 000019E0   700              MOVE.W  (SGMPOSY2),(COLPOSY)    ; MARCAMOS LA COOORDENADA DE LA COLA COMO COORDENADA DEL SEGMENTO 2
000014D4                           701  
000014D4                           702              ; Marca la nueva posición como cola
000014D4  3239 000019DE            703              MOVE.W  (COLPOSX),D1
000014DA  3439 000019E0            704              MOVE.W  (COLPOSY),D2
000014E0  4EB9 0000173A            705              JSR     CINDMTRZ
000014E6  4EB9 000017CC            706              JSR     COLOCPD
000014EC                           707  
000014EC                           708  ; CRECER SEGMENTOS
000014EC                           709              
000014EC                           710  
000014EC                           711  FINUPD
000014EC  4C9F 0006                712              MOVEM.W (A7)+,D1-D2
000014F0  4E75                     713              RTS
000014F2                           714              
000014F2                           715  ; ------------------------------------------------------------------------------
000014F2                           716  TAILPLOT
000014F2                           717  ; DIBUJAR COLA
000014F2                           718  ; INPUT    : NONE 
000014F2                           719  ; OUTPUT   : NONE
000014F2                           720  ; MODIFIES : NONE
000014F2                           721  ; ------------------------------------------------------------------------------
000014F2                           722  
000014F2  3F00                     723              MOVE.W  D0,-(A7)
000014F4  3003                     724              MOVE.W  D3,D0
000014F6  4EB9 000017F8            725              JSR     CNVICOOR
000014FC  2F01                     726              MOVE.L  D1,-(A7)
000014FE                           727              
000014FE  103C 0050                728              MOVE.B  #80,D0
00001502  223C 0000FF00            729              MOVE.L  #COLPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA COLA
00001508  4E4F                     730              TRAP    #15
0000150A                           731              
0000150A  103C 0051                732              MOVE.B  #81,D0
0000150E  223C 0000AA00            733              MOVE.L  #COLFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA COLA
00001514  4E4F                     734              TRAP    #15
00001516                           735              
00001516  103C 0057                736              MOVE.B  #87,D0
0000151A  221F                     737              MOVE.L  (A7)+,D1
0000151C  3F03                     738              MOVE.W  D3,-(A7)
0000151E  3601                     739              MOVE.W  D1,D3
00001520  0643 0014                740              ADD.W   #SIZECLDA,D3
00001524  3802                     741              MOVE.W  D2,D4                    
00001526  0644 0014                742              ADD.W   #SIZECLDA,D4
0000152A  4E4F                     743              TRAP    #15                    ; DIBUJAMOS EL CUADRADO 
0000152C                           744                          
0000152C  361F                     745              MOVE.W  (A7)+,D3  
0000152E  301F                     746              MOVE.W  (A7)+,D0
00001530                           747  
00001530  4E75                     748              RTS
00001532                           749  
00001532                           750  
00001532                           751              ; Itera sobre cada segmento de la cola y lo dibuja
00001532                           752              ; Convierte la posición de segmento actual a coordenadas
00001532                           753  
00001532                           754              ; Dibuja segmento actual
00001532                           755  
00001532                           756              ; Ir al siguiente segmento
00001532                           757              ; (Lógica de iteración según cómo estén almacenados los segmentos)
00001532                           758  
00001532                           759  
00001532                           760  
00001532                           761  
00001532                           762  
00001532                           763  
00001532                           764  
00001532                           765  
00001532                           766  
00001532                           767  
00001532                           768  
00001532                           769  
00001532                           770  
00001532                           771  
00001532                           772  
00001532                           773  
00001532                           774  
00001532                           775  
00001532                           776  
00001532                           777  
00001532                           778  
00001532                           779  
00001532                           780  -------------------- end include --------------------
00001532                           781              INCLUDE 'APPLE.X68'
00001532                           782     
00001532                           783  ; ------------------------------------------------------------------------------
00001532                           784  APPLEINIT
00001532                           785  ; Inicializa la manzana en una posición aleatoria
00001532                           786  ; INPUT    : NONE 
00001532                           787  ; OUTPUT   : NONE
00001532                           788  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
00001532                           789  ; ------------------------------------------------------------------------------
00001532                           790  
00001532                           791              ; Llama a la función para generar la posición aleatoria
00001532  4EB9 00001620            792              JSR     GENPOSMNZ
00001538                           793  
00001538                           794              ; Convierte las coordenadas de la manzana a índice de la matriz
00001538  4EB9 0000173A            795              JSR     CINDMTRZ
0000153E                           796  
0000153E                           797              ; Verifica si la celda está ocupada o libre
0000153E                           798  CHECK:
0000153E  4EB9 00001834            799              JSR     CHECKCLD
00001544  6700 0010                800              BEQ     MARKMNZ                  ; Si está libre
00001548                           801  
00001548                           802              ; Si la celda está ocupada
00001548  4EB9 00001620            803              JSR     GENPOSMNZ                ; Genera una nueva posición
0000154E  4EB9 0000173A            804              JSR     CINDMTRZ                 ; Convierte las nuevas coordenadas
00001554  60E8                     805              BRA     CHECK                    ; Repite la comprobación
00001556                           806  
00001556                           807  MARKMNZ:
00001556                           808              ; Marca la celda como ocupada con la manzana (estado 4)
00001556  4EB9 000017E2            809              JSR     MNZOCPD
0000155C                           810  
0000155C                           811              ; Dibuja la manzana en la pantalla
0000155C  4EB9 000015A2            812              JSR     APPLEPLOT
00001562                           813  
00001562  4E75                     814              RTS
00001564                           815  
00001564                           816  ; ------------------------------------------------------------------------------
00001564                           817  APPLEUPD
00001564                           818  ; Actualiza la posición de la manzana cuando la serpiente come
00001564                           819  ; INPUT    : NONE 
00001564                           820  ; OUTPUT   : NONE
00001564                           821  ; MODIFIES : MNZPOSX, MNZPOSY, ESTDCLDS
00001564                           822  ; ------------------------------------------------------------------------------
00001564                           823  
00001564                           824  
00001564                           825              ; Convierte las coordenadas actuales de la manzana a índice de la matriz
00001564  4EB9 0000173A            826              JSR     CINDMTRZ
0000156A                           827  
0000156A                           828              ; Marca la celda anterior como vacía
0000156A  4EB9 000017A0            829              JSR     MCLDVCIA
00001570                           830  
00001570                           831              ; Llama a la función para generar una nueva posición aleatoria
00001570  4EB9 00001620            832              JSR     GENPOSMNZ
00001576                           833  
00001576                           834              ; Convierte las nuevas coordenadas de la manzana a índice de la matriz
00001576  4EB9 0000173A            835              JSR     CINDMTRZ
0000157C                           836  
0000157C                           837  CHCKUPDT:
0000157C  4EB9 00001834            838              JSR     CHECKCLD             ; Verifica si la celda está libre
00001582  6700 0010                839              BEQ     NEWMNZ               ; Si está libre
00001586                           840  
00001586                           841              ; Si la celda está ocupada
00001586  4EB9 00001620            842              JSR     GENPOSMNZ            ; Genera una nueva posición
0000158C  4EB9 0000173A            843              JSR     CINDMTRZ             ; Convierte las nuevas coordenadas
00001592  60E8                     844              BRA     CHCKUPDT             ; Repite la comprobación
00001594                           845  
00001594                           846  NEWMNZ:
00001594                           847              ; Marca la celda como ocupada con la manzana (estado 4)
00001594  4EB9 000017E2            848              JSR     MNZOCPD
0000159A                           849  
0000159A                           850              ; Dibuja la nueva manzana en la pantalla
0000159A  4EB9 000015A2            851              JSR     APPLEPLOT
000015A0                           852  
000015A0  4E75                     853              RTS
000015A2                           854              
000015A2                           855  ; ------------------------------------------------------------------------------
000015A2                           856  APPLEPLOT
000015A2                           857  ; Dibuja la manzana
000015A2                           858  ; INPUT    : NONE 
000015A2                           859  ; OUTPUT   : NONE
000015A2                           860  ; MODIFIES : NONE
000015A2                           861  ; ------------------------------------------------------------------------------
000015A2  3F00                     862              MOVE.W  D0,-(A7)
000015A4  3003                     863              MOVE.W  D3,D0
000015A6  4EB9 000017F8            864              JSR     CNVICOOR
000015AC  2F01                     865              MOVE.L  D1,-(A7)                ; PRIMERO DEBEMOS DIBUJAR EL FONDO Y LUEGO LA MANZANA
000015AE                           866              
000015AE  103C 0050                867              MOVE.B  #80,D0
000015B2  223C 0090EE90            868              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
000015B8  4E4F                     869              TRAP    #15
000015BA                           870              
000015BA  103C 0051                871              MOVE.B  #81,D0
000015BE  223C 0090EE90            872              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
000015C4  4E4F                     873              TRAP    #15
000015C6                           874              
000015C6  103C 0057                875              MOVE.B  #87,D0
000015CA  221F                     876              MOVE.L  (A7)+,D1
000015CC  3F03                     877              MOVE.W  D3,-(A7)
000015CE  3601                     878              MOVE.W  D1,D3
000015D0  0643 0014                879              ADD.W   #SIZECLDA,D3
000015D4  3802                     880              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
000015D6  0644 0014                881              ADD.W   #SIZECLDA,D4
000015DA  4E4F                     882              TRAP    #15                     
000015DC                           883                          
000015DC  361F                     884              MOVE.W  (A7)+,D3  
000015DE  301F                     885              MOVE.W  (A7)+,D0
000015E0                           886  
000015E0  3F00                     887              MOVE.W  D0,-(A7)
000015E2  3003                     888              MOVE.W  D3,D0
000015E4  4EB9 000017F8            889              JSR     CNVICOOR
000015EA  2F01                     890              MOVE.L  D1,-(A7)
000015EC                           891              
000015EC  103C 0050                892              MOVE.B  #80,D0
000015F0  223C 0000AAFF            893              MOVE.L  #MNZPCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL CONTORNO DE LA MANZANA
000015F6  4E4F                     894              TRAP    #15
000015F8                           895              
000015F8  103C 0051                896              MOVE.B  #81,D0
000015FC  223C 000000FF            897              MOVE.L  #MNZFCOL,D1            ; PONEMOS EL COLOR DE DIBUJADO AL COLOR DEL RELLENO DE LA MANZANA
00001602  4E4F                     898              TRAP    #15
00001604                           899              
00001604  103C 0058                900              MOVE.B  #88,D0
00001608  221F                     901              MOVE.L  (A7)+,D1
0000160A  3F03                     902              MOVE.W  D3,-(A7)
0000160C  3601                     903              MOVE.W  D1,D3
0000160E  0643 0014                904              ADD.W   #SIZECLDA,D3
00001612  3802                     905              MOVE.W  D2,D4                    ; DIBUJAMOS EL CIRCULO
00001614  0644 0014                906              ADD.W   #SIZECLDA,D4
00001618  4E4F                     907              TRAP    #15                     
0000161A                           908                          
0000161A  361F                     909              MOVE.W  (A7)+,D3  
0000161C  301F                     910              MOVE.W  (A7)+,D0
0000161E                           911  
0000161E                           912  
0000161E  4E75                     913              RTS
00001620                           914  ; ----------------------------------------------------------------------------
00001620                           915  GENPOSMNZ
00001620                           916  ; Genera una posición aleatoria para la manzana
00001620                           917  ; INPUT: NONE
00001620                           918  ; OUTPUT:
00001620                           919  ; MODIFIES: MNZPOSX, MNZPOSY
00001620                           920  ; ----------------------------------------------------------------------------
00001620                           921  
00001620  48E7 8000                922              MOVEM.L D0,-(A7)
00001624                           923  
00001624                           924              ; Genera la coordenada X aleatoria
00001624  4EB8 111E                925              JSR     UTLRAND
00001628  0240 001F                926              ANDI.W  #NUMCLMNS-1, D0       ; Asegura que esté en [0, NUMCLMNS-1]
0000162C  C0FC 0014                927              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
00001630  3200                     928              MOVE.W  D0,D1
00001632  33C0 000019D2            929              MOVE.W  D0, MNZPOSX           ; Guarda la coordenada X generada
00001638                           930              
00001638                           931              ; Generar coordenada Y aleatoria
00001638  4EB8 111E                932              JSR     UTLRAND
0000163C  0240 0017                933              ANDI.W  #NUMFILAS-1, D0       ; Asegura que esté en el rango [0, NUMFILAS-1]
00001640  C0FC 0014                934              MULU    #SIZECLDA, D0         ; Escala al tamaño real de las celdas
00001644  3400                     935              MOVE.W  D0,D2
00001646  33C0 000019D4            936              MOVE.W  D0, MNZPOSY           ; Guarda la coordenada Y generada
0000164C                           937              
0000164C  4CDF 0001                938              MOVEM.L (A7)+,D0
00001650  4E75                     939              RTS 
00001652                           940  
00001652                           941  
00001652                           942  
00001652                           943  
00001652                           944  
00001652                           945  
00001652                           946  -------------------- end include --------------------
00001652                           947              INCLUDE 'SCORE.X68'
00001652                           948     
00001652                           949  ; ------------------------------------------------------------------------------
00001652                           950  SCOINIT
00001652                           951  ; INICIALIZAR MARCADOR.
00001652                           952  ; INPUT    : NONE 
00001652                           953  ; OUTPUT   : NONE
00001652                           954  ; MODIFIES : NONE
00001652                           955  ; ------------------------------------------------------------------------------
00001652  4279 000019EC            956              CLR.W   (JGOPNTS)
00001658  4E75                     957              RTS
0000165A                           958              
0000165A                           959  ; ------------------------------------------------------------------------------
0000165A                           960  SCOUPD
0000165A                           961  ; ACTUALIZAR MARCADOR.
0000165A                           962  ; INPUT    : NONE 
0000165A                           963  ; OUTPUT   : NONE
0000165A                           964  ; MODIFIES : NONE
0000165A                           965  ; ------------------------------------------------------------------------------
0000165A                           966              
0000165A  48E7 8000                967              MOVEM.L D0,-(A7)
0000165E                           968              
0000165E                           969              ;Incrementa el marcador
0000165E  3039 000019EC            970              MOVE.W  (JGOPNTS),D0
00001664  0640 0019                971              ADD.W  #25,D0
00001668  33C0 000019EC            972              MOVE.W  D0,(JGOPNTS)
0000166E                           973              
0000166E  4CDF 0001                974              MOVEM.L (A7)+,D0
00001672                           975  
00001672  4E75                     976              RTS
00001674                           977              
00001674                           978  ; ------------------------------------------------------------------------------
00001674                           979  SCOPLOT
00001674                           980  ; DIBUJAR MARCADOR.
00001674                           981  ; INPUT    : NONE 
00001674                           982  ; OUTPUT   : NONE
00001674                           983  ; MODIFIES : NONE
00001674                           984  ; ------------------------------------------------------------------------------
00001674  48E7 C040                985             MOVEM.L  D0-D1/A1,-(A7)
00001678                           986             ; SET COLOR DE FONDO
00001678  103C 0051                987             MOVE.B   #81,D0
0000167C  223C 0090EE90            988             MOVE.L   #COLFND,D1
00001682  4E4F                     989             TRAP     #15
00001684                           990             
00001684                           991             
00001684                           992             
00001684                           993             ; DIBUJAR LINEA DE PUNTUACIÓN
00001684  43F9 0000169E            994              LEA     .TXT1,A1
0000168A  4281                     995              CLR.L   D1
0000168C  3239 000019EC            996              MOVE.W  (JGOPNTS),D1
00001692  103C 0011                997              MOVE.B  #17,D0
00001696  4E4F                     998              TRAP    #15
00001698                           999              
00001698  4CDF 0203               1000              MOVEM.L (A7)+,D0-D1/A1
0000169C  4E75                    1001              RTS
0000169E                          1002  
0000169E                          1003  
0000169E= 50 55 4E 54 4F 53 ...   1004  .TXT1       DC.B    'PUNTOS : ',0
000016A8                          1005  
000016A8                          1006  
000016A8                          1007  
000016A8                          1008  
000016A8                          1009  -------------------- end include --------------------
000016A8                          1010              INCLUDE 'MATRIZ.X68'
000016A8                          1011  ; ----------------------------------------------------------------------------
000016A8                          1012  ; MATRIZ
000016A8                          1013  ; ----------------------------------------------------------------------------
000016A8                          1014  
000016A8                          1015  ;-----------------------------------------------------------------------------
000016A8                          1016  MTZINIT
000016A8                          1017  ; INICIALIZA LA MATRIZ, AL PRINCIPIO ESTÁ VACÍA
000016A8                          1018  ; INPUT    : NONE
000016A8                          1019  ; OUTPUT   : NONE
000016A8                          1020  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
000016A8                          1021  ; ----------------------------------------------------------------------------
000016A8                          1022              
000016A8  48A7 E080               1023              MOVEM.W D0-D2/A0,-(A7)
000016AC                          1024              
000016AC  41F9 000019F0           1025              LEA ESTDCLDS, A0       ; Apunta al inicio de ESTDCLDS
000016B2  303C 0300               1026              MOVE.W #TCELDAS, D0    ; Número total de celdas
000016B6                          1027  
000016B6                          1028  CLNCLDS:
000016B6  4218                    1029              CLR.B (A0)+            ; Coloca 0 en cada celda
000016B8  5340                    1030              SUBI.W #1, D0          ; Decrementa el contador de celdas
000016BA  66FA                    1031              BNE CLNCLDS            ; Repite hasta que esten vacías
000016BC                          1032              
000016BC                          1033              
000016BC  3239 000019D6           1034              MOVE.W  CBZPOSX, D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
000016C2  3439 000019D8           1035              MOVE.W  CBZPOSY, D2
000016C8  4EB9 0000173A           1036              JSR     CINDMTRZ
000016CE  4EB9 00001774           1037              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
000016D4                          1038              
000016D4  3239 000019E2           1039              MOVE.W  SGMPOSX, D1
000016DA  3439 000019E4           1040              MOVE.W  SGMPOSY, D2             ; VEMOS LA POSICIÓN DEL SEGMENTO
000016E0  4EB9 0000173A           1041              JSR     CINDMTRZ
000016E6  4EB9 000017B6           1042              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
000016EC                          1043              
000016EC  3239 000019E6           1044              MOVE.W  SGMPOSX2, D1
000016F2  3439 000019E8           1045              MOVE.W  SGMPOSY2, D2            ; VEMOS LA POSICIÓN DEL SEGMENTO 2
000016F8  4EB9 0000173A           1046              JSR     CINDMTRZ
000016FE  4EB9 000017B6           1047              JSR     SGMOCPD                 ; MARCAMOS LA POSICION DEL SEGMENTO 2
00001704                          1048              
00001704  3239 000019DE           1049              MOVE.W  COLPOSX, D1             ; VEMOS LA POSICIÓN DE LA COLA
0000170A  3439 000019E0           1050              MOVE.W  COLPOSY, D2
00001710  4EB9 0000173A           1051              JSR     CINDMTRZ
00001716  4EB9 000017CC           1052              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
0000171C                          1053              
0000171C  3239 000019D2           1054              MOVE.W  MNZPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
00001722  3439 000019D4           1055              MOVE.W  MNZPOSY, D2
00001728  4EB9 0000173A           1056              JSR     CINDMTRZ
0000172E  4EB9 000017E2           1057              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
00001734                          1058              
00001734                          1059              
00001734  4C9F 0107               1060              MOVEM.W (A7)+,D0-D2/A0
00001738                          1061  
00001738  4E75                    1062              RTS
0000173A                          1063  
0000173A                          1064  ;-----------------------------------------------------------------------------
0000173A                          1065  CINDMTRZ
0000173A                          1066  ; CALCULA EL ÍNDICE DE UNA CELDA
0000173A                          1067  ; INPUT    : D1 = coordenada X pantalla, D2 = coordenada Y pantalla
0000173A                          1068  ; OUTPUT   : D0 = índice de la celda en ESTDCLDS
0000173A                          1069  ; MODIFIES : NONE
0000173A                          1070  ; ----------------------------------------------------------------------------
0000173A                          1071  
0000173A  48A7 7000               1072               MOVEM.W D1-D3,-(A7)     ; Guarda los registros D1-D3 en la pila
0000173E                          1073  
0000173E                          1074              ; Divide X por SIZECLDA
0000173E  3601                    1075              MOVE.W  D1, D3          ; Copia X a D3
00001740  4241                    1076              CLR.W   D1              ; Inicializa el cociente de X
00001742                          1077  
00001742  B67C 0014               1078  DIVX:       CMP.W   #SIZECLDA, D3    ; Compara D3 con SIZECLDA
00001746  6D00 000A               1079              BLT     ENDDIVX         ; Si D3 < SIZECLDA, salta a ENDDIVX
0000174A  0443 0014               1080              SUB.W   #SIZECLDA, D3   ; Resta SIZECLDA de D3
0000174E  5241                    1081              ADDQ.W  #1, D1          ; Incrementa el cociente de X
00001750  60F0                    1082              BRA     DIVX            ; Repite el bucle
00001752                          1083  
00001752                          1084  ENDDIVX:
00001752                          1085  
00001752                          1086              ; Divide Y por SIZECLDA
00001752  3602                    1087              MOVE.W  D2, D3          ; Copia Y a D3
00001754  4242                    1088              CLR.W   D2              ; Inicializa el cociente de Y
00001756                          1089  
00001756  B67C 0014               1090  DIVY:       CMP.W   #SIZECLDA, D3    ; Compara D3 con SIZECLDA
0000175A  6D00 000A               1091              BLT     ENDDIVY         ; Si D3 < SIZECLDA, salta a ENDDIVY
0000175E  0443 0014               1092              SUB.W   #SIZECLDA, D3   ; Resta SIZECLDA de D3
00001762  5242                    1093              ADDQ.W  #1, D2          ; Incrementa el cociente de Y
00001764  60F0                    1094              BRA     DIVY            ; Repite el bucle
00001766                          1095  
00001766                          1096  ENDDIVY:
00001766                          1097  
00001766                          1098              ; Calcula el índice
00001766  4240                    1099              CLR.W   D0
00001768  3002                    1100              MOVE.W  D2, D0          ; D0 = Y_CELDA
0000176A  EB40                    1101              ASL.W   #5, D0          ; D0 = Y_CELDA * NUMCLMNS (32 = 2^5)
0000176C  D041                    1102              ADD.W   D1, D0          ; D0 = Y_CELDA * NUMCLMNS + X_CELDA
0000176E                          1103  
0000176E  4C9F 000E               1104              MOVEM.W (A7)+,D1-D3     ; Restaura los registros D1-D3 desde la pila
00001772                          1105  
00001772  4E75                    1106              RTS  
00001774                          1107              
00001774                          1108  ;-----------------------------------------------------------------------------
00001774                          1109  CBZOCPD
00001774                          1110  ; MARCA UNA CELDA COMO OCUPADA POR LA CABEZA
00001774                          1111  ; INPUT    : D0 = índice de la celda en ESTDCLDS
00001774                          1112  ; OUTPUT   : NONE
00001774                          1113  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
00001774                          1114  ; ----------------------------------------------------------------------------
00001774                          1115  
00001774  48A7 0080               1116              MOVEM.W A0,-(A7)
00001778                          1117  
00001778  41F9 000019F0           1118              LEA     ESTDCLDS, A0                ; Dirección de la matriz en A0
0000177E  11B9 000019EA 0000      1119              MOVE.B  TRZPLOT, (A0, D0.W)           ; Marca la celda como ocupada
00001786                          1120              
00001786  4C9F 0100               1121              MOVEM.W (A7)+,A0
0000178A                          1122              
0000178A  4E75                    1123              RTS
0000178C                          1124              
0000178C                          1125              
0000178C                          1126              
0000178C                          1127  ;-----------------------------------------------------------------------------
0000178C                          1128  RSTCLD
0000178C                          1129  ; RESTA 1 A LA CELDA PASADA POR PARÁMETRO
0000178C                          1130  ; INPUT    : D0 = índice de la celda en ESTDCLDS
0000178C                          1131  ; OUTPUT   : NONE
0000178C                          1132  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
0000178C                          1133  ; ----------------------------------------------------------------------------
0000178C                          1134  
0000178C  48A7 0080               1135              MOVEM.W A0,-(A7)
00001790                          1136  
00001790  41F9 000019F0           1137              LEA     ESTDCLDS, A0              ; Dirección de la matriz en A0
00001796  5330 0000               1138              SUBQ.B   #1, (A0, D0.W)           ; Marca la celda como ocupada
0000179A                          1139              
0000179A  4C9F 0100               1140              MOVEM.W (A7)+,A0
0000179E                          1141              
0000179E  4E75                    1142              RTS
000017A0                          1143             
000017A0                          1144  ;-----------------------------------------------------------------------------
000017A0                          1145  MCLDVCIA
000017A0                          1146  ; MARCA UNA CELDA COMO VACÍA
000017A0                          1147  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000017A0                          1148  ; OUTPUT   : NONE
000017A0                          1149  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000017A0                          1150  ; ----------------------------------------------------------------------------
000017A0                          1151  
000017A0  48A7 0080               1152              MOVEM.W A0,-(A7)
000017A4                          1153  
000017A4  41F9 000019F0           1154              LEA ESTDCLDS, A0                ; Direccion de la matriz en A0
000017AA  11BC 0000 0000          1155              MOVE.B #0, (A0, D0.W)           ; Marca la celda como vacía
000017B0                          1156              
000017B0  4C9F 0100               1157              MOVEM.W (A7)+,A0
000017B4                          1158              
000017B4  4E75                    1159              RTS
000017B6                          1160  
000017B6                          1161  ;-----------------------------------------------------------------------------
000017B6                          1162  SGMOCPD
000017B6                          1163  ; MARCA UNA CELDA COMO OCUPADA POR EL SEGMENTO
000017B6                          1164  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000017B6                          1165  ; OUTPUT   : NONE
000017B6                          1166  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000017B6                          1167  ; ----------------------------------------------------------------------------
000017B6                          1168  
000017B6  48A7 0080               1169              MOVEM.W A0,-(A7)
000017BA                          1170  
000017BA  41F9 000019F0           1171              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
000017C0  11BC 0002 0000          1172              MOVE.B #2, (A0, D0.W)           ; Marca la celda como ocupada
000017C6                          1173              
000017C6  4C9F 0100               1174              MOVEM.W (A7)+,A0
000017CA                          1175              
000017CA  4E75                    1176              RTS
000017CC                          1177              
000017CC                          1178  ;-----------------------------------------------------------------------------
000017CC                          1179  COLOCPD
000017CC                          1180  ; MARCA UNA CELDA COMO OCUPADA POR LA COLA
000017CC                          1181  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000017CC                          1182  ; OUTPUT   : NONE
000017CC                          1183  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000017CC                          1184  ; ----------------------------------------------------------------------------
000017CC                          1185  
000017CC  48A7 0080               1186              MOVEM.W A0,-(A7)
000017D0                          1187  
000017D0  41F9 000019F0           1188              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
000017D6  11BC 0001 0000          1189              MOVE.B #1, (A0, D0.W)           ; Marca la celda como ocupada
000017DC                          1190              
000017DC  4C9F 0100               1191              MOVEM.W (A7)+,A0
000017E0                          1192              
000017E0  4E75                    1193              RTS
000017E2                          1194  
000017E2                          1195  
000017E2                          1196  ;-----------------------------------------------------------------------------
000017E2                          1197  MNZOCPD
000017E2                          1198  ; MARCA UNA CELDA COMO OCUPADA POR LA MANZANA
000017E2                          1199  ; INPUT    : D0 = índice de la celda en ESTDCLDS
000017E2                          1200  ; OUTPUT   : NONE
000017E2                          1201  ; MODIFIES : Estado de la celda en la variable ESTDCLDS
000017E2                          1202  ; ----------------------------------------------------------------------------
000017E2                          1203  
000017E2  48A7 0080               1204              MOVEM.W A0,-(A7)
000017E6                          1205  
000017E6  41F9 000019F0           1206              LEA ESTDCLDS, A0                ; Dirección de la matriz en A0
000017EC  11BC 0004 0000          1207              MOVE.B #4, (A0, D0.W)           ; Marca la celda como ocupada
000017F2                          1208              
000017F2  4C9F 0100               1209              MOVEM.W (A7)+,A0
000017F6                          1210              
000017F6  4E75                    1211              RTS
000017F8                          1212  
000017F8                          1213              
000017F8                          1214  ;-----------------------------------------------------------------------------
000017F8                          1215  CNVICOOR
000017F8                          1216  ; Convierte un índice de celda a coordenadas de pantalla (X, Y)
000017F8                          1217  ; INPUT    : D0 = índice de la celda en ESTADO_CELDAS
000017F8                          1218  ; OUTPUT   : D1 = coordenada X, D2 = coordenada Y
000017F8                          1219  ; MODIFIES : NONE
000017F8                          1220  ; ----------------------------------------------------------------------------
000017F8                          1221  
000017F8  48A7 9800               1222              MOVEM.W D0/D3-D4,-(A7)
000017FC                          1223  
000017FC  3400                    1224              MOVE.W  D0,D2         ; Copia índice a D2 para calcular la fila
000017FE  EA4A                    1225              LSR.W   #5,D2         ; D2 = índice / NUM_COLUMNAS (32 = 2^5)
00001800  3200                    1226              MOVE.W  D0,D1         ; Copia índice a D1 para calcular la columna
00001802  C27C 001F               1227              AND.W   #$1F,D1       ; D1 = índice % NUM_COLUMNAS (31 = 0x1F) (CREO)
00001806                          1228  
00001806                          1229              ; Multiplica por TAMAÑO_CELDA = 10
00001806  363C 0014               1230              MOVE.W  #SIZECLDA, D3
0000180A  3801                    1231              MOVE.W  D1,D4         ; Copia D1 para multiplicar por 10
0000180C  4241                    1232              CLR.W   D1            ; Inicializa resultado
0000180E                          1233  
0000180E                          1234  
0000180E                          1235  MULTLOOPX: 
0000180E  B87C 0000               1236              CMP.W   #0, D4        ; ¿Quedan iteraciones?
00001812  6700 0008               1237              BEQ     ENDMULTX
00001816  D243                    1238              ADD.W   D3,D1         ; Suma TAMANO_CELDA (10) repetidamente
00001818                          1239  
00001818  5344                    1240              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
0000181A  60F2                    1241              BRA     MULTLOOPX     ; Repite mientras no sea 0
0000181C                          1242  ENDMULTX: 
0000181C  3802                    1243              MOVE.W  D2,D4         ; Copia D2 para multiplicar por 10
0000181E  4242                    1244              CLR.W   D2            ; Inicializa resultado
00001820                          1245  
00001820                          1246  MULTLOOPY: 
00001820  B87C 0000               1247              CMP.W   #0, D4        ; ¿Quedan iteraciones?
00001824  6700 0008               1248              BEQ     ENDMULTY
00001828  D443                    1249              ADD.W   D3,D2         ; Suma TAMANO_CELDA (10) repetidamente
0000182A  5344                    1250              SUBQ.W  #1,D4         ; Cuenta las iteraciones restantes
0000182C  60F2                    1251              BRA     MULTLOOPY     ; Repite mientras no sea 0
0000182E                          1252  ENDMULTY:
0000182E  4C9F 0019               1253              MOVEM.W (A7)+,D0/D3-D4
00001832                          1254  
00001832  4E75                    1255              RTS
00001834                          1256  
00001834                          1257  ; ----------------------------------------------------------------------------
00001834                          1258  CHECKCLD
00001834                          1259  ; INPUT: D0 = índice de la celda
00001834                          1260  ; OUTPUT: D0 = 0 si está vacía, 1 si está ocupada
00001834                          1261  ; MODIFIES: Ninguno
00001834                          1262  ; ----------------------------------------------------------------------------
00001834                          1263  
00001834  41F9 000019F0           1264              LEA     ESTDCLDS, A0    ; Carga la dirección de la matriz ESTDCLDS
0000183A  1230 0000               1265              MOVE.B  (A0, D0.W),D1   ; Carga el estado de la celda en D1
0000183E  B23C 0000               1266              CMP.B   #0, D1          ; Compara si está vacía (0)
00001842  6700 0008               1267              BEQ     CLDFREE         ; Si está vacía
00001846  303C 0001               1268              MOVE.W  #1, D0          ; Si está ocupada, devuelve 1 (ocupada)
0000184A                          1269  
0000184A  4E75                    1270              RTS
0000184C                          1271  
0000184C                          1272  CLDFREE:
0000184C  303C 0000               1273              MOVE.W  #0, D0                 ; Devuelve 0 (libre)
00001850                          1274  
00001850  4E75                    1275              RTS
00001852                          1276  
00001852                          1277  
00001852                          1278  ;-----------------------------------------------------------------------------
00001852                          1279  FONPLOT
00001852                          1280  ; DIBUJADO DEL FONDO
00001852                          1281  ; INPUT    : NONE
00001852                          1282  ; OUTPUT   : NONE
00001852                          1283  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
00001852                          1284  ; ----------------------------------------------------------------------------
00001852                          1285  
00001852  3F00                    1286              MOVE.W  D0,-(A7)
00001854  3003                    1287              MOVE.W  D3,D0
00001856  4EB8 17F8               1288              JSR     CNVICOOR
0000185A  2F01                    1289              MOVE.L  D1,-(A7)
0000185C                          1290              
0000185C  103C 0050               1291              MOVE.B  #80,D0
00001860  223C 0090EE90           1292              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
00001866  4E4F                    1293              TRAP    #15
00001868                          1294              
00001868  103C 0051               1295              MOVE.B  #81,D0
0000186C  223C 0090EE90           1296              MOVE.L  #COLFND,D1            ; PONEMOS EL COLOR DE DIBUJADO A COLORFONDO
00001872  4E4F                    1297              TRAP    #15
00001874                          1298              
00001874  103C 0057               1299              MOVE.B  #87,D0
00001878  221F                    1300              MOVE.L  (A7)+,D1
0000187A  3F03                    1301              MOVE.W  D3,-(A7)
0000187C  3601                    1302              MOVE.W  D1,D3
0000187E  0643 0014               1303              ADD.W   #SIZECLDA,D3
00001882  3802                    1304              MOVE.W  D2,D4                    ; DIBUJAMOS EL CUADRADO
00001884  0644 0014               1305              ADD.W   #SIZECLDA,D4
00001888  4E4F                    1306              TRAP    #15                     
0000188A                          1307                          
0000188A  361F                    1308              MOVE.W  (A7)+,D3  
0000188C  301F                    1309              MOVE.W  (A7)+,D0
0000188E  4E75                    1310              RTS         
00001890                          1311  
00001890                          1312  
00001890                          1313  
00001890                          1314  ;-----------------------------------------------------------------------------
00001890                          1315  MTZUPD
00001890                          1316  ; ACTUALIZA LA MATRIZ CASILLA A CASILLA
00001890                          1317  ; INPUT    : NONE
00001890                          1318  ; OUTPUT   : NONE
00001890                          1319  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
00001890                          1320  ; ----------------------------------------------------------------------------
00001890                          1321  
00001890                          1322  
00001890  48A7 E080               1323              MOVEM.W D0-D2/A0,-(A7)
00001894                          1324              
00001894  41F9 000019F0           1325              LEA ESTDCLDS, A0       ; Apunta al inicio de ESTDCLDS
0000189A  303C 0300               1326              MOVE.W #TCELDAS, D0    ; Número total de celdas
0000189E                          1327  
0000189E                          1328  .CLNCLDS:
0000189E  4218                    1329              CLR.B (A0)+            ; Coloca 0 en cada celda
000018A0  5340                    1330              SUBI.W #1, D0          ; Decrementa el contador de celdas
000018A2  66FA                    1331              BNE .CLNCLDS           ; Repite hasta que esten vacías
000018A4                          1332              
000018A4                          1333              
000018A4  3239 000019D6           1334              MOVE.W  CBZPOSX, D1             ; VEMOS LA POSICION INICIAL DE LA CABEZA             
000018AA  3439 000019D8           1335              MOVE.W  CBZPOSY, D2
000018B0  4EB8 173A               1336              JSR     CINDMTRZ
000018B4  4EB8 1774               1337              JSR     CBZOCPD                 ; MARCAMOS LA POSICIÓN COMO CABEZA
000018B8                          1338              
000018B8  3239 000019E2           1339              MOVE.W  SGMPOSX, D1
000018BE  3439 000019E4           1340              MOVE.W  SGMPOSY, D2             ; VEMOS LA POSICIÓN INICIAL DEL SEGMENTO
000018C4  4EB8 173A               1341              JSR     CINDMTRZ
000018C8  4EB8 17B6               1342              JSR     SGMOCPD                 ; MARCAMOS LA POSICIÓN DEL SEGMENTO
000018CC                          1343              
000018CC  3239 000019DE           1344              MOVE.W  COLPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA COLA
000018D2  3439 000019E0           1345              MOVE.W  COLPOSY, D2
000018D8  4EB8 173A               1346              JSR     CINDMTRZ
000018DC  4EB8 17CC               1347              JSR     COLOCPD                 ; MARCAMOS LA POSICIÓN DE LA COLA
000018E0                          1348              
000018E0  3239 000019D2           1349              MOVE.W  MNZPOSX, D1             ; VEMOS LA POSICIÓN INICIAL DE LA MANZANA
000018E6  3439 000019D4           1350              MOVE.W  MNZPOSY, D2
000018EC  4EB8 173A               1351              JSR     CINDMTRZ
000018F0  4EB8 17E2               1352              JSR     MNZOCPD                 ; MARCAMOS LA POSICIÓN DE LA MANZANA
000018F4                          1353              
000018F4                          1354              
000018F4  4C9F 0107               1355              MOVEM.W (A7)+,D0-D2/A0
000018F8                          1356  
000018F8  4E75                    1357              RTS
000018FA                          1358  
000018FA                          1359  
000018FA                          1360  
000018FA                          1361  ;-----------------------------------------------------------------------------
000018FA                          1362  MTZPLOT
000018FA                          1363  ; DIBUJA LA MATRIZ CASILLA A CASILLA
000018FA                          1364  ; INPUT    : NONE
000018FA                          1365  ; OUTPUT   : NONE
000018FA                          1366  ; MODIFIES : Variable ESTCLDS que contiene el estado de las celdas
000018FA                          1367  ; ----------------------------------------------------------------------------
000018FA  48E7 F080               1368              MOVEM.L D0-D3/A0,-(A7)
000018FE                          1369  
000018FE  4240                    1370              CLR.W   D0
00001900  4243                    1371              CLR.W   D3
00001902  41F9 000019F0           1372              LEA     ESTDCLDS, A0            ; Apunta al inicio de ESTDCLDS
00001908  303C 0300               1373              MOVE.W  #TCELDAS, D0            ; Número total de celdas
0000190C  363C 0000               1374              MOVE.W  #0,D3                   ; LO UTILIZAMOS PARA SABER EL INDICE EN EL QUE NOS ENCONTRAMOS
00001910  4241                    1375              CLR.W   D1
00001912  4242                    1376              CLR.W   D2
00001914                          1377              
00001914                          1378  
00001914                          1379  PLOTCLDS:
00001914  1218                    1380              MOVE.B  (A0)+,D1                ; MOVEMOS EL VALOR DE LA CELDA A D1
00001916  B23C 0000               1381              CMP.B   #0,D1
0000191A  6700 0036               1382              BEQ     PLOTVAC                 ; SALTA A DIBUJAR POSICIÓN VACÍA
0000191E  B23C 0001               1383              CMP.B   #1,D1 
00001922  6700 0034               1384              BEQ     PLOTCOL                 ; SALTA A DIBUJAR COLA
00001926  B23C 0002               1385              CMP.B   #2,D1
0000192A  6700 0032               1386              BEQ     PLOTSEG                 ; SALTA A DIBUJAR SEGMENTO
0000192E  B239 000019EA           1387              CMP.B   TRZPLOT,D1
00001934  6700 0016               1388              BEQ     PLOTCBZ                 ; SALTA A DIBUJAR CABEZA
00001938  B23C 0004               1389              CMP.B   #4,D1                 
0000193C  6700 0026               1390              BEQ     PLOTAPPLE               ; SALTA A DIBUJAR MANZANA
00001940                          1391    
00001940                          1392  DONEPLOT            
00001940  5243                    1393              ADDQ    #1,D3                   ; AUMENTAMOS EL INDICE DE CELDA PARA LA SIGUIENTE
00001942  5340                    1394              SUBI.W  #1, D0                  ; Decrementa el contador de celdas
00001944  66CE                    1395              BNE     PLOTCLDS                ; Repite hasta que esten vacías
00001946  4CDF 010F               1396              MOVEM.L (A7)+,D0-D3/A0
0000194A  4E75                    1397              RTS
0000194C                          1398  PLOTCBZ:
0000194C  4EB8 1326               1399              JSR     HEADPLOT
00001950  60EE                    1400              BRA     DONEPLOT
00001952                          1401  
00001952                          1402  PLOTVAC:    
00001952  4EB8 1852               1403              JSR     FONPLOT
00001956  60E8                    1404              BRA     DONEPLOT                ; DIBUJADO HECHO 
00001958                          1405  
00001958                          1406  PLOTCOL:   
00001958  4EB8 14F2               1407              JSR     TAILPLOT 
0000195C  60E2                    1408              BRA     DONEPLOT                ; DIBUJADO HECHO 
0000195E                          1409              
0000195E                          1410  PLOTSEG:    
0000195E  4EB8 1452               1411              JSR     SEGPLOT
00001962  60DC                    1412              BRA     DONEPLOT                ; DIBUJADO HECHO    
00001964                          1413  
00001964                          1414  PLOTAPPLE:
00001964  4EB8 15A2               1415              JSR     APPLEPLOT
00001968  60D6                    1416              BRA     DONEPLOT            
0000196A                          1417  
0000196A                          1418  
0000196A                          1419  
0000196A                          1420  
0000196A                          1421  
0000196A                          1422  
0000196A                          1423  
0000196A                          1424  
0000196A                          1425  
0000196A                          1426  
0000196A                          1427  
0000196A                          1428  
0000196A                          1429  
0000196A                          1430  
0000196A                          1431  
0000196A                          1432  -------------------- end include --------------------
0000196A                          1433  START:
0000196A                          1434                  
0000196A                          1435  ; --- INIZIALIZACIÓN ---------------------------------------------------------
0000196A                          1436  
0000196A  007C 0700               1437              ORI.W   #$0700,SR
0000196E  4EB8 1000               1438              JSR     SYSINIT
00001972  4EB8 1108               1439              JSR     UTLINIT
00001976  4EB8 108C               1440              JSR     KBDINIT
0000197A  4EB8 16A8               1441              JSR     MTZINIT
0000197E  4EB8 123C               1442              JSR     HEADINIT                
00001982  4EB8 13AA               1443              JSR     SEGINIT
00001986  4EB8 1492               1444              JSR     TAILINIT
0000198A  4EB8 1652               1445              JSR     SCOINIT
0000198E  4EB8 1532               1446              JSR     APPLEINIT
00001992                          1447              
00001992                          1448  
00001992                          1449  .LOOP
00001992                          1450  
00001992                          1451  ; --- ACTUALIZAR -------------------------------------------------------------
00001992                          1452  
00001992                          1453  ; LEER DISPOSITIVOS DE ENTRADA
00001992                          1454  
00001992  4E41                    1455              TRAP    #1
00001994                          1456  
00001994                          1457  ; ACTUALIZAR LÓGICA DEL JUEGO
00001994                          1458              
00001994  4EB8 14A4               1459              JSR     TAILUPD
00001998  4EB8 13D8               1460              JSR     SEGUPD
0000199C  4EB8 126A               1461              JSR     HEADUPD
000019A0                          1462              ;JSR     APPLEUPD  
000019A0  4EB8 1890               1463              JSR     MTZUPD
000019A4                          1464              ;JSR     SCOUPD
000019A4                          1465              
000019A4                          1466  ; --- SINCRONIZACIÓN ---------------------------------------------------------
000019A4                          1467              
000019A4  4A39 00001CF8           1468  .WINT       TST.B   (SCRINTCT)
000019AA  67F8                    1469              BEQ     .WINT   
000019AC  4239 00001CF8           1470              CLR.B   (SCRINTCT)         
000019B2                          1471  
000019B2                          1472  
000019B2                          1473  ;---DIBUJAR-------------------------------------------------------------------
000019B2  4EB8 1326               1474               JSR    HEADPLOT
000019B6  4EB8 1452               1475               JSR    SEGPLOT
000019BA  4EB8 14F2               1476               JSR    TAILPLOT
000019BE  4EB8 15A2               1477               JSR    APPLEPLOT
000019C2  4EB8 18FA               1478               JSR    MTZPLOT
000019C6  4EB8 1674               1479               JSR    SCOPLOT
000019CA                          1480              
000019CA  4E40                    1481              TRAP    #0                      ; ACTUALIZA DOBLE BUFFER
000019CC                          1482  
000019CC                          1483  
000019CC  60C4                    1484              BRA     .LOOP
000019CE                          1485  
000019CE  FFFF FFFF               1486              SIMHALT
000019D2                          1487              
000019D2                          1488              INCLUDE 'VARS.X68'
000019D2                          1489  ; ----------------------------------------------------------------------------
000019D2                          1490  ; VARIABLES DEL JUEGO
000019D2                          1491  ; ----------------------------------------------------------------------------
000019D2                          1492  
000019D2                          1493  ; --- VARIABLES DE LA MANZANA ------------------------------------------------
000019D2                          1494  
000019D2                          1495  MNZPOSX     DS.W    1                       ; COORDENADA X DE LA MANZANA
000019D4                          1496  MNZPOSY     DS.W    1                       ; COORDENADA Y DE LA MANZANA
000019D6                          1497  
000019D6                          1498  ; --- VARIABLES DE LA SERPIENTE ----------------------------------------------
000019D6                          1499  
000019D6                          1500  CBZPOSX     DS.W    1                       ; COORDENADA X CABEZA
000019D8                          1501  CBZPOSY     DS.W    1                       ; COORDENADA Y CABEZA
000019DA                          1502  CBZVELX     DS.W    1                       ; VELOCIDAD X CABEZA
000019DC                          1503  CBZVELY     DS.W    1                       ; VELOCIDAD Y CABEZA
000019DE                          1504  COLPOSX     DS.W    1                       ; COORDENADA X COLA
000019E0                          1505  COLPOSY     DS.W    1                       ; COORDENADA Y COLA
000019E2                          1506  SGMPOSX     DS.W    1                       ; COORDENADA X SEGMENTO
000019E4                          1507  SGMPOSY     DS.W    1                       ; COORDENADA Y SEGMENTO
000019E6                          1508  SGMPOSX2    DS.W    1                       ; COORDENADA X SEGMENTO 2
000019E8                          1509  SGMPOSY2    DS.W    1                       ; COORDENADA Y SEGMENTO 2
000019EA                          1510  TRZPLOT     DS.B    1                       ; NÚMERO DE TROZOS A DIBUJAR
000019EB                          1511  
000019EB                          1512  
000019EB                          1513  
000019EB                          1514  ; --- VARIABLES DEL MARCADOR -------------------------------------------------
000019EB                          1515  
000019EC                          1516  JGOPNTS     DS.W    1                       ; PUNTUACIÓN DEL JUEGO
000019EE                          1517  
000019EE                          1518  
000019EE                          1519  
000019EE                          1520  
000019EE                          1521  
000019EE                          1522  
000019EE                          1523  
000019EE                          1524  
000019EE                          1525  
000019EE                          1526  
000019EE                          1527  -------------------- end include --------------------
000019EE                          1528              INCLUDE 'LIB/UTLVARS.X68'
000019EE                          1529  ; =============================================================================
000019EE                          1530  ; UTILITY VARIABLES
000019EE                          1531  ; =============================================================================
000019EE                          1532  
000019EE                          1533  UTLRNDIX    DS.B    1                       ; NEXT INDEX TO RANDOM NUMBER
000019F0                          1534              DS.W    0
000019F0                          1535  -------------------- end include --------------------
000019F0                          1536              INCLUDE 'SYSVARS.X68'
000019F0                          1537  ; ----------------------------------------------------------------------------
000019F0                          1538  ; VARIABLES DEL SISTEMA
000019F0                          1539  ; ----------------------------------------------------------------------------
000019F0                          1540  
000019F0                          1541  ; --- VARIABLES DE LA MATRIZ -------------------------------------------------
000019F0                          1542  
000019F0                          1543  ESTDCLDS    DS.B    TCELDAS                 ; ESTADO DE LAS CELDAS 0=VACÍO  1=COLA   2=SEGMENTO  TRZPLOT=CABEZA  4?=MANZANA    
00001CF0                          1544  ESTDCBZ     DS.B    1                       ; 0= DERECHA, 1=ARRIBA, 2=IZQUIERDA, 3=ABAJO
00001CF1                          1545  
00001CF1                          1546  ; --- VARIABLES DE TECLADO ---------------------------------------------------
00001CF1                          1547  
00001CF1                          1548  KBDVAL      DS.B    1
00001CF2                          1549  KBDEDGE     DS.B    1                       ; KEY EDGE
00001CF4                          1550  LASTKEY     DS.L    1                       
00001CF8                          1551  
00001CF8                          1552  ;--- TIMED INTERRUPT RELATED VARIABLES ---------------------------------------
00001CF8                          1553              
00001CF8                          1554  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER
00001CFA                          1555              DS.W    0
00001CFA                          1556  
00001CFA                          1557  
00001CFA                          1558  
00001CFA                          1559  
00001CFA                          1560  
00001CFA                          1561  
00001CFA                          1562  
00001CFA                          1563  
00001CFA                          1564  
00001CFA                          1565  
00001CFA                          1566  
00001CFA                          1567  
00001CFA                          1568  
00001CFA                          1569  
00001CFA                          1570  -------------------- end include --------------------
00001CFA                          1571      
00001CFA                          1572      
00001CFA                          1573              END    START        

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
APPLEINIT           1532
APPLEPLOT           15A2
APPLEUPD            1564
ARR                 10E2
CBZFCOL             AA00
CBZHEIGH            14
CBZOCPD             1774
CBZPCOL             FF00
CBZPOSX             19D6
CBZPOSY             19D8
CBZVEL              14
CBZVELX             19DA
CBZVELY             19DC
CBZWIDTH            14
CHCKUPDT            157C
CHECK               153E
CHECKCLD            1834
CHKCOL              12DC
CINDMTRZ            173A
CLDFREE             184C
CLNCLDS             16B6
CNVICOOR            17F8
COLFCOL             AA00
COLFND              90EE90
COLHEIGH            A
COLOCPD             17CC
COLPCOL             FF00
COLPOSX             19DE
COLPOSY             19E0
COLWIDTH            A
CONTINU             1102
DER                 10D6
DIVX                1742
DIVY                1756
DONEPLOT            1940
DWN                 10FA
ENDDIVX             1752
ENDDIVY             1766
ENDMULTX            181C
ENDMULTY            182E
ESTDCBZ             1CF0
ESTDCLDS            19F0
FIN                 1320
FINUPD              14EC
FONPLOT             1852
GENPOSMNZ           1620
HEADINIT            123C
HEADPLOT            1326
HEADUPD             126A
IZQ                 10EE
JGOPNTS             19EC
KBDDOWN             28
KBDEDGE             1CF2
KBDINIT             108C
KBDLEFT             25
KBDRIGHT            27
KBDUP               26
KBDUPD              109A
KBDVAL              1CF1
LASTKEY             1CF4
LNGINI              1
MARKMNZ             1556
MAXSGM              1
MCLDVCIA            17A0
MNZFCOL             FF
MNZHEIGH            14
MNZOCPD             17E2
MNZPCOL             AAFF
MNZPOSX             19D2
MNZPOSY             19D4
MNZWIDTH            14
MTZINIT             16A8
MTZPLOT             18FA
MTZUPD              1890
MTZUPD:CLNCLDS      189E
MULTLOOPX           180E
MULTLOOPY           1820
NEWMNZ              1594
NOCOL               1308
NUMCLMNS            20
NUMFILAS            18
OJOFCOL             FFFFFF
OJOHEIGH            A
OJOPCOL             0
OJOWIDTH            A
PANHEIGH            1E0
PANWIDTH            280
PLOTAPPLE           1964
PLOTCBZ             194C
PLOTCLDS            1914
PLOTCOL             1958
PLOTSEG             195E
PLOTVAC             1952
PNTSFCOL            0
PNTSTEXT            65
RSTCLD              178C
SCOINIT             1652
SCOPLOT             1674
SCOPLOT:TXT1        169E
SCOUPD              165A
SCRINIT             1026
SCRINTCT            1CF8
SCRPLOT             1072
SCRTIM              106A
SEGINIT             13AA
SEGPLOT             1452
SEGUPD              13D8
SGMFCOL             AA00
SGMHEIGH            14
SGMOCPD             17B6
SGMPCOL             FF00
SGMPOSX             19E2
SGMPOSX2            19E6
SGMPOSY             19E4
SGMPOSY2            19E8
SGMWIDTH            14
SIGABA              12D4
SIGARR              12BC
SIGDER              12B0
SIGIZQ              12C8
SIZECLDA            14
START               196A
START:LOOP          1992
START:WINT          19A4
SYSINIT             1000
TAILINIT            1492
TAILPLOT            14F2
TAILUPD             14A4
TCELDAS             300
TRZPLOT             19EA
UTLINIT             1108
UTLRAND             111E
UTLRAND:RANDVEC     113C
UTLRNDIX            19EE
